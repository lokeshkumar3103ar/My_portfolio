var e=Object.defineProperty,t=(t,n,i)=>((t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i)(t,"symbol"!=typeof n?n+"":n,i);import{r as n,j as i,a as r,g as s,R as a,c as o,b as l,d as c,F as h,e as d,f as u,h as p,i as m,k as f,l as g,m as v,n as x,o as y,p as _,q as b,s as w,t as M,u as S,v as T,w as E,x as A,y as C,z as R,A as N,B as I,C as P,D as L,I as D,H as k,E as U,G as O,J as F,K as B,L as z,M as j,N as V,O as H,P as G,Q as W,S as X,T as q,U as Y,V as Z,W as $,X as J,Y as K,Z as Q,_ as ee,$ as te,a0 as ne}from"./vendor-B8bTUjau.js";import{g as ie,S as re,m as se,A as ae,u as oe,a as le,b as ce,L as he,d as de}from"./animations-mhXZ36l4.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const ue=n.createContext(),pe=({children:e})=>{const[t,r]=n.useState(!1);n.useEffect((()=>{const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;("dark"===e||!e&&t)&&(r(!0),document.documentElement.classList.add("dark"))}),[]);return i.jsx(ue.Provider,{value:{isDarkMode:t,toggleTheme:()=>{r(!t),t?(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark"))}},children:e})},me={blue:{primary:"#1D4ED8",secondary:"#9333EA",accent:"#F59E0B",name:"Blue-Purple",gradient:"linear-gradient(135deg, #1D4ED8, #9333EA)"}},fe=n.createContext(),ge=({children:e})=>{const[t,r]=n.useState((()=>{const e=localStorage.getItem("colorTheme");return e&&me[e]?e:"blue"}));function s(e){if(!e)return null;e=e.replace(/^#/,"");let t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}}return n.useEffect((()=>{const e=me[t];if(e){document.documentElement.style.setProperty("--color-primary",e.primary),document.documentElement.style.setProperty("--color-secondary",e.secondary),document.documentElement.style.setProperty("--color-accent",e.accent);const n=s(e.primary),i=s(e.secondary);n&&i&&(document.documentElement.style.setProperty("--color-primary-light",`rgba(${n.r}, ${n.g}, ${n.b}, 0.1)`),document.documentElement.style.setProperty("--color-primary-medium",`rgba(${n.r}, ${n.g}, ${n.b}, 0.5)`),document.documentElement.style.setProperty("--color-secondary-light",`rgba(${i.r}, ${i.g}, ${i.b}, 0.1)`),document.documentElement.style.setProperty("--color-secondary-medium",`rgba(${i.r}, ${i.g}, ${i.b}, 0.5)`),document.documentElement.style.setProperty("--gradient-primary",e.gradient)),document.documentElement.style.setProperty("--color-background","#F9FAFB"),document.documentElement.style.setProperty("--color-background-dark","#1F2937"),document.documentElement.style.setProperty("--color-text","#111827"),document.documentElement.style.setProperty("--color-text-dark","#E5E7EB"),localStorage.setItem("colorTheme",t),window.dispatchEvent(new CustomEvent("themechange",{detail:{theme:t,colors:e}}))}}),[t]),i.jsx(fe.Provider,{value:{activeTheme:t,setActiveTheme:r,colorThemes:me,currentColors:me[t]},children:e})};function ve(e,t,n){return Math.max(e,Math.min(t,n))}var xe=class{constructor(){t(this,"isRunning",!1),t(this,"value",0),t(this,"from",0),t(this,"to",0),t(this,"currentTime",0),t(this,"lerp"),t(this,"duration"),t(this,"easing"),t(this,"onUpdate")}advance(e){var t;if(!this.isRunning)return;let n=!1;if(this.duration&&this.easing){this.currentTime+=e;const t=ve(0,this.currentTime/this.duration,1);n=t>=1;const i=n?1:this.easing(t);this.value=this.from+(this.to-this.from)*i}else this.lerp?(this.value=function(e,t,n,i){return function(e,t,n){return(1-n)*e+n*t}(e,t,1-Math.exp(-n*i))}(this.value,this.to,60*this.lerp,e),Math.round(this.value)===this.to&&(this.value=this.to,n=!0)):(this.value=this.to,n=!0);n&&this.stop(),null==(t=this.onUpdate)||t.call(this,this.value,n)}stop(){this.isRunning=!1}fromTo(e,t,{lerp:n,duration:i,easing:r,onStart:s,onUpdate:a}){this.from=this.value=e,this.to=t,this.lerp=n,this.duration=i,this.easing=r,this.currentTime=0,this.isRunning=!0,null==s||s(),this.onUpdate=a}};var ye=class{constructor(e,n,{autoResize:i=!0,debounce:r=250}={}){t(this,"width",0),t(this,"height",0),t(this,"scrollHeight",0),t(this,"scrollWidth",0),t(this,"debouncedResize"),t(this,"wrapperResizeObserver"),t(this,"contentResizeObserver"),t(this,"resize",(()=>{this.onWrapperResize(),this.onContentResize()})),t(this,"onWrapperResize",(()=>{this.wrapper instanceof Window?(this.width=window.innerWidth,this.height=window.innerHeight):(this.width=this.wrapper.clientWidth,this.height=this.wrapper.clientHeight)})),t(this,"onContentResize",(()=>{this.wrapper instanceof Window?(this.scrollHeight=this.content.scrollHeight,this.scrollWidth=this.content.scrollWidth):(this.scrollHeight=this.wrapper.scrollHeight,this.scrollWidth=this.wrapper.scrollWidth)})),this.wrapper=e,this.content=n,i&&(this.debouncedResize=function(e,t){let n;return function(...i){let r=this;clearTimeout(n),n=setTimeout((()=>{n=void 0,e.apply(r,i)}),t)}}(this.resize,r),this.wrapper instanceof Window?window.addEventListener("resize",this.debouncedResize,!1):(this.wrapperResizeObserver=new ResizeObserver(this.debouncedResize),this.wrapperResizeObserver.observe(this.wrapper)),this.contentResizeObserver=new ResizeObserver(this.debouncedResize),this.contentResizeObserver.observe(this.content)),this.resize()}destroy(){var e,t;null==(e=this.wrapperResizeObserver)||e.disconnect(),null==(t=this.contentResizeObserver)||t.disconnect(),this.wrapper===window&&this.debouncedResize&&window.removeEventListener("resize",this.debouncedResize,!1)}get limit(){return{x:this.scrollWidth-this.width,y:this.scrollHeight-this.height}}},_e=class{constructor(){t(this,"events",{})}emit(e,...t){var n;let i=this.events[e]||[];for(let r=0,s=i.length;r<s;r++)null==(n=i[r])||n.call(i,...t)}on(e,t){var n;return(null==(n=this.events[e])?void 0:n.push(t))||(this.events[e]=[t]),()=>{var n;this.events[e]=null==(n=this.events[e])?void 0:n.filter((e=>t!==e))}}off(e,t){var n;this.events[e]=null==(n=this.events[e])?void 0:n.filter((e=>t!==e))}destroy(){this.events={}}},be=100/6,we={passive:!1},Me=class{constructor(e,n={wheelMultiplier:1,touchMultiplier:1}){t(this,"touchStart",{x:0,y:0}),t(this,"lastDelta",{x:0,y:0}),t(this,"window",{width:0,height:0}),t(this,"emitter",new _e),t(this,"onTouchStart",(e=>{const{clientX:t,clientY:n}=e.targetTouches?e.targetTouches[0]:e;this.touchStart.x=t,this.touchStart.y=n,this.lastDelta={x:0,y:0},this.emitter.emit("scroll",{deltaX:0,deltaY:0,event:e})})),t(this,"onTouchMove",(e=>{const{clientX:t,clientY:n}=e.targetTouches?e.targetTouches[0]:e,i=-(t-this.touchStart.x)*this.options.touchMultiplier,r=-(n-this.touchStart.y)*this.options.touchMultiplier;this.touchStart.x=t,this.touchStart.y=n,this.lastDelta={x:i,y:r},this.emitter.emit("scroll",{deltaX:i,deltaY:r,event:e})})),t(this,"onTouchEnd",(e=>{this.emitter.emit("scroll",{deltaX:this.lastDelta.x,deltaY:this.lastDelta.y,event:e})})),t(this,"onWheel",(e=>{let{deltaX:t,deltaY:n,deltaMode:i}=e;t*=1===i?be:2===i?this.window.width:1,n*=1===i?be:2===i?this.window.height:1,t*=this.options.wheelMultiplier,n*=this.options.wheelMultiplier,this.emitter.emit("scroll",{deltaX:t,deltaY:n,event:e})})),t(this,"onWindowResize",(()=>{this.window={width:window.innerWidth,height:window.innerHeight}})),this.element=e,this.options=n,window.addEventListener("resize",this.onWindowResize,!1),this.onWindowResize(),this.element.addEventListener("wheel",this.onWheel,we),this.element.addEventListener("touchstart",this.onTouchStart,we),this.element.addEventListener("touchmove",this.onTouchMove,we),this.element.addEventListener("touchend",this.onTouchEnd,we)}on(e,t){return this.emitter.on(e,t)}destroy(){this.emitter.destroy(),window.removeEventListener("resize",this.onWindowResize,!1),this.element.removeEventListener("wheel",this.onWheel,we),this.element.removeEventListener("touchstart",this.onTouchStart,we),this.element.removeEventListener("touchmove",this.onTouchMove,we),this.element.removeEventListener("touchend",this.onTouchEnd,we)}},Se=e=>Math.min(1,1.001-Math.pow(2,-10*e)),Te=class{constructor({wrapper:e=window,content:n=document.documentElement,eventsTarget:i=e,smoothWheel:r=!0,syncTouch:s=!1,syncTouchLerp:a=.075,touchInertiaExponent:o=1.7,duration:l,easing:c,lerp:h=.1,infinite:d=!1,orientation:u="vertical",gestureOrientation:p="vertical",touchMultiplier:m=1,wheelMultiplier:f=1,autoResize:g=!0,prevent:v,virtualScroll:x,overscroll:y=!0,autoRaf:_=!1,anchors:b=!1,autoToggle:w=!1,allowNestedScroll:M=!1,__experimental__naiveDimensions:S=!1}={}){t(this,"_isScrolling",!1),t(this,"_isStopped",!1),t(this,"_isLocked",!1),t(this,"_preventNextNativeScrollEvent",!1),t(this,"_resetVelocityTimeout",null),t(this,"__rafID",null),t(this,"isTouching"),t(this,"time",0),t(this,"userData",{}),t(this,"lastVelocity",0),t(this,"velocity",0),t(this,"direction",0),t(this,"options"),t(this,"targetScroll"),t(this,"animatedScroll"),t(this,"animate",new xe),t(this,"emitter",new _e),t(this,"dimensions"),t(this,"virtualScroll"),t(this,"onScrollEnd",(e=>{e instanceof CustomEvent||"smooth"!==this.isScrolling&&!1!==this.isScrolling||e.stopPropagation()})),t(this,"dispatchScrollendEvent",(()=>{this.options.wrapper.dispatchEvent(new CustomEvent("scrollend",{bubbles:this.options.wrapper===window,detail:{lenisScrollEnd:!0}}))})),t(this,"onTransitionEnd",(e=>{if(e.propertyName.includes("overflow")){const e=this.isHorizontal?"overflow-x":"overflow-y",t=getComputedStyle(this.rootElement)[e];["hidden","clip"].includes(t)?this.internalStop():this.internalStart()}})),t(this,"onClick",(e=>{const t=e.composedPath().find((e=>{var t,n,i;return e instanceof HTMLAnchorElement&&((null==(t=e.getAttribute("href"))?void 0:t.startsWith("#"))||(null==(n=e.getAttribute("href"))?void 0:n.startsWith("/#"))||(null==(i=e.getAttribute("href"))?void 0:i.startsWith("./#")))}));if(t){const e=t.getAttribute("href");if(e){const t="object"==typeof this.options.anchors&&this.options.anchors?this.options.anchors:void 0;let n=`#${e.split("#")[1]}`;["#","/#","./#","#top","/#top","./#top"].includes(e)&&(n=0),this.scrollTo(n,t)}}})),t(this,"onPointerDown",(e=>{1===e.button&&this.reset()})),t(this,"onVirtualScroll",(e=>{if("function"==typeof this.options.virtualScroll&&!1===this.options.virtualScroll(e))return;const{deltaX:t,deltaY:n,event:i}=e;if(this.emitter.emit("virtual-scroll",{deltaX:t,deltaY:n,event:i}),i.ctrlKey)return;if(i.lenisStopPropagation)return;const r=i.type.includes("touch"),s=i.type.includes("wheel");this.isTouching="touchstart"===i.type||"touchmove"===i.type;const a=0===t&&0===n;if(this.options.syncTouch&&r&&"touchstart"===i.type&&a&&!this.isStopped&&!this.isLocked)return void this.reset();const o="vertical"===this.options.gestureOrientation&&0===n||"horizontal"===this.options.gestureOrientation&&0===t;if(a||o)return;let l=i.composedPath();l=l.slice(0,l.indexOf(this.rootElement));const c=this.options.prevent;if(l.find((e=>{var i,a,o;return e instanceof HTMLElement&&("function"==typeof c&&(null==c?void 0:c(e))||(null==(i=e.hasAttribute)?void 0:i.call(e,"data-lenis-prevent"))||r&&(null==(a=e.hasAttribute)?void 0:a.call(e,"data-lenis-prevent-touch"))||s&&(null==(o=e.hasAttribute)?void 0:o.call(e,"data-lenis-prevent-wheel"))||this.options.allowNestedScroll&&this.checkNestedScroll(e,{deltaX:t,deltaY:n}))})))return;if(this.isStopped||this.isLocked)return void(i.cancelable&&i.preventDefault());if(!(this.options.syncTouch&&r||this.options.smoothWheel&&s))return this.isScrolling="native",this.animate.stop(),void(i.lenisStopPropagation=!0);let h=n;"both"===this.options.gestureOrientation?h=Math.abs(n)>Math.abs(t)?n:t:"horizontal"===this.options.gestureOrientation&&(h=t),(!this.options.overscroll||this.options.infinite||this.options.wrapper!==window&&(this.animatedScroll>0&&this.animatedScroll<this.limit||0===this.animatedScroll&&n>0||this.animatedScroll===this.limit&&n<0))&&(i.lenisStopPropagation=!0),i.cancelable&&i.preventDefault();const d=r&&this.options.syncTouch,u=r&&"touchend"===i.type;u&&(h=Math.sign(this.velocity)*Math.pow(Math.abs(this.velocity),this.options.touchInertiaExponent)),this.scrollTo(this.targetScroll+h,{programmatic:!1,...d?{lerp:u?this.options.syncTouchLerp:1}:{lerp:this.options.lerp,duration:this.options.duration,easing:this.options.easing}})})),t(this,"onNativeScroll",(()=>{if(null!==this._resetVelocityTimeout&&(clearTimeout(this._resetVelocityTimeout),this._resetVelocityTimeout=null),this._preventNextNativeScrollEvent)this._preventNextNativeScrollEvent=!1;else if(!1===this.isScrolling||"native"===this.isScrolling){const e=this.animatedScroll;this.animatedScroll=this.targetScroll=this.actualScroll,this.lastVelocity=this.velocity,this.velocity=this.animatedScroll-e,this.direction=Math.sign(this.animatedScroll-e),this.isStopped||(this.isScrolling="native"),this.emit(),0!==this.velocity&&(this._resetVelocityTimeout=setTimeout((()=>{this.lastVelocity=this.velocity,this.velocity=0,this.isScrolling=!1,this.emit()}),400))}})),t(this,"raf",(e=>{const t=e-(this.time||e);this.time=e,this.animate.advance(.001*t),this.options.autoRaf&&(this.__rafID=requestAnimationFrame(this.raf))})),window.lenisVersion="1.3.8",e&&e!==document.documentElement||(e=window),"number"==typeof l&&"function"!=typeof c?c=Se:"function"==typeof c&&"number"!=typeof l&&(l=1),this.options={wrapper:e,content:n,eventsTarget:i,smoothWheel:r,syncTouch:s,syncTouchLerp:a,touchInertiaExponent:o,duration:l,easing:c,lerp:h,infinite:d,gestureOrientation:p,orientation:u,touchMultiplier:m,wheelMultiplier:f,autoResize:g,prevent:v,virtualScroll:x,overscroll:y,autoRaf:_,anchors:b,autoToggle:w,allowNestedScroll:M,__experimental__naiveDimensions:S},this.dimensions=new ye(e,n,{autoResize:g}),this.updateClassName(),this.targetScroll=this.animatedScroll=this.actualScroll,this.options.wrapper.addEventListener("scroll",this.onNativeScroll,!1),this.options.wrapper.addEventListener("scrollend",this.onScrollEnd,{capture:!0}),this.options.anchors&&this.options.wrapper===window&&this.options.wrapper.addEventListener("click",this.onClick,!1),this.options.wrapper.addEventListener("pointerdown",this.onPointerDown,!1),this.virtualScroll=new Me(i,{touchMultiplier:m,wheelMultiplier:f}),this.virtualScroll.on("scroll",this.onVirtualScroll),this.options.autoToggle&&this.rootElement.addEventListener("transitionend",this.onTransitionEnd,{passive:!0}),this.options.autoRaf&&(this.__rafID=requestAnimationFrame(this.raf))}destroy(){this.emitter.destroy(),this.options.wrapper.removeEventListener("scroll",this.onNativeScroll,!1),this.options.wrapper.removeEventListener("scrollend",this.onScrollEnd,{capture:!0}),this.options.wrapper.removeEventListener("pointerdown",this.onPointerDown,!1),this.options.anchors&&this.options.wrapper===window&&this.options.wrapper.removeEventListener("click",this.onClick,!1),this.virtualScroll.destroy(),this.dimensions.destroy(),this.cleanUpClassName(),this.__rafID&&cancelAnimationFrame(this.__rafID)}on(e,t){return this.emitter.on(e,t)}off(e,t){return this.emitter.off(e,t)}setScroll(e){this.isHorizontal?this.options.wrapper.scrollTo({left:e,behavior:"instant"}):this.options.wrapper.scrollTo({top:e,behavior:"instant"})}resize(){this.dimensions.resize(),this.animatedScroll=this.targetScroll=this.actualScroll,this.emit()}emit(){this.emitter.emit("scroll",this)}reset(){this.isLocked=!1,this.isScrolling=!1,this.animatedScroll=this.targetScroll=this.actualScroll,this.lastVelocity=this.velocity=0,this.animate.stop()}start(){this.isStopped&&(this.options.autoToggle?this.rootElement.style.removeProperty("overflow"):this.internalStart())}internalStart(){this.isStopped&&(this.reset(),this.isStopped=!1,this.emit())}stop(){this.isStopped||(this.options.autoToggle?this.rootElement.style.setProperty("overflow","clip"):this.internalStop())}internalStop(){this.isStopped||(this.reset(),this.isStopped=!0,this.emit())}scrollTo(e,{offset:t=0,immediate:n=!1,lock:i=!1,duration:r=this.options.duration,easing:s=this.options.easing,lerp:a=this.options.lerp,onStart:o,onComplete:l,force:c=!1,programmatic:h=!0,userData:d}={}){if(!this.isStopped&&!this.isLocked||c){if("string"==typeof e&&["top","left","start"].includes(e))e=0;else if("string"==typeof e&&["bottom","right","end"].includes(e))e=this.limit;else{let n;if("string"==typeof e?n=document.querySelector(e):e instanceof HTMLElement&&(null==e?void 0:e.nodeType)&&(n=e),n){if(this.options.wrapper!==window){const e=this.rootElement.getBoundingClientRect();t-=this.isHorizontal?e.left:e.top}const i=n.getBoundingClientRect();e=(this.isHorizontal?i.left:i.top)+this.animatedScroll}}if("number"==typeof e){if(e+=t,e=Math.round(e),this.options.infinite){if(h){this.targetScroll=this.animatedScroll=this.scroll;const t=e-this.animatedScroll;t>this.limit/2?e-=this.limit:t<-this.limit/2&&(e+=this.limit)}}else e=ve(0,e,this.limit);if(e===this.targetScroll)return null==o||o(this),void(null==l||l(this));if(this.userData=d??{},n)return this.animatedScroll=this.targetScroll=e,this.setScroll(this.scroll),this.reset(),this.preventNextNativeScrollEvent(),this.emit(),null==l||l(this),this.userData={},void requestAnimationFrame((()=>{this.dispatchScrollendEvent()}));h||(this.targetScroll=e),"number"==typeof r&&"function"!=typeof s?s=Se:"function"==typeof s&&"number"!=typeof r&&(r=1),this.animate.fromTo(this.animatedScroll,e,{duration:r,easing:s,lerp:a,onStart:()=>{i&&(this.isLocked=!0),this.isScrolling="smooth",null==o||o(this)},onUpdate:(e,t)=>{this.isScrolling="smooth",this.lastVelocity=this.velocity,this.velocity=e-this.animatedScroll,this.direction=Math.sign(this.velocity),this.animatedScroll=e,this.setScroll(this.scroll),h&&(this.targetScroll=e),t||this.emit(),t&&(this.reset(),this.emit(),null==l||l(this),this.userData={},requestAnimationFrame((()=>{this.dispatchScrollendEvent()})),this.preventNextNativeScrollEvent())}})}}}preventNextNativeScrollEvent(){this._preventNextNativeScrollEvent=!0,requestAnimationFrame((()=>{this._preventNextNativeScrollEvent=!1}))}checkNestedScroll(e,{deltaX:t,deltaY:n}){const i=Date.now(),r=e._lenis??(e._lenis={});let s,a,o,l,c,h,d,u;const p=this.options.gestureOrientation;if(i-(r.time??0)>2e3){r.time=Date.now();const t=window.getComputedStyle(e);r.computedStyle=t;const n=t.overflowX,i=t.overflowY;if(s=["auto","overlay","scroll"].includes(n),a=["auto","overlay","scroll"].includes(i),r.hasOverflowX=s,r.hasOverflowY=a,!s&&!a)return!1;if("vertical"===p&&!a)return!1;if("horizontal"===p&&!s)return!1;c=e.scrollWidth,h=e.scrollHeight,d=e.clientWidth,u=e.clientHeight,o=c>d,l=h>u,r.isScrollableX=o,r.isScrollableY=l,r.scrollWidth=c,r.scrollHeight=h,r.clientWidth=d,r.clientHeight=u}else o=r.isScrollableX,l=r.isScrollableY,s=r.hasOverflowX,a=r.hasOverflowY,c=r.scrollWidth,h=r.scrollHeight,d=r.clientWidth,u=r.clientHeight;if(!s&&!a||!o&&!l)return!1;if(!("vertical"!==p||a&&l))return!1;if(!("horizontal"!==p||s&&o))return!1;let m,f,g,v,x,y;if("horizontal"===p)m="x";else if("vertical"===p)m="y";else{0!==t&&s&&o&&(m="x"),0!==n&&a&&l&&(m="y")}if(!m)return!1;if("x"===m)f=e.scrollLeft,g=c-d,v=t,x=s,y=o;else{if("y"!==m)return!1;f=e.scrollTop,g=h-u,v=n,x=a,y=l}return(v>0?f<g:f>0)&&x&&y}get rootElement(){return this.options.wrapper===window?document.documentElement:this.options.wrapper}get limit(){return this.options.__experimental__naiveDimensions?this.isHorizontal?this.rootElement.scrollWidth-this.rootElement.clientWidth:this.rootElement.scrollHeight-this.rootElement.clientHeight:this.dimensions.limit[this.isHorizontal?"x":"y"]}get isHorizontal(){return"horizontal"===this.options.orientation}get actualScroll(){const e=this.options.wrapper;return this.isHorizontal?e.scrollX??e.scrollLeft:e.scrollY??e.scrollTop}get scroll(){return this.options.infinite?(e=this.animatedScroll,t=this.limit,(e%t+t)%t):this.animatedScroll;var e,t}get progress(){return 0===this.limit?1:this.scroll/this.limit}get isScrolling(){return this._isScrolling}set isScrolling(e){this._isScrolling!==e&&(this._isScrolling=e,this.updateClassName())}get isStopped(){return this._isStopped}set isStopped(e){this._isStopped!==e&&(this._isStopped=e,this.updateClassName())}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked!==e&&(this._isLocked=e,this.updateClassName())}get isSmooth(){return"smooth"===this.isScrolling}get className(){let e="lenis";return this.options.autoToggle&&(e+=" lenis-autoToggle"),this.isStopped&&(e+=" lenis-stopped"),this.isLocked&&(e+=" lenis-locked"),this.isScrolling&&(e+=" lenis-scrolling"),"smooth"===this.isScrolling&&(e+=" lenis-smooth"),e}updateClassName(){this.cleanUpClassName(),this.rootElement.className=`${this.rootElement.className} ${this.className}`.trim()}cleanUpClassName(){this.rootElement.className=this.rootElement.className.replace(/lenis(-\w+)?/g,"").trim()}};ie.registerPlugin(re);let Ee=null,Ae=null;function Ce(){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return Re(),null;if(Ee)return Ee;Ee=new Te({duration:1.3,easing:e=>1-Math.pow(1-e,3),smoothWheel:!0,smoothTouch:!1,touchMultiplier:2,syncTouch:!0,gestureOrientation:"vertical"}),Ee.on("scroll",re.update);const e=t=>{null==Ee||Ee.raf(t),Ae=requestAnimationFrame(e)};Ae=requestAnimationFrame(e),re.scrollerProxy(document.documentElement,{scrollTop(e){return arguments.length&&(null==Ee||Ee.scrollTo(e,{immediate:!1})),window.scrollY||document.documentElement.scrollTop},getBoundingClientRect:()=>({top:0,left:0,width:window.innerWidth,height:window.innerHeight})});const t=()=>{re.refresh()};window.addEventListener("resize",t,{passive:!0});const n=e=>{if(!Ee)return;if(e.defaultPrevented)return;const t=e.target;if((e=>{if(!e)return!1;const t=e.tagName;return e.isContentEditable||"INPUT"===t||"TEXTAREA"===t||"SELECT"===t})(t)||(e=>{let t=e,n=0;for(;t&&t!==document.body&&n<5;){const e=window.getComputedStyle(t).overflowY;if(t.scrollHeight>t.clientHeight&&("auto"===e||"scroll"===e))return!0;t=t.parentElement,n++}return!1})(t))return;const n=window.innerHeight,i=Math.max(110,Math.min(230,Math.round(.14*n))),r=Math.round(.85*n),s=Math.max(0,document.documentElement.scrollHeight-n),a=window.scrollY||document.documentElement.scrollTop||0;let o=!0;switch(e.key){case"ArrowDown":Ee.scrollTo(Math.min(a+i,s),{duration:1.05});break;case"ArrowUp":Ee.scrollTo(Math.max(a-i,0),{duration:1.05});break;case"PageDown":Ee.scrollTo(Math.min(a+r,s),{duration:1.05});break;case"PageUp":Ee.scrollTo(Math.max(a-r,0),{duration:1.05});break;case"Home":Ee.scrollTo(0,{duration:1.05});break;case"End":Ee.scrollTo(s,{duration:1.05});break;case" ":e.shiftKey?Ee.scrollTo(Math.max(a-r,0),{duration:1.05}):Ee.scrollTo(Math.min(a+r,s),{duration:1.05});break;default:o=!1}o&&e.preventDefault()};return window.addEventListener("keydown",n,{passive:!1}),Ee._cleanup=()=>{window.removeEventListener("resize",t),window.removeEventListener("keydown",n)},document.documentElement.classList.add("has-scroll-smooth"),Ee}function Re(){var e;document.documentElement.classList.remove("has-scroll-smooth"),Ae&&(cancelAnimationFrame(Ae),Ae=null),Ee&&(null==(e=Ee._cleanup)||e.call(Ee),Ee.destroy(),Ee=null)}function Ne(e,t={}){const n={offset:0,immediate:!1,...t};if(Ee)Ee.scrollTo(e,n);else if("number"==typeof e)window.scrollTo({top:e-(n.offset||0),behavior:"smooth"});else{const t="string"==typeof e?document.querySelector(e):e;if(!t)return;const i=t.getBoundingClientRect().top+window.pageYOffset-(n.offset||0);window.scrollTo({top:i,behavior:"smooth"})}}
/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Ie="179",Pe=0,Le=1,De=2,ke=100,Ue=101,Oe=102,Fe=200,Be=201,ze=202,je=203,Ve=204,He=205,Ge=206,We=207,Xe=208,qe=209,Ye=210,Ze=211,$e=212,Je=213,Ke=214,Qe=0,et=1,tt=2,nt=3,it=4,rt=5,st=6,at=7,ot="attached",lt="detached",ct=300,ht=301,dt=302,ut=303,pt=304,mt=306,ft=1e3,gt=1001,vt=1002,xt=1003,yt=1004,_t=1005,bt=1006,wt=1007,Mt=1008,St=1008,Tt=1009,Et=1010,At=1011,Ct=1012,Rt=1013,Nt=1014,It=1015,Pt=1016,Lt=1017,Dt=1018,kt=1020,Ut=35902,Ot=1021,Ft=1022,Bt=1023,zt=1026,jt=1027,Vt=1028,Ht=1029,Gt=1030,Wt=1031,Xt=1033,qt=33776,Yt=33777,Zt=33778,$t=33779,Jt=35840,Kt=35841,Qt=35842,en=35843,tn=36196,nn=37492,rn=37496,sn=37808,an=37809,on=37810,ln=37811,cn=37812,hn=37813,dn=37814,un=37815,pn=37816,mn=37817,fn=37818,gn=37819,vn=37820,xn=37821,yn=36492,_n=36494,bn=36495,wn=36283,Mn=36284,Sn=36285,Tn=36286,En=2300,An=2301,Cn=2302,Rn=2400,Nn=2401,In=2402,Pn=2500,Ln=2501,Dn="",kn="srgb",Un="srgb-linear",On="linear",Fn="srgb",Bn=7680,zn=512,jn=513,Vn=514,Hn=515,Gn=516,Wn=517,Xn=518,qn=519,Yn=35044,Zn="300 es",$n=2e3,Jn=2001;class Kn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n&&(void 0!==n[e]&&-1!==n[e].indexOf(t))}removeEventListener(e,t){const n=this._listeners;if(void 0===n)return;const i=n[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const n=t[e.type];if(void 0!==n){e.target=this;const t=n.slice(0);for(let n=0,i=t.length;n<i;n++)t[n].call(this,e);e.target=null}}}const Qn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let ei=1234567;const ti=Math.PI/180,ni=180/Math.PI;function ii(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Qn[255&e]+Qn[e>>8&255]+Qn[e>>16&255]+Qn[e>>24&255]+"-"+Qn[255&t]+Qn[t>>8&255]+"-"+Qn[t>>16&15|64]+Qn[t>>24&255]+"-"+Qn[63&n|128]+Qn[n>>8&255]+"-"+Qn[n>>16&255]+Qn[n>>24&255]+Qn[255&i]+Qn[i>>8&255]+Qn[i>>16&255]+Qn[i>>24&255]).toLowerCase()}function ri(e,t,n){return Math.max(t,Math.min(n,e))}function si(e,t){return(e%t+t)%t}function ai(e,t,n){return(1-n)*e+n*t}function oi(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function li(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const ci={DEG2RAD:ti,RAD2DEG:ni,generateUUID:ii,clamp:ri,euclideanModulo:si,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:ai,damp:function(e,t,n,i){return ai(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(si(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(ei=e);let t=ei+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*ti},radToDeg:function(e){return e*ni},isPowerOfTwo:function(e){return!(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),c=s((t+i)/2),h=a((t+i)/2),d=s((t-i)/2),u=a((t-i)/2),p=s((i-t)/2),m=a((i-t)/2);switch(r){case"XYX":e.set(o*h,l*d,l*u,o*c);break;case"YZY":e.set(l*u,o*h,l*d,o*c);break;case"ZXZ":e.set(l*d,l*u,o*h,o*c);break;case"XZX":e.set(o*h,l*m,l*p,o*c);break;case"YXY":e.set(l*p,o*h,l*m,o*c);break;case"ZYZ":e.set(l*m,l*p,o*h,o*c)}},normalize:li,denormalize:oi};class hi{constructor(e=0,t=0){hi.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=ri(this.x,e.x,t.x),this.y=ri(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=ri(this.x,e,t),this.y=ri(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ri(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ri(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class di{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,s,a){let o=n[i+0],l=n[i+1],c=n[i+2],h=n[i+3];const d=r[s+0],u=r[s+1],p=r[s+2],m=r[s+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===a)return e[t+0]=d,e[t+1]=u,e[t+2]=p,void(e[t+3]=m);if(h!==m||o!==d||l!==u||c!==p){let e=1-a;const t=o*d+l*u+c*p+h*m,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,t*n);e=Math.sin(e*s)/r,a=Math.sin(a*s)/r}const r=a*n;if(o=o*e+d*r,l=l*e+u*r,c=c*e+p*r,h=h*e+m*r,e===1-a){const e=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=e,l*=e,c*=e,h*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,i,r,s){const a=n[i],o=n[i+1],l=n[i+2],c=n[i+3],h=r[s],d=r[s+1],u=r[s+2],p=r[s+3];return e[t]=a*p+c*h+o*u-l*d,e[t+1]=o*p+c*d+l*h-a*u,e[t+2]=l*p+c*u+a*d-o*h,e[t+3]=c*p-a*h-o*d-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,r=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(i/2),h=a(r/2),d=o(n/2),u=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"YXZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"ZXY":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"ZYX":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"YZX":this._x=d*c*h+l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h-d*u*p;break;case"XZY":this._x=d*c*h-l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h+d*u*p}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],h=t[10],d=n+a+h;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(s-i)*e}else if(n>a&&n>h){const e=2*Math.sqrt(1+n-a-h);this._w=(c-o)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(r+l)/e}else if(a>h){const e=2*Math.sqrt(1+a-n-h);this._w=(r-l)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+h-n-a);this._w=(s-i)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ri(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+s*a+i*l-r*o,this._y=i*c+s*o+r*a-n*l,this._z=r*c+s*l+n*o-i*a,this._w=s*c-n*a-i*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,s=this._w;let a=s*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=s*h+this._w*d,this._x=n*h+this._x*d,this._y=i*h+this._y*d,this._z=r*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ui{constructor(e=0,t=0,n=0){ui.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(mi.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(mi.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=2*(s*i-a*n),c=2*(a*t-r*i),h=2*(r*n-s*t);return this.x=t+o*l+s*h-a*c,this.y=n+o*c+a*l-r*h,this.z=i+o*h+r*c-s*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=ri(this.x,e.x,t.x),this.y=ri(this.y,e.y,t.y),this.z=ri(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=ri(this.x,e,t),this.y=ri(this.y,e,t),this.z=ri(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ri(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return pi.copy(this).projectOnVector(e),this.sub(pi)}reflect(e){return this.sub(pi.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ri(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const pi=new ui,mi=new di;class fi{constructor(e,t,n,i,r,s,a,o,l){fi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,a,o,l)}set(e,t,n,i,r,s,a,o,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=a,c[3]=t,c[4]=r,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],h=n[7],d=n[2],u=n[5],p=n[8],m=i[0],f=i[3],g=i[6],v=i[1],x=i[4],y=i[7],_=i[2],b=i[5],w=i[8];return r[0]=s*m+a*v+o*_,r[3]=s*f+a*x+o*b,r[6]=s*g+a*y+o*w,r[1]=l*m+c*v+h*_,r[4]=l*f+c*x+h*b,r[7]=l*g+c*y+h*w,r[2]=d*m+u*v+p*_,r[5]=d*f+u*x+p*b,r[8]=d*g+u*y+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-n*r*c+n*a*o+i*r*l-i*s*o}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=c*s-a*l,d=a*o-c*r,u=l*r-s*o,p=t*h+n*d+i*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(i*l-c*n)*m,e[2]=(a*n-i*s)*m,e[3]=d*m,e[4]=(c*t-i*o)*m,e[5]=(i*r-a*t)*m,e[6]=u*m,e[7]=(n*o-l*t)*m,e[8]=(s*t-n*r)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+e,-i*l,i*o,-i*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(gi.makeScale(e,t)),this}rotate(e){return this.premultiply(gi.makeRotation(-e)),this}translate(e,t){return this.premultiply(gi.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const gi=new fi;function vi(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const xi={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function yi(e,t){return new xi[e](t)}function _i(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function bi(){const e=_i("canvas");return e.style.display="block",e}const wi={};function Mi(e){e in wi||(wi[e]=!0)}const Si=(new fi).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Ti=(new fi).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Ei(){const e={enabled:!0,workingColorSpace:Un,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===Fn&&(e.r=Ci(e.r),e.g=Ci(e.g),e.b=Ci(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Fn&&(e.r=Ri(e.r),e.g=Ri(e.g),e.b=Ri(e.b)),e):e},workingToColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},colorSpaceToWorking:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Dn?On:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(t,n){return Mi("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),e.workingToColorSpace(t,n)},toWorkingColorSpace:function(t,n){return Mi("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),e.colorSpaceToWorking(t,n)}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],i=[.3127,.329];return e.define({[Un]:{primaries:t,whitePoint:i,transfer:On,toXYZ:Si,fromXYZ:Ti,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:kn},outputColorSpaceConfig:{drawingBufferColorSpace:kn}},[kn]:{primaries:t,whitePoint:i,transfer:Fn,toXYZ:Si,fromXYZ:Ti,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:kn}}}),e}const Ai=Ei();function Ci(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ri(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let Ni;class Ii{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{void 0===Ni&&(Ni=_i("canvas")),Ni.width=e.width,Ni.height=e.height;const t=Ni.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),n=Ni}return n.toDataURL(t)}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=_i("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*Ci(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Ci(t[e]/255)):t[e]=Ci(t[e]);return{data:t,width:e.width,height:e.height}}return e}}let Pi=0;class Li{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Pi++}),this.uuid=ii(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):null!==t?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(Di(i[t].image)):e.push(Di(i[t]))}else e=Di(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function Di(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Ii.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:{}}let ki=0;const Ui=new ui;class Oi extends Kn{constructor(e=Oi.DEFAULT_IMAGE,t=Oi.DEFAULT_MAPPING,n=1001,i=1001,r=1006,s=1008,a=1023,o=1009,l=Oi.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ki++}),this.uuid=ii(),this.name="",this.source=new Li(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new hi(0,0),this.repeat=new hi(1,1),this.center=new hi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new fi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Ui).x}get height(){return this.source.getSize(Ui).y}get depth(){return this.source.getSize(Ui).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(void 0===n)continue;const i=this[t];void 0!==i&&(i&&n&&i.isVector2&&n.isVector2||i&&n&&i.isVector3&&n.isVector3||i&&n&&i.isMatrix3&&n.isMatrix3?i.copy(n):this[t]=n)}}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ct)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ft:e.x=e.x-Math.floor(e.x);break;case gt:e.x=e.x<0?0:1;break;case vt:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ft:e.y=e.y-Math.floor(e.y);break;case gt:e.y=e.y<0?0:1;break;case vt:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}Oi.DEFAULT_IMAGE=null,Oi.DEFAULT_MAPPING=ct,Oi.DEFAULT_ANISOTROPY=1;class Fi{constructor(e=0,t=0,n=0,i=1){Fi.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const s=.01,a=.1,o=e.elements,l=o[0],c=o[4],h=o[8],d=o[1],u=o[5],p=o[9],m=o[2],f=o[6],g=o[10];if(Math.abs(c-d)<s&&Math.abs(h-m)<s&&Math.abs(p-f)<s){if(Math.abs(c+d)<a&&Math.abs(h+m)<a&&Math.abs(p+f)<a&&Math.abs(l+u+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(u+1)/2,v=(g+1)/2,x=(c+d)/4,y=(h+m)/4,_=(p+f)/4;return e>o&&e>v?e<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=x/n,r=y/n):o>v?o<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=x/i,r=_/i):v<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=y/r,i=_/r),this.set(n,i,r,t),this}let v=Math.sqrt((f-p)*(f-p)+(h-m)*(h-m)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(f-p)/v,this.y=(h-m)/v,this.z=(d-c)/v,this.w=Math.acos((l+u+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=ri(this.x,e.x,t.x),this.y=ri(this.y,e.y,t.y),this.z=ri(this.z,e.z,t.z),this.w=ri(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=ri(this.x,e,t),this.y=ri(this.y,e,t),this.z=ri(this.z,e,t),this.w=ri(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ri(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Bi extends Kn{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:bt,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new Fi(0,0,e,t),this.scissorTest=!1,this.viewport=new Fi(0,0,e,t);const i={width:e,height:t,depth:n.depth},r=new Oi(i);this.textures=[];const s=n.count;for(let a=0;a<s;a++)this.textures[a]=r.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:bt,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==e.mapping&&(t.mapping=e.mapping),void 0!==e.wrapS&&(t.wrapS=e.wrapS),void 0!==e.wrapT&&(t.wrapT=e.wrapT),void 0!==e.wrapR&&(t.wrapR=e.wrapR),void 0!==e.magFilter&&(t.magFilter=e.magFilter),void 0!==e.minFilter&&(t.minFilter=e.minFilter),void 0!==e.format&&(t.format=e.format),void 0!==e.type&&(t.type=e.type),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.colorSpace&&(t.colorSpace=e.colorSpace),void 0!==e.flipY&&(t.flipY=e.flipY),void 0!==e.generateMipmaps&&(t.generateMipmaps=e.generateMipmaps),void 0!==e.internalFormat&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++){this.textures[n].setValues(t)}}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const n=Object.assign({},e.textures[t].image);this.textures[t].source=new Li(n)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class zi extends Bi{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class ji extends Oi{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=xt,this.minFilter=xt,this.wrapR=gt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Vi extends Oi{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=xt,this.minFilter=xt,this.wrapR=gt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Hi{constructor(e=new ui(1/0,1/0,1/0),t=new ui(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Wi.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Wi.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Wi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,Wi):Wi.fromBufferAttribute(i,t),Wi.applyMatrix4(e.matrixWorld),this.expandByPoint(Wi);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Xi.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Xi.copy(n.boundingBox)),Xi.applyMatrix4(e.matrixWorld),this.union(Xi)}const i=e.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Wi),Wi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Qi),er.subVectors(this.max,Qi),qi.subVectors(e.a,Qi),Yi.subVectors(e.b,Qi),Zi.subVectors(e.c,Qi),$i.subVectors(Yi,qi),Ji.subVectors(Zi,Yi),Ki.subVectors(qi,Zi);let t=[0,-$i.z,$i.y,0,-Ji.z,Ji.y,0,-Ki.z,Ki.y,$i.z,0,-$i.x,Ji.z,0,-Ji.x,Ki.z,0,-Ki.x,-$i.y,$i.x,0,-Ji.y,Ji.x,0,-Ki.y,Ki.x,0];return!!ir(t,qi,Yi,Zi,er)&&(t=[1,0,0,0,1,0,0,0,1],!!ir(t,qi,Yi,Zi,er)&&(tr.crossVectors($i,Ji),t=[tr.x,tr.y,tr.z],ir(t,qi,Yi,Zi,er)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Wi).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Wi).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Gi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Gi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Gi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Gi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Gi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Gi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Gi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Gi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Gi)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Gi=[new ui,new ui,new ui,new ui,new ui,new ui,new ui,new ui],Wi=new ui,Xi=new Hi,qi=new ui,Yi=new ui,Zi=new ui,$i=new ui,Ji=new ui,Ki=new ui,Qi=new ui,er=new ui,tr=new ui,nr=new ui;function ir(e,t,n,i,r){for(let s=0,a=e.length-3;s<=a;s+=3){nr.fromArray(e,s);const a=r.x*Math.abs(nr.x)+r.y*Math.abs(nr.y)+r.z*Math.abs(nr.z),o=t.dot(nr),l=n.dot(nr),c=i.dot(nr);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const rr=new Hi,sr=new ui,ar=new ui;class or{constructor(e=new ui,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):rr.setFromPoints(e).getCenter(n);let i=0;for(let r=0,s=e.length;r<s;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;sr.subVectors(e,this.center);const t=sr.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(sr,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(ar.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(sr.copy(e.center).add(ar)),this.expandByPoint(sr.copy(e.center).sub(ar))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const lr=new ui,cr=new ui,hr=new ui,dr=new ui,ur=new ui,pr=new ui,mr=new ui;class fr{constructor(e=new ui,t=new ui(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,lr)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=lr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(lr.copy(this.origin).addScaledVector(this.direction,t),lr.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){cr.copy(e).add(t).multiplyScalar(.5),hr.copy(t).sub(e).normalize(),dr.copy(this.origin).sub(cr);const r=.5*e.distanceTo(t),s=-this.direction.dot(hr),a=dr.dot(this.direction),o=-dr.dot(hr),l=dr.lengthSq(),c=Math.abs(1-s*s);let h,d,u,p;if(c>0)if(h=s*o-a,d=s*a-o,p=r*c,h>=0)if(d>=-p)if(d<=p){const e=1/c;h*=e,d*=e,u=h*(h+s*d+2*a)+d*(s*h+d+2*o)+l}else d=r,h=Math.max(0,-(s*d+a)),u=-h*h+d*(d+2*o)+l;else d=-r,h=Math.max(0,-(s*d+a)),u=-h*h+d*(d+2*o)+l;else d<=-p?(h=Math.max(0,-(-s*r+a)),d=h>0?-r:Math.min(Math.max(-r,-o),r),u=-h*h+d*(d+2*o)+l):d<=p?(h=0,d=Math.min(Math.max(-r,-o),r),u=d*(d+2*o)+l):(h=Math.max(0,-(s*r+a)),d=h>0?r:Math.min(Math.max(-r,-o),r),u=-h*h+d*(d+2*o)+l);else d=s>0?-r:r,h=Math.max(0,-(s*d+a)),u=-h*h+d*(d+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(cr).addScaledVector(hr,d),u}intersectSphere(e,t){lr.subVectors(e.center,this.origin);const n=lr.dot(this.direction),i=lr.dot(lr)-n*n,r=e.radius*e.radius;if(i>r)return null;const s=Math.sqrt(r-i),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return!(e.radius<0)&&this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,i=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,i=(e.min.x-d.x)*l),c>=0?(r=(e.min.y-d.y)*c,s=(e.max.y-d.y)*c):(r=(e.max.y-d.y)*c,s=(e.min.y-d.y)*c),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),h>=0?(a=(e.min.z-d.z)*h,o=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,o=(e.min.z-d.z)*h),n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,lr)}intersectTriangle(e,t,n,i,r){ur.subVectors(t,e),pr.subVectors(n,e),mr.crossVectors(ur,pr);let s,a=this.direction.dot(mr);if(a>0){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}dr.subVectors(this.origin,e);const o=s*this.direction.dot(pr.crossVectors(dr,pr));if(o<0)return null;const l=s*this.direction.dot(ur.cross(dr));if(l<0)return null;if(o+l>a)return null;const c=-s*dr.dot(mr);return c<0?null:this.at(c/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class gr{constructor(e,t,n,i,r,s,a,o,l,c,h,d,u,p,m,f){gr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,a,o,l,c,h,d,u,p,m,f)}set(e,t,n,i,r,s,a,o,l,c,h,d,u,p,m,f){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=d,g[3]=u,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new gr).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/vr.setFromMatrixColumn(e,0).length(),r=1/vr.setFromMatrixColumn(e,1).length(),s=1/vr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){const e=s*c,n=s*h,i=a*c,r=a*h;t[0]=o*c,t[4]=-o*h,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*o,t[2]=r-e*l,t[6]=i+n*l,t[10]=s*o}else if("YXZ"===e.order){const e=o*c,n=o*h,i=l*c,r=l*h;t[0]=e+r*a,t[4]=i*a-n,t[8]=s*l,t[1]=s*h,t[5]=s*c,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=s*o}else if("ZXY"===e.order){const e=o*c,n=o*h,i=l*c,r=l*h;t[0]=e-r*a,t[4]=-s*h,t[8]=i+n*a,t[1]=n+i*a,t[5]=s*c,t[9]=r-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){const e=s*c,n=s*h,i=a*c,r=a*h;t[0]=o*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=o*h,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){const e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=r-e*h,t[8]=i*h+n,t[1]=h,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*h+i,t[10]=e-r*h}else if("XZY"===e.order){const e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=-h,t[8]=l*c,t[1]=e*h+r,t[5]=s*c,t[9]=n*h-i,t[2]=i*h-n,t[6]=a*c,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(yr,e,_r)}lookAt(e,t,n){const i=this.elements;return Mr.subVectors(e,t),0===Mr.lengthSq()&&(Mr.z=1),Mr.normalize(),br.crossVectors(n,Mr),0===br.lengthSq()&&(1===Math.abs(n.z)?Mr.x+=1e-4:Mr.z+=1e-4,Mr.normalize(),br.crossVectors(n,Mr)),br.normalize(),wr.crossVectors(Mr,br),i[0]=br.x,i[4]=wr.x,i[8]=Mr.x,i[1]=br.y,i[5]=wr.y,i[9]=Mr.y,i[2]=br.z,i[6]=wr.z,i[10]=Mr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],h=n[5],d=n[9],u=n[13],p=n[2],m=n[6],f=n[10],g=n[14],v=n[3],x=n[7],y=n[11],_=n[15],b=i[0],w=i[4],M=i[8],S=i[12],T=i[1],E=i[5],A=i[9],C=i[13],R=i[2],N=i[6],I=i[10],P=i[14],L=i[3],D=i[7],k=i[11],U=i[15];return r[0]=s*b+a*T+o*R+l*L,r[4]=s*w+a*E+o*N+l*D,r[8]=s*M+a*A+o*I+l*k,r[12]=s*S+a*C+o*P+l*U,r[1]=c*b+h*T+d*R+u*L,r[5]=c*w+h*E+d*N+u*D,r[9]=c*M+h*A+d*I+u*k,r[13]=c*S+h*C+d*P+u*U,r[2]=p*b+m*T+f*R+g*L,r[6]=p*w+m*E+f*N+g*D,r[10]=p*M+m*A+f*I+g*k,r[14]=p*S+m*C+f*P+g*U,r[3]=v*b+x*T+y*R+_*L,r[7]=v*w+x*E+y*N+_*D,r[11]=v*M+x*A+y*I+_*k,r[15]=v*S+x*C+y*P+_*U,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],h=e[6],d=e[10],u=e[14];return e[3]*(+r*o*h-i*l*h-r*a*d+n*l*d+i*a*u-n*o*u)+e[7]*(+t*o*u-t*l*d+r*s*d-i*s*u+i*l*c-r*o*c)+e[11]*(+t*l*h-t*a*u-r*s*h+n*s*u+r*a*c-n*l*c)+e[15]*(-i*a*c-t*o*h+t*a*d+i*s*h-n*s*d+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=e[9],d=e[10],u=e[11],p=e[12],m=e[13],f=e[14],g=e[15],v=h*f*l-m*d*l+m*o*u-a*f*u-h*o*g+a*d*g,x=p*d*l-c*f*l-p*o*u+s*f*u+c*o*g-s*d*g,y=c*m*l-p*h*l+p*a*u-s*m*u-c*a*g+s*h*g,_=p*h*o-c*m*o-p*a*d+s*m*d+c*a*f-s*h*f,b=t*v+n*x+i*y+r*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return e[0]=v*w,e[1]=(m*d*r-h*f*r-m*i*u+n*f*u+h*i*g-n*d*g)*w,e[2]=(a*f*r-m*o*r+m*i*l-n*f*l-a*i*g+n*o*g)*w,e[3]=(h*o*r-a*d*r-h*i*l+n*d*l+a*i*u-n*o*u)*w,e[4]=x*w,e[5]=(c*f*r-p*d*r+p*i*u-t*f*u-c*i*g+t*d*g)*w,e[6]=(p*o*r-s*f*r-p*i*l+t*f*l+s*i*g-t*o*g)*w,e[7]=(s*d*r-c*o*r+c*i*l-t*d*l-s*i*u+t*o*u)*w,e[8]=y*w,e[9]=(p*h*r-c*m*r-p*n*u+t*m*u+c*n*g-t*h*g)*w,e[10]=(s*m*r-p*a*r+p*n*l-t*m*l-s*n*g+t*a*g)*w,e[11]=(c*a*r-s*h*r-c*n*l+t*h*l+s*n*u-t*a*u)*w,e[12]=_*w,e[13]=(c*m*i-p*h*i+p*n*d-t*m*d-c*n*f+t*h*f)*w,e[14]=(p*a*i-s*m*i-p*n*o+t*m*o+s*n*f-t*a*f)*w,e[15]=(s*h*i-c*a*i+c*n*o-t*h*o-s*n*d+t*a*d)*w,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,a=e.y,o=e.z,l=r*s,c=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,c*a+n,c*o-i*s,0,l*o-i*a,c*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,s=t._y,a=t._z,o=t._w,l=r+r,c=s+s,h=a+a,d=r*l,u=r*c,p=r*h,m=s*c,f=s*h,g=a*h,v=o*l,x=o*c,y=o*h,_=n.x,b=n.y,w=n.z;return i[0]=(1-(m+g))*_,i[1]=(u+y)*_,i[2]=(p-x)*_,i[3]=0,i[4]=(u-y)*b,i[5]=(1-(d+g))*b,i[6]=(f+v)*b,i[7]=0,i[8]=(p+x)*w,i[9]=(f-v)*w,i[10]=(1-(d+m))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=vr.set(i[0],i[1],i[2]).length();const s=vr.set(i[4],i[5],i[6]).length(),a=vr.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],xr.copy(this);const o=1/r,l=1/s,c=1/a;return xr.elements[0]*=o,xr.elements[1]*=o,xr.elements[2]*=o,xr.elements[4]*=l,xr.elements[5]*=l,xr.elements[6]*=l,xr.elements[8]*=c,xr.elements[9]*=c,xr.elements[10]*=c,t.setFromRotationMatrix(xr),n.x=r,n.y=s,n.z=a,this}makePerspective(e,t,n,i,r,s,a=2e3,o=!1){const l=this.elements,c=2*r/(t-e),h=2*r/(n-i),d=(t+e)/(t-e),u=(n+i)/(n-i);let p,m;if(o)p=r/(s-r),m=s*r/(s-r);else if(a===$n)p=-(s+r)/(s-r),m=-2*s*r/(s-r);else{if(a!==Jn)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);p=-s/(s-r),m=-s*r/(s-r)}return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=h,l[9]=u,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,i,r,s,a=2e3,o=!1){const l=this.elements,c=2/(t-e),h=2/(n-i),d=-(t+e)/(t-e),u=-(n+i)/(n-i);let p,m;if(o)p=1/(s-r),m=s/(s-r);else if(a===$n)p=-2/(s-r),m=-(s+r)/(s-r);else{if(a!==Jn)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=-1/(s-r),m=-r/(s-r)}return l[0]=c,l[4]=0,l[8]=0,l[12]=d,l[1]=0,l[5]=h,l[9]=0,l[13]=u,l[2]=0,l[6]=0,l[10]=p,l[14]=m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const vr=new ui,xr=new gr,yr=new ui(0,0,0),_r=new ui(1,1,1),br=new ui,wr=new ui,Mr=new ui,Sr=new gr,Tr=new di;class Er{constructor(e=0,t=0,n=0,i=Er.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],c=i[9],h=i[2],d=i[6],u=i[10];switch(t){case"XYZ":this._y=Math.asin(ri(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,u),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ri(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,u),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(ri(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,u),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-ri(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,u),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ri(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,u));break;case"XZY":this._z=Math.asin(-ri(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,u),this._y=0)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Sr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Sr,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Tr.setFromEuler(this),this.setFromQuaternion(Tr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Er.DEFAULT_ORDER="XYZ";class Ar{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let Cr=0;const Rr=new ui,Nr=new di,Ir=new gr,Pr=new ui,Lr=new ui,Dr=new ui,kr=new di,Ur=new ui(1,0,0),Or=new ui(0,1,0),Fr=new ui(0,0,1),Br={type:"added"},zr={type:"removed"},jr={type:"childadded",child:null},Vr={type:"childremoved",child:null};class Hr extends Kn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Cr++}),this.uuid=ii(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Hr.DEFAULT_UP.clone();const e=new ui,t=new Er,n=new di,i=new ui(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new gr},normalMatrix:{value:new fi}}),this.matrix=new gr,this.matrixWorld=new gr,this.matrixAutoUpdate=Hr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Hr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ar,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Nr.setFromAxisAngle(e,t),this.quaternion.multiply(Nr),this}rotateOnWorldAxis(e,t){return Nr.setFromAxisAngle(e,t),this.quaternion.premultiply(Nr),this}rotateX(e){return this.rotateOnAxis(Ur,e)}rotateY(e){return this.rotateOnAxis(Or,e)}rotateZ(e){return this.rotateOnAxis(Fr,e)}translateOnAxis(e,t){return Rr.copy(e).applyQuaternion(this.quaternion),this.position.add(Rr.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ur,e)}translateY(e){return this.translateOnAxis(Or,e)}translateZ(e){return this.translateOnAxis(Fr,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ir.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Pr.copy(e):Pr.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Lr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ir.lookAt(Lr,Pr,this.up):Ir.lookAt(Pr,Lr,this.up),this.quaternion.setFromRotationMatrix(Ir),i&&(Ir.extractRotation(i.matrixWorld),Nr.setFromRotationMatrix(Ir),this.quaternion.premultiply(Nr.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this||e&&e.isObject3D&&(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Br),jr.child=e,this.dispatchEvent(jr),jr.child=null),this}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(zr),Vr.child=e,this.dispatchEvent(Vr),Vr.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ir.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Ir.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ir),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Br),jr.child=e,this.dispatchEvent(jr),jr.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Lr,e,Dr),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Lr,kr,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){t[n].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map((e=>({...e,boundingBox:e.boundingBox?e.boundingBox.toJSON():void 0,boundingSphere:e.boundingSphere?e.boundingSphere.toJSON():void 0}))),i.instanceInfo=this._instanceInfo.map((e=>({...e}))),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(i.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(i.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=s(e.geometries),i=s(e.materials),r=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),c=s(e.animations),h=s(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),h.length>0&&(n.nodes=h)}return n.object=i,n;function s(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}Hr.DEFAULT_UP=new ui(0,1,0),Hr.DEFAULT_MATRIX_AUTO_UPDATE=!0,Hr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Gr=new ui,Wr=new ui,Xr=new ui,qr=new ui,Yr=new ui,Zr=new ui,$r=new ui,Jr=new ui,Kr=new ui,Qr=new ui,es=new Fi,ts=new Fi,ns=new Fi;class is{constructor(e=new ui,t=new ui,n=new ui){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Gr.subVectors(e,t),i.cross(Gr);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Gr.subVectors(i,t),Wr.subVectors(n,t),Xr.subVectors(e,t);const s=Gr.dot(Gr),a=Gr.dot(Wr),o=Gr.dot(Xr),l=Wr.dot(Wr),c=Wr.dot(Xr),h=s*l-a*a;if(0===h)return r.set(0,0,0),null;const d=1/h,u=(l*o-a*c)*d,p=(s*c-a*o)*d;return r.set(1-u-p,p,u)}static containsPoint(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,qr)&&(qr.x>=0&&qr.y>=0&&qr.x+qr.y<=1)}static getInterpolation(e,t,n,i,r,s,a,o){return null===this.getBarycoord(e,t,n,i,qr)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,qr.x),o.addScaledVector(s,qr.y),o.addScaledVector(a,qr.z),o)}static getInterpolatedAttribute(e,t,n,i,r,s){return es.setScalar(0),ts.setScalar(0),ns.setScalar(0),es.fromBufferAttribute(e,t),ts.fromBufferAttribute(e,n),ns.fromBufferAttribute(e,i),s.setScalar(0),s.addScaledVector(es,r.x),s.addScaledVector(ts,r.y),s.addScaledVector(ns,r.z),s}static isFrontFacing(e,t,n,i){return Gr.subVectors(n,t),Wr.subVectors(e,t),Gr.cross(Wr).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Gr.subVectors(this.c,this.b),Wr.subVectors(this.a,this.b),.5*Gr.cross(Wr).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return is.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return is.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return is.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return is.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return is.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let s,a;Yr.subVectors(i,n),Zr.subVectors(r,n),Jr.subVectors(e,n);const o=Yr.dot(Jr),l=Zr.dot(Jr);if(o<=0&&l<=0)return t.copy(n);Kr.subVectors(e,i);const c=Yr.dot(Kr),h=Zr.dot(Kr);if(c>=0&&h<=c)return t.copy(i);const d=o*h-c*l;if(d<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(n).addScaledVector(Yr,s);Qr.subVectors(e,r);const u=Yr.dot(Qr),p=Zr.dot(Qr);if(p>=0&&u<=p)return t.copy(r);const m=u*l-o*p;if(m<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(n).addScaledVector(Zr,a);const f=c*p-u*h;if(f<=0&&h-c>=0&&u-p>=0)return $r.subVectors(r,i),a=(h-c)/(h-c+(u-p)),t.copy(i).addScaledVector($r,a);const g=1/(f+m+d);return s=m*g,a=d*g,t.copy(n).addScaledVector(Yr,s).addScaledVector(Zr,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const rs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ss={h:0,s:0,l:0},as={h:0,s:0,l:0};function os(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class ls{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=kn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Ai.colorSpaceToWorking(this,t),this}setRGB(e,t,n,i=Ai.workingColorSpace){return this.r=e,this.g=t,this.b=n,Ai.colorSpaceToWorking(this,i),this}setHSL(e,t,n,i=Ai.workingColorSpace){if(e=si(e,1),t=ri(t,0,1),n=ri(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=os(r,i,e+1/3),this.g=os(r,i,e),this.b=os(r,i,e-1/3)}return Ai.colorSpaceToWorking(this,i),this}setStyle(e,t=kn){function n(e){void 0!==e&&parseFloat(e)}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let e;const r=i[1],s=i[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(e[4]),this.setRGB(Math.min(255,parseInt(e[1],10))/255,Math.min(255,parseInt(e[2],10))/255,Math.min(255,parseInt(e[3],10))/255,t);if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(e[4]),this.setRGB(Math.min(100,parseInt(e[1],10))/100,Math.min(100,parseInt(e[2],10))/100,Math.min(100,parseInt(e[3],10))/100,t);break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(e[4]),this.setHSL(parseFloat(e[1])/360,parseFloat(e[2])/100,parseFloat(e[3])/100,t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],n=e.length;if(3===n)return this.setRGB(parseInt(e.charAt(0),16)/15,parseInt(e.charAt(1),16)/15,parseInt(e.charAt(2),16)/15,t);if(6===n)return this.setHex(parseInt(e,16),t)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=kn){const n=rs[e.toLowerCase()];return void 0!==n&&this.setHex(n,t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ci(e.r),this.g=Ci(e.g),this.b=Ci(e.b),this}copyLinearToSRGB(e){return this.r=Ri(e.r),this.g=Ri(e.g),this.b=Ri(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=kn){return Ai.workingToColorSpace(cs.copy(this),e),65536*Math.round(ri(255*cs.r,0,255))+256*Math.round(ri(255*cs.g,0,255))+Math.round(ri(255*cs.b,0,255))}getHexString(e=kn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ai.workingColorSpace){Ai.workingToColorSpace(cs.copy(this),t);const n=cs.r,i=cs.g,r=cs.b,s=Math.max(n,i,r),a=Math.min(n,i,r);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const e=s-a;switch(l=c<=.5?e/(s+a):e/(2-s-a),s){case n:o=(i-r)/e+(i<r?6:0);break;case i:o=(r-n)/e+2;break;case r:o=(n-i)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=Ai.workingColorSpace){return Ai.workingToColorSpace(cs.copy(this),t),e.r=cs.r,e.g=cs.g,e.b=cs.b,e}getStyle(e=kn){Ai.workingToColorSpace(cs.copy(this),e);const t=cs.r,n=cs.g,i=cs.b;return e!==kn?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(ss),this.setHSL(ss.h+e,ss.s+t,ss.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(ss),e.getHSL(as);const n=ai(ss.h,as.h,t),i=ai(ss.s,as.s,t),r=ai(ss.l,as.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const cs=new ls;ls.NAMES=rs;let hs=0;class ds extends Kn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:hs++}),this.uuid=ii(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Ve,this.blendDst=He,this.blendEquation=ke,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ls(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Bn,this.stencilZFail=Bn,this.stencilZPass=Bn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n)continue;const i=this[t];void 0!==i&&(i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==Ve&&(n.blendSrc=this.blendSrc),this.blendDst!==He&&(n.blendDst=this.blendDst),this.blendEquation!==ke&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Bn&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Bn&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Bn&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class us extends ds{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ls(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Er,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ps=ms();function ms(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(i[l]=0,i[256|l]=32768,r[l]=24,r[256|l]=24):e<-14?(i[l]=1024>>-e-14,i[256|l]=1024>>-e-14|32768,r[l]=-e-1,r[256|l]=-e-1):e<=15?(i[l]=e+15<<10,i[256|l]=e+15<<10|32768,r[l]=13,r[256|l]=13):e<128?(i[l]=31744,i[256|l]=64512,r[l]=24,r[256|l]=24):(i[l]=31744,i[256|l]=64512,r[l]=13,r[256|l]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;!(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,s[l]=e|t}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(o[l]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}function fs(e){Math.abs(e),e=ri(e,-65504,65504),ps.floatView[0]=e;const t=ps.uint32View[0],n=t>>23&511;return ps.baseTable[n]+((8388607&t)>>ps.shiftTable[n])}function gs(e){const t=e>>10;return ps.uint32View[0]=ps.mantissaTable[ps.offsetTable[t]+(1023&e)]+ps.exponentTable[t],ps.floatView[0]}class vs{static toHalfFloat(e){return fs(e)}static fromHalfFloat(e){return gs(e)}}const xs=new ui,ys=new hi;let _s=0;class bs{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:_s++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Yn,this.updateRanges=[],this.gpuType=It,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)ys.fromBufferAttribute(this,t),ys.applyMatrix3(e),this.setXY(t,ys.x,ys.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)xs.fromBufferAttribute(this,t),xs.applyMatrix3(e),this.setXYZ(t,xs.x,xs.y,xs.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)xs.fromBufferAttribute(this,t),xs.applyMatrix4(e),this.setXYZ(t,xs.x,xs.y,xs.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)xs.fromBufferAttribute(this,t),xs.applyNormalMatrix(e),this.setXYZ(t,xs.x,xs.y,xs.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)xs.fromBufferAttribute(this,t),xs.transformDirection(e),this.setXYZ(t,xs.x,xs.y,xs.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=oi(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=li(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=oi(t,this.array)),t}setX(e,t){return this.normalized&&(t=li(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=oi(t,this.array)),t}setY(e,t){return this.normalized&&(t=li(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=oi(t,this.array)),t}setZ(e,t){return this.normalized&&(t=li(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=oi(t,this.array)),t}setW(e,t){return this.normalized&&(t=li(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=li(t,this.array),n=li(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=li(t,this.array),n=li(n,this.array),i=li(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=li(t,this.array),n=li(n,this.array),i=li(i,this.array),r=li(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Yn&&(e.usage=this.usage),e}}class ws extends bs{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Ms extends bs{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Ss extends bs{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Ts=0;const Es=new gr,As=new Hr,Cs=new ui,Rs=new Hi,Ns=new Hi,Is=new ui;class Ps extends Kn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ts++}),this.uuid=ii(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(vi(e)?Ms:ws)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new fi).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Es.makeRotationFromQuaternion(e),this.applyMatrix4(Es),this}rotateX(e){return Es.makeRotationX(e),this.applyMatrix4(Es),this}rotateY(e){return Es.makeRotationY(e),this.applyMatrix4(Es),this}rotateZ(e){return Es.makeRotationZ(e),this.applyMatrix4(Es),this}translate(e,t,n){return Es.makeTranslation(e,t,n),this.applyMatrix4(Es),this}scale(e,t,n){return Es.makeScale(e,t,n),this.applyMatrix4(Es),this}lookAt(e){return As.lookAt(e),As.updateMatrix(),this.applyMatrix4(As.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Cs).negate(),this.translate(Cs.x,Cs.y,Cs.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}this.setAttribute("position",new Ss(t,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const n=e[i];t.setXYZ(i,n.x,n.y,n.z||0)}e.length,t.count,t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Hi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingBox.set(new ui(-1/0,-1/0,-1/0),new ui(1/0,1/0,1/0));else{if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Rs.setFromBufferAttribute(n),this.morphTargetsRelative?(Is.addVectors(this.boundingBox.min,Rs.min),this.boundingBox.expandByPoint(Is),Is.addVectors(this.boundingBox.max,Rs.max),this.boundingBox.expandByPoint(Is)):(this.boundingBox.expandByPoint(Rs.min),this.boundingBox.expandByPoint(Rs.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new or);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingSphere.set(new ui,1/0);else if(e){const n=this.boundingSphere.center;if(Rs.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const n=t[e];Ns.setFromBufferAttribute(n),this.morphTargetsRelative?(Is.addVectors(Rs.min,Ns.min),Rs.expandByPoint(Is),Is.addVectors(Rs.max,Ns.max),Rs.expandByPoint(Is)):(Rs.expandByPoint(Ns.min),Rs.expandByPoint(Ns.max))}Rs.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)Is.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Is));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],a=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)Is.fromBufferAttribute(s,t),a&&(Cs.fromBufferAttribute(e,t),Is.add(Cs)),i=Math.max(i,n.distanceToSquared(Is))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return;const n=t.position,i=t.normal,r=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new bs(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),a=[],o=[];for(let M=0;M<n.count;M++)a[M]=new ui,o[M]=new ui;const l=new ui,c=new ui,h=new ui,d=new hi,u=new hi,p=new hi,m=new ui,f=new ui;function g(e,t,i){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),h.fromBufferAttribute(n,i),d.fromBufferAttribute(r,e),u.fromBufferAttribute(r,t),p.fromBufferAttribute(r,i),c.sub(l),h.sub(l),u.sub(d),p.sub(d);const s=1/(u.x*p.y-p.x*u.y);isFinite(s)&&(m.copy(c).multiplyScalar(p.y).addScaledVector(h,-u.y).multiplyScalar(s),f.copy(h).multiplyScalar(u.x).addScaledVector(c,-p.x).multiplyScalar(s),a[e].add(m),a[t].add(m),a[i].add(m),o[e].add(f),o[t].add(f),o[i].add(f))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let M=0,S=v.length;M<S;++M){const t=v[M],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)g(e.getX(i+0),e.getX(i+1),e.getX(i+2))}const x=new ui,y=new ui,_=new ui,b=new ui;function w(e){_.fromBufferAttribute(i,e),b.copy(_);const t=a[e];x.copy(t),x.sub(_.multiplyScalar(_.dot(t))).normalize(),y.crossVectors(b,t);const n=y.dot(o[e])<0?-1:1;s.setXYZW(e,x.x,x.y,x.z,n)}for(let M=0,S=v.length;M<S;++M){const t=v[M],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)w(e.getX(i+0)),w(e.getX(i+1)),w(e.getX(i+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new bs(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new ui,r=new ui,s=new ui,a=new ui,o=new ui,l=new ui,c=new ui,h=new ui;if(e)for(let d=0,u=e.count;d<u;d+=3){const u=e.getX(d+0),p=e.getX(d+1),m=e.getX(d+2);i.fromBufferAttribute(t,u),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,m),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),a.fromBufferAttribute(n,u),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,m),a.add(c),o.add(c),l.add(c),n.setXYZ(u,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(m,l.x,l.y,l.z)}else for(let e=0,d=t.count;e<d;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Is.fromBufferAttribute(e,t),Is.normalize(),e.setXYZ(t,Is.x,Is.y,Is.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,s=new n.constructor(t.length*i);let a=0,o=0;for(let l=0,c=t.length;l<c;l++){a=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(let e=0;e<i;e++)s[o++]=n[a++]}return new bs(s,i,r)}if(null===this.index)return this;const t=new Ps,n=this.index.array,i=this.attributes;for(const a in i){const r=e(i[a],n);t.setAttribute(a,r)}const r=this.morphAttributes;for(const a in r){const i=[],s=r[a];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],n);i.push(r)}t.morphAttributes[a]=i}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let a=0,o=s.length;a<o;a++){const e=s[a];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const o in n){const t=n[o];e.data.attributes[o]=t.toJSON(e.data)}const i={};let r=!1;for(const o in this.morphAttributes){const t=this.morphAttributes[o],n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];n.push(r.toJSON(e.data))}n.length>0&&(i[o]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere=a.toJSON()),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone());const i=e.attributes;for(const l in i){const e=i[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],n=r[l];for(let i=0,r=n.length;i<r;i++)e.push(n[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let l=0,c=s.length;l<c;l++){const e=s[l];this.addGroup(e.start,e.count,e.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ls=new gr,Ds=new fr,ks=new or,Us=new ui,Os=new ui,Fs=new ui,Bs=new ui,zs=new ui,js=new ui,Vs=new ui,Hs=new ui;class Gs extends Hr{constructor(e=new Ps,t=new us){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(r&&a){js.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=a[n],o=r[n];0!==i&&(zs.fromBufferAttribute(o,e),s?js.addScaledVector(zs,i):js.addScaledVector(zs.sub(t),i))}t.add(js)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),ks.copy(n.boundingSphere),ks.applyMatrix4(r),Ds.copy(e.ray).recast(e.near),!1===ks.containsPoint(Ds.origin)){if(null===Ds.intersectSphere(ks,Us))return;if(Ds.origin.distanceToSquared(Us)>(e.far-e.near)**2)return}Ls.copy(r).invert(),Ds.copy(e.ray).applyMatrix4(Ls),null!==n.boundingBox&&!1===Ds.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Ds)}}_computeIntersections(e,t,n){let i;const r=this.geometry,s=this.material,a=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,h=r.attributes.normal,d=r.groups,u=r.drawRange;if(null!==a)if(Array.isArray(s))for(let p=0,m=d.length;p<m;p++){const r=d[p],o=s[r.materialIndex];for(let s=Math.max(r.start,u.start),d=Math.min(a.count,Math.min(r.start+r.count,u.start+u.count));s<d;s+=3){i=Ws(this,o,e,n,l,c,h,a.getX(s),a.getX(s+1),a.getX(s+2)),i&&(i.faceIndex=Math.floor(s/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,u.start),o=Math.min(a.count,u.start+u.count);r<o;r+=3){i=Ws(this,s,e,n,l,c,h,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}else if(void 0!==o)if(Array.isArray(s))for(let p=0,m=d.length;p<m;p++){const r=d[p],a=s[r.materialIndex];for(let s=Math.max(r.start,u.start),d=Math.min(o.count,Math.min(r.start+r.count,u.start+u.count));s<d;s+=3){i=Ws(this,a,e,n,l,c,h,s,s+1,s+2),i&&(i.faceIndex=Math.floor(s/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,u.start),a=Math.min(o.count,u.start+u.count);r<a;r+=3){i=Ws(this,s,e,n,l,c,h,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}}}function Ws(e,t,n,i,r,s,a,o,l,c){e.getVertexPosition(o,Os),e.getVertexPosition(l,Fs),e.getVertexPosition(c,Bs);const h=function(e,t,n,i,r,s,a,o){let l;if(l=1===t.side?i.intersectTriangle(a,s,r,!0,o):i.intersectTriangle(r,s,a,0===t.side,o),null===l)return null;Hs.copy(o),Hs.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Hs);return c<n.near||c>n.far?null:{distance:c,point:Hs.clone(),object:e}}(e,t,n,i,Os,Fs,Bs,Vs);if(h){const e=new ui;is.getBarycoord(Vs,Os,Fs,Bs,e),r&&(h.uv=is.getInterpolatedAttribute(r,o,l,c,e,new hi)),s&&(h.uv1=is.getInterpolatedAttribute(s,o,l,c,e,new hi)),a&&(h.normal=is.getInterpolatedAttribute(a,o,l,c,e,new ui),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const t={a:o,b:l,c:c,normal:new ui,materialIndex:0};is.getNormal(Os,Fs,Bs,t.normal),h.face=t,h.barycoord=e}return h}class Xs extends Ps{constructor(e=1,t=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],h=[];let d=0,u=0;function p(e,t,n,i,r,s,p,m,f,g,v){const x=s/f,y=p/g,_=s/2,b=p/2,w=m/2,M=f+1,S=g+1;let T=0,E=0;const A=new ui;for(let a=0;a<S;a++){const s=a*y-b;for(let o=0;o<M;o++){const d=o*x-_;A[e]=d*i,A[t]=s*r,A[n]=w,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=m>0?1:-1,c.push(A.x,A.y,A.z),h.push(o/f),h.push(1-a/g),T+=1}}for(let a=0;a<g;a++)for(let e=0;e<f;e++){const t=d+e+M*a,n=d+e+M*(a+1),i=d+(e+1)+M*(a+1),r=d+(e+1)+M*a;o.push(t,n,r),o.push(n,i,r),E+=6}a.addGroup(u,E,v),u+=E,d+=T}p("z","y","x",-1,-1,n,t,e,s,r,0),p("z","y","x",1,-1,n,t,-e,s,r,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new Ss(l,3)),this.setAttribute("normal",new Ss(c,3)),this.setAttribute("uv",new Ss(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xs(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function qs(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?t[n][i]=null:t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function Ys(e){const t={};for(let n=0;n<e.length;n++){const i=qs(e[n]);for(const e in i)t[e]=i[e]}return t}function Zs(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:Ai.workingColorSpace}const $s={clone:qs,merge:Ys};class Js extends ds{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=qs(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Ks extends Hr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new gr,this.projectionMatrix=new gr,this.projectionMatrixInverse=new gr,this.coordinateSystem=$n,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Qs=new ui,ea=new hi,ta=new hi;class na extends Ks{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*ni*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*ti*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*ni*Math.atan(Math.tan(.5*ti*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Qs.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Qs.x,Qs.y).multiplyScalar(-e/Qs.z),Qs.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Qs.x,Qs.y).multiplyScalar(-e/Qs.z)}getViewSize(e,t){return this.getViewBounds(e,ea,ta),t.subVectors(ta,ea)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*ti*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,a=s.fullHeight;r+=s.offsetX*i/e,t-=s.offsetY*n/a,i*=s.width/e,n*=s.height/a}const a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const ia=-90;class ra extends Hr{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new na(ia,1,e,t);i.layers=this.layers,this.add(i);const r=new na(ia,1,e,t);r.layers=this.layers,this.add(r);const s=new na(ia,1,e,t);s.layers=this.layers,this.add(s);const a=new na(ia,1,e,t);a.layers=this.layers,this.add(a);const o=new na(ia,1,e,t);o.layers=this.layers,this.add(o);const l=new na(ia,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,s,a,o]=t;for(const l of t)this.remove(l);if(e===$n)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==Jn)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,s,a,o,l,c]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const m=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,s),e.setRenderTarget(n,2,i),e.render(t,a),e.setRenderTarget(n,3,i),e.render(t,o),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=m,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(h,d,u),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class sa extends Oi{constructor(e=[],t=301,n,i,r,s,a,o,l,c){super(e,t,n,i,r,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class aa extends zi{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new sa(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new Xs(5,5,5),r=new Js({name:"CubemapFromEquirect",uniforms:qs(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=t;const s=new Gs(i,r),a=t.minFilter;t.minFilter===Mt&&(t.minFilter=bt);return new ra(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t=!0,n=!0,i=!0){const r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,n,i);e.setRenderTarget(r)}}class oa extends Hr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const la={type:"move"};class ca{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new oa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new oa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ui,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ui),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new oa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ui,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ui),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const s of e.hand.values()){const e=t.getJointPose(s,n),i=this._getHandJoint(l,s);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(la)))}return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new oa;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class ha{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ls(e),this.density=t}clone(){return new ha(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class da{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new ls(e),this.near=t,this.far=n}clone(){return new da(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class ua extends Hr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Er,this.environmentIntensity=1,this.environmentRotation=new Er,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class pa{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Yn,this.updateRanges=[],this.version=0,this.uuid=ii()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ii()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ii()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ma=new ui;class fa{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)ma.fromBufferAttribute(this,t),ma.applyMatrix4(e),this.setXYZ(t,ma.x,ma.y,ma.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ma.fromBufferAttribute(this,t),ma.applyNormalMatrix(e),this.setXYZ(t,ma.x,ma.y,ma.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ma.fromBufferAttribute(this,t),ma.transformDirection(e),this.setXYZ(t,ma.x,ma.y,ma.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=oi(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=li(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=li(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=li(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=li(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=li(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=oi(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=oi(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=oi(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=oi(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=li(t,this.array),n=li(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=li(t,this.array),n=li(n,this.array),i=li(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=li(t,this.array),n=li(n,this.array),i=li(i,this.array),r=li(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new bs(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new fa(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ga extends ds{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ls(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let va;const xa=new ui,ya=new ui,_a=new ui,ba=new hi,wa=new hi,Ma=new gr,Sa=new ui,Ta=new ui,Ea=new ui,Aa=new hi,Ca=new hi,Ra=new hi;class Na extends Hr{constructor(e=new ga){if(super(),this.isSprite=!0,this.type="Sprite",void 0===va){va=new Ps;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new pa(e,5);va.setIndex([0,1,2,0,2,3]),va.setAttribute("position",new fa(t,3,0,!1)),va.setAttribute("uv",new fa(t,2,3,!1))}this.geometry=va,this.material=e,this.center=new hi(.5,.5),this.count=1}raycast(e,t){e.camera,ya.setFromMatrixScale(this.matrixWorld),Ma.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_a.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ya.multiplyScalar(-_a.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;Ia(Sa.set(-.5,-.5,0),_a,s,ya,i,r),Ia(Ta.set(.5,-.5,0),_a,s,ya,i,r),Ia(Ea.set(.5,.5,0),_a,s,ya,i,r),Aa.set(0,0),Ca.set(1,0),Ra.set(1,1);let a=e.ray.intersectTriangle(Sa,Ta,Ea,!1,xa);if(null===a&&(Ia(Ta.set(-.5,.5,0),_a,s,ya,i,r),Ca.set(0,1),a=e.ray.intersectTriangle(Sa,Ea,Ta,!1,xa),null===a))return;const o=e.ray.origin.distanceTo(xa);o<e.near||o>e.far||t.push({distance:o,point:xa.clone(),uv:is.getInterpolation(xa,Sa,Ta,Ea,Aa,Ca,Ra,new hi),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Ia(e,t,n,i,r,s){ba.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(wa.x=s*ba.x-r*ba.y,wa.y=r*ba.x+s*ba.y):wa.copy(ba),e.copy(t),e.x+=wa.x,e.y+=wa.y,e.applyMatrix4(Ma)}const Pa=new ui,La=new ui;class Da extends Hr{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance,e.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const i=this.levels;let r;for(r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const e=t.splice(n,1);return this.remove(e[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let i=t[n].distance;if(t[n].object.visible&&(i-=i*t[n].hysteresis),e<i)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Pa.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Pa);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Pa.setFromMatrixPosition(e.matrixWorld),La.setFromMatrixPosition(this.matrixWorld);const n=Pa.distanceTo(La)/e.zoom;let i,r;for(t[0].object.visible=!0,i=1,r=t.length;i<r;i++){let e=t[i].distance;if(t[i].object.visible&&(e-=e*t[i].hysteresis),!(n>=e))break;t[i-1].object.visible=!1,t[i].object.visible=!0}for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const e=n[i];t.object.levels.push({object:e.object.uuid,distance:e.distance,hysteresis:e.hysteresis})}return t}}const ka=new ui,Ua=new Fi,Oa=new Fi,Fa=new ui,Ba=new gr,za=new ui,ja=new or,Va=new gr,Ha=new fr;class Ga extends Gs{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=ot,this.bindMatrix=new gr,this.bindMatrixInverse=new gr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Hi),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,za),this.boundingBox.expandByPoint(za)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new or),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,za),this.boundingSphere.expandByPoint(za)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),ja.copy(this.boundingSphere),ja.applyMatrix4(i),!1!==e.ray.intersectsSphere(ja)&&(Va.copy(i).invert(),Ha.copy(e.ray).applyMatrix4(Va),null!==this.boundingBox&&!1===Ha.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,Ha)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Fi,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===ot?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===lt&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;Ua.fromBufferAttribute(i.attributes.skinIndex,e),Oa.fromBufferAttribute(i.attributes.skinWeight,e),ka.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const e=Oa.getComponent(r);if(0!==e){const i=Ua.getComponent(r);Ba.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Fa.copy(ka).applyMatrix4(Ba),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Wa extends Hr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Xa extends Oi{constructor(e=null,t=1,n=1,i,r,s,a,o,l=1003,c=1003,h,d){super(null,s,a,o,l,c,i,r,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const qa=new gr,Ya=new gr;class Za{constructor(e=[],t=[]){this.uuid=ii(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new gr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new gr;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,s=e.length;r<s;r++){const i=e[r]?e[r].matrixWorld:Ya;qa.multiplyMatrices(i,t[r]),qa.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new Za(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Xa(t,e,e,Bt,It);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){let i=t[e.bones[n]];void 0===i&&(i=new Wa),this.bones.push(i),this.boneInverses.push((new gr).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const s=n[i];e.boneInverses.push(s.toArray())}return e}}class $a extends bs{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Ja=new gr,Ka=new gr,Qa=[],eo=new Hi,to=new gr,no=new Gs,io=new or;class ro extends Gs{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new $a(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,to)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Hi),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Ja),eo.copy(e.boundingBox).applyMatrix4(Ja),this.boundingBox.union(eo)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new or),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Ja),io.copy(e.boundingSphere).applyMatrix4(Ja),this.boundingSphere.union(io)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,r=e*(n.length+1)+1;for(let s=0;s<n.length;s++)n[s]=i[r+s]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(no.geometry=this.geometry,no.material=this.material,void 0!==no.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),io.copy(this.boundingSphere),io.applyMatrix4(n),!1!==e.ray.intersectsSphere(io)))for(let r=0;r<i;r++){this.getMatrixAt(r,Ja),Ka.multiplyMatrices(n,Ja),no.matrixWorld=Ka,no.raycast(e,Qa);for(let e=0,n=Qa.length;e<n;e++){const n=Qa[e];n.instanceId=r,n.object=this,t.push(n)}Qa.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new $a(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;null===this.morphTexture&&(this.morphTexture=new Xa(new Float32Array(i*this.count),i,this.count,Vt,It));const r=this.morphTexture.source.data.data;let s=0;for(let l=0;l<n.length;l++)s+=n[l];const a=this.geometry.morphTargetsRelative?1:1-s,o=i*e;r[o]=a,r.set(n,o+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const so=new ui,ao=new ui,oo=new fi;class lo{constructor(e=new ui(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=so.subVectors(n,t).cross(ao.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(so),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||oo.getNormalMatrix(e),i=this.coplanarPoint(so).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const co=new or,ho=new hi(.5,.5),uo=new ui;class po{constructor(e=new lo,t=new lo,n=new lo,i=new lo,r=new lo,s=new lo){this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3,n=!1){const i=this.planes,r=e.elements,s=r[0],a=r[1],o=r[2],l=r[3],c=r[4],h=r[5],d=r[6],u=r[7],p=r[8],m=r[9],f=r[10],g=r[11],v=r[12],x=r[13],y=r[14],_=r[15];if(i[0].setComponents(l-s,u-c,g-p,_-v).normalize(),i[1].setComponents(l+s,u+c,g+p,_+v).normalize(),i[2].setComponents(l+a,u+h,g+m,_+x).normalize(),i[3].setComponents(l-a,u-h,g-m,_-x).normalize(),n)i[4].setComponents(o,d,f,y).normalize(),i[5].setComponents(l-o,u-d,g-f,_-y).normalize();else if(i[4].setComponents(l-o,u-d,g-f,_-y).normalize(),t===$n)i[5].setComponents(l+o,u+d,g+f,_+y).normalize();else{if(t!==Jn)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);i[5].setComponents(o,d,f,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),co.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),co.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(co)}intersectsSprite(e){co.center.set(0,0,0);const t=ho.distanceTo(e.center);return co.radius=.7071067811865476+t,co.applyMatrix4(e.matrixWorld),this.intersectsSphere(co)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(uo.x=i.normal.x>0?e.max.x:e.min.x,uo.y=i.normal.y>0?e.max.y:e.min.y,uo.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(uo)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const mo=new gr,fo=new po;class go{constructor(){this.coordinateSystem=$n}intersectsObject(e,t){if(!t.isArrayCamera||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(mo.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),fo.setFromProjectionMatrix(mo,i.coordinateSystem,i.reversedDepth),fo.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(mo.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),fo.setFromProjectionMatrix(mo,i.coordinateSystem,i.reversedDepth),fo.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(mo.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),fo.setFromProjectionMatrix(mo,i.coordinateSystem,i.reversedDepth),fo.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(mo.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),fo.setFromProjectionMatrix(mo,i.coordinateSystem,i.reversedDepth),fo.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(mo.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),fo.setFromProjectionMatrix(mo,i.coordinateSystem,i.reversedDepth),fo.containsPoint(e))return!0}return!1}clone(){return new go}}function vo(e,t){return e-t}function xo(e,t){return e.z-t.z}function yo(e,t){return t.z-e.z}class _o{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,i){const r=this.pool,s=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});const a=r[this.index];s.push(a),this.index++,a.start=e,a.count=t,a.z=n,a.index=i}reset(){this.list.length=0,this.index=0}}const bo=new gr,wo=new ls(1,1,1),Mo=new po,So=new go,To=new Hi,Eo=new or,Ao=new ui,Co=new ui,Ro=new ui,No=new _o,Io=new Gs,Po=[];function Lo(e,t,n=0){const i=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const r=e.count;for(let s=0;s<r;s++)for(let r=0;r<i;r++)t.setComponent(s+n,r,e.getComponent(s,r))}else t.array.set(e.array,n*i);t.needsUpdate=!0}function Do(e,t){if(e.constructor!==t.constructor){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++)t[i]=e[i]}else{const n=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,n))}}class ko extends Gs{constructor(e,t,n=2*t,i){super(new Ps,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new Xa(t,e,e,Bt,It);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new Xa(t,e,e,Ht,Nt);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new Xa(t,e,e,Bt,It);n.colorSpace=Ai.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(const i in e.attributes){const r=e.getAttribute(i),{array:s,itemSize:a,normalized:o}=r,l=new s.constructor(n*a),c=new bs(l,a,o);t.setAttribute(i,c)}if(null!==e.getIndex()){const e=n>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new bs(e,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=e.getAttribute(n),r=t.getAttribute(n);if(i.itemSize!==r.itemSize||i.normalized!==r.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Hi);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(!1===t[n].active)continue;const i=t[n].geometryIndex;this.getMatrixAt(n,bo),this.getBoundingBoxAt(i,To).applyMatrix4(bo),e.union(To)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new or);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(!1===t[n].active)continue;const i=t[n].geometryIndex;this.getMatrixAt(n,bo),this.getBoundingSphereAt(i,Eo).applyMatrix4(bo),e.union(Eo)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const t={visible:!0,active:!0,geometryIndex:e};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(vo),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=t):(n=this._instanceInfo.length,this._instanceInfo.push(t));const i=this._matricesTexture;bo.identity().toArray(i.image.data,16*n),i.needsUpdate=!0;const r=this._colorsTexture;return r&&(wo.toArray(r.image.data,4*n),r.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},r=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=-1===t?e.getAttribute("position").count:t;const s=e.getIndex();if(null!==s&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=-1===n?s.count:n),-1!==i.indexStart&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let a;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(vo),a=this._availableGeometryIds.shift(),r[a]=i):(a=this._geometryCount,this._geometryCount++,r.push(i)),this.setGeometryAt(a,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,a}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,i=null!==n.getIndex(),r=n.getIndex(),s=t.getIndex(),a=this._geometryInfo[e];if(i&&s.count>a.reservedIndexCount||t.attributes.position.count>a.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const o=a.vertexStart,l=a.reservedVertexCount;a.vertexCount=t.getAttribute("position").count;for(const c in n.attributes){const e=t.getAttribute(c),i=n.getAttribute(c);Lo(e,i,o);const r=e.itemSize;for(let t=e.count,n=l;t<n;t++){const e=o+t;for(let t=0;t<r;t++)i.setComponent(e,t,0)}i.needsUpdate=!0,i.addUpdateRange(o*r,l*r)}if(i){const e=a.indexStart,n=a.reservedIndexCount;a.indexCount=t.getIndex().count;for(let t=0;t<s.count;t++)r.setX(e+t,o+s.getX(t));for(let t=s.count,i=n;t<i;t++)r.setX(e+t,o);r.needsUpdate=!0,r.addUpdateRange(e,a.reservedIndexCount)}return a.start=i?a.indexStart:a.vertexStart,a.count=i?a.indexCount:a.vertexCount,a.boundingBox=null,null!==t.boundingBox&&(a.boundingBox=t.boundingBox.clone()),a.boundingSphere=null,null!==t.boundingSphere&&(a.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||!1===t[e].active)return this;const n=this._instanceInfo;for(let i=0,r=n.length;i<r;i++)n[i].active&&n[i].geometryIndex===e&&this.deleteInstance(i);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,i=n.map(((e,t)=>t)).sort(((e,t)=>n[e].vertexStart-n[t].vertexStart)),r=this.geometry;for(let s=0,a=n.length;s<a;s++){const a=i[s],o=n[a];if(!1!==o.active){if(null!==r.index){if(o.indexStart!==t){const{indexStart:n,vertexStart:i,reservedIndexCount:s}=o,a=r.index,l=a.array,c=e-i;for(let e=n;e<n+s;e++)l[e]=l[e]+c;a.array.copyWithin(t,n,n+s),a.addUpdateRange(t,s),o.indexStart=t}t+=o.reservedIndexCount}if(o.vertexStart!==e){const{vertexStart:t,reservedVertexCount:n}=o,i=r.attributes;for(const r in i){const s=i[r],{array:a,itemSize:o}=s;a.copyWithin(e*o,t*o,(t+n)*o),s.addUpdateRange(e*o,n*o)}o.vertexStart=e}e+=o.reservedVertexCount,o.start=r.index?o.indexStart:o.vertexStart,this._nextIndexStart=r.index?o.indexStart+o.reservedIndexCount:0,this._nextVertexStart=o.vertexStart+o.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(null===i.boundingBox){const e=new Hi,t=n.index,r=n.attributes.position;for(let n=i.start,s=i.start+i.count;n<s;n++){let i=n;t&&(i=t.getX(i)),e.expandByPoint(Ao.fromBufferAttribute(r,i))}i.boundingBox=e}return t.copy(i.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(null===i.boundingSphere){const t=new or;this.getBoundingBoxAt(e,To),To.getCenter(t.center);const r=n.index,s=n.attributes.position;let a=0;for(let e=i.start,n=i.start+i.count;e<n;e++){let n=e;r&&(n=r.getX(n)),Ao.fromBufferAttribute(s,n),a=Math.max(a,t.center.distanceToSquared(Ao))}t.radius=Math.sqrt(a),i.boundingSphere=t}return t.copy(i.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,i=this._matricesTexture.image.data;return t.toArray(i,16*e),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,16*e)}setColorAt(e,t){return this.validateInstanceId(e),null===this._colorsTexture&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,4*e),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,4*e)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t||(this._instanceInfo[e].visible=t,this._visibilityChanged=!0),this}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(vo);t[t.length-1]===n.length-1;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const i=new Int32Array(e),r=new Int32Array(e);Do(this._multiDrawCounts,i),Do(this._multiDrawStarts,r),this._multiDrawCounts=i,this._multiDrawStarts=r,this._maxInstanceCount=e;const s=this._indirectTexture,a=this._matricesTexture,o=this._colorsTexture;s.dispose(),this._initIndirectTexture(),Do(s.image.data,this._indirectTexture.image.data),a.dispose(),this._initMatricesTexture(),Do(a.image.data,this._matricesTexture.image.data),o&&(o.dispose(),this._initColorsTexture(),Do(o.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter((e=>e.active));if(Math.max(...n.map((e=>e.vertexStart+e.reservedVertexCount)))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index){if(Math.max(...n.map((e=>e.indexStart+e.reservedIndexCount)))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`)}const i=this.geometry;i.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Ps,this._initializeGeometry(i));const r=this.geometry;i.index&&Do(i.index.array,r.index.array);for(const s in i.attributes)Do(i.attributes[s].array,r.attributes[s].array)}raycast(e,t){const n=this._instanceInfo,i=this._geometryInfo,r=this.matrixWorld,s=this.geometry;Io.material=this.material,Io.geometry.index=s.index,Io.geometry.attributes=s.attributes,null===Io.geometry.boundingBox&&(Io.geometry.boundingBox=new Hi),null===Io.geometry.boundingSphere&&(Io.geometry.boundingSphere=new or);for(let a=0,o=n.length;a<o;a++){if(!n[a].visible||!n[a].active)continue;const s=n[a].geometryIndex,o=i[s];Io.geometry.setDrawRange(o.start,o.count),this.getMatrixAt(a,Io.matrixWorld).premultiply(r),this.getBoundingBoxAt(s,Io.geometry.boundingBox),this.getBoundingSphereAt(s,Io.geometry.boundingSphere),Io.raycast(e,Po);for(let e=0,n=Po.length;e<n;e++){const n=Po[e];n.object=this,n.batchId=a,t.push(n)}Po.length=0}Io.material=null,Io.geometry.index=null,Io.geometry.attributes={},Io.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map((e=>({...e,boundingBox:null!==e.boundingBox?e.boundingBox.clone():null,boundingSphere:null!==e.boundingSphere?e.boundingSphere.clone():null}))),this._instanceInfo=e._instanceInfo.map((e=>({...e}))),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,i,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const s=i.getIndex(),a=null===s?1:s.array.BYTES_PER_ELEMENT,o=this._instanceInfo,l=this._multiDrawStarts,c=this._multiDrawCounts,h=this._geometryInfo,d=this.perObjectFrustumCulled,u=this._indirectTexture,p=u.image.data,m=n.isArrayCamera?So:Mo;d&&!n.isArrayCamera&&(bo.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),Mo.setFromProjectionMatrix(bo,n.coordinateSystem,n.reversedDepth));let f=0;if(this.sortObjects){bo.copy(this.matrixWorld).invert(),Ao.setFromMatrixPosition(n.matrixWorld).applyMatrix4(bo),Co.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(bo);for(let i=0,r=o.length;i<r;i++)if(o[i].visible&&o[i].active){const e=o[i].geometryIndex;this.getMatrixAt(i,bo),this.getBoundingSphereAt(e,Eo).applyMatrix4(bo);let t=!1;if(d&&(t=!m.intersectsSphere(Eo,n)),!t){const t=h[e],n=Ro.subVectors(Eo.center,Ao).dot(Co);No.push(t.start,t.count,n,i)}}const e=No.list,t=this.customSort;null===t?e.sort(r.transparent?yo:xo):t.call(this,e,n);for(let n=0,i=e.length;n<i;n++){const t=e[n];l[f]=t.start*a,c[f]=t.count,p[f]=t.index,f++}No.reset()}else for(let g=0,v=o.length;g<v;g++)if(o[g].visible&&o[g].active){const e=o[g].geometryIndex;let t=!1;if(d&&(this.getMatrixAt(g,bo),this.getBoundingSphereAt(e,Eo).applyMatrix4(bo),t=!m.intersectsSphere(Eo,n)),!t){const t=h[e];l[f]=t.start*a,c[f]=t.count,p[f]=g,f++}}u.needsUpdate=!0,this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,t,n,i,r,s){this.onBeforeRender(e,null,i,r,s)}}class Uo extends ds{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ls(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Oo=new ui,Fo=new ui,Bo=new gr,zo=new fr,jo=new or,Vo=new ui,Ho=new ui;class Go extends Hr{constructor(e=new Ps,t=new Uo){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)Oo.fromBufferAttribute(t,e-1),Fo.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Oo.distanceTo(Fo);e.setAttribute("lineDistance",new Ss(n,1))}return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),jo.copy(n.boundingSphere),jo.applyMatrix4(i),jo.radius+=r,!1===e.ray.intersectsSphere(jo))return;Bo.copy(i).invert(),zo.copy(e.ray).applyMatrix4(Bo);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=this.isLineSegments?2:1,c=n.index,h=n.attributes.position;if(null!==c){const n=Math.max(0,s.start),i=Math.min(c.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=l){const n=c.getX(r),i=c.getX(r+1),s=Wo(this,e,zo,o,n,i,r);s&&t.push(s)}if(this.isLineLoop){const r=c.getX(i-1),s=c.getX(n),a=Wo(this,e,zo,o,r,s,i-1);a&&t.push(a)}}else{const n=Math.max(0,s.start),i=Math.min(h.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=l){const n=Wo(this,e,zo,o,r,r+1,r);n&&t.push(n)}if(this.isLineLoop){const r=Wo(this,e,zo,o,i-1,n,i-1);r&&t.push(r)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Wo(e,t,n,i,r,s,a){const o=e.geometry.attributes.position;Oo.fromBufferAttribute(o,r),Fo.fromBufferAttribute(o,s);if(n.distanceSqToSegment(Oo,Fo,Vo,Ho)>i)return;Vo.applyMatrix4(e.matrixWorld);const l=t.ray.origin.distanceTo(Vo);return l<t.near||l>t.far?void 0:{distance:l,point:Ho.clone().applyMatrix4(e.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:e}}const Xo=new ui,qo=new ui;class Yo extends Go{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)Xo.fromBufferAttribute(t,e),qo.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Xo.distanceTo(qo);e.setAttribute("lineDistance",new Ss(n,1))}return this}}class Zo extends Go{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class $o extends ds{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ls(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Jo=new gr,Ko=new fr,Qo=new or,el=new ui;class tl extends Hr{constructor(e=new Ps,t=new $o){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Qo.copy(n.boundingSphere),Qo.applyMatrix4(i),Qo.radius+=r,!1===e.ray.intersectsSphere(Qo))return;Jo.copy(i).invert(),Ko.copy(e.ray).applyMatrix4(Jo);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);n<r;n++){const r=l.getX(n);el.fromBufferAttribute(c,r),nl(el,r,o,i,e,t,this)}}else{for(let n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);n<r;n++)el.fromBufferAttribute(c,n),nl(el,n,o,i,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function nl(e,t,n,i,r,s,a){const o=Ko.distanceSqToPoint(e);if(o<n){const n=new ui;Ko.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}class il extends Oi{constructor(e,t,n,i,r=1006,s=1006,a,o,l){super(e,t,n,i,r,s,a,o,l),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const c=this;"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,c._requestVideoFrameCallbackId=e.requestVideoFrameCallback(t)})))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){0!==this._requestVideoFrameCallbackId&&this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),super.dispose()}}class rl extends Oi{constructor(e,t,n,i,r,s,a,o,l,c,h,d){super(null,s,a,o,l,c,i,r,h,d),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class sl extends Oi{constructor(e,t,n=1014,i,r,s,a=1003,o=1003,l,c=1026,h=1){if(c!==zt&&c!==jt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:e,height:t,depth:h},i,r,s,a,o,c,n,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Li(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class al extends Ps{constructor(e=1,t=1,n=4,i=8,r=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:i,heightSegments:r},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),i=Math.max(3,Math.floor(i)),r=Math.max(1,Math.floor(r));const s=[],a=[],o=[],l=[],c=t/2,h=Math.PI/2*e,d=t,u=2*h+d,p=2*n+r,m=i+1,f=new ui,g=new ui;for(let v=0;v<=p;v++){let x=0,y=0,_=0,b=0;if(v<=n){const t=v/n,i=t*Math.PI/2;y=-c-e*Math.cos(i),_=e*Math.sin(i),b=-e*Math.cos(i),x=t*h}else if(v<=n+r){const i=(v-n)/r;y=i*t-c,_=e,b=0,x=h+i*d}else{const t=(v-n-r)/n,i=t*Math.PI/2;y=c+e*Math.sin(i),_=e*Math.cos(i),b=e*Math.sin(i),x=h+d+t*h}const w=Math.max(0,Math.min(1,x/u));let M=0;0===v?M=.5/i:v===p&&(M=-.5/i);for(let e=0;e<=i;e++){const t=e/i,n=t*Math.PI*2,r=Math.sin(n),s=Math.cos(n);g.x=-_*s,g.y=y,g.z=_*r,a.push(g.x,g.y,g.z),f.set(-_*s,b,_*r),f.normalize(),o.push(f.x,f.y,f.z),l.push(t+M,w)}if(v>0){const e=(v-1)*m;for(let t=0;t<i;t++){const n=e+t,i=e+t+1,r=v*m+t,a=v*m+t+1;s.push(n,i,r),s.push(i,a,r)}}}this.setIndex(s),this.setAttribute("position",new Ss(a,3)),this.setAttribute("normal",new Ss(o,3)),this.setAttribute("uv",new Ss(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new al(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class ol extends Ps{constructor(e=1,t=32,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],s=[],a=[],o=[],l=new ui,c=new hi;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let h=0,d=3;h<=t;h++,d+=3){const r=n+h/t*i;l.x=e*Math.cos(r),l.y=e*Math.sin(r),s.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(s[d]/e+1)/2,c.y=(s[d+1]/e+1)/2,o.push(c.x,c.y)}for(let h=1;h<=t;h++)r.push(h,h+1,0);this.setIndex(r),this.setAttribute("position",new Ss(s,3)),this.setAttribute("normal",new Ss(a,3)),this.setAttribute("uv",new Ss(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ol(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class ll extends Ps{constructor(e=1,t=1,n=1,i=32,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],h=[],d=[],u=[];let p=0;const m=[],f=n/2;let g=0;function v(n){const r=p,s=new hi,m=new ui;let v=0;const x=!0===n?e:t,y=!0===n?1:-1;for(let e=1;e<=i;e++)h.push(0,f*y,0),d.push(0,y,0),u.push(.5,.5),p++;const _=p;for(let e=0;e<=i;e++){const t=e/i*o+a,n=Math.cos(t),r=Math.sin(t);m.x=x*r,m.y=f*y,m.z=x*n,h.push(m.x,m.y,m.z),d.push(0,y,0),s.x=.5*n+.5,s.y=.5*r*y+.5,u.push(s.x,s.y),p++}for(let e=0;e<i;e++){const t=r+e,i=_+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const s=new ui,v=new ui;let x=0;const y=(t-e)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,x=g*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*o+a,l=Math.sin(r),m=Math.cos(r);v.x=x*l,v.y=-g*n+f,v.z=x*m,h.push(v.x,v.y,v.z),s.set(l,y,m).normalize(),d.push(s.x,s.y,s.z),u.push(t,1-g),c.push(p++)}m.push(c)}for(let n=0;n<i;n++)for(let i=0;i<r;i++){const s=m[i][n],a=m[i+1][n],o=m[i+1][n+1],l=m[i][n+1];(e>0||0!==i)&&(c.push(s,a,l),x+=3),(t>0||i!==r-1)&&(c.push(a,o,l),x+=3)}l.addGroup(g,x,0),g+=x}(),!1===s&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Ss(h,3)),this.setAttribute("normal",new Ss(d,3)),this.setAttribute("uv",new Ss(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ll(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class cl extends ll{constructor(e=1,t=1,n=32,i=1,r=!1,s=0,a=2*Math.PI){super(0,e,t,n,i,r,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(e){return new cl(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class hl extends Ps{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],s=[];function a(e,t,n,i){const r=i+1,s=[];for(let a=0;a<=r;a++){s[a]=[];const i=e.clone().lerp(n,a/r),o=t.clone().lerp(n,a/r),l=r-a;for(let e=0;e<=l;e++)s[a][e]=0===e&&a===r?i:i.clone().lerp(o,e/l)}for(let a=0;a<r;a++)for(let e=0;e<2*(r-a)-1;e++){const t=Math.floor(e/2);e%2==0?(o(s[a][t+1]),o(s[a+1][t]),o(s[a][t])):(o(s[a][t+1]),o(s[a+1][t+1]),o(s[a+1][t]))}}function o(e){r.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=i/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new ui,i=new ui,r=new ui;for(let s=0;s<t.length;s+=3)l(t[s+0],n),l(t[s+1],i),l(t[s+2],r),a(n,i,r,e)}(i),function(e){const t=new ui;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new ui;for(let n=0;n<r.length;n+=3){e.x=r[n+0],e.y=r[n+1],e.z=r[n+2];const i=h(e)/2/Math.PI+.5,a=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);s.push(i,1-a)}var t;(function(){const e=new ui,t=new ui,n=new ui,i=new ui,a=new hi,o=new hi,l=new hi;for(let d=0,u=0;d<r.length;d+=9,u+=6){e.set(r[d+0],r[d+1],r[d+2]),t.set(r[d+3],r[d+4],r[d+5]),n.set(r[d+6],r[d+7],r[d+8]),a.set(s[u+0],s[u+1]),o.set(s[u+2],s[u+3]),l.set(s[u+4],s[u+5]),i.copy(e).add(t).add(n).divideScalar(3);const p=h(i);c(a,u+0,e,p),c(o,u+2,t,p),c(l,u+4,n,p)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],n=s[e+2],i=s[e+4],r=Math.max(t,n,i),a=Math.min(t,n,i);r>.9&&a<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),i<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new Ss(r,3)),this.setAttribute("normal",new Ss(r.slice(),3)),this.setAttribute("uv",new Ss(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hl(e.vertices,e.indices,e.radius,e.details)}}class dl extends hl{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new dl(e.radius,e.detail)}}const ul=new ui,pl=new ui,ml=new ui,fl=new is;class gl extends Ps{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,i=Math.pow(10,n),r=Math.cos(ti*t),s=e.getIndex(),a=e.getAttribute("position"),o=s?s.count:a.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),d={},u=[];for(let e=0;e<o;e+=3){s?(l[0]=s.getX(e),l[1]=s.getX(e+1),l[2]=s.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:o}=fl;if(t.fromBufferAttribute(a,l[0]),n.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),fl.getNormal(ml),h[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,h[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,h[2]=`${Math.round(o.x*i)},${Math.round(o.y*i)},${Math.round(o.z*i)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=h[e],i=h[t],s=fl[c[e]],a=fl[c[t]],o=`${n}_${i}`,p=`${i}_${n}`;p in d&&d[p]?(ml.dot(d[p].normal)<=r&&(u.push(s.x,s.y,s.z),u.push(a.x,a.y,a.z)),d[p]=null):o in d||(d[o]={index0:l[e],index1:l[t],normal:ml.clone()})}}for(const e in d)if(d[e]){const{index0:t,index1:n}=d[e];ul.fromBufferAttribute(a,t),pl.fromBufferAttribute(a,n),u.push(ul.x,ul.y,ul.z),u.push(pl.x,pl.y,pl.z)}this.setAttribute("position",new Ss(u,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class vl{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let i=0;const r=n.length;let s;s=t||e*n[r-1];let a,o=0,l=r-1;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),a=n[i]-s,a<0)o=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const c=n[i];return(i+(s-c)/(n[i+1]-c))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),a=this.getPoint(r),o=t||(s.isVector2?new hi:new ui);return o.copy(a).sub(s).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new ui,i=[],r=[],s=[],a=new ui,o=new gr;for(let u=0;u<=e;u++){const t=u/e;i[u]=this.getTangentAt(t,new ui)}r[0]=new ui,s[0]=new ui;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),h=Math.abs(i[0].y),d=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),d<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let u=1;u<=e;u++){if(r[u]=r[u-1].clone(),s[u]=s[u-1].clone(),a.crossVectors(i[u-1],i[u]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(ri(i[u-1].dot(i[u]),-1,1));r[u].applyMatrix4(o.makeRotationAxis(a,e))}s[u].crossVectors(i[u],r[u])}if(!0===t){let t=Math.acos(ri(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(o.makeRotationAxis(i[n],t*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class xl extends vl{constructor(e=0,t=0,n=1,i=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t=new hi){const n=t,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const a=this.aStartAngle+e*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=o-this.aX,i=l-this.aY;o=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class yl extends xl{constructor(e,t,n,i,r,s){super(e,t,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function _l(){let e=0,t=0,n=0,i=0;function r(r,s,a,o){e=r,t=a,n=-3*r+3*s-2*a-o,i=2*r-2*s+a+o}return{initCatmullRom:function(e,t,n,i,s){r(t,n,s*(n-e),s*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,s,a,o){let l=(t-e)/s-(n-e)/(s+a)+(n-t)/a,c=(n-t)/a-(i-t)/(a+o)+(i-n)/o;l*=a,c*=a,r(t,n,l,c)},calc:function(r){const s=r*r;return e+t*r+n*s+i*(s*r)}}}const bl=new ui,wl=new _l,Ml=new _l,Sl=new _l;class Tl extends vl{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new ui){const n=t,i=this.points,r=i.length,s=(r-(this.closed?0:1))*e;let a,o,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?a=i[(l-1)%r]:(bl.subVectors(i[0],i[1]).add(i[0]),a=bl);const h=i[l%r],d=i[(l+1)%r];if(this.closed||l+2<r?o=i[(l+2)%r]:(bl.subVectors(i[r-1],i[r-2]).add(i[r-1]),o=bl),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(h),e),n=Math.pow(h.distanceToSquared(d),e),i=Math.pow(d.distanceToSquared(o),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),wl.initNonuniformCatmullRom(a.x,h.x,d.x,o.x,t,n,i),Ml.initNonuniformCatmullRom(a.y,h.y,d.y,o.y,t,n,i),Sl.initNonuniformCatmullRom(a.z,h.z,d.z,o.z,t,n,i)}else"catmullrom"===this.curveType&&(wl.initCatmullRom(a.x,h.x,d.x,o.x,this.tension),Ml.initCatmullRom(a.y,h.y,d.y,o.y,this.tension),Sl.initCatmullRom(a.z,h.z,d.z,o.z,this.tension));return n.set(wl.calc(c),Ml.calc(c),Sl.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new ui).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function El(e,t,n,i,r){const s=.5*(i-t),a=.5*(r-n),o=e*e;return(2*n-2*i+s+a)*(e*o)+(-3*n+3*i-2*s-a)*o+s*e+n}function Al(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Cl(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}class Rl extends vl{constructor(e=new hi,t=new hi,n=new hi,i=new hi){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new hi){const n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(Cl(e,i.x,r.x,s.x,a.x),Cl(e,i.y,r.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Nl extends vl{constructor(e=new ui,t=new ui,n=new ui,i=new ui){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new ui){const n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(Cl(e,i.x,r.x,s.x,a.x),Cl(e,i.y,r.y,s.y,a.y),Cl(e,i.z,r.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Il extends vl{constructor(e=new hi,t=new hi){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new hi){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new hi){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Pl extends vl{constructor(e=new ui,t=new ui){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new ui){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ui){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ll extends vl{constructor(e=new hi,t=new hi,n=new hi){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new hi){const n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(Al(e,i.x,r.x,s.x),Al(e,i.y,r.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Dl extends vl{constructor(e=new ui,t=new ui,n=new ui){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ui){const n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(Al(e,i.x,r.x,s.x),Al(e,i.y,r.y,s.y),Al(e,i.z,r.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class kl extends vl{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new hi){const n=t,i=this.points,r=(i.length-1)*e,s=Math.floor(r),a=r-s,o=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],h=i[s>i.length-3?i.length-1:s+2];return n.set(El(a,o.x,l.x,c.x,h.x),El(a,o.y,l.y,c.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new hi).fromArray(n))}return this}}var Ul=Object.freeze({__proto__:null,ArcCurve:yl,CatmullRomCurve3:Tl,CubicBezierCurve:Rl,CubicBezierCurve3:Nl,EllipseCurve:xl,LineCurve:Il,LineCurve3:Pl,QuadraticBezierCurve:Ll,QuadraticBezierCurve3:Dl,SplineCurve:kl});class Ol extends vl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Ul[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const e=i[r]-n,s=this.curves[r],a=s.getLength(),o=0===a?0:1-e/a;return s.getPointAt(o,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],a=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let e=0;e<o.length;e++){const i=o[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Ul[n.type]).fromJSON(n))}return this}}class Fl extends Ol{constructor(e){super(),this.type="Path",this.currentPoint=new hi,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Il(this.currentPoint.clone(),new hi(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new Ll(this.currentPoint.clone(),new hi(e,t),new hi(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,s){const a=new Rl(this.currentPoint.clone(),new hi(e,t),new hi(n,i),new hi(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new kl(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,n,i,r,s),this}absarc(e,t,n,i,r,s){return this.absellipse(e,t,n,n,i,r,s),this}ellipse(e,t,n,i,r,s,a,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,s,a,o),this}absellipse(e,t,n,i,r,s,a,o){const l=new xl(e,t,n,i,r,s,a,o);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Bl extends Fl{constructor(e){super(e),this.uuid=ii(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Fl).fromJSON(n))}return this}}function zl(e,t,n=2){const i=t&&t.length,r=i?t[0]*n:e.length;let s=jl(e,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c;if(i&&(s=function(e,t,n,i){const r=[];for(let s=0,a=t.length;s<a;s++){const n=jl(e,t[s]*i,s<a-1?t[s+1]*i:e.length,i,!1);n===n.next&&(n.steiner=!0),r.push(Kl(n))}r.sort(Yl);for(let s=0;s<r.length;s++)n=Zl(r[s],n);return n}(e,t,s,n)),e.length>80*n){o=1/0,l=1/0;let t=-1/0,i=-1/0;for(let s=n;s<r;s+=n){const n=e[s],r=e[s+1];n<o&&(o=n),r<l&&(l=r),n>t&&(t=n),r>i&&(i=r)}c=Math.max(t-o,i-l),c=0!==c?32767/c:0}return Hl(s,a,n,o,l,c,0),a}function jl(e,t,n,i,r){let s;if(r===function(e,t,n,i){let r=0;for(let s=t,a=n-i;s<n;s+=i)r+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return r}(e,t,n,i)>0)for(let a=t;a<n;a+=i)s=cc(a/i|0,e[a],e[a+1],s);else for(let a=n-i;a>=t;a-=i)s=cc(a/i|0,e[a],e[a+1],s);return s&&ic(s,s.next)&&(hc(s),s=s.next),s}function Vl(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!ic(i,i.next)&&0!==nc(i.prev,i,i.next))i=i.next;else{if(hc(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function Hl(e,t,n,i,r,s,a){if(!e)return;!a&&s&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=Jl(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n=1;do{let i,r=e;e=null;let s=null;for(t=0;r;){t++;let a=r,o=0;for(let e=0;e<n&&(o++,a=a.nextZ,a);e++);let l=n;for(;o>0||l>0&&a;)0!==o&&(0===l||!a||r.z<=a.z)?(i=r,r=r.nextZ,o--):(i=a,a=a.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;r=a}s.nextZ=null,n*=2}while(t>1)}(r)}(e,i,r,s);let o=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(s?Wl(e,i,r,s):Gl(e))t.push(l.i,e.i,c.i),hc(e),e=c.next,o=c.next;else if((e=c)===o){a?1===a?Hl(e=Xl(Vl(e),t),t,n,i,r,s,2):2===a&&ql(e,t,n,i,r,s):Hl(Vl(e),t,n,i,r,s,1);break}}}function Gl(e){const t=e.prev,n=e,i=e.next;if(nc(t,n,i)>=0)return!1;const r=t.x,s=n.x,a=i.x,o=t.y,l=n.y,c=i.y,h=Math.min(r,s,a),d=Math.min(o,l,c),u=Math.max(r,s,a),p=Math.max(o,l,c);let m=i.next;for(;m!==t;){if(m.x>=h&&m.x<=u&&m.y>=d&&m.y<=p&&ec(r,o,s,l,a,c,m.x,m.y)&&nc(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Wl(e,t,n,i){const r=e.prev,s=e,a=e.next;if(nc(r,s,a)>=0)return!1;const o=r.x,l=s.x,c=a.x,h=r.y,d=s.y,u=a.y,p=Math.min(o,l,c),m=Math.min(h,d,u),f=Math.max(o,l,c),g=Math.max(h,d,u),v=Jl(p,m,t,n,i),x=Jl(f,g,t,n,i);let y=e.prevZ,_=e.nextZ;for(;y&&y.z>=v&&_&&_.z<=x;){if(y.x>=p&&y.x<=f&&y.y>=m&&y.y<=g&&y!==r&&y!==a&&ec(o,h,l,d,c,u,y.x,y.y)&&nc(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,_.x>=p&&_.x<=f&&_.y>=m&&_.y<=g&&_!==r&&_!==a&&ec(o,h,l,d,c,u,_.x,_.y)&&nc(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;y&&y.z>=v;){if(y.x>=p&&y.x<=f&&y.y>=m&&y.y<=g&&y!==r&&y!==a&&ec(o,h,l,d,c,u,y.x,y.y)&&nc(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;_&&_.z<=x;){if(_.x>=p&&_.x<=f&&_.y>=m&&_.y<=g&&_!==r&&_!==a&&ec(o,h,l,d,c,u,_.x,_.y)&&nc(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Xl(e,t){let n=e;do{const i=n.prev,r=n.next.next;!ic(i,r)&&rc(i,n,n.next,r)&&oc(i,r)&&oc(r,i)&&(t.push(i.i,n.i,r.i),hc(n),hc(n.next),n=e=r),n=n.next}while(n!==e);return Vl(n)}function ql(e,t,n,i,r,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&tc(a,e)){let o=lc(a,e);return a=Vl(a,a.next),o=Vl(o,o.next),Hl(a,t,n,i,r,s,0),void Hl(o,t,n,i,r,s,0)}e=e.next}a=a.next}while(a!==e)}function Yl(e,t){let n=e.x-t.x;if(0===n&&(n=e.y-t.y,0===n)){n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)}return n}function Zl(e,t){const n=function(e,t){let n=t;const i=e.x,r=e.y;let s,a=-1/0;if(ic(e,n))return n;do{if(ic(e,n.next))return n.next;if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const e=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>a&&(a=e,s=n.x<n.next.x?n:n.next,e===i))return s}n=n.next}while(n!==t);if(!s)return null;const o=s,l=s.x,c=s.y;let h=1/0;n=s;do{if(i>=n.x&&n.x>=l&&i!==n.x&&Ql(r<c?i:a,r,l,c,r<c?a:i,r,n.x,n.y)){const t=Math.abs(r-n.y)/(i-n.x);oc(n,e)&&(t<h||t===h&&(n.x>s.x||n.x===s.x&&$l(s,n)))&&(s=n,h=t)}n=n.next}while(n!==o);return s}(e,t);if(!n)return t;const i=lc(n,e);return Vl(i,i.next),Vl(n,n.next)}function $l(e,t){return nc(e.prev,e,t.prev)<0&&nc(t.next,e,e.next)<0}function Jl(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Kl(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ql(e,t,n,i,r,s,a,o){return(r-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(i-o)>=(n-a)*(t-o)&&(n-a)*(s-o)>=(r-a)*(i-o)}function ec(e,t,n,i,r,s,a,o){return!(e===a&&t===o)&&Ql(e,t,n,i,r,s,a,o)}function tc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&rc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(oc(e,t)&&oc(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(nc(e.prev,e,t.prev)||nc(e,t.prev,t))||ic(e,t)&&nc(e.prev,e,e.next)>0&&nc(t.prev,t,t.next)>0)}function nc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function ic(e,t){return e.x===t.x&&e.y===t.y}function rc(e,t,n,i){const r=ac(nc(e,t,n)),s=ac(nc(e,t,i)),a=ac(nc(n,i,e)),o=ac(nc(n,i,t));return r!==s&&a!==o||(!(0!==r||!sc(e,n,t))||(!(0!==s||!sc(e,i,t))||(!(0!==a||!sc(n,e,i))||!(0!==o||!sc(n,t,i)))))}function sc(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function ac(e){return e>0?1:e<0?-1:0}function oc(e,t){return nc(e.prev,e,e.next)<0?nc(e,t,e.next)>=0&&nc(e,e.prev,t)>=0:nc(e,t,e.prev)<0||nc(e,e.next,t)<0}function lc(e,t){const n=dc(e.i,e.x,e.y),i=dc(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function cc(e,t,n,i){const r=dc(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function hc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function dc(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class uc{static triangulate(e,t,n=2){return zl(e,t,n)}}class pc{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return pc.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];mc(e),fc(n,e);let s=e.length;t.forEach(mc);for(let o=0;o<t.length;o++)i.push(s),s+=t[o].length,fc(n,t[o]);const a=uc.triangulate(n,i);for(let o=0;o<a.length;o+=3)r.push(a.slice(o,o+3));return r}}function mc(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function fc(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class gc extends Ps{constructor(e=new Bl([new hi(.5,.5),new hi(-.5,.5),new hi(-.5,-.5),new hi(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let a=0,o=e.length;a<o;a++){s(e[a])}function s(e){const s=[],a=void 0!==t.curveSegments?t.curveSegments:12,o=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:.2,d=void 0!==t.bevelSize?t.bevelSize:h-.1,u=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const m=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:vc;let g,v,x,y,_,b=!1;m&&(g=m.getSpacedPoints(o),b=!0,c=!1,v=m.computeFrenetFrames(o,!1),x=new ui,y=new ui,_=new ui),c||(p=0,h=0,d=0,u=0);const w=e.extractPoints(a);let M=w.shape;const S=w.holes;if(!pc.isClockWise(M)){M=M.reverse();for(let e=0,t=S.length;e<t;e++){const t=S[e];pc.isClockWise(t)&&(S[e]=t.reverse())}}function T(e){const t=1e-10*1e-10;let n=e[0];for(let i=1;i<=e.length;i++){const r=i%e.length,s=e[r],a=s.x-n.x,o=s.y-n.y,l=a*a+o*o,c=Math.max(Math.abs(s.x),Math.abs(s.y),Math.abs(n.x),Math.abs(n.y));l<=t*c*c?(e.splice(r,1),i--):n=s}}T(M),S.forEach(T);const E=S.length,A=M;for(let t=0;t<E;t++){const e=S[t];M=M.concat(e)}function C(e,t,n){return e.clone().addScaledVector(t,n)}const R=M.length;function N(e,t,n){let i,r,s;const a=e.x-t.x,o=e.y-t.y,l=n.x-e.x,c=n.y-e.y,h=a*a+o*o,d=a*c-o*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(h),u=Math.sqrt(l*l+c*c),p=t.x-o/d,m=t.y+a/d,f=((n.x-c/u-p)*c-(n.y+l/u-m)*l)/(a*c-o*l);i=p+a*f-e.x,r=m+o*f-e.y;const g=i*i+r*r;if(g<=2)return new hi(i,r);s=Math.sqrt(g/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(i=-o,r=a,s=Math.sqrt(h)):(i=a,r=o,s=Math.sqrt(h/2))}return new hi(i/s,r/s)}const I=[];for(let t=0,n=A.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),I[t]=N(A[t],A[i],A[r]);const P=[];let L,D,k=I.concat();for(let t=0,n=E;t<n;t++){const e=S[t];L=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),L[t]=N(e[t],e[i],e[r]);P.push(L),k=k.concat(L)}if(0===p)D=pc.triangulateShape(A,S);else{const e=[],t=[];for(let n=0;n<p;n++){const i=n/p,r=h*Math.cos(i*Math.PI/2),s=d*Math.sin(i*Math.PI/2)+u;for(let t=0,n=A.length;t<n;t++){const n=C(A[t],I[t],s);B(n.x,n.y,-r),0===i&&e.push(n)}for(let e=0,n=E;e<n;e++){const n=S[e];L=P[e];const a=[];for(let e=0,t=n.length;e<t;e++){const t=C(n[e],L[e],s);B(t.x,t.y,-r),0===i&&a.push(t)}0===i&&t.push(a)}}D=pc.triangulateShape(e,t)}const U=D.length,O=d+u;for(let t=0;t<R;t++){const e=c?C(M[t],k[t],O):M[t];b?(y.copy(v.normals[0]).multiplyScalar(e.x),x.copy(v.binormals[0]).multiplyScalar(e.y),_.copy(g[0]).add(y).add(x),B(_.x,_.y,_.z)):B(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<R;e++){const n=c?C(M[e],k[e],O):M[e];b?(y.copy(v.normals[t]).multiplyScalar(n.x),x.copy(v.binormals[t]).multiplyScalar(n.y),_.copy(g[t]).add(y).add(x),B(_.x,_.y,_.z)):B(n.x,n.y,l/o*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=h*Math.cos(e*Math.PI/2),i=d*Math.sin(e*Math.PI/2)+u;for(let t=0,r=A.length;t<r;t++){const e=C(A[t],I[t],i);B(e.x,e.y,l+n)}for(let t=0,r=S.length;t<r;t++){const e=S[t];L=P[t];for(let t=0,r=e.length;t<r;t++){const r=C(e[t],L[t],i);b?B(r.x,r.y+g[o-1].y,g[o-1].x+n):B(r.x,r.y,l+n)}}}function F(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=o+2*p;e<n;e++){const n=R*e,s=R*(e+1);j(t+i+n,t+r+n,t+r+s,t+i+s)}}}function B(e,t,n){s.push(e),s.push(t),s.push(n)}function z(e,t,r){V(e),V(t),V(r);const s=i.length/3,a=f.generateTopUV(n,i,s-3,s-2,s-1);H(a[0]),H(a[1]),H(a[2])}function j(e,t,r,s){V(e),V(t),V(s),V(t),V(r),V(s);const a=i.length/3,o=f.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);H(o[0]),H(o[1]),H(o[3]),H(o[1]),H(o[2]),H(o[3])}function V(e){i.push(s[3*e+0]),i.push(s[3*e+1]),i.push(s[3*e+2])}function H(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(c){let e=0,t=R*e;for(let n=0;n<U;n++){const e=D[n];z(e[2]+t,e[1]+t,e[0]+t)}e=o+2*p,t=R*e;for(let n=0;n<U;n++){const e=D[n];z(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<U;e++){const t=D[e];z(t[2],t[1],t[0])}for(let e=0;e<U;e++){const t=D[e];z(t[0]+R*o,t[1]+R*o,t[2]+R*o)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;F(A,t),t+=A.length;for(let n=0,i=S.length;n<i;n++){const e=S[n];F(e,t),t+=e.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new Ss(i,3)),this.setAttribute("uv",new Ss(r,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const t=e[i];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,s=e.shapes.length;r<s;r++){const i=t[e.shapes[r]];n.push(i)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new Ul[i.type]).fromJSON(i)),new gc(n,e.options)}}const vc={generateTopUV:function(e,t,n,i,r){const s=t[3*n],a=t[3*n+1],o=t[3*i],l=t[3*i+1],c=t[3*r],h=t[3*r+1];return[new hi(s,a),new hi(o,l),new hi(c,h)]},generateSideWallUV:function(e,t,n,i,r,s){const a=t[3*n],o=t[3*n+1],l=t[3*n+2],c=t[3*i],h=t[3*i+1],d=t[3*i+2],u=t[3*r],p=t[3*r+1],m=t[3*r+2],f=t[3*s],g=t[3*s+1],v=t[3*s+2];return Math.abs(o-h)<Math.abs(a-c)?[new hi(a,1-l),new hi(c,1-d),new hi(u,1-m),new hi(f,1-v)]:[new hi(o,1-l),new hi(h,1-d),new hi(p,1-m),new hi(g,1-v)]}};class xc extends hl{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new xc(e.radius,e.detail)}}class yc extends Ps{constructor(e=[new hi(0,-.5),new hi(.5,0),new hi(0,.5)],t=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=ri(i,0,2*Math.PI);const r=[],s=[],a=[],o=[],l=[],c=1/t,h=new ui,d=new hi,u=new ui,p=new ui,m=new ui;let f=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:f=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,u.x=1*g,u.y=-f,u.z=0*g,m.copy(u),u.normalize(),o.push(u.x,u.y,u.z);break;case e.length-1:o.push(m.x,m.y,m.z);break;default:f=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,u.x=1*g,u.y=-f,u.z=0*g,p.copy(u),u.x+=m.x,u.y+=m.y,u.z+=m.z,u.normalize(),o.push(u.x,u.y,u.z),m.copy(p)}for(let v=0;v<=t;v++){const r=n+v*c*i,u=Math.sin(r),p=Math.cos(r);for(let n=0;n<=e.length-1;n++){h.x=e[n].x*u,h.y=e[n].y,h.z=e[n].x*p,s.push(h.x,h.y,h.z),d.x=v/t,d.y=n/(e.length-1),a.push(d.x,d.y);const i=o[3*n+0]*u,r=o[3*n+1],c=o[3*n+0]*p;l.push(i,r,c)}}for(let v=0;v<t;v++)for(let t=0;t<e.length-1;t++){const n=t+v*e.length,i=n,s=n+e.length,a=n+e.length+1,o=n+1;r.push(i,s,o),r.push(a,o,s)}this.setIndex(r),this.setAttribute("position",new Ss(s,3)),this.setAttribute("uv",new Ss(a,2)),this.setAttribute("normal",new Ss(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yc(e.points,e.segments,e.phiStart,e.phiLength)}}class _c extends hl{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _c(e.radius,e.detail)}}class bc extends Ps{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,s=t/2,a=Math.floor(n),o=Math.floor(i),l=a+1,c=o+1,h=e/a,d=t/o,u=[],p=[],m=[],f=[];for(let g=0;g<c;g++){const e=g*d-s;for(let t=0;t<l;t++){const n=t*h-r;p.push(n,-e,0),m.push(0,0,1),f.push(t/a),f.push(1-g/o)}}for(let g=0;g<o;g++)for(let e=0;e<a;e++){const t=e+l*g,n=e+l*(g+1),i=e+1+l*(g+1),r=e+1+l*g;u.push(t,n,r),u.push(n,i,r)}this.setIndex(u),this.setAttribute("position",new Ss(p,3)),this.setAttribute("normal",new Ss(m,3)),this.setAttribute("uv",new Ss(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bc(e.width,e.height,e.widthSegments,e.heightSegments)}}class wc extends Ps{constructor(e=.5,t=1,n=32,i=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n);const a=[],o=[],l=[],c=[];let h=e;const d=(t-e)/(i=Math.max(1,i)),u=new ui,p=new hi;for(let m=0;m<=i;m++){for(let e=0;e<=n;e++){const i=r+e/n*s;u.x=h*Math.cos(i),u.y=h*Math.sin(i),o.push(u.x,u.y,u.z),l.push(0,0,1),p.x=(u.x/t+1)/2,p.y=(u.y/t+1)/2,c.push(p.x,p.y)}h+=d}for(let m=0;m<i;m++){const e=m*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,s=i+n+1,o=i+n+2,l=i+1;a.push(r,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new Ss(o,3)),this.setAttribute("normal",new Ss(l,3)),this.setAttribute("uv",new Ss(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wc(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Mc extends Ps{constructor(e=new Bl([new hi(0,.5),new hi(-.5,-.5),new hi(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(a,o,c),a+=o,o=0;function l(e){const a=i.length/3,l=e.extractPoints(t);let c=l.shape;const h=l.holes;!1===pc.isClockWise(c)&&(c=c.reverse());for(let t=0,n=h.length;t<n;t++){const e=h[t];!0===pc.isClockWise(e)&&(h[t]=e.reverse())}const d=pc.triangulateShape(c,h);for(let t=0,n=h.length;t<n;t++){const e=h[t];c=c.concat(e)}for(let t=0,n=c.length;t<n;t++){const e=c[t];i.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,i=d.length;t<i;t++){const e=d[t],i=e[0]+a,r=e[1]+a,s=e[2]+a;n.push(i,r,s),o+=3}}this.setIndex(n),this.setAttribute("position",new Ss(i,3)),this.setAttribute("normal",new Ss(r,3)),this.setAttribute("uv",new Ss(s,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}return new Mc(n,e.curveSegments)}}class Sc extends Ps{constructor(e=1,t=32,n=16,i=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let l=0;const c=[],h=new ui,d=new ui,u=[],p=[],m=[],f=[];for(let g=0;g<=n;g++){const u=[],v=g/n;let x=0;0===g&&0===s?x=.5/t:g===n&&o===Math.PI&&(x=-.5/t);for(let n=0;n<=t;n++){const o=n/t;h.x=-e*Math.cos(i+o*r)*Math.sin(s+v*a),h.y=e*Math.cos(s+v*a),h.z=e*Math.sin(i+o*r)*Math.sin(s+v*a),p.push(h.x,h.y,h.z),d.copy(h).normalize(),m.push(d.x,d.y,d.z),f.push(o+x,1-v),u.push(l++)}c.push(u)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=c[g][e+1],i=c[g][e],r=c[g+1][e],a=c[g+1][e+1];(0!==g||s>0)&&u.push(t,i,a),(g!==n-1||o<Math.PI)&&u.push(i,r,a)}this.setIndex(u),this.setAttribute("position",new Ss(p,3)),this.setAttribute("normal",new Ss(m,3)),this.setAttribute("uv",new Ss(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sc(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Tc extends hl{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Tc(e.radius,e.detail)}}class Ec extends Ps{constructor(e=1,t=.4,n=12,i=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],o=[],l=[],c=new ui,h=new ui,d=new ui;for(let u=0;u<=n;u++)for(let s=0;s<=i;s++){const p=s/i*r,m=u/n*Math.PI*2;h.x=(e+t*Math.cos(m))*Math.cos(p),h.y=(e+t*Math.cos(m))*Math.sin(p),h.z=t*Math.sin(m),a.push(h.x,h.y,h.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),d.subVectors(h,c).normalize(),o.push(d.x,d.y,d.z),l.push(s/i),l.push(u/n)}for(let u=1;u<=n;u++)for(let e=1;e<=i;e++){const t=(i+1)*u+e-1,n=(i+1)*(u-1)+e-1,r=(i+1)*(u-1)+e,a=(i+1)*u+e;s.push(t,n,a),s.push(n,r,a)}this.setIndex(s),this.setAttribute("position",new Ss(a,3)),this.setAttribute("normal",new Ss(o,3)),this.setAttribute("uv",new Ss(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ec(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Ac extends Ps{constructor(e=1,t=.4,n=64,i=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],l=[],c=[],h=new ui,d=new ui,u=new ui,p=new ui,m=new ui,f=new ui,g=new ui;for(let x=0;x<=n;++x){const a=x/n*r*Math.PI*2;v(a,r,s,e,u),v(a+.01,r,s,e,p),f.subVectors(p,u),g.addVectors(p,u),m.crossVectors(f,g),g.crossVectors(m,f),m.normalize(),g.normalize();for(let e=0;e<=i;++e){const r=e/i*Math.PI*2,s=-t*Math.cos(r),a=t*Math.sin(r);h.x=u.x+(s*g.x+a*m.x),h.y=u.y+(s*g.y+a*m.y),h.z=u.z+(s*g.z+a*m.z),o.push(h.x,h.y,h.z),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(x/n),c.push(e/i)}}for(let x=1;x<=n;x++)for(let e=1;e<=i;e++){const t=(i+1)*(x-1)+(e-1),n=(i+1)*x+(e-1),r=(i+1)*x+e,s=(i+1)*(x-1)+e;a.push(t,n,s),a.push(n,r,s)}function v(e,t,n,i,r){const s=Math.cos(e),a=Math.sin(e),o=n/t*e,l=Math.cos(o);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new Ss(o,3)),this.setAttribute("normal",new Ss(l,3)),this.setAttribute("uv",new Ss(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ac(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Cc extends Ps{constructor(e=new Dl(new ui(-1,-1,0),new ui(-1,1,0),new ui(1,1,0)),t=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const s=e.computeFrenetFrames(t,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new ui,o=new ui,l=new hi;let c=new ui;const h=[],d=[],u=[],p=[];function m(r){c=e.getPointAt(r/t,c);const l=s.normals[r],u=s.binormals[r];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,r=Math.sin(t),s=-Math.cos(t);o.x=s*l.x+r*u.x,o.y=s*l.y+r*u.y,o.z=s*l.z+r*u.z,o.normalize(),d.push(o.x,o.y,o.z),a.x=c.x+n*o.x,a.y=c.y+n*o.y,a.z=c.z+n*o.z,h.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)m(e);m(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)l.x=e/t,l.y=n/i,u.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),s=(i+1)*e+t,a=(i+1)*(e-1)+t;p.push(n,r,a),p.push(r,s,a)}}()}(),this.setIndex(p),this.setAttribute("position",new Ss(h,3)),this.setAttribute("normal",new Ss(d,3)),this.setAttribute("uv",new Ss(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Cc((new Ul[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Rc extends Ps{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,i=new ui,r=new ui;if(null!==e.index){const s=e.attributes.position,a=e.index;let o=e.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,l=o.length;e<l;++e){const l=o[e],c=l.start;for(let e=c,o=c+l.count;e<o;e+=3)for(let l=0;l<3;l++){const o=a.getX(e+l),c=a.getX(e+(l+1)%3);i.fromBufferAttribute(s,o),r.fromBufferAttribute(s,c),!0===Nc(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}}else{const s=e.attributes.position;for(let e=0,a=s.count/3;e<a;e++)for(let o=0;o<3;o++){const a=3*e+o,l=3*e+(o+1)%3;i.fromBufferAttribute(s,a),r.fromBufferAttribute(s,l),!0===Nc(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new Ss(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Nc(e,t,n){const i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var Ic=Object.freeze({__proto__:null,BoxGeometry:Xs,CapsuleGeometry:al,CircleGeometry:ol,ConeGeometry:cl,CylinderGeometry:ll,DodecahedronGeometry:dl,EdgesGeometry:gl,ExtrudeGeometry:gc,IcosahedronGeometry:xc,LatheGeometry:yc,OctahedronGeometry:_c,PlaneGeometry:bc,PolyhedronGeometry:hl,RingGeometry:wc,ShapeGeometry:Mc,SphereGeometry:Sc,TetrahedronGeometry:Tc,TorusGeometry:Ec,TorusKnotGeometry:Ac,TubeGeometry:Cc,WireframeGeometry:Rc});class Pc extends ds{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ls(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Lc extends Js{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Dc extends ds{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new ls(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ls(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Er,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class kc extends Dc{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new hi(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ri(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ls(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ls(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ls(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Uc extends ds{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ls(16777215),this.specular=new ls(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ls(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Er,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Oc extends ds{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ls(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ls(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Fc extends ds{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Bc extends ds{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ls(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ls(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Er,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class zc extends ds{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class jc extends ds{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class Vc extends ds{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ls(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Hc extends Uo{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Gc(e,t){return e&&e.constructor!==t?"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}function Wc(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Xc(e){const t=e.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n}function qc(e,t,n){const i=e.length,r=new e.constructor(i);for(let s=0,a=0;a!==i;++s){const i=n[s]*t;for(let n=0;n!==t;++n)r[a++]=e[i+n]}return r}function Yc(e,t,n,i){let r=1,s=e[0];for(;void 0!==s&&void 0===s[i];)s=e[r++];if(void 0===s)return;let a=s[i];if(void 0!==a)if(Array.isArray(a))do{a=s[i],void 0!==a&&(t.push(s.time),n.push(...a)),s=e[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[i],void 0!==a&&(t.push(s.time),a.toArray(n,n.length)),s=e[r++]}while(void 0!==s);else do{a=s[i],void 0!==a&&(t.push(s.time),n.push(a)),s=e[r++]}while(void 0!==s)}class Zc{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let s=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(e>=r)break e;{const a=t[1];e<a&&(n=2,r=a);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0}}for(;n<s;){const i=n+s>>>1;e<t[i]?s=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let s=0;s!==i;++s)t[s]=n[r+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class $c extends Zc{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Rn,endingEnd:Rn}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,s=e+1,a=i[r],o=i[s];if(void 0===a)switch(this.getSettings_().endingStart){case Nn:r=e,a=2*t-n;break;case In:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case Nn:s=e,o=2*n-t;break;case In:s=1,o=n+i[1]-i[0];break;default:s=e-1,o=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,u=this._weightNext,p=(n-t)/(i-t),m=p*p,f=m*p,g=-d*f+2*d*m-d*p,v=(1+d)*f+(-1.5-2*d)*m+(-.5+d)*p+1,x=(-1-u)*f+(1.5+u)*m+.5*p,y=u*f-u*m;for(let _=0;_!==a;++_)r[_]=g*s[c+_]+v*s[l+_]+x*s[o+_]+y*s[h+_];return r}}class Jc extends Zc{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(n-t)/(i-t),h=1-c;for(let d=0;d!==a;++d)r[d]=s[l+d]*h+s[o+d]*c;return r}}class Kc extends Zc{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Qc{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Gc(t,this.TimeBufferType),this.values=Gc(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Gc(e.times,Array),values:Gc(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Kc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Jc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new $c(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case En:t=this.InterpolantFactoryMethodDiscrete;break;case An:t=this.InterpolantFactoryMethodLinear;break;case Cn:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return En;case this.InterpolantFactoryMethodLinear:return An;case this.InterpolantFactoryMethodSmooth:return Cn}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=n.slice(r,s),this.values=this.values.slice(r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(e=!1);let s=null;for(let a=0;a!==r;a++){const t=n[a];if("number"==typeof t&&isNaN(t)){e=!1;break}if(null!==s&&s>t){e=!1;break}s=t}if(void 0!==i&&Wc(i))for(let a=0,o=i.length;a!==o;++a){const t=i[a];if(isNaN(t)){e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Cn,r=e.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(i)r=!0;else{const e=a*n,i=e-n,s=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[i+a]||n!==t[s+a]){r=!0;break}}}if(r){if(a!==s){e[s]=e[a];const i=a*n,r=s*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*n,i=s*n,a=0;a!==n;++a)t[i+a]=t[e+a];++s}return s!==e.length?(this.times=e.slice(0,s),this.values=t.slice(0,s*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Qc.prototype.ValueTypeName="",Qc.prototype.TimeBufferType=Float32Array,Qc.prototype.ValueBufferType=Float32Array,Qc.prototype.DefaultInterpolation=An;class eh extends Qc{constructor(e,t,n){super(e,t,n)}}eh.prototype.ValueTypeName="bool",eh.prototype.ValueBufferType=Array,eh.prototype.DefaultInterpolation=En,eh.prototype.InterpolantFactoryMethodLinear=void 0,eh.prototype.InterpolantFactoryMethodSmooth=void 0;class th extends Qc{constructor(e,t,n,i){super(e,t,n,i)}}th.prototype.ValueTypeName="color";class nh extends Qc{constructor(e,t,n,i){super(e,t,n,i)}}nh.prototype.ValueTypeName="number";class ih extends Zc{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-t)/(i-t);let l=e*a;for(let c=l+a;l!==c;l+=4)di.slerpFlat(r,0,s,l-a,s,l,o);return r}}class rh extends Qc{constructor(e,t,n,i){super(e,t,n,i)}InterpolantFactoryMethodLinear(e){return new ih(this.times,this.values,this.getValueSize(),e)}}rh.prototype.ValueTypeName="quaternion",rh.prototype.InterpolantFactoryMethodSmooth=void 0;class sh extends Qc{constructor(e,t,n){super(e,t,n)}}sh.prototype.ValueTypeName="string",sh.prototype.ValueBufferType=Array,sh.prototype.DefaultInterpolation=En,sh.prototype.InterpolantFactoryMethodLinear=void 0,sh.prototype.InterpolantFactoryMethodSmooth=void 0;class ah extends Qc{constructor(e,t,n,i){super(e,t,n,i)}}ah.prototype.ValueTypeName="vector";class oh{constructor(e="",t=-1,n=[],i=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=ii(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let s=0,a=n.length;s!==a;++s)t.push(lh(n[s]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=n.length;r!==s;++r)t.push(Qc.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,s=[];for(let a=0;a<r;a++){let e=[],o=[];e.push((a+r-1)%r,a,(a+1)%r),o.push(0,1,0);const l=Xc(e);e=qc(e,1,l),o=qc(o,1,l),i||0!==e[0]||(e.push(r),o.push(o[0])),s.push(new nh(".morphTargetInfluences["+t[a].name+"]",e,o).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){const t=e[a],n=t.name.match(r);if(n&&n.length>1){const e=n[1];let r=i[e];r||(i[e]=r=[]),r.push(t)}}const s=[];for(const a in i)s.push(this.CreateFromMorphTargetSequence(a,i[a],t,n));return s}static parseAnimation(e,t){if(!e)return null;const n=function(e,t,n,i,r){if(0!==n.length){const s=[],a=[];Yc(n,s,a,i),0!==s.length&&r.push(new e(t,s,a))}},i=[],r=e.name||"default",s=e.fps||30,a=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let i=0;i<e[n].morphTargets.length;i++)t[e[n].morphTargets[i]]=-1;for(const r in t){const t=[],s=[];for(let i=0;i!==e[n].morphTargets.length;++i){const i=e[n];t.push(i.time),s.push(i.morphTarget===r?1:0)}i.push(new nh(".morphTargetInfluence["+r+"]",t,s))}o=t.length*s}else{const r=".bones["+t[c].name+"]";n(ah,r+".position",e,"pos",i),n(rh,r+".quaternion",e,"rot",i),n(ah,r+".scale",e,"scl",i)}}if(0===i.length)return null;return new this(r,o,i,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function lh(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return nh;case"vector":case"vector2":case"vector3":case"vector4":return ah;case"color":return th;case"quaternion":return rh;case"bool":case"boolean":return eh;case"string":return sh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];Yc(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const ch={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class hh{constructor(e,t,n){const i=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.abortController=new AbortController,this.itemStart=function(e){o++,!1===s&&void 0!==i.onStart&&i.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const dh=new hh;class uh{constructor(e){this.manager=void 0!==e?e:dh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}uh.DEFAULT_MATERIAL_NAME="__DEFAULT";const ph={};class mh extends Error{constructor(e,t){super(e),this.response=t}}class fh extends uh{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=ch.get(`file:${e}`);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==ph[e])return void ph[e].push({onLoad:t,onProgress:n,onError:i});ph[e]=[],ph[e].push({onLoad:t,onProgress:n,onError:i});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:"function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),a=this.mimeType,o=this.responseType;fetch(s).then((t=>{if(200===t.status||0===t.status){if(t.status,"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=ph[e],i=t.body.getReader(),r=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),s=r?parseInt(r):0,a=0!==s;let o=0;const l=new ReadableStream({start(e){!function t(){i.read().then((({done:i,value:r})=>{if(i)e.close();else{o+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(r),t()}}),(t=>{e.error(t)}))}()}});return new Response(l)}throw new mh(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,a)));case"json":return e.json();default:if(""===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{ch.add(`file:${e}`,t);const n=ph[e];delete ph[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{const n=ph[e];if(void 0===n)throw this.manager.itemError(e),t;delete ph[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}const gh=new WeakMap;class vh extends uh{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=ch.get(`image:${e}`);if(void 0!==s){if(!0===s.complete)r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0);else{let e=gh.get(s);void 0===e&&(e=[],gh.set(s,e)),e.push({onLoad:t,onError:i})}return s}const a=_i("img");function o(){c(),t&&t(this);const n=gh.get(this)||[];for(let e=0;e<n.length;e++){const t=n[e];t.onLoad&&t.onLoad(this)}gh.delete(this),r.manager.itemEnd(e)}function l(t){c(),i&&i(t),ch.remove(`image:${e}`);const n=gh.get(this)||[];for(let e=0;e<n.length;e++){const i=n[e];i.onError&&i.onError(t)}gh.delete(this),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),ch.add(`image:${e}`,a),r.manager.itemStart(e),a.src=e,a}}class xh extends uh{constructor(e){super(e)}load(e,t,n,i){const r=new sa;r.colorSpace=kn;const s=new vh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(n){s.load(e[n],(function(e){r.images[n]=e,a++,6===a&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(let l=0;l<e.length;++l)o(l);return r}}class yh extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new Xa,a=new fh(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,(function(e){let n;try{n=r.parse(e)}catch(a){if(void 0===i)return;i(a)}void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:gt,s.wrapT=void 0!==n.wrapT?n.wrapT:gt,s.magFilter=void 0!==n.magFilter?n.magFilter:bt,s.minFilter=void 0!==n.minFilter?n.minFilter:bt,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(s.colorSpace=n.colorSpace),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=Mt),1===n.mipmapCount&&(s.minFilter=bt),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,t&&t(s,n)}),n,i),s}}class _h extends Hr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ls(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}class bh extends _h{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Hr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ls(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const wh=new gr,Mh=new ui,Sh=new ui;class Th{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new hi(512,512),this.mapType=Tt,this.map=null,this.mapPass=null,this.matrix=new gr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new po,this._frameExtents=new hi(1,1),this._viewportCount=1,this._viewports=[new Fi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Mh.setFromMatrixPosition(e.matrixWorld),t.position.copy(Mh),Sh.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Sh),t.updateMatrixWorld(),wh.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(wh,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(wh)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Eh extends Th{constructor(){super(new na(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=2*ni*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Ah extends _h{constructor(e,t,n=0,i=Math.PI/3,r=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Hr.DEFAULT_UP),this.updateMatrix(),this.target=new Hr,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new Eh}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Ch=new gr,Rh=new ui,Nh=new ui;class Ih extends Th{constructor(){super(new na(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new hi(4,2),this._viewportCount=6,this._viewports=[new Fi(2,1,1,1),new Fi(0,1,1,1),new Fi(3,1,1,1),new Fi(1,1,1,1),new Fi(3,0,1,1),new Fi(1,0,1,1)],this._cubeDirections=[new ui(1,0,0),new ui(-1,0,0),new ui(0,0,1),new ui(0,0,-1),new ui(0,1,0),new ui(0,-1,0)],this._cubeUps=[new ui(0,1,0),new ui(0,1,0),new ui(0,1,0),new ui(0,1,0),new ui(0,0,1),new ui(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Rh.setFromMatrixPosition(e.matrixWorld),n.position.copy(Rh),Nh.copy(n.position),Nh.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Nh),n.updateMatrixWorld(),i.makeTranslation(-Rh.x,-Rh.y,-Rh.z),Ch.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ch,n.coordinateSystem,n.reversedDepth)}}class Ph extends _h{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Ih}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Lh extends Ks{constructor(e=-1,t=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,s=n+e,a=i+t,o=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class Dh extends Th{constructor(){super(new Lh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class kh extends _h{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Hr.DEFAULT_UP),this.updateMatrix(),this.target=new Hr,this.shadow=new Dh}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Uh extends _h{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Oh extends _h{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Fh{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ui)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*i),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],n*i*1.092548),t.addScaledVector(s[5],i*r*1.092548),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],n*r*1.092548),t.addScaledVector(s[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*i),t.addScaledVector(s[2],1.023328*r),t.addScaledVector(s[3],1.023328*n),t.addScaledVector(s[4],.858086*n*i),t.addScaledVector(s[5],.858086*i*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],.858086*n*r),t.addScaledVector(s[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}class Bh extends _h{constructor(e=new Fh,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class zh extends uh{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,s=new fh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(s){i&&i(s),r.manager.itemError(e)}}),n,i)}parse(e){const t=this.textures;function n(e){return t[e],t[e]}const i=this.createMaterialFromType(e.type);if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new ls).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(i.dispersion=e.dispersion),void 0!==e.iridescence&&(i.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(i.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(i.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(i.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(i.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(i.depthFunc=e.depthFunc),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(i.blendSrc=e.blendSrc),void 0!==e.blendDst&&(i.blendDst=e.blendDst),void 0!==e.blendEquation&&(i.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(i.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(i.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(i.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(i.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),void 0!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(i.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const r in e.uniforms){const t=e.uniforms[r];switch(i.uniforms[r]={},t.type){case"t":i.uniforms[r].value=n(t.value);break;case"c":i.uniforms[r].value=(new ls).setHex(t.value);break;case"v2":i.uniforms[r].value=(new hi).fromArray(t.value);break;case"v3":i.uniforms[r].value=(new ui).fromArray(t.value);break;case"v4":i.uniforms[r].value=(new Fi).fromArray(t.value);break;case"m3":i.uniforms[r].value=(new fi).fromArray(t.value);break;case"m4":i.uniforms[r].value=(new gr).fromArray(t.value);break;default:i.uniforms[r].value=t.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(i.glslVersion=e.glslVersion),void 0!==e.extensions)for(const r in e.extensions)i.extensions[r]=e.extensions[r];if(void 0!==e.lights&&(i.lights=e.lights),void 0!==e.clipping&&(i.clipping=e.clipping),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new hi).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapRotation&&i.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new hi).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(i.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(i.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return zh.createMaterialFromType(e)}static createMaterialFromType(e){return new{ShadowMaterial:Pc,SpriteMaterial:ga,RawShaderMaterial:Lc,ShaderMaterial:Js,PointsMaterial:$o,MeshPhysicalMaterial:kc,MeshStandardMaterial:Dc,MeshPhongMaterial:Uc,MeshToonMaterial:Oc,MeshNormalMaterial:Fc,MeshLambertMaterial:Bc,MeshDepthMaterial:zc,MeshDistanceMaterial:jc,MeshBasicMaterial:us,MeshMatcapMaterial:Vc,LineDashedMaterial:Hc,LineBasicMaterial:Uo,Material:ds}[e]}}class jh{static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Vh extends Ps{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Hh extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new fh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(s){i&&i(s),r.manager.itemError(e)}}),n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const r=e.interleavedBuffers[i],s=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers,r=i[t],s=new Uint32Array(r).buffer;return n[t]=s,s}(e,r.buffer),a=yi(r.type,s),o=new pa(a,r.stride);return o.uuid=r.uuid,t[i]=o,o}const r=e.isInstancedBufferGeometry?new Vh:new Ps,s=e.data.index;if(void 0!==s){const e=yi(s.type,s.array);r.setIndex(new bs(e,1))}const a=e.data.attributes;for(const h in a){const t=a[h];let n;if(t.isInterleavedBufferAttribute){const r=i(e.data,t.data);n=new fa(r,t.itemSize,t.offset,t.normalized)}else{const e=yi(t.type,t.array);n=new(t.isInstancedBufferAttribute?$a:bs)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),void 0!==t.usage&&n.setUsage(t.usage),r.setAttribute(h,n)}const o=e.data.morphAttributes;if(o)for(const h in o){const t=o[h],n=[];for(let r=0,s=t.length;r<s;r++){const s=t[r];let a;if(s.isInterleavedBufferAttribute){const t=i(e.data,s.data);a=new fa(t,s.itemSize,s.offset,s.normalized)}else{const e=yi(s.type,s.array);a=new bs(e,s.itemSize,s.normalized)}void 0!==s.name&&(a.name=s.name),n.push(a)}r.morphAttributes[h]=n}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let h=0,d=l.length;h!==d;++h){const e=l[h];r.addGroup(e.start,e.count,e.materialIndex)}const c=e.data.boundingSphere;return void 0!==c&&(r.boundingSphere=(new or).fromJSON(c)),e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}const Gh={UVMapping:ct,CubeReflectionMapping:ht,CubeRefractionMapping:dt,EquirectangularReflectionMapping:ut,EquirectangularRefractionMapping:pt,CubeUVReflectionMapping:mt},Wh={RepeatWrapping:ft,ClampToEdgeWrapping:gt,MirroredRepeatWrapping:vt},Xh={NearestFilter:xt,NearestMipmapNearestFilter:yt,NearestMipmapLinearFilter:_t,LinearFilter:bt,LinearMipmapNearestFilter:wt,LinearMipmapLinearFilter:Mt},qh=new WeakMap;let Yh;class Zh{static getContext(){return void 0===Yh&&(Yh=new(window.AudioContext||window.webkitAudioContext)),Yh}static setContext(e){Yh=e}}const $h=new gr,Jh=new gr,Kh=new gr;class Qh extends na{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class ed{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const td=new ui,nd=new di,id=new ui,rd=new ui,sd=new ui;class ad extends Hr{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return;if(!1===this.hasPlaybackControl)return;this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1!==this.hasPlaybackControl&&this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),"buffer"!==e.sourceType||(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice()),this}clone(e){return new this.constructor(this.listener).copy(this,e)}}const od=new ui,ld=new di,cd=new ui,hd=new ui;class dd{constructor(e,t,n){let i,r,s;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==i;++e)n[r+e]=n[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(n[o]!==n[o+t]){a.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,s=i;r!==s;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let s=0;s!==r;++s)e[t+s]=e[n+s]}_slerp(e,t,n,i){di.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const s=this._workIndex*r;di.multiplyQuaternionsFlat(e,s,e,t,e,n),di.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,n,i,r){const s=1-i;for(let a=0;a!==r;++a){const r=t+a;e[r]=e[r]*s+e[n+a]*i}}_lerpAdditive(e,t,n,i,r){for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]+e[n+s]*i}}}const ud="\\[\\]\\.:\\/",pd=new RegExp("["+ud+"]","g"),md="[^"+ud+"]",fd="[^"+ud.replace("\\.","")+"]",gd=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",md)+/(WCOD+)?/.source.replace("WCOD",fd)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",md)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",md)+"$"),vd=["material","materials","bones","map"];class xd{constructor(e,t,n){this.path=t,this.parsedPath=n||xd.parseTrackName(t),this.node=xd.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new xd.Composite(e,t,n):new xd(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(pd,"")}static parseTrackName(e){const t=gd.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==vd.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const s=n(r.children);if(s)return s}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=xd.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return;if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return;if(!e.material.materials)return;e=e.material.materials;break;case"bones":if(!e.skeleton)return;e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return;if(!e.material.map)return;e=e.material.map;break;default:if(void 0===e[n])return;e=e[n]}if(void 0!==i){if(void 0===e[i])return;e=e[i]}}const s=e[i];if(void 0===s){t.nodeName;return}let a=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?a=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return;if(!e.geometry.morphAttributes)return;void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}xd.Composite=class{constructor(e,t,n){const i=n||xd.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},xd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},xd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},xd.prototype.GetterByBindingType=[xd.prototype._getValue_direct,xd.prototype._getValue_array,xd.prototype._getValue_arrayElement,xd.prototype._getValue_toArray],xd.prototype.SetterByBindingTypeAndVersioning=[[xd.prototype._setValue_direct,xd.prototype._setValue_direct_setNeedsUpdate,xd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[xd.prototype._setValue_array,xd.prototype._setValue_array_setNeedsUpdate,xd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[xd.prototype._setValue_arrayElement,xd.prototype._setValue_arrayElement_setNeedsUpdate,xd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[xd.prototype._setValue_fromArray,xd.prototype._setValue_fromArray_setNeedsUpdate,xd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class yd{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,s=r.length,a=new Array(s),o={endingStart:Rn,endingEnd:Rn};for(let l=0;l!==s;++l){const e=r[l].createInterpolant(null);a[l]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),!0===n){const n=this._clip.duration,i=e._clip.duration,r=i/n,s=n/i;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+n,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;i<0||0===n?t=0:(this._startTime=null,t=n*i)}t*=this._updateTimeScale(e);const s=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Ln)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(s),t[n].accumulateAdditive(a);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(s),t[n].accumulate(i,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const s=2202===n;if(0===e)return-1===r||!s||1&~r?i:t-i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&!(1&~r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=Nn,i.endingEnd=Nn):(i.endingStart=e?this.zeroSlopeAtStart?Nn:Rn:In,i.endingEnd=t?this.zeroSlopeAtEnd?Nn:Rn:In)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=t,a[1]=r+e,o[1]=n,this}}const _d=new Float32Array(1);class bd{constructor(e){this.value=e}clone(){return new bd(void 0===this.value.clone?this.value:this.value.clone())}}let wd=0;const Md=new gr;class Sd{constructor(e,t,n=0,i=1/0){this.ray=new fr(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new Ar,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera&&(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t)}setFromXRController(e){return Md.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Md),this}intersectObject(e,t=!0,n=[]){return Ed(e,this,n,t),n.sort(Td),n}intersectObjects(e,t=!0,n=[]){for(let i=0,r=e.length;i<r;i++)Ed(e[i],this,n,t);return n.sort(Td),n}}function Td(e,t){return e.distance-t.distance}function Ed(e,t,n,i){let r=!0;if(e.layers.test(t.layers)){!1===e.raycast(t,n)&&(r=!1)}if(!0===r&&!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)Ed(i[e],t,n,!0)}}function Ad(){!1===this._document.hidden&&this.reset()}class Cd{constructor(e,t,n,i){Cd.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,i){const r=this.elements;return r[0]=e,r[2]=t,r[1]=n,r[3]=i,this}}const Rd=new hi;const Nd=new ui,Id=new ui,Pd=new ui,Ld=new ui,Dd=new ui,kd=new ui,Ud=new ui;const Od=new ui;const Fd=new ui,Bd=new gr,zd=new gr;function jd(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push(...jd(e.children[n]));return t}const Vd=new ui,Hd=new ls,Gd=new ls;const Wd=new ui,Xd=new ui,qd=new ui;const Yd=new ui,Zd=new Ks;function $d(e,t,n,i,r,s,a){Yd.set(r,s,a).unproject(i);const o=t[e];if(void 0!==o){const e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],Yd.x,Yd.y,Yd.z)}}const Jd=new Hi;const Kd=new ui;let Qd,eu;function tu(e,t,n,i){const r=function(e){switch(e){case Tt:case Et:return{byteLength:1,components:1};case Ct:case At:case Pt:return{byteLength:2,components:1};case Lt:case Dt:return{byteLength:2,components:4};case Nt:case Rt:case It:return{byteLength:4,components:1};case Ut:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}(i);switch(n){case Ot:return e*t;case Vt:case Ht:return e*t/r.components*r.byteLength;case Gt:case Wt:return e*t*2/r.components*r.byteLength;case Ft:return e*t*3/r.components*r.byteLength;case Bt:case Xt:return e*t*4/r.components*r.byteLength;case qt:case Yt:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case Zt:case $t:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case Kt:case en:return Math.max(e,16)*Math.max(t,8)/4;case Jt:case Qt:return Math.max(e,8)*Math.max(t,8)/2;case tn:case nn:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case rn:case sn:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case an:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case on:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case ln:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case cn:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case hn:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case dn:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case un:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case pn:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case mn:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case fn:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case gn:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case vn:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case xn:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case yn:case _n:case bn:return Math.ceil(e/4)*Math.ceil(t/4)*16;case wn:case Mn:return Math.ceil(e/4)*Math.ceil(t/4)*8;case Sn:case Tn:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}
/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
function nu(){let e=null,t=!1,n=null,i=null;function r(t,s){n(t,s),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function iu(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=t.get(n);i&&(e.deleteBuffer(i.buffer),t.delete(n))},update:function(n,i){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const r=t.get(n);if(void 0===r)t.set(n,function(t,n){const i=t.array,r=t.usage,s=i.byteLength,a=e.createBuffer();let o;if(e.bindBuffer(n,a),e.bufferData(n,i,r),t.onUploadCallback(),i instanceof Float32Array)o=e.FLOAT;else if("undefined"!=typeof Float16Array&&i instanceof Float16Array)o=e.HALF_FLOAT;else if(i instanceof Uint16Array)o=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(i instanceof Int16Array)o=e.SHORT;else if(i instanceof Uint32Array)o=e.UNSIGNED_INT;else if(i instanceof Int32Array)o=e.INT;else if(i instanceof Int8Array)o=e.BYTE;else if(i instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);o=e.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:s}}(n,i));else if(r.version<n.version){if(r.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,i){const r=n.array,s=n.updateRanges;if(e.bindBuffer(i,t),0===s.length)e.bufferSubData(i,0,r);else{s.sort(((e,t)=>e.start-t.start));let t=0;for(let e=1;e<s.length;e++){const n=s[t],i=s[e];i.start<=n.start+n.count+1?n.count=Math.max(n.count,i.start+i.count-n.start):(++t,s[t]=i)}s.length=t+1;for(let n=0,a=s.length;n<a;n++){const t=s[n];e.bufferSubData(i,t.start*r.BYTES_PER_ELEMENT,r,t.start,t.count)}n.clearUpdateRanges()}n.onUploadCallback()}(r.buffer,n,i),r.version=n.version}}}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ie}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__=Ie));const ru={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\tfloat depth = unpackRGBAToDepth( texture2D( depths, uv ) );\n\t\t#ifdef USE_REVERSEDEPTHBUF\n\t\t\treturn step( depth, compare );\n\t\t#else\n\t\t\treturn step( compare, depth );\n\t\t#endif\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\t#ifdef USE_REVERSEDEPTHBUF\n\t\t\tfloat hard_shadow = step( distribution.x, compare );\n\t\t#else\n\t\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\t#endif\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_REVERSEDEPTHBUF\n\t\tfloat fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];\n\t#else\n\t\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;\n\t#endif\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},su={common:{diffuse:{value:new ls(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new fi},alphaMap:{value:null},alphaMapTransform:{value:new fi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new fi}},envmap:{envMap:{value:null},envMapRotation:{value:new fi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new fi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new fi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new fi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new fi},normalScale:{value:new hi(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new fi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new fi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new fi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new fi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ls(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ls(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new fi},alphaTest:{value:0},uvTransform:{value:new fi}},sprite:{diffuse:{value:new ls(16777215)},opacity:{value:1},center:{value:new hi(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new fi},alphaMap:{value:null},alphaMapTransform:{value:new fi},alphaTest:{value:0}}},au={basic:{uniforms:Ys([su.common,su.specularmap,su.envmap,su.aomap,su.lightmap,su.fog]),vertexShader:ru.meshbasic_vert,fragmentShader:ru.meshbasic_frag},lambert:{uniforms:Ys([su.common,su.specularmap,su.envmap,su.aomap,su.lightmap,su.emissivemap,su.bumpmap,su.normalmap,su.displacementmap,su.fog,su.lights,{emissive:{value:new ls(0)}}]),vertexShader:ru.meshlambert_vert,fragmentShader:ru.meshlambert_frag},phong:{uniforms:Ys([su.common,su.specularmap,su.envmap,su.aomap,su.lightmap,su.emissivemap,su.bumpmap,su.normalmap,su.displacementmap,su.fog,su.lights,{emissive:{value:new ls(0)},specular:{value:new ls(1118481)},shininess:{value:30}}]),vertexShader:ru.meshphong_vert,fragmentShader:ru.meshphong_frag},standard:{uniforms:Ys([su.common,su.envmap,su.aomap,su.lightmap,su.emissivemap,su.bumpmap,su.normalmap,su.displacementmap,su.roughnessmap,su.metalnessmap,su.fog,su.lights,{emissive:{value:new ls(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ru.meshphysical_vert,fragmentShader:ru.meshphysical_frag},toon:{uniforms:Ys([su.common,su.aomap,su.lightmap,su.emissivemap,su.bumpmap,su.normalmap,su.displacementmap,su.gradientmap,su.fog,su.lights,{emissive:{value:new ls(0)}}]),vertexShader:ru.meshtoon_vert,fragmentShader:ru.meshtoon_frag},matcap:{uniforms:Ys([su.common,su.bumpmap,su.normalmap,su.displacementmap,su.fog,{matcap:{value:null}}]),vertexShader:ru.meshmatcap_vert,fragmentShader:ru.meshmatcap_frag},points:{uniforms:Ys([su.points,su.fog]),vertexShader:ru.points_vert,fragmentShader:ru.points_frag},dashed:{uniforms:Ys([su.common,su.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ru.linedashed_vert,fragmentShader:ru.linedashed_frag},depth:{uniforms:Ys([su.common,su.displacementmap]),vertexShader:ru.depth_vert,fragmentShader:ru.depth_frag},normal:{uniforms:Ys([su.common,su.bumpmap,su.normalmap,su.displacementmap,{opacity:{value:1}}]),vertexShader:ru.meshnormal_vert,fragmentShader:ru.meshnormal_frag},sprite:{uniforms:Ys([su.sprite,su.fog]),vertexShader:ru.sprite_vert,fragmentShader:ru.sprite_frag},background:{uniforms:{uvTransform:{value:new fi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ru.background_vert,fragmentShader:ru.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new fi}},vertexShader:ru.backgroundCube_vert,fragmentShader:ru.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ru.cube_vert,fragmentShader:ru.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ru.equirect_vert,fragmentShader:ru.equirect_frag},distanceRGBA:{uniforms:Ys([su.common,su.displacementmap,{referencePosition:{value:new ui},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ru.distanceRGBA_vert,fragmentShader:ru.distanceRGBA_frag},shadow:{uniforms:Ys([su.lights,su.fog,{color:{value:new ls(0)},opacity:{value:1}}]),vertexShader:ru.shadow_vert,fragmentShader:ru.shadow_frag}};au.physical={uniforms:Ys([au.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new fi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new fi},clearcoatNormalScale:{value:new hi(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new fi},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new fi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new fi},sheen:{value:0},sheenColor:{value:new ls(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new fi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new fi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new fi},transmissionSamplerSize:{value:new hi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new fi},attenuationDistance:{value:0},attenuationColor:{value:new ls(0)},specularColor:{value:new ls(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new fi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new fi},anisotropyVector:{value:new hi},anisotropyMap:{value:null},anisotropyMapTransform:{value:new fi}}]),vertexShader:ru.meshphysical_vert,fragmentShader:ru.meshphysical_frag};const ou={r:0,b:0,g:0},lu=new Er,cu=new gr;function hu(e,t,n,i,r,s,a){const o=new ls(0);let l,c,h=!0===s?0:1,d=null,u=0,p=null;function m(e){let i=!0===e.isScene?e.background:null;if(i&&i.isTexture){i=(e.backgroundBlurriness>0?n:t).get(i)}return i}function f(t,n){t.getRGB(ou,Zs(e)),i.buffers.color.setClear(ou.r,ou.g,ou.b,n,a)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),h=t,f(o,h)},getClearAlpha:function(){return h},setClearAlpha:function(e){h=e,f(o,h)},render:function(t){let n=!1;const r=m(t);null===r?f(o,h):r&&r.isColor&&(f(r,1),n=!0);const s=e.xr.getEnvironmentBlendMode();"additive"===s?i.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===s&&i.buffers.color.setClear(0,0,0,0,a),(e.autoClear||n)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const i=m(n);i&&(i.isCubeTexture||i.mapping===mt)?(void 0===c&&(c=new Gs(new Xs(1,1,1),new Js({name:"BackgroundCubeMaterial",uniforms:qs(au.backgroundCube.uniforms),vertexShader:au.backgroundCube.vertexShader,fragmentShader:au.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),lu.copy(n.backgroundRotation),lu.x*=-1,lu.y*=-1,lu.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(lu.y*=-1,lu.z*=-1),c.material.uniforms.envMap.value=i,c.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(cu.makeRotationFromEuler(lu)),c.material.toneMapped=Ai.getTransfer(i.colorSpace)!==Fn,d===i&&u===i.version&&p===e.toneMapping||(c.material.needsUpdate=!0,d=i,u=i.version,p=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null)):i&&i.isTexture&&(void 0===l&&(l=new Gs(new bc(2,2),new Js({name:"BackgroundMaterial",uniforms:qs(au.background.uniforms),vertexShader:au.background.vertexShader,fragmentShader:au.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=i,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=Ai.getTransfer(i.colorSpace)!==Fn,!0===i.matrixAutoUpdate&&i.updateMatrix(),l.material.uniforms.uvTransform.value.copy(i.matrix),d===i&&u===i.version&&p===e.toneMapping||(l.material.needsUpdate=!0,d=i,u=i.version,p=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function du(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),i={},r=c(null);let s=r,a=!1;function o(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function c(e){const t=[],i=[],r=[];for(let s=0;s<n;s++)t[s]=0,i[s]=0,r[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function h(){const e=s.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function d(e){u(e,0)}function u(t,n){const i=s.newAttributes,r=s.enabledAttributes,a=s.attributeDivisors;i[t]=1,0===r[t]&&(e.enableVertexAttribArray(t),r[t]=1),a[t]!==n&&(e.vertexAttribDivisor(t,n),a[t]=n)}function p(){const t=s.newAttributes,n=s.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function m(t,n,i,r,s,a,o){!0===o?e.vertexAttribIPointer(t,n,i,s,a):e.vertexAttribPointer(t,n,i,r,s,a)}function f(){g(),a=!0,s!==r&&(s=r,o(s.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,l,f,g){let v=!1;const x=function(t,n,r){const s=!0===r.wireframe;let a=i[t.id];void 0===a&&(a={},i[t.id]=a);let o=a[n.id];void 0===o&&(o={},a[n.id]=o);let l=o[s];void 0===l&&(l=c(e.createVertexArray()),o[s]=l);return l}(f,l,r);s!==x&&(s=x,o(s.object)),v=function(e,t,n,i){const r=s.attributes,a=t.attributes;let o=0;const l=n.getAttributes();for(const s in l){if(l[s].location>=0){const t=r[s];let n=a[s];if(void 0===n&&("instanceMatrix"===s&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===s&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;o++}}return s.attributesNum!==o||s.index!==i}(n,f,l,g),v&&function(e,t,n,i){const r={},a=t.attributes;let o=0;const l=n.getAttributes();for(const s in l){if(l[s].location>=0){let t=a[s];void 0===t&&("instanceMatrix"===s&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===s&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),r[s]=n,o++}}s.attributes=r,s.attributesNum=o,s.index=i}(n,f,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||a)&&(a=!1,function(n,i,r,s){h();const a=s.attributes,o=r.getAttributes(),l=i.defaultAttributeValues;for(const c in o){const i=o[c];if(i.location>=0){let r=a[c];if(void 0===r&&("instanceMatrix"===c&&n.instanceMatrix&&(r=n.instanceMatrix),"instanceColor"===c&&n.instanceColor&&(r=n.instanceColor)),void 0!==r){const a=r.normalized,o=r.itemSize,l=t.get(r);if(void 0===l)continue;const c=l.buffer,h=l.type,p=l.bytesPerElement,f=h===e.INT||h===e.UNSIGNED_INT||r.gpuType===Rt;if(r.isInterleavedBufferAttribute){const t=r.data,l=t.stride,g=r.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)u(i.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<i.locationSize;e++)d(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<i.locationSize;e++)m(i.location+e,o/i.locationSize,h,a,l*p,(g+o/i.locationSize*e)*p,f)}else{if(r.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)u(i.location+e,r.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<i.locationSize;e++)d(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<i.locationSize;e++)m(i.location+e,o/i.locationSize,h,a,o*p,o/i.locationSize*e*p,f)}}else if(void 0!==l){const t=l[c];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(i.location,t);break;case 3:e.vertexAttrib3fv(i.location,t);break;case 4:e.vertexAttrib4fv(i.location,t);break;default:e.vertexAttrib1fv(i.location,t)}}}}p()}(n,r,l,f),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:f,resetDefaultState:g,dispose:function(){f();for(const e in i){const t=i[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete i[e]}},releaseStatesOfGeometry:function(e){if(void 0===i[e.id])return;const t=i[e.id];for(const n in t){const e=t[n];for(const t in e)l(e[t].object),delete e[t];delete t[n]}delete i[e.id]},releaseStatesOfProgram:function(e){for(const t in i){const n=i[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)l(r[e].object),delete r[e];delete n[e.id]}},initAttributes:h,enableAttribute:d,disableUnusedAttributes:p}}function uu(e,t,n){let i;function r(t,r,s){0!==s&&(e.drawArraysInstanced(i,t,r,s),n.update(r,i,s))}this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=r,this.renderMultiDraw=function(e,r,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,e,0,r,0,s);let a=0;for(let t=0;t<s;t++)a+=r[t];n.update(a,i,1)},this.renderMultiDrawInstances=function(e,s,a,o){if(0===a)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)r(e[t],s[t],o[t]);else{l.multiDrawArraysInstancedWEBGL(i,e,0,s,0,o,0,a);let t=0;for(let e=0;e<a;e++)t+=s[e]*o[e];n.update(t,i,1)}}}function pu(e,t,n,i){let r;function s(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a=void 0!==n.precision?n.precision:"highp";const o=s(a);o!==a&&(a=o);const l=!0===n.logarithmicDepthBuffer,c=!0===n.reversedDepthBuffer&&t.has("EXT_clip_control"),h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:s,textureFormatReadable:function(t){return t===Bt||i.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const r=n===Pt&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==Tt&&i.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==It&&!r)},precision:a,logarithmicDepthBuffer:l,reversedDepthBuffer:c,maxTextures:h,maxVertexTextures:d,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:d>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function mu(e){const t=this;let n=null,i=0,r=!1,s=!1;const a=new lo,o=new fi,l={value:null,needsUpdate:!1};function c(e,n,i,r){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const t=i+4*s,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=i;n!==s;++n,l+=4)a.copy(e[n]).applyMatrix4(r,o),a.normal.toArray(c,l),c[l+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(a,o,h){const d=a.clippingPlanes,u=a.clipIntersection,p=a.clipShadows,m=e.get(a);if(!r||null===d||0===d.length||s&&!p)s?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{const e=s?0:i,t=4*e;let r=m.clippingState||null;l.value=r,r=c(d,o,t,h);for(let i=0;i!==t;++i)r[i]=n[i];m.clippingState=r,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=e}}}function fu(e){let t=new WeakMap;function n(e,t){return t===ut?e.mapping=ht:t===pt&&(e.mapping=dt),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(s===ut||s===pt){if(t.has(r)){return n(t.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const a=new aa(s.height);return a.fromEquirectangularTexture(e,r),t.set(r,a),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}const gu=[.125,.215,.35,.446,.526,.582],vu=20,xu=new Lh,yu=new ls;let _u=null,bu=0,wu=0,Mu=!1;const Su=(1+Math.sqrt(5))/2,Tu=1/Su,Eu=[new ui(-Su,Tu,0),new ui(Su,Tu,0),new ui(-Tu,0,Su),new ui(Tu,0,Su),new ui(0,Su,-Tu),new ui(0,Su,Tu),new ui(-1,1,-1),new ui(1,1,-1),new ui(-1,1,1),new ui(1,1,1)],Au=new ui;class Cu{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100,r={}){const{size:s=256,position:a=Au}=r;_u=this._renderer.getRenderTarget(),bu=this._renderer.getActiveCubeFace(),wu=this._renderer.getActiveMipmapLevel(),Mu=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(s);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,i,o,a),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Pu(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Iu(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(_u,bu,wu),this._renderer.xr.enabled=Mu,e.scissorTest=!1,Nu(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ht||e.mapping===dt?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),_u=this._renderer.getRenderTarget(),bu=this._renderer.getActiveCubeFace(),wu=this._renderer.getActiveMipmapLevel(),Mu=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:bt,minFilter:bt,generateMipmaps:!1,type:Pt,format:Bt,colorSpace:Un,depthBuffer:!1},i=Ru(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Ru(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const s=e-4+1+gu.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);n.push(s);let o=1/s;a>e-4?o=gu[a-e+4-1]:0===a&&(o=0),i.push(o);const l=1/(s-2),c=-l,h=1+l,d=[c,c,h,c,h,h,c,c,h,h,c,h],u=6,p=6,m=3,f=2,g=1,v=new Float32Array(m*p*u),x=new Float32Array(f*p*u),y=new Float32Array(g*p*u);for(let e=0;e<u;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(i,m*p*e),x.set(d,f*p*e);const r=[e,e,e,e,e,e];y.set(r,g*p*e)}const _=new Ps;_.setAttribute("position",new bs(v,m)),_.setAttribute("uv",new bs(x,f)),_.setAttribute("faceIndex",new bs(y,g)),t.push(_),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(vu),r=new ui(0,1,0),s=new Js({name:"SphericalGaussianBlur",defines:{n:vu,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Lu(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return s}(i,e,t)}return i}_compileMaterial(e){const t=new Gs(this._lodPlanes[0],e);this._renderer.compile(t,xu)}_sceneToCubeUV(e,t,n,i,r){const s=new na(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,h=l.toneMapping;l.getClearColor(yu),l.toneMapping=0,l.autoClear=!1;l.state.buffers.depth.getReversed()&&(l.setRenderTarget(i),l.clearDepth(),l.setRenderTarget(null));const d=new us({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new Gs(new Xs,d);let p=!1;const m=e.background;m?m.isColor&&(d.color.copy(m),e.background=null,p=!0):(d.color.copy(yu),p=!0);for(let f=0;f<6;f++){const t=f%3;0===t?(s.up.set(0,a[f],0),s.position.set(r.x,r.y,r.z),s.lookAt(r.x+o[f],r.y,r.z)):1===t?(s.up.set(0,0,a[f]),s.position.set(r.x,r.y,r.z),s.lookAt(r.x,r.y+o[f],r.z)):(s.up.set(0,a[f],0),s.position.set(r.x,r.y,r.z),s.lookAt(r.x,r.y,r.z+o[f]));const n=this._cubeSize;Nu(i,t*n,f>2?n:0,n,n),l.setRenderTarget(i),p&&l.render(u,s),l.render(e,s)}u.geometry.dispose(),u.material.dispose(),l.toneMapping=h,l.autoClear=c,e.background=m}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===ht||e.mapping===dt;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Pu()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Iu());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new Gs(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const a=this._cubeSize;Nu(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(s,xu)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let r=1;r<i;r++){const t=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=Eu[(i-r-1)%Eu.length];this._blur(e,r-1,r,t,n)}t.autoClear=n}_blur(e,t,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",r),this._halfBlur(s,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,s,a){const o=this._renderer,l=this._blurMaterial,c=new Gs(this._lodPlanes[i],l),h=l.uniforms,d=this._sizeLods[n]-1,u=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,p=r/u,m=isFinite(r)?1+Math.floor(3*p):vu,f=[];let g=0;for(let y=0;y<vu;++y){const e=y/p,t=Math.exp(-e*e/2);f.push(t),0===y?g+=t:y<m&&(g+=2*t)}for(let y=0;y<f.length;y++)f[y]=f[y]/g;h.envMap.value=e.texture,h.samples.value=m,h.weights.value=f,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a);const{_lodMax:v}=this;h.dTheta.value=u,h.mipInt.value=v-n;const x=this._sizeLods[i];Nu(t,3*x*(i>v-4?i-v+4:0),4*(this._cubeSize-x),3*x,2*x),o.setRenderTarget(t),o.render(c,xu)}}function Ru(e,t,n){const i=new zi(e,t,n);return i.texture.mapping=mt,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Nu(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function Iu(){return new Js({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Lu(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Pu(){return new Js({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Lu(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Lu(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Du(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,a=s===ut||s===pt,o=s===ht||s===dt;if(a||o){let s=t.get(r);const l=void 0!==s?s.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==l)return null===n&&(n=new Cu(e)),s=a?n.fromEquirectangular(r,s):n.fromCubemap(r,s),s.texture.pmremVersion=r.pmremVersion,t.set(r,s),s.texture;if(void 0!==s)return s.texture;{const l=r.image;return a&&l&&l.height>0||o&&l&&function(e){let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(l)?(null===n&&(n=new Cu(e)),s=a?n.fromEquirectangular(r):n.fromCubemap(r),s.texture.pmremVersion=r.pmremVersion,t.set(r,s),r.addEventListener("dispose",i),s.texture):null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function ku(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&Mi("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Uu(e,t,n,i){const r={},s=new WeakMap;function a(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const n in o.attributes)t.remove(o.attributes[n]);o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(t.remove(l),s.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],i=e.index,r=e.attributes.position;let a=0;if(null!==i){const e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],s=e[t+2];n.push(i,r,r,s,s,i)}}else{if(void 0===r)return;{const e=r.array;a=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}}const o=new(vi(n)?Ms:ws)(n,1);o.version=a;const l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",a),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const r in i)t.update(i[r],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){const t=s.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return s.get(e)}}}function Ou(e,t,n){let i,r,s;function a(t,a,o){0!==o&&(e.drawElementsInstanced(i,a,r,t*s,o),n.update(a,i,o))}this.setMode=function(e){i=e},this.setIndex=function(e){r=e.type,s=e.bytesPerElement},this.render=function(t,a){e.drawElements(i,a,r,t*s),n.update(a,i,1)},this.renderInstances=a,this.renderMultiDraw=function(e,s,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,s,0,r,e,0,a);let o=0;for(let t=0;t<a;t++)o+=s[t];n.update(o,i,1)},this.renderMultiDrawInstances=function(e,o,l,c){if(0===l)return;const h=t.get("WEBGL_multi_draw");if(null===h)for(let t=0;t<e.length;t++)a(e[t]/s,o[t],c[t]);else{h.multiDrawElementsInstancedWEBGL(i,o,0,r,e,0,c,0,l);let t=0;for(let e=0;e<l;e++)t+=o[e]*c[e];n.update(t,i,1)}}}function Fu(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n}}}}function Bu(e,t,n){const i=new WeakMap,r=new Fi;return{update:function(s,a,o){const l=s.morphTargetInfluences,c=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=void 0!==c?c.length:0;let d=i.get(a);if(void 0===d||d.count!==h){let e=function(){v.dispose(),i.delete(a),a.removeEventListener("dispose",e)};void 0!==d&&d.texture.dispose();const n=void 0!==a.morphAttributes.position,s=void 0!==a.morphAttributes.normal,o=void 0!==a.morphAttributes.color,l=a.morphAttributes.position||[],c=a.morphAttributes.normal||[],u=a.morphAttributes.color||[];let p=0;!0===n&&(p=1),!0===s&&(p=2),!0===o&&(p=3);let m=a.attributes.position.count*p,f=1;m>t.maxTextureSize&&(f=Math.ceil(m/t.maxTextureSize),m=t.maxTextureSize);const g=new Float32Array(m*f*4*h),v=new ji(g,m,f,h);v.type=It,v.needsUpdate=!0;const x=4*p;for(let t=0;t<h;t++){const e=l[t],i=c[t],a=u[t],h=m*f*4*t;for(let t=0;t<e.count;t++){const l=t*x;!0===n&&(r.fromBufferAttribute(e,t),g[h+l+0]=r.x,g[h+l+1]=r.y,g[h+l+2]=r.z,g[h+l+3]=0),!0===s&&(r.fromBufferAttribute(i,t),g[h+l+4]=r.x,g[h+l+5]=r.y,g[h+l+6]=r.z,g[h+l+7]=0),!0===o&&(r.fromBufferAttribute(a,t),g[h+l+8]=r.x,g[h+l+9]=r.y,g[h+l+10]=r.z,g[h+l+11]=4===a.itemSize?r.w:1)}}d={count:h,texture:v,size:new hi(m,f)},i.set(a,d),a.addEventListener("dispose",e)}if(!0===s.isInstancedMesh&&null!==s.morphTexture)o.getUniforms().setValue(e,"morphTexture",s.morphTexture,n);else{let t=0;for(let e=0;e<l.length;e++)t+=l[e];const n=a.morphTargetsRelative?1:1-t;o.getUniforms().setValue(e,"morphTargetBaseInfluence",n),o.getUniforms().setValue(e,"morphTargetInfluences",l)}o.getUniforms().setValue(e,"morphTargetsTexture",d.texture,n),o.getUniforms().setValue(e,"morphTargetsTextureSize",d.size)}}}function zu(e,t,n,i){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(a){const o=i.render.frame,l=a.geometry,c=t.get(a,l);if(r.get(c)!==o&&(t.update(c),r.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),r.get(a)!==o&&(n.update(a.instanceMatrix,e.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,e.ARRAY_BUFFER),r.set(a,o))),a.isSkinnedMesh){const e=a.skeleton;r.get(e)!==o&&(e.update(),r.set(e,o))}return c},dispose:function(){r=new WeakMap}}}const ju=new Oi,Vu=new sl(1,1),Hu=new ji,Gu=new Vi,Wu=new sa,Xu=[],qu=[],Yu=new Float32Array(16),Zu=new Float32Array(9),$u=new Float32Array(4);function Ju(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let s=Xu[r];if(void 0===s&&(s=new Float32Array(r),Xu[r]=s),0!==t){i.toArray(s,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(s,r)}return s}function Ku(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function Qu(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function ep(e,t){let n=qu[t];void 0===n&&(n=new Int32Array(t),qu[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function tp(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function np(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ku(n,t))return;e.uniform2fv(this.addr,t),Qu(n,t)}}function ip(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Ku(n,t))return;e.uniform3fv(this.addr,t),Qu(n,t)}}function rp(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ku(n,t))return;e.uniform4fv(this.addr,t),Qu(n,t)}}function sp(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Ku(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Qu(n,t)}else{if(Ku(n,i))return;$u.set(i),e.uniformMatrix2fv(this.addr,!1,$u),Qu(n,i)}}function ap(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Ku(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Qu(n,t)}else{if(Ku(n,i))return;Zu.set(i),e.uniformMatrix3fv(this.addr,!1,Zu),Qu(n,i)}}function op(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Ku(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Qu(n,t)}else{if(Ku(n,i))return;Yu.set(i),e.uniformMatrix4fv(this.addr,!1,Yu),Qu(n,i)}}function lp(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function cp(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ku(n,t))return;e.uniform2iv(this.addr,t),Qu(n,t)}}function hp(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Ku(n,t))return;e.uniform3iv(this.addr,t),Qu(n,t)}}function dp(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ku(n,t))return;e.uniform4iv(this.addr,t),Qu(n,t)}}function up(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function pp(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ku(n,t))return;e.uniform2uiv(this.addr,t),Qu(n,t)}}function mp(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Ku(n,t))return;e.uniform3uiv(this.addr,t),Qu(n,t)}}function fp(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ku(n,t))return;e.uniform4uiv(this.addr,t),Qu(n,t)}}function gp(e,t,n){const i=this.cache,r=n.allocateTextureUnit();let s;i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),this.type===e.SAMPLER_2D_SHADOW?(Vu.compareFunction=515,s=Vu):s=ju,n.setTexture2D(t||s,r)}function vp(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||Gu,r)}function xp(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||Wu,r)}function yp(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Hu,r)}function _p(e,t){e.uniform1fv(this.addr,t)}function bp(e,t){const n=Ju(t,this.size,2);e.uniform2fv(this.addr,n)}function wp(e,t){const n=Ju(t,this.size,3);e.uniform3fv(this.addr,n)}function Mp(e,t){const n=Ju(t,this.size,4);e.uniform4fv(this.addr,n)}function Sp(e,t){const n=Ju(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Tp(e,t){const n=Ju(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Ep(e,t){const n=Ju(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Ap(e,t){e.uniform1iv(this.addr,t)}function Cp(e,t){e.uniform2iv(this.addr,t)}function Rp(e,t){e.uniform3iv(this.addr,t)}function Np(e,t){e.uniform4iv(this.addr,t)}function Ip(e,t){e.uniform1uiv(this.addr,t)}function Pp(e,t){e.uniform2uiv(this.addr,t)}function Lp(e,t){e.uniform3uiv(this.addr,t)}function Dp(e,t){e.uniform4uiv(this.addr,t)}function kp(e,t,n){const i=this.cache,r=t.length,s=ep(n,r);Ku(i,s)||(e.uniform1iv(this.addr,s),Qu(i,s));for(let a=0;a!==r;++a)n.setTexture2D(t[a]||ju,s[a])}function Up(e,t,n){const i=this.cache,r=t.length,s=ep(n,r);Ku(i,s)||(e.uniform1iv(this.addr,s),Qu(i,s));for(let a=0;a!==r;++a)n.setTexture3D(t[a]||Gu,s[a])}function Op(e,t,n){const i=this.cache,r=t.length,s=ep(n,r);Ku(i,s)||(e.uniform1iv(this.addr,s),Qu(i,s));for(let a=0;a!==r;++a)n.setTextureCube(t[a]||Wu,s[a])}function Fp(e,t,n){const i=this.cache,r=t.length,s=ep(n,r);Ku(i,s)||(e.uniform1iv(this.addr,s),Qu(i,s));for(let a=0;a!==r;++a)n.setTexture2DArray(t[a]||Hu,s[a])}class Bp{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return tp;case 35664:return np;case 35665:return ip;case 35666:return rp;case 35674:return sp;case 35675:return ap;case 35676:return op;case 5124:case 35670:return lp;case 35667:case 35671:return cp;case 35668:case 35672:return hp;case 35669:case 35673:return dp;case 5125:return up;case 36294:return pp;case 36295:return mp;case 36296:return fp;case 35678:case 36198:case 36298:case 36306:case 35682:return gp;case 35679:case 36299:case 36307:return vp;case 35680:case 36300:case 36308:case 36293:return xp;case 36289:case 36303:case 36311:case 36292:return yp}}(t.type)}}class zp{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return _p;case 35664:return bp;case 35665:return wp;case 35666:return Mp;case 35674:return Sp;case 35675:return Tp;case 35676:return Ep;case 5124:case 35670:return Ap;case 35667:case 35671:return Cp;case 35668:case 35672:return Rp;case 35669:case 35673:return Np;case 5125:return Ip;case 36294:return Pp;case 36295:return Lp;case 36296:return Dp;case 35678:case 36198:case 36298:case 36306:case 35682:return kp;case 35679:case 36299:case 36307:return Up;case 35680:case 36300:case 36308:case 36293:return Op;case 36289:case 36303:case 36311:case 36292:return Fp}}(t.type)}}class jp{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(e,t[s.id],n)}}}const Vp=/(\w+)(\])?(\[|\.)?/g;function Hp(e,t){e.seq.push(t),e.map[t.id]=t}function Gp(e,t,n){const i=e.name,r=i.length;for(Vp.lastIndex=0;;){const s=Vp.exec(i),a=Vp.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){Hp(n,void 0===c?new Bp(o,e,t):new zp(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new jp(o),Hp(n,e)),n=e}}}class Wp{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);Gp(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,s=t.length;r!==s;++r){const s=t[r],a=n[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function Xp(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let qp=0;const Yp=new fi;function Zp(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=(e.getShaderInfoLog(t)||"").trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let a=r;a<s;a++){const e=a+1;i.push(`${e===t?">":" "} ${e}: ${n[a]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function $p(e,t){const n=function(e){Ai._getMatrix(Yp,Ai.workingColorSpace,e);const t=`mat3( ${Yp.elements.map((e=>e.toFixed(4)))} )`;switch(Ai.getTransfer(e)){case On:return[t,"LinearTransferOETF"];case Fn:return[t,"sRGBTransferOETF"];default:return[t,"LinearTransferOETF"]}}(t);return[`vec4 ${e}( vec4 value ) {`,`\treturn ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join("\n")}function Jp(e,t){let n;switch(t){case 1:default:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Cineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Kp=new ui;function Qp(){Ai.getLuminanceCoefficients(Kp);return["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${Kp.x.toFixed(4)}, ${Kp.y.toFixed(4)}, ${Kp.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")}function em(e){return""!==e}function tm(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function nm(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const im=/^[ \t]*#include +<([\w\d./]+)>/gm;function rm(e){return e.replace(im,am)}const sm=new Map;function am(e,t){let n=ru[t];if(void 0===n){const e=sm.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=ru[e]}return rm(n)}const om=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function lm(e){return e.replace(om,cm)}function cm(e,t,n,i){let r="";for(let s=parseInt(t);s<parseInt(n);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function hm(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function dm(e,t,n,i){const r=e.getContext(),s=n.defines;let a=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ht:case dt:t="ENVMAP_TYPE_CUBE";break;case mt:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),h=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===dt&&(t="ENVMAP_MODE_REFRACTION");return t}(n),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),u=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(em).join("\n")}(n),m=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),f=r.createProgram();let g,v,x=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m].filter(em).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m].filter(em).join("\n"),v.length>0&&(v+="\n")):(g=[hm(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reversedDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(em).join("\n"),v=[hm(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+h:"",n.envMap?"#define "+d:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reversedDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?ru.tonemapping_pars_fragment:"",0!==n.toneMapping?Jp("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",ru.colorspace_pars_fragment,$p("linearToOutputTexel",n.outputColorSpace),Qp(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(em).join("\n")),a=rm(a),a=tm(a,n),a=nm(a,n),o=rm(o),o=tm(o,n),o=nm(o,n),a=lm(a),o=lm(o),!0!==n.isRawShaderMaterial&&(x="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===Zn?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Zn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const y=x+g+a,_=x+v+o,b=Xp(r,r.VERTEX_SHADER,y),w=Xp(r,r.FRAGMENT_SHADER,_);function M(t){if(e.debug.checkShaderErrors){const n=r.getProgramInfoLog(f)||"",i=r.getShaderInfoLog(b)||"",s=r.getShaderInfoLog(w)||"",a=n.trim(),o=i.trim(),l=s.trim();let c=!0,h=!0;if(!1===r.getProgramParameter(f,r.LINK_STATUS))if(c=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(r,f,b,w);else{Zp(r,b,"vertex"),Zp(r,w,"fragment")}else""!==a||""!==o&&""!==l||(h=!1);h&&(t.diagnostics={runnable:c,programLog:a,vertexShader:{log:o,prefix:g},fragmentShader:{log:l,prefix:v}})}r.deleteShader(b),r.deleteShader(w),S=new Wp(r,f),T=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),s=i.name;let a=1;i.type===e.FLOAT_MAT2&&(a=2),i.type===e.FLOAT_MAT3&&(a=3),i.type===e.FLOAT_MAT4&&(a=4),n[s]={type:i.type,location:e.getAttribLocation(t,s),locationSize:a}}return n}(r,f)}let S,T;r.attachShader(f,b),r.attachShader(f,w),void 0!==n.index0AttributeName?r.bindAttribLocation(f,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(f,0,"position"),r.linkProgram(f),this.getUniforms=function(){return void 0===S&&M(this),S},this.getAttributes=function(){return void 0===T&&M(this),T};let E=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=r.getProgramParameter(f,37297)),E},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(f),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=qp++,this.cacheKey=t,this.usedTimes=1,this.program=f,this.vertexShader=b,this.fragmentShader=w,this}let um=0;class pm{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new mm(e),t.set(e,n)),n}}class mm{constructor(e){this.id=um++,this.code=e,this.usedTimes=0}}function fm(e,t,n,i,r,s,a){const o=new Ar,l=new pm,c=new Set,h=[],d=r.logarithmicDepthBuffer,u=r.vertexTextures;let p=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function f(e){return c.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(s,o,h,g,v){const x=g.fog,y=v.geometry,_=s.isMeshStandardMaterial?g.environment:null,b=(s.isMeshStandardMaterial?n:t).get(s.envMap||_),w=b&&b.mapping===mt?b.image.height:null,M=m[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),s.precision);const S=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,T=void 0!==S?S.length:0;let E,A,C,R,N=0;if(void 0!==y.morphAttributes.position&&(N=1),void 0!==y.morphAttributes.normal&&(N=2),void 0!==y.morphAttributes.color&&(N=3),M){const e=au[M];E=e.vertexShader,A=e.fragmentShader}else E=s.vertexShader,A=s.fragmentShader,l.update(s),C=l.getVertexShaderID(s),R=l.getFragmentShaderID(s);const I=e.getRenderTarget(),P=e.state.buffers.depth.getReversed(),L=!0===v.isInstancedMesh,D=!0===v.isBatchedMesh,k=!!s.map,U=!!s.matcap,O=!!b,F=!!s.aoMap,B=!!s.lightMap,z=!!s.bumpMap,j=!!s.normalMap,V=!!s.displacementMap,H=!!s.emissiveMap,G=!!s.metalnessMap,W=!!s.roughnessMap,X=s.anisotropy>0,q=s.clearcoat>0,Y=s.dispersion>0,Z=s.iridescence>0,$=s.sheen>0,J=s.transmission>0,K=X&&!!s.anisotropyMap,Q=q&&!!s.clearcoatMap,ee=q&&!!s.clearcoatNormalMap,te=q&&!!s.clearcoatRoughnessMap,ne=Z&&!!s.iridescenceMap,ie=Z&&!!s.iridescenceThicknessMap,re=$&&!!s.sheenColorMap,se=$&&!!s.sheenRoughnessMap,ae=!!s.specularMap,oe=!!s.specularColorMap,le=!!s.specularIntensityMap,ce=J&&!!s.transmissionMap,he=J&&!!s.thicknessMap,de=!!s.gradientMap,ue=!!s.alphaMap,pe=s.alphaTest>0,me=!!s.alphaHash,fe=!!s.extensions;let ge=0;s.toneMapped&&(null!==I&&!0!==I.isXRRenderTarget||(ge=e.toneMapping));const ve={shaderID:M,shaderType:s.type,shaderName:s.name,vertexShader:E,fragmentShader:A,defines:s.defines,customVertexShaderID:C,customFragmentShaderID:R,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,batching:D,batchingColor:D&&null!==v._colorsTexture,instancing:L,instancingColor:L&&null!==v.instanceColor,instancingMorph:L&&null!==v.morphTexture,supportsVertexTextures:u,outputColorSpace:null===I?e.outputColorSpace:!0===I.isXRRenderTarget?I.texture.colorSpace:Un,alphaToCoverage:!!s.alphaToCoverage,map:k,matcap:U,envMap:O,envMapMode:O&&b.mapping,envMapCubeUVHeight:w,aoMap:F,lightMap:B,bumpMap:z,normalMap:j,displacementMap:u&&V,emissiveMap:H,normalMapObjectSpace:j&&1===s.normalMapType,normalMapTangentSpace:j&&0===s.normalMapType,metalnessMap:G,roughnessMap:W,anisotropy:X,anisotropyMap:K,clearcoat:q,clearcoatMap:Q,clearcoatNormalMap:ee,clearcoatRoughnessMap:te,dispersion:Y,iridescence:Z,iridescenceMap:ne,iridescenceThicknessMap:ie,sheen:$,sheenColorMap:re,sheenRoughnessMap:se,specularMap:ae,specularColorMap:oe,specularIntensityMap:le,transmission:J,transmissionMap:ce,thicknessMap:he,gradientMap:de,opaque:!1===s.transparent&&1===s.blending&&!1===s.alphaToCoverage,alphaMap:ue,alphaTest:pe,alphaHash:me,combine:s.combine,mapUv:k&&f(s.map.channel),aoMapUv:F&&f(s.aoMap.channel),lightMapUv:B&&f(s.lightMap.channel),bumpMapUv:z&&f(s.bumpMap.channel),normalMapUv:j&&f(s.normalMap.channel),displacementMapUv:V&&f(s.displacementMap.channel),emissiveMapUv:H&&f(s.emissiveMap.channel),metalnessMapUv:G&&f(s.metalnessMap.channel),roughnessMapUv:W&&f(s.roughnessMap.channel),anisotropyMapUv:K&&f(s.anisotropyMap.channel),clearcoatMapUv:Q&&f(s.clearcoatMap.channel),clearcoatNormalMapUv:ee&&f(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&f(s.clearcoatRoughnessMap.channel),iridescenceMapUv:ne&&f(s.iridescenceMap.channel),iridescenceThicknessMapUv:ie&&f(s.iridescenceThicknessMap.channel),sheenColorMapUv:re&&f(s.sheenColorMap.channel),sheenRoughnessMapUv:se&&f(s.sheenRoughnessMap.channel),specularMapUv:ae&&f(s.specularMap.channel),specularColorMapUv:oe&&f(s.specularColorMap.channel),specularIntensityMapUv:le&&f(s.specularIntensityMap.channel),transmissionMapUv:ce&&f(s.transmissionMap.channel),thicknessMapUv:he&&f(s.thicknessMap.channel),alphaMapUv:ue&&f(s.alphaMap.channel),vertexTangents:!!y.attributes.tangent&&(j||X),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!y.attributes.uv&&(k||ue),fog:!!x,useFog:!0===s.fog,fogExp2:!!x&&x.isFogExp2,flatShading:!0===s.flatShading&&!1===s.wireframe,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:d,reversedDepthBuffer:P,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:T,morphTextureStride:N,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.length>0,shadowMapType:e.shadowMap.type,toneMapping:ge,decodeVideoTexture:k&&!0===s.map.isVideoTexture&&Ai.getTransfer(s.map.colorSpace)===Fn,decodeVideoTextureEmissive:H&&!0===s.emissiveMap.isVideoTexture&&Ai.getTransfer(s.emissiveMap.colorSpace)===Fn,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:fe&&!0===s.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(fe&&!0===s.extensions.multiDraw||D)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return ve.vertexUv1s=c.has(1),ve.vertexUv2s=c.has(2),ve.vertexUv3s=c.has(3),c.clear(),ve},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.supportsVertexTextures&&o.enable(0);t.instancing&&o.enable(1);t.instancingColor&&o.enable(2);t.instancingMorph&&o.enable(3);t.matcap&&o.enable(4);t.envMap&&o.enable(5);t.normalMapObjectSpace&&o.enable(6);t.normalMapTangentSpace&&o.enable(7);t.clearcoat&&o.enable(8);t.iridescence&&o.enable(9);t.alphaTest&&o.enable(10);t.vertexColors&&o.enable(11);t.vertexAlphas&&o.enable(12);t.vertexUv1s&&o.enable(13);t.vertexUv2s&&o.enable(14);t.vertexUv3s&&o.enable(15);t.vertexTangents&&o.enable(16);t.anisotropy&&o.enable(17);t.alphaHash&&o.enable(18);t.batching&&o.enable(19);t.dispersion&&o.enable(20);t.batchingColor&&o.enable(21);t.gradientMap&&o.enable(22);e.push(o.mask),o.disableAll(),t.fog&&o.enable(0);t.useFog&&o.enable(1);t.flatShading&&o.enable(2);t.logarithmicDepthBuffer&&o.enable(3);t.reversedDepthBuffer&&o.enable(4);t.skinning&&o.enable(5);t.morphTargets&&o.enable(6);t.morphNormals&&o.enable(7);t.morphColors&&o.enable(8);t.premultipliedAlpha&&o.enable(9);t.shadowMapEnabled&&o.enable(10);t.doubleSided&&o.enable(11);t.flipSided&&o.enable(12);t.useDepthPacking&&o.enable(13);t.dithering&&o.enable(14);t.transmission&&o.enable(15);t.sheen&&o.enable(16);t.opaque&&o.enable(17);t.pointsUvs&&o.enable(18);t.decodeVideoTexture&&o.enable(19);t.decodeVideoTextureEmissive&&o.enable(20);t.alphaToCoverage&&o.enable(21);e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=m[e.type];let n;if(t){const e=au[t];n=$s.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,r=h.length;e<r;e++){const t=h[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new dm(e,n,t,s),h.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=h.indexOf(e);h[t]=h[h.length-1],h.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:h,dispose:function(){l.dispose()}}}function gm(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function vm(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function xm(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function ym(){const e=[];let t=0;const n=[],i=[],r=[];function s(n,i,r,s,a,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=o),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,a,o,l,c){const h=s(e,t,a,o,l,c);a.transmission>0?i.push(h):!0===a.transparent?r.push(h):n.push(h)},unshift:function(e,t,a,o,l,c){const h=s(e,t,a,o,l,c);a.transmission>0?i.unshift(h):!0===a.transparent?r.unshift(h):n.unshift(h)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||vm),i.length>1&&i.sort(t||xm),r.length>1&&r.sort(t||xm)}}}function _m(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new ym,e.set(t,[r])):n>=i.length?(r=new ym,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function bm(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new ui,color:new ls};break;case"SpotLight":n={position:new ui,direction:new ui,color:new ls,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ui,color:new ls,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ui,skyColor:new ls,groundColor:new ls};break;case"RectAreaLight":n={color:new ls,position:new ui,halfWidth:new ui,halfHeight:new ui}}return e[t.id]=n,n}}}let wm=0;function Mm(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Sm(e){const t=new bm,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new hi};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new hi,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let o=0;o<9;o++)i.probe.push(new ui);const r=new ui,s=new gr,a=new gr;return{setup:function(r){let s=0,a=0,o=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let l=0,c=0,h=0,d=0,u=0,p=0,m=0,f=0,g=0,v=0,x=0;r.sort(Mm);for(let e=0,_=r.length;e<_;e++){const y=r[e],_=y.color,b=y.intensity,w=y.distance,M=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)s+=_.r*b,a+=_.g*b,o+=_.b*b;else if(y.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(y.sh.coefficients[e],b);x++}else if(y.isDirectionalLight){const e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),y.castShadow){const e=y.shadow,t=n.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,i.directionalShadow[l]=t,i.directionalShadowMap[l]=M,i.directionalShadowMatrix[l]=y.shadow.matrix,p++}i.directional[l]=e,l++}else if(y.isSpotLight){const e=t.get(y);e.position.setFromMatrixPosition(y.matrixWorld),e.color.copy(_).multiplyScalar(b),e.distance=w,e.coneCos=Math.cos(y.angle),e.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),e.decay=y.decay,i.spot[h]=e;const r=y.shadow;if(y.map&&(i.spotLightMap[g]=y.map,g++,r.updateMatrices(y),y.castShadow&&v++),i.spotLightMatrix[h]=r.matrix,y.castShadow){const e=n.get(y);e.shadowIntensity=r.intensity,e.shadowBias=r.bias,e.shadowNormalBias=r.normalBias,e.shadowRadius=r.radius,e.shadowMapSize=r.mapSize,i.spotShadow[h]=e,i.spotShadowMap[h]=M,f++}h++}else if(y.isRectAreaLight){const e=t.get(y);e.color.copy(_).multiplyScalar(b),e.halfWidth.set(.5*y.width,0,0),e.halfHeight.set(0,.5*y.height,0),i.rectArea[d]=e,d++}else if(y.isPointLight){const e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),e.distance=y.distance,e.decay=y.decay,y.castShadow){const e=y.shadow,t=n.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,i.pointShadow[c]=t,i.pointShadowMap[c]=M,i.pointShadowMatrix[c]=y.shadow.matrix,m++}i.point[c]=e,c++}else if(y.isHemisphereLight){const e=t.get(y);e.skyColor.copy(y.color).multiplyScalar(b),e.groundColor.copy(y.groundColor).multiplyScalar(b),i.hemi[u]=e,u++}}d>0&&(!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=su.LTC_FLOAT_1,i.rectAreaLTC2=su.LTC_FLOAT_2):(i.rectAreaLTC1=su.LTC_HALF_1,i.rectAreaLTC2=su.LTC_HALF_2)),i.ambient[0]=s,i.ambient[1]=a,i.ambient[2]=o;const y=i.hash;y.directionalLength===l&&y.pointLength===c&&y.spotLength===h&&y.rectAreaLength===d&&y.hemiLength===u&&y.numDirectionalShadows===p&&y.numPointShadows===m&&y.numSpotShadows===f&&y.numSpotMaps===g&&y.numLightProbes===x||(i.directional.length=l,i.spot.length=h,i.rectArea.length=d,i.point.length=c,i.hemi.length=u,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=m,i.pointShadowMap.length=m,i.spotShadow.length=f,i.spotShadowMap.length=f,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=m,i.spotLightMatrix.length=f+g-v,i.spotLightMap.length=g,i.numSpotLightShadowsWithMaps=v,i.numLightProbes=x,y.directionalLength=l,y.pointLength=c,y.spotLength=h,y.rectAreaLength=d,y.hemiLength=u,y.numDirectionalShadows=p,y.numPointShadows=m,y.numSpotShadows=f,y.numSpotMaps=g,y.numLightProbes=x,i.version=wm++)},setupView:function(e,t){let n=0,o=0,l=0,c=0,h=0;const d=t.matrixWorldInverse;for(let u=0,p=e.length;u<p;u++){const t=e[u];if(t.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(d),n++}else if(t.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(d),l++}else if(t.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),a.identity(),s.copy(t.matrixWorld),s.premultiply(d),a.extractRotation(s),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(t.isPointLight){const e=i.point[o];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),o++}else if(t.isHemisphereLight){const e=i.hemi[h];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(d),h++}}},state:i}}function Tm(e){const t=new Sm(e),n=[],i=[];const r={lightsArray:n,shadowsArray:i,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){r.camera=e,n.length=0,i.length=0},state:r,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){i.push(e)}}}function Em(e){let t=new WeakMap;return{get:function(n,i=0){const r=t.get(n);let s;return void 0===r?(s=new Tm(e),t.set(n,[s])):i>=r.length?(s=new Tm(e),r.push(s)):s=r[i],s},dispose:function(){t=new WeakMap}}}function Am(e,t,n){let i=new po;const r=new hi,s=new hi,a=new Fi,o=new zc({depthPacking:3201}),l=new jc,c={},h=n.maxTextureSize,d={[Pe]:1,[Le]:0,[De]:2},u=new Js({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new hi},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=u.clone();p.defines.HORIZONTAL_PASS=1;const m=new Ps;m.setAttribute("position",new bs(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new Gs(m,u),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function x(n,i){const s=t.update(f);u.defines.VSM_SAMPLES!==n.blurSamples&&(u.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,u.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new zi(r.x,r.y)),u.uniforms.shadow_pass.value=n.map.texture,u.uniforms.resolution.value=n.mapSize,u.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,s,u,f,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,s,p,f,null)}function y(t,n,i,r){let s=null;const a=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==a)s=a;else if(s=!0===i.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0||!0===n.alphaToCoverage){const e=s.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=s.clone(),i[t]=r,n.addEventListener("dispose",b)),s=r}if(s.visible=n.visible,s.wireframe=n.wireframe,s.side=3===r?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],s.alphaMap=n.alphaMap,s.alphaTest=!0===n.alphaToCoverage?.5:n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===i.isPointLight&&!0===s.isMeshDistanceMaterial){e.properties.get(s).light=i}return s}function _(n,r,s,a,o){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===o)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=t.update(n),l=n.material;if(Array.isArray(l)){const t=i.groups;for(let c=0,h=t.length;c<h;c++){const h=t[c],d=l[h.materialIndex];if(d&&d.visible){const t=y(n,d,a,o);n.onBeforeShadow(e,n,r,s,i,t,h),e.renderBufferDirect(s,null,i,t,n,h),n.onAfterShadow(e,n,r,s,i,t,h)}}}else if(l.visible){const t=y(n,l,a,o);n.onBeforeShadow(e,n,r,s,i,t,null),e.renderBufferDirect(s,null,i,t,n,null),n.onAfterShadow(e,n,r,s,i,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)_(l[e],r,s,a,o)}function b(e){e.target.removeEventListener("dispose",b);for(const t in c){const n=c[t],i=e.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(t,n,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),u=e.state;u.setBlending(0),u.buffers.depth.getReversed()?u.buffers.color.setClear(0,0,0,0):u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);const p=3!==v&&3===this.type,m=3===v&&3!==this.type;for(let f=0,g=t.length;f<g;f++){const l=t[f],c=l.shadow;if(void 0===c)continue;if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const d=c.getFrameExtents();if(r.multiply(d),s.copy(c.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/d.x),r.x=s.x*d.x,c.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/d.y),r.y=s.y*d.y,c.mapSize.y=s.y)),null===c.map||!0===p||!0===m){const e=3!==this.type?{minFilter:xt,magFilter:xt}:{};null!==c.map&&c.map.dispose(),c.map=new zi(r.x,r.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const g=c.getViewportCount();for(let e=0;e<g;e++){const t=c.getViewport(e);a.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),u.viewport(a),c.updateMatrices(l,e),i=c.getFrustum(),_(n,o,c.camera,l,this.type)}!0!==c.isPointLightShadow&&3===this.type&&x(c,o),c.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,d)}}const Cm={[Qe]:1,[tt]:6,[it]:7,[nt]:5,[et]:0,[st]:2,[at]:4,[rt]:3};function Rm(e,t){const n=new function(){let t=!1;const n=new Fi;let i=null;const r=new Fi(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,s,a,o){!0===o&&(t*=a,i*=a,s*=a),n.set(t,i,s,a),!1===r.equals(n)&&(e.clearColor(t,i,s,a),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},i=new function(){let n=!1,i=!1,r=null,s=null,a=null;return{setReversed:function(e){if(i!==e){const n=t.get("EXT_clip_control");e?n.clipControlEXT(n.LOWER_LEFT_EXT,n.ZERO_TO_ONE_EXT):n.clipControlEXT(n.LOWER_LEFT_EXT,n.NEGATIVE_ONE_TO_ONE_EXT),i=e;const r=a;a=null,this.setClear(r)}},getReversed:function(){return i},setTest:function(t){t?z(e.DEPTH_TEST):j(e.DEPTH_TEST)},setMask:function(t){r===t||n||(e.depthMask(t),r=t)},setFunc:function(t){if(i&&(t=Cm[t]),s!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}s=t}},setLocked:function(e){n=e},setClear:function(t){a!==t&&(i&&(t=1-t),e.clearDepth(t),a=t)},reset:function(){n=!1,r=null,s=null,a=null,i=!1}}},r=new function(){let t=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(n){t||(n?z(e.STENCIL_TEST):j(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a){i===t&&r===n&&s===a||(e.stencilFunc(t,n,a),i=t,r=n,s=a)},setOp:function(t,n,i){a===t&&o===n&&l===i||(e.stencilOp(t,n,i),a=t,o=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null}}},s=new WeakMap,a=new WeakMap;let o={},l={},c=new WeakMap,h=[],d=null,u=!1,p=null,m=null,f=null,g=null,v=null,x=null,y=null,_=new ls(0,0,0),b=0,w=!1,M=null,S=null,T=null,E=null,A=null;const C=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let R=!1,N=0;const I=e.getParameter(e.VERSION);-1!==I.indexOf("WebGL")?(N=parseFloat(/^WebGL (\d)/.exec(I)[1]),R=N>=1):-1!==I.indexOf("OpenGL ES")&&(N=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),R=N>=2);let P=null,L={};const D=e.getParameter(e.SCISSOR_BOX),k=e.getParameter(e.VIEWPORT),U=(new Fi).fromArray(D),O=(new Fi).fromArray(k);function F(t,n,i,r){const s=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<i;o++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,r,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s);return a}const B={};function z(t){!0!==o[t]&&(e.enable(t),o[t]=!0)}function j(t){!1!==o[t]&&(e.disable(t),o[t]=!1)}B[e.TEXTURE_2D]=F(e.TEXTURE_2D,e.TEXTURE_2D,1),B[e.TEXTURE_CUBE_MAP]=F(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),B[e.TEXTURE_2D_ARRAY]=F(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),B[e.TEXTURE_3D]=F(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),i.setClear(1),r.setClear(0),z(e.DEPTH_TEST),i.setFunc(3),W(!1),X(1),z(e.CULL_FACE),G(0);const V={[ke]:e.FUNC_ADD,[Ue]:e.FUNC_SUBTRACT,[Oe]:e.FUNC_REVERSE_SUBTRACT};V[103]=e.MIN,V[104]=e.MAX;const H={[Fe]:e.ZERO,[Be]:e.ONE,[ze]:e.SRC_COLOR,[Ve]:e.SRC_ALPHA,[Ye]:e.SRC_ALPHA_SATURATE,[Xe]:e.DST_COLOR,[Ge]:e.DST_ALPHA,[je]:e.ONE_MINUS_SRC_COLOR,[He]:e.ONE_MINUS_SRC_ALPHA,[qe]:e.ONE_MINUS_DST_COLOR,[We]:e.ONE_MINUS_DST_ALPHA,[Ze]:e.CONSTANT_COLOR,[$e]:e.ONE_MINUS_CONSTANT_COLOR,[Je]:e.CONSTANT_ALPHA,[Ke]:e.ONE_MINUS_CONSTANT_ALPHA};function G(t,n,i,r,s,a,o,l,c,h){if(0!==t){if(!1===u&&(z(e.BLEND),u=!0),5===t)s=s||n,a=a||i,o=o||r,n===m&&s===v||(e.blendEquationSeparate(V[n],V[s]),m=n,v=s),i===f&&r===g&&a===x&&o===y||(e.blendFuncSeparate(H[i],H[r],H[a],H[o]),f=i,g=r,x=a,y=o),!1!==l.equals(_)&&c===b||(e.blendColor(l.r,l.g,l.b,c),_.copy(l),b=c),p=t,w=!1;else if(t!==p||h!==w){if(m===ke&&v===ke||(e.blendEquation(e.FUNC_ADD),m=ke,v=ke),h)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ZERO,e.ONE)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE,e.ONE,e.ONE)}f=null,g=null,x=null,y=null,_.set(0,0,0),b=0,p=t,w=h}}else!0===u&&(j(e.BLEND),u=!1)}function W(t){M!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),M=t)}function X(t){0!==t?(z(e.CULL_FACE),t!==S&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):j(e.CULL_FACE),S=t}function q(t,n,i){t?(z(e.POLYGON_OFFSET_FILL),E===n&&A===i||(e.polygonOffset(n,i),E=n,A=i)):j(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:i,stencil:r},enable:z,disable:j,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,t===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let i=h,r=!1;if(t){i=c.get(n),void 0===i&&(i=[],c.set(n,i));const s=t.textures;if(i.length!==s.length||i[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=s.length;t<n;t++)i[t]=e.COLOR_ATTACHMENT0+t;i.length=s.length,r=!0}}else i[0]!==e.BACK&&(i[0]=e.BACK,r=!0);r&&e.drawBuffers(i)},useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:G,setMaterial:function(t,s){2===t.side?j(e.CULL_FACE):z(e.CULL_FACE);let a=1===t.side;s&&(a=!a),W(a),1===t.blending&&!1===t.transparent?G(0):G(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),i.setFunc(t.depthFunc),i.setTest(t.depthTest),i.setMask(t.depthWrite),n.setMask(t.colorWrite);const o=t.stencilWrite;r.setTest(o),o&&(r.setMask(t.stencilWriteMask),r.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),r.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?z(e.SAMPLE_ALPHA_TO_COVERAGE):j(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:X,setLineWidth:function(t){t!==T&&(R&&e.lineWidth(t),T=t)},setPolygonOffset:q,setScissorTest:function(t){t?z(e.SCISSOR_TEST):j(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+C-1),P!==t&&(e.activeTexture(t),P=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===P?e.TEXTURE0+C-1:P);let r=L[i];void 0===r&&(r={type:void 0,texture:void 0},L[i]=r),r.type===t&&r.texture===n||(P!==i&&(e.activeTexture(i),P=i),e.bindTexture(t,n||B[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=L[P];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D(...arguments)}catch(t){}},compressedTexImage3D:function(){try{e.compressedTexImage3D(...arguments)}catch(t){}},texImage2D:function(){try{e.texImage2D(...arguments)}catch(t){}},texImage3D:function(){try{e.texImage3D(...arguments)}catch(t){}},updateUBOMapping:function(t,n){let i=a.get(n);void 0===i&&(i=new WeakMap,a.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=a.get(n).get(t);s.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),s.set(n,i))},texStorage2D:function(){try{e.texStorage2D(...arguments)}catch(t){}},texStorage3D:function(){try{e.texStorage3D(...arguments)}catch(t){}},texSubImage2D:function(){try{e.texSubImage2D(...arguments)}catch(t){}},texSubImage3D:function(){try{e.texSubImage3D(...arguments)}catch(t){}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D(...arguments)}catch(t){}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D(...arguments)}catch(t){}},scissor:function(t){!1===U.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),U.copy(t))},viewport:function(t){!1===O.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),O.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),i.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),o={},P=null,L={},l={},c=new WeakMap,h=[],d=null,u=!1,p=null,m=null,f=null,g=null,v=null,x=null,y=null,_=new ls(0,0,0),b=0,w=!1,M=null,S=null,T=null,E=null,A=null,U.set(0,0,e.canvas.width,e.canvas.height),O.set(0,0,e.canvas.width,e.canvas.height),n.reset(),i.reset(),r.reset()}}}function Nm(e,t,n,i,r,s,a){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new hi,h=new WeakMap;let d;const u=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(G){}function m(e,t){return p?new OffscreenCanvas(e,t):_i("canvas")}function f(e,t,n){let i=1;const r=H(e);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(i*r.width),s=Math.floor(i*r.height);void 0===d&&(d=m(n,s));const a=t?m(n,s):d;a.width=n,a.height=s;return a.getContext("2d").drawImage(e,0,0,n,s),a}return e}return e}function g(e){return e.generateMipmaps}function v(t){e.generateMipmap(t)}function x(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function y(n,i,r,s,a=!1){if(null!==n&&void 0!==e[n])return e[n];let o=i;if(i===e.RED&&(r===e.FLOAT&&(o=e.R32F),r===e.HALF_FLOAT&&(o=e.R16F),r===e.UNSIGNED_BYTE&&(o=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.R8UI),r===e.UNSIGNED_SHORT&&(o=e.R16UI),r===e.UNSIGNED_INT&&(o=e.R32UI),r===e.BYTE&&(o=e.R8I),r===e.SHORT&&(o=e.R16I),r===e.INT&&(o=e.R32I)),i===e.RG&&(r===e.FLOAT&&(o=e.RG32F),r===e.HALF_FLOAT&&(o=e.RG16F),r===e.UNSIGNED_BYTE&&(o=e.RG8)),i===e.RG_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RG8UI),r===e.UNSIGNED_SHORT&&(o=e.RG16UI),r===e.UNSIGNED_INT&&(o=e.RG32UI),r===e.BYTE&&(o=e.RG8I),r===e.SHORT&&(o=e.RG16I),r===e.INT&&(o=e.RG32I)),i===e.RGB_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RGB8UI),r===e.UNSIGNED_SHORT&&(o=e.RGB16UI),r===e.UNSIGNED_INT&&(o=e.RGB32UI),r===e.BYTE&&(o=e.RGB8I),r===e.SHORT&&(o=e.RGB16I),r===e.INT&&(o=e.RGB32I)),i===e.RGBA_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RGBA8UI),r===e.UNSIGNED_SHORT&&(o=e.RGBA16UI),r===e.UNSIGNED_INT&&(o=e.RGBA32UI),r===e.BYTE&&(o=e.RGBA8I),r===e.SHORT&&(o=e.RGBA16I),r===e.INT&&(o=e.RGBA32I)),i===e.RGB&&r===e.UNSIGNED_INT_5_9_9_9_REV&&(o=e.RGB9_E5),i===e.RGBA){const t=a?On:Ai.getTransfer(s);r===e.FLOAT&&(o=e.RGBA32F),r===e.HALF_FLOAT&&(o=e.RGBA16F),r===e.UNSIGNED_BYTE&&(o=t===Fn?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return o!==e.R16F&&o!==e.R32F&&o!==e.RG16F&&o!==e.RG32F&&o!==e.RGBA16F&&o!==e.RGBA32F||t.get("EXT_color_buffer_float"),o}function _(t,n){let i;return t?null===n||n===Nt||n===kt?i=e.DEPTH24_STENCIL8:n===It?i=e.DEPTH32F_STENCIL8:n===Ct&&(i=e.DEPTH24_STENCIL8):null===n||n===Nt||n===kt?i=e.DEPTH_COMPONENT24:n===It?i=e.DEPTH_COMPONENT32F:n===Ct&&(i=e.DEPTH_COMPONENT16),i}function b(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==xt&&e.minFilter!==bt?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function w(e){const t=e.target;t.removeEventListener("dispose",w),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=u.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&S(e),0===Object.keys(r).length&&u.delete(n)}i.remove(e)}(t),t.isVideoTexture&&h.delete(t)}function M(t){const n=t.target;n.removeEventListener("dispose",M),function(t){const n=i.get(t);t.depthTexture&&(t.depthTexture.dispose(),i.remove(t.depthTexture));if(t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(let t=0;t<n.__webglFramebuffer[i].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[i][t]);else e.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=t.textures;for(let s=0,o=r.length;s<o;s++){const t=i.get(r[s]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),a.memory.textures--),i.remove(r[s])}i.remove(t)}(n)}function S(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete u.get(r)[n.__cacheKey],a.memory.textures--}let T=0;function E(t,r){const s=i.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;h.get(e)!==t&&(h.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&!0!==t.isExternalTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e);else if(!1!==e.complete)return void L(s,t,r)}else t.isExternalTexture&&(s.__webglTexture=t.sourceTexture?t.sourceTexture:null);n.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+r)}const A={[ft]:e.REPEAT,[gt]:e.CLAMP_TO_EDGE,[vt]:e.MIRRORED_REPEAT},C={[xt]:e.NEAREST,[yt]:e.NEAREST_MIPMAP_NEAREST,[_t]:e.NEAREST_MIPMAP_LINEAR,[bt]:e.LINEAR,[wt]:e.LINEAR_MIPMAP_NEAREST,[Mt]:e.LINEAR_MIPMAP_LINEAR},R={[zn]:e.NEVER,[qn]:e.ALWAYS,[jn]:e.LESS,[Hn]:e.LEQUAL,[Vn]:e.EQUAL,[Xn]:e.GEQUAL,[Gn]:e.GREATER,[Wn]:e.NOTEQUAL};function N(n,s){if(s.type===It&&!1===t.has("OES_texture_float_linear")&&(s.magFilter===bt||s.magFilter===wt||s.magFilter===_t||s.magFilter===Mt||s.minFilter===bt||s.minFilter===wt||s.minFilter===_t||s.minFilter),e.texParameteri(n,e.TEXTURE_WRAP_S,A[s.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,A[s.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,A[s.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,C[s.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,C[s.minFilter]),s.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,R[s.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(s.magFilter===xt)return;if(s.minFilter!==_t&&s.minFilter!==Mt)return;if(s.type===It&&!1===t.has("OES_texture_float_linear"))return;if(s.anisotropy>1||i.get(s).__currentAnisotropy){const a=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy}}}function I(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w));const r=n.source;let s=u.get(r);void 0===s&&(s={},u.set(r,s));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===s[o]&&(s[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,i=!0),s[o].usedTimes++;const r=s[t.__cacheKey];void 0!==r&&(s[t.__cacheKey].usedTimes--,0===r.usedTimes&&S(n)),t.__cacheKey=o,t.__webglTexture=s[o].texture}return i}function P(e,t,n){return Math.floor(Math.floor(e/n)/t)}function L(t,a,o){let l=e.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),a.isData3DTexture&&(l=e.TEXTURE_3D);const c=I(t,a),h=a.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const d=i.get(h);if(h.version!==d.__version||!0===c){n.activeTexture(e.TEXTURE0+o);const t=Ai.getPrimaries(Ai.workingColorSpace),i=a.colorSpace===Dn?null:Ai.getPrimaries(a.colorSpace),u=a.colorSpace===Dn||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,u);let p=f(a.image,!1,r.maxTextureSize);p=V(a,p);const m=s.convert(a.format,a.colorSpace),x=s.convert(a.type);let w,M=y(a.internalFormat,m,x,a.colorSpace,a.isVideoTexture);N(l,a);const S=a.mipmaps,T=!0!==a.isVideoTexture,E=void 0===d.__version||!0===c,A=h.dataReady,C=b(a,p);if(a.isDepthTexture)M=_(a.format===jt,a.type),E&&(T?n.texStorage2D(e.TEXTURE_2D,1,M,p.width,p.height):n.texImage2D(e.TEXTURE_2D,0,M,p.width,p.height,0,m,x,null));else if(a.isDataTexture)if(S.length>0){T&&E&&n.texStorage2D(e.TEXTURE_2D,C,M,S[0].width,S[0].height);for(let t=0,i=S.length;t<i;t++)w=S[t],T?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,m,x,w.data):n.texImage2D(e.TEXTURE_2D,t,M,w.width,w.height,0,m,x,w.data);a.generateMipmaps=!1}else T?(E&&n.texStorage2D(e.TEXTURE_2D,C,M,p.width,p.height),A&&function(t,i,r,s){const a=t.updateRanges;if(0===a.length)n.texSubImage2D(e.TEXTURE_2D,0,0,0,i.width,i.height,r,s,i.data);else{a.sort(((e,t)=>e.start-t.start));let o=0;for(let e=1;e<a.length;e++){const t=a[o],n=a[e],r=t.start+t.count,s=P(n.start,i.width,4),l=P(t.start,i.width,4);n.start<=r+1&&s===l&&P(n.start+n.count-1,i.width,4)===s?t.count=Math.max(t.count,n.start+n.count-t.start):(++o,a[o]=n)}a.length=o+1;const l=e.getParameter(e.UNPACK_ROW_LENGTH),c=e.getParameter(e.UNPACK_SKIP_PIXELS),h=e.getParameter(e.UNPACK_SKIP_ROWS);e.pixelStorei(e.UNPACK_ROW_LENGTH,i.width);for(let t=0,d=a.length;t<d;t++){const o=a[t],l=Math.floor(o.start/4),c=Math.ceil(o.count/4),h=l%i.width,d=Math.floor(l/i.width),u=c,p=1;e.pixelStorei(e.UNPACK_SKIP_PIXELS,h),e.pixelStorei(e.UNPACK_SKIP_ROWS,d),n.texSubImage2D(e.TEXTURE_2D,0,h,d,u,p,r,s,i.data)}t.clearUpdateRanges(),e.pixelStorei(e.UNPACK_ROW_LENGTH,l),e.pixelStorei(e.UNPACK_SKIP_PIXELS,c),e.pixelStorei(e.UNPACK_SKIP_ROWS,h)}}(a,p,m,x)):n.texImage2D(e.TEXTURE_2D,0,M,p.width,p.height,0,m,x,p.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){T&&E&&n.texStorage3D(e.TEXTURE_2D_ARRAY,C,M,S[0].width,S[0].height,p.depth);for(let t=0,i=S.length;t<i;t++)if(w=S[t],a.format!==Bt){if(null!==m)if(T){if(A)if(a.layerUpdates.size>0){const i=tu(w.width,w.height,a.format,a.type);for(const r of a.layerUpdates){const s=w.data.subarray(r*i/w.data.BYTES_PER_ELEMENT,(r+1)*i/w.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,r,w.width,w.height,1,m,s)}a.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,p.depth,m,w.data)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,M,w.width,w.height,p.depth,0,w.data,0,0)}else T?A&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,p.depth,m,x,w.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,M,w.width,w.height,p.depth,0,m,x,w.data)}else{T&&E&&n.texStorage2D(e.TEXTURE_2D,C,M,S[0].width,S[0].height);for(let t=0,i=S.length;t<i;t++)w=S[t],a.format!==Bt?null!==m&&(T?A&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,m,w.data):n.compressedTexImage2D(e.TEXTURE_2D,t,M,w.width,w.height,0,w.data)):T?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,m,x,w.data):n.texImage2D(e.TEXTURE_2D,t,M,w.width,w.height,0,m,x,w.data)}else if(a.isDataArrayTexture)if(T){if(E&&n.texStorage3D(e.TEXTURE_2D_ARRAY,C,M,p.width,p.height,p.depth),A)if(a.layerUpdates.size>0){const t=tu(p.width,p.height,a.format,a.type);for(const i of a.layerUpdates){const r=p.data.subarray(i*t/p.data.BYTES_PER_ELEMENT,(i+1)*t/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,i,p.width,p.height,1,m,x,r)}a.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,m,x,p.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,M,p.width,p.height,p.depth,0,m,x,p.data);else if(a.isData3DTexture)T?(E&&n.texStorage3D(e.TEXTURE_3D,C,M,p.width,p.height,p.depth),A&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,m,x,p.data)):n.texImage3D(e.TEXTURE_3D,0,M,p.width,p.height,p.depth,0,m,x,p.data);else if(a.isFramebufferTexture){if(E)if(T)n.texStorage2D(e.TEXTURE_2D,C,M,p.width,p.height);else{let t=p.width,i=p.height;for(let r=0;r<C;r++)n.texImage2D(e.TEXTURE_2D,r,M,t,i,0,m,x,null),t>>=1,i>>=1}}else if(S.length>0){if(T&&E){const t=H(S[0]);n.texStorage2D(e.TEXTURE_2D,C,M,t.width,t.height)}for(let t=0,i=S.length;t<i;t++)w=S[t],T?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,m,x,w):n.texImage2D(e.TEXTURE_2D,t,M,m,x,w);a.generateMipmaps=!1}else if(T){if(E){const t=H(p);n.texStorage2D(e.TEXTURE_2D,C,M,t.width,t.height)}A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,m,x,p)}else n.texImage2D(e.TEXTURE_2D,0,M,m,x,p);g(a)&&v(l),d.__version=h.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}function D(t,r,a,l,c,h){const d=s.convert(a.format,a.colorSpace),u=s.convert(a.type),p=y(a.internalFormat,d,u,a.colorSpace),m=i.get(r),f=i.get(a);if(f.__renderTarget=r,!m.__hasExternalTextures){const t=Math.max(1,r.width>>h),i=Math.max(1,r.height>>h);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,h,p,t,i,r.depth,0,d,u,null):n.texImage2D(c,h,p,t,i,0,d,u,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),j(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,c,f.__webglTexture,0,z(r)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,c,f.__webglTexture,h),n.bindFramebuffer(e.FRAMEBUFFER,null)}function k(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const r=n.depthTexture,s=r&&r.isDepthTexture?r.type:null,a=_(n.stencilBuffer,s),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=z(n);j(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,a,n.width,n.height):i?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,a,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,a,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let r=0;r<t.length;r++){const a=t[r],l=s.convert(a.format,a.colorSpace),c=s.convert(a.type),h=y(a.internalFormat,l,c,a.colorSpace),d=z(n);i&&!1===j(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,d,h,n.width,n.height):j(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,d,h,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,h,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function U(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const s=i.get(r.depthTexture);s.__renderTarget=r,s.__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),E(r.depthTexture,0);const a=s.__webglTexture,l=z(r);if(r.depthTexture.format===zt)j(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{if(r.depthTexture.format!==jt)throw new Error("Unknown depthTexture format");j(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}function O(t){const r=i.get(t),s=!0===t.isWebGLCubeRenderTarget;if(r.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(r.__depthDisposeCallback&&r.__depthDisposeCallback(),e){const t=()=>{delete r.__boundDepthTexture,delete r.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),r.__depthDisposeCallback=t}r.__boundDepthTexture=e}if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");const e=t.texture.mipmaps;e&&e.length>0?U(r.__webglFramebuffer[0],t):U(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)if(n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),void 0===r.__webglDepthbuffer[i])r.__webglDepthbuffer[i]=e.createRenderbuffer(),k(r.__webglDepthbuffer[i],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,s=r.__webglDepthbuffer[i];e.bindRenderbuffer(e.RENDERBUFFER,s),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,s)}}else{const i=t.texture.mipmaps;if(i&&i.length>0?n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[0]):n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),void 0===r.__webglDepthbuffer)r.__webglDepthbuffer=e.createRenderbuffer(),k(r.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,i=r.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,i)}}n.bindFramebuffer(e.FRAMEBUFFER,null)}const F=[],B=[];function z(e){return Math.min(r.maxSamples,e.samples)}function j(e){const n=i.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function V(e,t){const n=e.colorSpace;e.format,e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==Un&&n!==Dn&&Ai.getTransfer(n),t}function H(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){const e=T;return r.maxTextures,T+=1,e},this.resetTextureUnits=function(){T=0},this.setTexture2D=E,this.setTexture2DArray=function(t,r){const s=i.get(t);!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version?L(s,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){const s=i.get(t);!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version?L(s,t,r):n.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,a){const o=i.get(t);t.version>0&&o.__version!==t.version?function(t,a,o){if(6!==a.image.length)return;const l=I(t,a),c=a.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const h=i.get(c);if(c.version!==h.__version||!0===l){n.activeTexture(e.TEXTURE0+o);const t=Ai.getPrimaries(Ai.workingColorSpace),i=a.colorSpace===Dn?null:Ai.getPrimaries(a.colorSpace),d=a.colorSpace===Dn||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const u=a.isCompressedTexture||a.image[0].isCompressedTexture,p=a.image[0]&&a.image[0].isDataTexture,m=[];for(let e=0;e<6;e++)m[e]=u||p?p?a.image[e].image:a.image[e]:f(a.image[e],!0,r.maxCubemapSize),m[e]=V(a,m[e]);const x=m[0],_=s.convert(a.format,a.colorSpace),w=s.convert(a.type),M=y(a.internalFormat,_,w,a.colorSpace),S=!0!==a.isVideoTexture,T=void 0===h.__version||!0===l,E=c.dataReady;let A,C=b(a,x);if(N(e.TEXTURE_CUBE_MAP,a),u){S&&T&&n.texStorage2D(e.TEXTURE_CUBE_MAP,C,M,x.width,x.height);for(let t=0;t<6;t++){A=m[t].mipmaps;for(let i=0;i<A.length;i++){const r=A[i];a.format!==Bt?null!==_&&(S?E&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,_,r.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,M,r.width,r.height,0,r.data)):S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,_,w,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,M,r.width,r.height,0,_,w,r.data)}}}else{if(A=a.mipmaps,S&&T){A.length>0&&C++;const t=H(m[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,C,M,t.width,t.height)}for(let t=0;t<6;t++)if(p){S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m[t].width,m[t].height,_,w,m[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,M,m[t].width,m[t].height,0,_,w,m[t].data);for(let i=0;i<A.length;i++){const r=A[i].image[t].image;S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,_,w,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,M,r.width,r.height,0,_,w,r.data)}}else{S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,_,w,m[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,M,_,w,m[t]);for(let i=0;i<A.length;i++){const r=A[i];S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,_,w,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,M,_,w,r.image[t])}}}g(a)&&v(e.TEXTURE_CUBE_MAP),h.__version=c.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}(o,t,a):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+a)},this.rebindTextures=function(t,n,r){const s=i.get(t);void 0!==n&&D(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&O(t)},this.setupRenderTarget=function(t){const r=t.texture,o=i.get(t),l=i.get(r);t.addEventListener("dispose",M);const c=t.textures,h=!0===t.isWebGLCubeRenderTarget,d=c.length>1;if(d||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=r.version,a.memory.textures++),h){o.__webglFramebuffer=[];for(let t=0;t<6;t++)if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer[t]=[];for(let n=0;n<r.mipmaps.length;n++)o.__webglFramebuffer[t][n]=e.createFramebuffer()}else o.__webglFramebuffer[t]=e.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer=[];for(let t=0;t<r.mipmaps.length;t++)o.__webglFramebuffer[t]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(d)for(let t=0,n=c.length;t<n;t++){const n=i.get(c[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),a.memory.textures++)}if(t.samples>0&&!1===j(t)){o.__webglMultisampledFramebuffer=e.createFramebuffer(),o.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const i=c[n];o.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,o.__webglColorRenderbuffer[n]);const r=s.convert(i.format,i.colorSpace),a=s.convert(i.type),l=y(i.internalFormat,r,a,i.colorSpace,!0===t.isXRRenderTarget),h=z(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,h,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,o.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(o.__webglDepthRenderbuffer=e.createRenderbuffer(),k(o.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(h){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),N(e.TEXTURE_CUBE_MAP,r);for(let n=0;n<6;n++)if(r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)D(o.__webglFramebuffer[n][i],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else D(o.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(r)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){for(let r=0,s=c.length;r<s;r++){const s=c[r],a=i.get(s);let l=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(l,a.__webglTexture),N(l,s),D(o.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0+r,l,0),g(s)&&v(l)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(i,l.__webglTexture),N(i,r),r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)D(o.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,i,n);else D(o.__webglFramebuffer,t,r,e.COLOR_ATTACHMENT0,i,0);g(r)&&v(i),n.unbindTexture()}t.depthBuffer&&O(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let r=0,s=t.length;r<s;r++){const s=t[r];if(g(s)){const t=x(e),r=i.get(s).__webglTexture;n.bindTexture(t,r),v(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===j(t)){const r=t.textures,s=t.width,a=t.height;let o=e.COLOR_BUFFER_BIT;const c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,h=i.get(t),d=r.length>1;if(d)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer);const u=t.texture.mipmaps;u&&u.length>0?n.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglFramebuffer[0]):n.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let n=0;n<r.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),d){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,h.__webglColorRenderbuffer[n]);const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,a,0,0,s,a,o,e.NEAREST),!0===l&&(F.length=0,B.length=0,F.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(F.push(c),B.push(c),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,B)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,F))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,h.__webglColorRenderbuffer[t]);const s=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=D,this.useMultisampledRTT=j}function Im(e,t){return{convert:function(n,i=""){let r;const s=Ai.getTransfer(i);if(n===Tt)return e.UNSIGNED_BYTE;if(n===Lt)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Dt)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Ut)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===Et)return e.BYTE;if(n===At)return e.SHORT;if(n===Ct)return e.UNSIGNED_SHORT;if(n===Rt)return e.INT;if(n===Nt)return e.UNSIGNED_INT;if(n===It)return e.FLOAT;if(n===Pt)return e.HALF_FLOAT;if(n===Ot)return e.ALPHA;if(n===Ft)return e.RGB;if(n===Bt)return e.RGBA;if(n===zt)return e.DEPTH_COMPONENT;if(n===jt)return e.DEPTH_STENCIL;if(n===Vt)return e.RED;if(n===Ht)return e.RED_INTEGER;if(n===Gt)return e.RG;if(n===Wt)return e.RG_INTEGER;if(n===Xt)return e.RGBA_INTEGER;if(n===qt||n===Yt||n===Zt||n===$t)if(s===Fn){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===qt)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Yt)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Zt)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===$t)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===qt)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Yt)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Zt)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===$t)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Jt||n===Kt||n===Qt||n===en){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===Jt)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Kt)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Qt)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===en)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===tn||n===nn||n===rn){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===tn||n===nn)return s===Fn?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===rn)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===sn||n===an||n===on||n===ln||n===cn||n===hn||n===dn||n===un||n===pn||n===mn||n===fn||n===gn||n===vn||n===xn){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===sn)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===an)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===on)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===ln)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===cn)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===hn)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===dn)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===un)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===pn)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===mn)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===fn)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===gn)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===vn)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===xn)return s===Fn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===yn||n===_n||n===bn){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(n===yn)return s===Fn?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===_n)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===bn)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===wn||n===Mn||n===Sn||n===Tn){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===yn)return r.COMPRESSED_RED_RGTC1_EXT;if(n===Mn)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Sn)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Tn)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===kt?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class Pm extends Oi{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}}class Lm{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(null===this.texture){const n=new Pm(e.texture);e.depthNear===t.depthNear&&e.depthFar===t.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new Js({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Gs(new bc(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Dm extends Kn{constructor(e,t){super();const n=this;let i=null,r=1,s=null,a="local-floor",o=1,l=null,c=null,h=null,d=null,u=null,p=null;const m=new Lm,f={},g=t.getContextAttributes();let v=null,x=null;const y=[],_=[],b=new hi;let w=null;const M=new na;M.viewport=new Fi;const S=new na;S.viewport=new Fi;const T=[M,S],E=new Qh;let A=null,C=null;function R(e){const t=_.indexOf(e.inputSource);if(-1===t)return;const n=y[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||s),n.dispatchEvent({type:e.type,data:e.inputSource}))}function N(){i.removeEventListener("select",R),i.removeEventListener("selectstart",R),i.removeEventListener("selectend",R),i.removeEventListener("squeeze",R),i.removeEventListener("squeezestart",R),i.removeEventListener("squeezeend",R),i.removeEventListener("end",N),i.removeEventListener("inputsourceschange",I);for(let e=0;e<y.length;e++){const t=_[e];null!==t&&(_[e]=null,y[e].disconnect(t))}A=null,C=null,m.reset();for(const e in f)delete f[e];e.setRenderTarget(v),u=null,d=null,h=null,i=null,x=null,U.stop(),n.isPresenting=!1,e.setPixelRatio(w),e.setSize(b.width,b.height,!1),n.dispatchEvent({type:"sessionend"})}function I(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=_.indexOf(n);i>=0&&(_[i]=null,y[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=_.indexOf(n);if(-1===i){for(let e=0;e<y.length;e++){if(e>=_.length){_.push(n),i=e;break}if(null===_[e]){_[e]=n,i=e;break}}if(-1===i)break}const r=y[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=y[e];return void 0===t&&(t=new ca,y[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=y[e];return void 0===t&&(t=new ca,y[e]=t),t.getGripSpace()},this.getHand=function(e){let t=y[e];return void 0===t&&(t=new ca,y[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,n.isPresenting},this.setReferenceSpaceType=function(e){a=e,n.isPresenting},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:u},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){v=e.getRenderTarget(),i.addEventListener("select",R),i.addEventListener("selectstart",R),i.addEventListener("selectend",R),i.addEventListener("squeeze",R),i.addEventListener("squeezestart",R),i.addEventListener("squeezeend",R),i.addEventListener("end",N),i.addEventListener("inputsourceschange",I),!0!==g.xrCompatible&&await t.makeXRCompatible(),w=e.getPixelRatio(),e.getSize(b),"undefined"!=typeof XRWebGLBinding&&(h=new XRWebGLBinding(i,t));if(null!==h&&"createProjectionLayer"in XRWebGLBinding.prototype){let n=null,s=null,a=null;g.depth&&(a=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=g.stencil?jt:zt,s=g.stencil?kt:Nt);const o={colorFormat:t.RGBA8,depthFormat:a,scaleFactor:r};d=h.createProjectionLayer(o),i.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),x=new zi(d.textureWidth,d.textureHeight,{format:Bt,type:Tt,depthTexture:new sl(d.textureWidth,d.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}else{const n={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:u}),e.setPixelRatio(1),e.setSize(u.framebufferWidth,u.framebufferHeight,!1),x=new zi(u.framebufferWidth,u.framebufferHeight,{format:Bt,type:Tt,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil,resolveDepthBuffer:!1===u.ignoreDepthValues,resolveStencilBuffer:!1===u.ignoreDepthValues})}x.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await i.requestReferenceSpace(a),U.setContext(i),U.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};const P=new ui,L=new ui;function D(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;let t=e.near,n=e.far;null!==m.texture&&(m.depthNear>0&&(t=m.depthNear),m.depthFar>0&&(n=m.depthFar)),E.near=S.near=M.near=t,E.far=S.far=M.far=n,A===E.near&&C===E.far||(i.updateRenderState({depthNear:E.near,depthFar:E.far}),A=E.near,C=E.far),E.layers.mask=6|e.layers.mask,M.layers.mask=3&E.layers.mask,S.layers.mask=5&E.layers.mask;const r=e.parent,s=E.cameras;D(E,r);for(let i=0;i<s.length;i++)D(s[i],r);2===s.length?function(e,t,n){P.setFromMatrixPosition(t.matrixWorld),L.setFromMatrixPosition(n.matrixWorld);const i=P.distanceTo(L),r=t.projectionMatrix.elements,s=n.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],d=(s[8]+1)/s[0],u=a*h,p=a*d,m=i/(-h+d),f=m*-h;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(m),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===r[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=a+m,n=o+m,r=u-f,s=p+(i-f),h=l*o/n*t,d=c*o/n*t;e.projectionMatrix.makePerspective(r,s,h,d,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(E,M,S):E.projectionMatrix.copy(M.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*ni*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,E,r)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==d||null!==u)return o},this.setFoveation=function(e){o=e,null!==d&&(d.fixedFoveation=e),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==m.texture},this.getDepthSensingMesh=function(){return m.getMesh(E)},this.getCameraTexture=function(e){return f[e]};let k=null;const U=new nu;U.setAnimationLoop((function(t,r){if(c=r.getViewerPose(l||s),p=r,null!==c){const t=c.views;null!==u&&(e.setRenderTargetFramebuffer(x,u.framebuffer),e.setRenderTarget(x));let n=!1;t.length!==E.cameras.length&&(E.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let s=null;if(null!==u)s=u.getViewport(r);else{const t=h.getViewSubImage(d,r);s=t.viewport,0===i&&(e.setRenderTargetTextures(x,t.colorTexture,t.depthStencilTexture),e.setRenderTarget(x))}let a=T[i];void 0===a&&(a=new na,a.layers.enable(i),a.viewport=new Fi,T[i]=a),a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(r.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(s.x,s.y,s.width,s.height),0===i&&(E.matrix.copy(a.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),!0===n&&E.cameras.push(a)}const r=i.enabledFeatures;if(r&&r.includes("depth-sensing")&&"gpu-optimized"==i.depthUsage&&h){const e=h.getDepthInformation(t[0]);e&&e.isValid&&e.texture&&m.init(e,i.renderState)}if(r&&r.includes("camera-access")&&(e.state.unbindTexture(),h))for(let e=0;e<t.length;e++){const n=t[e].camera;if(n){let e=f[n];e||(e=new Pm,f[n]=e);const t=h.getCameraImage(n);e.sourceTexture=t}}}for(let e=0;e<y.length;e++){const t=_[e],n=y[e];null!==t&&void 0!==n&&n.update(t,r,l||s)}k&&k(t,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),p=null})),this.setAnimationLoop=function(e){k=e},this.dispose=function(){}}}const km=new Er,Um=new gr;function Om(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map,n(i.map,e.mapTransform)),i.alphaMap&&(e.alphaMap.value=i.alphaMap,n(i.alphaMap,e.alphaMapTransform)),i.bumpMap&&(e.bumpMap.value=i.bumpMap,n(i.bumpMap,e.bumpMapTransform),e.bumpScale.value=i.bumpScale,1===i.side&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,n(i.normalMap,e.normalMapTransform),e.normalScale.value.copy(i.normalScale),1===i.side&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,n(i.displacementMap,e.displacementMapTransform),e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,e.emissiveMapTransform)),i.specularMap&&(e.specularMap.value=i.specularMap,n(i.specularMap,e.specularMapTransform)),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const r=t.get(i),s=r.envMap,a=r.envMapRotation;s&&(e.envMap.value=s,km.copy(a),km.x*=-1,km.y*=-1,km.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(km.y*=-1,km.z*=-1),e.envMapRotation.value.setFromMatrix4(Um.makeRotationFromEuler(km)),e.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity,n(i.lightMap,e.lightMapTransform)),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Zs(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,s,a,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,o)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,s,a):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Fm(e,t,n,i){let r={},s={},a=[];const o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,i){const r=e.value,s=t+"_"+n;if(void 0===i[s])return i[s]="number"==typeof r||"boolean"==typeof r?r:r.clone(),!0;{const e=i[s];if("number"==typeof r||"boolean"==typeof r){if(e!==r)return i[s]=r,!0}else if(!1===e.equals(r))return e.copy(r),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture,t}function h(t){const n=t.target;n.removeEventListener("dispose",h);const i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,d){let u=r[n.id];void 0===u&&(!function(e){const t=e.uniforms;let n=0;const i=16;for(let s=0,a=t.length;s<a;s++){const e=Array.isArray(t[s])?t[s]:[t[s]];for(let t=0,r=e.length;t<r;t++){const r=e[t],s=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=s.length;e<t;e++){const t=c(s[e]),a=n%i,o=a%t.boundary,l=a+o;n+=o,0!==l&&i-l<t.storage&&(n+=i-l),r.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,n+=t.storage}}}const r=n%i;r>0&&(n+=i-r);e.__size=n,e.__cache={}}(n),u=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===a.indexOf(e))return a.push(e),e;return 0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=u,n.addEventListener("dispose",h));const p=d.program;i.updateUBOMapping(n,p);const m=t.render.frame;s[n.id]!==m&&(!function(t){const n=r[t.id],i=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let r=0,a=i.length;r<a;r++){const t=Array.isArray(i[r])?i[r]:[i[r]];for(let n=0,i=t.length;n<i;n++){const i=t[n];if(!0===l(i,r,n,s)){const t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let s=0;s<n.length;s++){const a=n[s],o=c(a);"number"==typeof a||"boolean"==typeof a?(i.__data[0]=a,e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):a.isMatrix3?(i.__data[0]=a.elements[0],i.__data[1]=a.elements[1],i.__data[2]=a.elements[2],i.__data[3]=0,i.__data[4]=a.elements[3],i.__data[5]=a.elements[4],i.__data[6]=a.elements[5],i.__data[7]=0,i.__data[8]=a.elements[6],i.__data[9]=a.elements[7],i.__data[10]=a.elements[8],i.__data[11]=0):(a.toArray(i.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),s[n.id]=m)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);a=[],r={},s={}}}}class Bm{constructor(e={}){const{canvas:t=bi(),context:n=null,depth:i=!0,stencil:r=!1,alpha:s=!1,antialias:a=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:h=!1,reversedDepthBuffer:d=!1}=e;let u;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");u=n.getContextAttributes().alpha}else u=s;const p=new Uint32Array(4),m=new Int32Array(4);let f=null,g=null;const v=[],x=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=0,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const y=this;let _=!1;this._outputColorSpace=kn;let b=0,w=0,M=null,S=-1,T=null;const E=new Fi,A=new Fi;let C=null;const R=new ls(0);let N=0,I=t.width,P=t.height,L=1,D=null,k=null;const U=new Fi(0,0,I,P),O=new Fi(0,0,I,P);let F=!1;const B=new po;let z=!1,j=!1;const V=new gr,H=new ui,G=new Fi,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let X=!1;function q(){return null===M?L:1}let Y,Z,$,J,K,Q,ee,te,ne,ie,re,se,ae,oe,le,ce,he,de,ue,pe,me,fe,ge,ve,xe=n;function ye(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:i,stencil:r,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Ie}`),t.addEventListener("webglcontextlost",we,!1),t.addEventListener("webglcontextrestored",Me,!1),t.addEventListener("webglcontextcreationerror",Se,!1),null===xe){const t="webgl2";if(xe=ye(t,e),null===xe)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(He){throw He}function _e(){Y=new ku(xe),Y.init(),fe=new Im(xe,Y),Z=new pu(xe,Y,e,fe),$=new Rm(xe,Y),Z.reversedDepthBuffer&&d&&$.buffers.depth.setReversed(!0),J=new Fu(xe),K=new gm,Q=new Nm(xe,Y,$,K,Z,fe,J),ee=new fu(y),te=new Du(y),ne=new iu(xe),ge=new du(xe,ne),ie=new Uu(xe,ne,J,ge),re=new zu(xe,ie,ne,J),ue=new Bu(xe,Z,Q),ce=new mu(K),se=new fm(y,ee,te,Y,Z,ge,ce),ae=new Om(y,K),oe=new _m,le=new Em(Y),de=new hu(y,ee,te,$,re,u,o),he=new Am(y,re,Z),ve=new Fm(xe,J,Z,$),pe=new uu(xe,Y,J),me=new Ou(xe,Y,J),J.programs=se.programs,y.capabilities=Z,y.extensions=Y,y.properties=K,y.renderLists=oe,y.shadowMap=he,y.state=$,y.info=J}_e();const be=new Dm(y,xe);function we(e){e.preventDefault(),_=!0}function Me(){_=!1;const e=J.autoReset,t=he.enabled,n=he.autoUpdate,i=he.needsUpdate,r=he.type;_e(),J.autoReset=e,he.enabled=t,he.autoUpdate=n,he.needsUpdate=i,he.type=r}function Se(e){}function Te(e){const t=e.target;t.removeEventListener("dispose",Te),function(e){(function(e){const t=K.get(e).programs;void 0!==t&&(t.forEach((function(e){se.releaseProgram(e)})),e.isShaderMaterial&&se.releaseShaderCache(e))})(e),K.remove(e)}(t)}function Ee(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Oe(e,t,n),e.side=0,e.needsUpdate=!0,Oe(e,t,n),e.side=2):Oe(e,t,n)}this.xr=be,this.getContext=function(){return xe},this.getContextAttributes=function(){return xe.getContextAttributes()},this.forceContextLoss=function(){const e=Y.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=Y.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(e){void 0!==e&&(L=e,this.setSize(I,P,!1))},this.getSize=function(e){return e.set(I,P)},this.setSize=function(e,n,i=!0){be.isPresenting||(I=e,P=n,t.width=Math.floor(e*L),t.height=Math.floor(n*L),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(I*L,P*L).floor()},this.setDrawingBufferSize=function(e,n,i){I=e,P=n,L=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(E)},this.getViewport=function(e){return e.copy(U)},this.setViewport=function(e,t,n,i){e.isVector4?U.set(e.x,e.y,e.z,e.w):U.set(e,t,n,i),$.viewport(E.copy(U).multiplyScalar(L).round())},this.getScissor=function(e){return e.copy(O)},this.setScissor=function(e,t,n,i){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,i),$.scissor(A.copy(O).multiplyScalar(L).round())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){$.setScissorTest(F=e)},this.setOpaqueSort=function(e){D=e},this.setTransparentSort=function(e){k=e},this.getClearColor=function(e){return e.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor(...arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha(...arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;if(e){let e=!1;if(null!==M){const t=M.texture.format;e=t===Xt||t===Wt||t===Ht}if(e){const e=M.texture.type,t=e===Tt||e===Nt||e===Ct||e===kt||e===Lt||e===Dt,n=de.getClearColor(),i=de.getClearAlpha(),r=n.r,s=n.g,a=n.b;t?(p[0]=r,p[1]=s,p[2]=a,p[3]=i,xe.clearBufferuiv(xe.COLOR,0,p)):(m[0]=r,m[1]=s,m[2]=a,m[3]=i,xe.clearBufferiv(xe.COLOR,0,m))}else i|=xe.COLOR_BUFFER_BIT}t&&(i|=xe.DEPTH_BUFFER_BIT),n&&(i|=xe.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),xe.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",we,!1),t.removeEventListener("webglcontextrestored",Me,!1),t.removeEventListener("webglcontextcreationerror",Se,!1),de.dispose(),oe.dispose(),le.dispose(),K.dispose(),ee.dispose(),te.dispose(),re.dispose(),ge.dispose(),ve.dispose(),se.dispose(),be.dispose(),be.removeEventListener("sessionstart",Ce),be.removeEventListener("sessionend",Re),Ne.stop()},this.renderBufferDirect=function(e,t,n,i,r,s){null===t&&(t=W);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(e,t,n,i,r){!0!==t.isScene&&(t=W);Q.resetTextureUnits();const s=t.fog,a=i.isMeshStandardMaterial?t.environment:null,o=null===M?y.outputColorSpace:!0===M.isXRRenderTarget?M.texture.colorSpace:Un,l=(i.isMeshStandardMaterial?te:ee).get(i.envMap||a),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,h=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),d=!!n.morphAttributes.position,u=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let m=0;i.toneMapped&&(null!==M&&!0!==M.isXRRenderTarget||(m=y.toneMapping));const f=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==f?f.length:0,x=K.get(i),_=g.state.lights;if(!0===z&&(!0===j||e!==T)){const t=e===T&&i.id===S;ce.setState(i,e,t)}let b=!1;i.version===x.__version?x.needsLights&&x.lightsStateVersion!==_.state.version||x.outputColorSpace!==o||r.isBatchedMesh&&!1===x.batching?b=!0:r.isBatchedMesh||!0!==x.batching?r.isBatchedMesh&&!0===x.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===x.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===x.instancing?b=!0:r.isInstancedMesh||!0!==x.instancing?r.isSkinnedMesh&&!1===x.skinning?b=!0:r.isSkinnedMesh||!0!==x.skinning?r.isInstancedMesh&&!0===x.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===x.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===x.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===x.instancingMorph&&null!==r.morphTexture||x.envMap!==l||!0===i.fog&&x.fog!==s?b=!0:void 0===x.numClippingPlanes||x.numClippingPlanes===ce.numPlanes&&x.numIntersection===ce.numIntersection?(x.vertexAlphas!==c||x.vertexTangents!==h||x.morphTargets!==d||x.morphNormals!==u||x.morphColors!==p||x.toneMapping!==m||x.morphTargetsCount!==v)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,x.__version=i.version);let w=x.currentProgram;!0===b&&(w=Oe(i,t,r));let E=!1,A=!1,C=!1;const R=w.getUniforms(),N=x.uniforms;$.useProgram(w.program)&&(E=!0,A=!0,C=!0);i.id!==S&&(S=i.id,A=!0);if(E||T!==e){$.buffers.depth.getReversed()&&!0!==e.reversedDepth&&(e._reversedDepth=!0,e.updateProjectionMatrix()),R.setValue(xe,"projectionMatrix",e.projectionMatrix),R.setValue(xe,"viewMatrix",e.matrixWorldInverse);const t=R.map.cameraPosition;void 0!==t&&t.setValue(xe,H.setFromMatrixPosition(e.matrixWorld)),Z.logarithmicDepthBuffer&&R.setValue(xe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&R.setValue(xe,"isOrthographic",!0===e.isOrthographicCamera),T!==e&&(T=e,A=!0,C=!0)}if(r.isSkinnedMesh){R.setOptional(xe,r,"bindMatrix"),R.setOptional(xe,r,"bindMatrixInverse");const e=r.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),R.setValue(xe,"boneTexture",e.boneTexture,Q))}r.isBatchedMesh&&(R.setOptional(xe,r,"batchingTexture"),R.setValue(xe,"batchingTexture",r._matricesTexture,Q),R.setOptional(xe,r,"batchingIdTexture"),R.setValue(xe,"batchingIdTexture",r._indirectTexture,Q),R.setOptional(xe,r,"batchingColorTexture"),null!==r._colorsTexture&&R.setValue(xe,"batchingColorTexture",r._colorsTexture,Q));const I=n.morphAttributes;void 0===I.position&&void 0===I.normal&&void 0===I.color||ue.update(r,n,w);(A||x.receiveShadow!==r.receiveShadow)&&(x.receiveShadow=r.receiveShadow,R.setValue(xe,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(N.envMap.value=l,N.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);i.isMeshStandardMaterial&&null===i.envMap&&null!==t.environment&&(N.envMapIntensity.value=t.environmentIntensity);A&&(R.setValue(xe,"toneMappingExposure",y.toneMappingExposure),x.needsLights&&(k=C,(D=N).ambientLightColor.needsUpdate=k,D.lightProbe.needsUpdate=k,D.directionalLights.needsUpdate=k,D.directionalLightShadows.needsUpdate=k,D.pointLights.needsUpdate=k,D.pointLightShadows.needsUpdate=k,D.spotLights.needsUpdate=k,D.spotLightShadows.needsUpdate=k,D.rectAreaLights.needsUpdate=k,D.hemisphereLights.needsUpdate=k),s&&!0===i.fog&&ae.refreshFogUniforms(N,s),ae.refreshMaterialUniforms(N,i,L,P,g.state.transmissionRenderTarget[e.id]),Wp.upload(xe,Fe(x),N,Q));var D,k;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Wp.upload(xe,Fe(x),N,Q),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&R.setValue(xe,"center",r.center);if(R.setValue(xe,"modelViewMatrix",r.modelViewMatrix),R.setValue(xe,"normalMatrix",r.normalMatrix),R.setValue(xe,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];ve.update(n,w),ve.bind(n,w)}}return w}(e,t,n,i,r);$.setMaterial(i,a);let l=n.index,c=1;if(!0===i.wireframe){if(l=ie.getWireframeAttribute(n),void 0===l)return;c=2}const h=n.drawRange,d=n.attributes.position;let u=h.start*c,p=(h.start+h.count)*c;null!==s&&(u=Math.max(u,s.start*c),p=Math.min(p,(s.start+s.count)*c)),null!==l?(u=Math.max(u,0),p=Math.min(p,l.count)):null!=d&&(u=Math.max(u,0),p=Math.min(p,d.count));const m=p-u;if(m<0||m===1/0)return;let f;ge.setup(r,i,o,n,l);let v=pe;if(null!==l&&(f=ne.get(l),v=me,v.setIndex(f)),r.isMesh)!0===i.wireframe?($.setLineWidth(i.wireframeLinewidth*q()),v.setMode(xe.LINES)):v.setMode(xe.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),$.setLineWidth(e*q()),r.isLineSegments?v.setMode(xe.LINES):r.isLineLoop?v.setMode(xe.LINE_LOOP):v.setMode(xe.LINE_STRIP)}else r.isPoints?v.setMode(xe.POINTS):r.isSprite&&v.setMode(xe.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)Mi("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if(Y.get("WEBGL_multi_draw"))v.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{const e=r._multiDrawStarts,t=r._multiDrawCounts,n=r._multiDrawCount,s=l?ne.get(l).bytesPerElement:1,a=K.get(i).currentProgram.getUniforms();for(let i=0;i<n;i++)a.setValue(xe,"_gl_DrawID",i),v.render(e[i]/s,t[i])}else if(r.isInstancedMesh)v.renderInstances(u,m,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(u,m,t)}else v.render(u,m)},this.compile=function(e,t,n=null){null===n&&(n=e),g=le.get(n),g.init(t),x.push(g),n.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))})),e!==n&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))})),g.setupLights();const i=new Set;return e.traverse((function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let r=0;r<t.length;r++){const s=t[r];Ee(s,n,e),i.add(s)}else Ee(t,n,e),i.add(t)})),g=x.pop(),i},this.compileAsync=function(e,t,n=null){const i=this.compile(e,t,n);return new Promise((t=>{function n(){i.forEach((function(e){K.get(e).currentProgram.isReady()&&i.delete(e)})),0!==i.size?setTimeout(n,10):t(e)}null!==Y.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Ae=null;function Ce(){Ne.stop()}function Re(){Ne.start()}const Ne=new nu;function Pe(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)g.pushLight(e),e.castShadow&&g.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||B.intersectsSprite(e)){i&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(V);const t=re.update(e),r=e.material;r.visible&&f.push(e,t,r,n,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||B.intersectsObject(e))){const t=re.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),G.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),G.copy(t.boundingSphere.center)),G.applyMatrix4(e.matrixWorld).applyMatrix4(V)),Array.isArray(r)){const i=t.groups;for(let s=0,a=i.length;s<a;s++){const a=i[s],o=r[a.materialIndex];o&&o.visible&&f.push(e,t,o,n,G.z,a)}}else r.visible&&f.push(e,t,r,n,G.z,null)}const r=e.children;for(let s=0,a=r.length;s<a;s++)Pe(r[s],t,n,i)}function Le(e,t,n,i){const r=e.opaque,s=e.transmissive,a=e.transparent;g.setupLightsView(n),!0===z&&ce.setGlobalState(y.clippingPlanes,n),i&&$.viewport(E.copy(i)),r.length>0&&ke(r,t,n),s.length>0&&ke(s,t,n),a.length>0&&ke(a,t,n),$.buffers.depth.setTest(!0),$.buffers.depth.setMask(!0),$.buffers.color.setMask(!0),$.setPolygonOffset(!1)}function De(e,t,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===g.state.transmissionRenderTarget[i.id]&&(g.state.transmissionRenderTarget[i.id]=new zi(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")||Y.has("EXT_color_buffer_float")?Pt:Tt,minFilter:Mt,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Ai.workingColorSpace}));const s=g.state.transmissionRenderTarget[i.id],a=i.viewport||E;s.setSize(a.z*y.transmissionResolutionScale,a.w*y.transmissionResolutionScale);const o=y.getRenderTarget(),l=y.getActiveCubeFace(),c=y.getActiveMipmapLevel();y.setRenderTarget(s),y.getClearColor(R),N=y.getClearAlpha(),N<1&&y.setClearColor(16777215,.5),y.clear(),X&&de.render(n);const h=y.toneMapping;y.toneMapping=0;const d=i.viewport;if(void 0!==i.viewport&&(i.viewport=void 0),g.setupLightsView(i),!0===z&&ce.setGlobalState(y.clippingPlanes,i),ke(e,n,i),Q.updateMultisampleRenderTarget(s),Q.updateRenderTargetMipmap(s),!1===Y.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,l=s.material,c=s.group;if(2===l.side&&a.layers.test(i.layers)){const t=l.side;l.side=1,l.needsUpdate=!0,Ue(a,n,i,o,l,c),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(Q.updateMultisampleRenderTarget(s),Q.updateRenderTargetMipmap(s))}y.setRenderTarget(o,l,c),y.setClearColor(R,N),void 0!==d&&(i.viewport=d),y.toneMapping=h}function ke(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],a=s.object,o=s.geometry,l=s.group;let c=s.material;!0===c.allowOverride&&null!==i&&(c=i),a.layers.test(n.layers)&&Ue(a,t,n,o,c,l)}}function Ue(e,t,n,i,r,s){e.onBeforeRender(y,t,n,i,r,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(y,t,n,i,e,s),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,s),r.side=0,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,s),r.side=2):y.renderBufferDirect(n,t,i,r,e,s),e.onAfterRender(y,t,n,i,r,s)}function Oe(e,t,n){!0!==t.isScene&&(t=W);const i=K.get(e),r=g.state.lights,s=g.state.shadowsArray,a=r.state.version,o=se.getParameters(e,r.state,s,t,n),l=se.getProgramCacheKey(o);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?te:ee).get(e.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Te),c=new Map,i.programs=c);let h=c.get(l);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===a)return Be(e,o),h}else o.uniforms=se.getUniforms(e),e.onBeforeCompile(o,y),h=se.acquireProgram(o,l),c.set(l,h),i.uniforms=o.uniforms;const d=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=ce.uniform),Be(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(d.ambientLightColor.value=r.state.ambient,d.lightProbe.value=r.state.probe,d.directionalLights.value=r.state.directional,d.directionalLightShadows.value=r.state.directionalShadow,d.spotLights.value=r.state.spot,d.spotLightShadows.value=r.state.spotShadow,d.rectAreaLights.value=r.state.rectArea,d.ltc_1.value=r.state.rectAreaLTC1,d.ltc_2.value=r.state.rectAreaLTC2,d.pointLights.value=r.state.point,d.pointLightShadows.value=r.state.pointShadow,d.hemisphereLights.value=r.state.hemi,d.directionalShadowMap.value=r.state.directionalShadowMap,d.directionalShadowMatrix.value=r.state.directionalShadowMatrix,d.spotShadowMap.value=r.state.spotShadowMap,d.spotLightMatrix.value=r.state.spotLightMatrix,d.spotLightMap.value=r.state.spotLightMap,d.pointShadowMap.value=r.state.pointShadowMap,d.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=h,i.uniformsList=null,h}function Fe(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=Wp.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Be(e,t){const n=K.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Ne.setAnimationLoop((function(e){Ae&&Ae(e)})),"undefined"!=typeof self&&Ne.setContext(self),this.setAnimationLoop=function(e){Ae=e,be.setAnimationLoop(e),null===e?Ne.stop():Ne.start()},be.addEventListener("sessionstart",Ce),be.addEventListener("sessionend",Re),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return;if(!0===_)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===be.enabled&&!0===be.isPresenting&&(!0===be.cameraAutoUpdate&&be.updateCamera(t),t=be.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,M),g=le.get(e,x.length),g.init(t),x.push(g),V.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),B.setFromProjectionMatrix(V,$n,t.reversedDepth),j=this.localClippingEnabled,z=ce.init(this.clippingPlanes,j),f=oe.get(e,v.length),f.init(),v.push(f),!0===be.enabled&&!0===be.isPresenting){const e=y.xr.getDepthSensingMesh();null!==e&&Pe(e,t,-1/0,y.sortObjects)}Pe(e,t,0,y.sortObjects),f.finish(),!0===y.sortObjects&&f.sort(D,k),X=!1===be.enabled||!1===be.isPresenting||!1===be.hasDepthSensing(),X&&de.addToRenderList(f,e),this.info.render.frame++,!0===z&&ce.beginShadows();const n=g.state.shadowsArray;he.render(n,e,t),!0===z&&ce.endShadows(),!0===this.info.autoReset&&this.info.reset();const i=f.opaque,r=f.transmissive;if(g.setupLights(),t.isArrayCamera){const n=t.cameras;if(r.length>0)for(let t=0,s=n.length;t<s;t++){De(i,r,e,n[t])}X&&de.render(e);for(let t=0,i=n.length;t<i;t++){const i=n[t];Le(f,e,i,i.viewport)}}else r.length>0&&De(i,r,e,t),X&&de.render(e),Le(f,e,t);null!==M&&0===w&&(Q.updateMultisampleRenderTarget(M),Q.updateRenderTargetMipmap(M)),!0===e.isScene&&e.onAfterRender(y,e,t),ge.resetDefaultState(),S=-1,T=null,x.pop(),x.length>0?(g=x[x.length-1],!0===z&&ce.setGlobalState(y.clippingPlanes,g.state.camera)):g=null,v.pop(),f=v.length>0?v[v.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(e,t,n){const i=K.get(e);i.__autoAllocateDepthBuffer=!1===e.resolveDepthBuffer,!1===i.__autoAllocateDepthBuffer&&(i.__useRenderToTexture=!1),K.get(e.texture).__webglTexture=t,K.get(e.depthTexture).__webglTexture=i.__autoAllocateDepthBuffer?void 0:n,i.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(e,t){const n=K.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t};const ze=xe.createFramebuffer();this.setRenderTarget=function(e,t=0,n=0){M=e,b=t,w=n;let i=!0,r=null,s=!1,a=!1;if(e){const o=K.get(e);if(void 0!==o.__useDefaultFramebuffer)$.bindFramebuffer(xe.FRAMEBUFFER,null),i=!1;else if(void 0===o.__webglFramebuffer)Q.setupRenderTarget(e);else if(o.__hasExternalTextures)Q.rebindTextures(e,K.get(e.texture).__webglTexture,K.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(o.__boundDepthTexture!==t){if(null!==t&&K.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Q.setupDepthRenderbuffer(e)}}const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const c=K.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(c[t])?c[t][n]:c[t],s=!0):r=e.samples>0&&!1===Q.useMultisampledRTT(e)?K.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,E.copy(e.viewport),A.copy(e.scissor),C=e.scissorTest}else E.copy(U).multiplyScalar(L).floor(),A.copy(O).multiplyScalar(L).floor(),C=F;0!==n&&(r=ze);if($.bindFramebuffer(xe.FRAMEBUFFER,r)&&i&&$.drawBuffers(e,r),$.viewport(E),$.scissor(A),$.setScissorTest(C),s){const i=K.get(e.texture);xe.framebufferTexture2D(xe.FRAMEBUFFER,xe.COLOR_ATTACHMENT0,xe.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(a){const i=t;for(let t=0;t<e.textures.length;t++){const r=K.get(e.textures[t]);xe.framebufferTextureLayer(xe.FRAMEBUFFER,xe.COLOR_ATTACHMENT0+t,r.__webglTexture,n,i)}}else if(null!==e&&0!==n){const t=K.get(e.texture);xe.framebufferTexture2D(xe.FRAMEBUFFER,xe.COLOR_ATTACHMENT0,xe.TEXTURE_2D,t.__webglTexture,n)}S=-1},this.readRenderTargetPixels=function(e,t,n,i,r,s,a,o=0){if(!e||!e.isWebGLRenderTarget)return;let l=K.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(l=l[a]),l){$.bindFramebuffer(xe.FRAMEBUFFER,l);try{const a=e.textures[o],l=a.format,c=a.type;if(!Z.textureFormatReadable(l))return;if(!Z.textureTypeReadable(c))return;t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&(e.textures.length>1&&xe.readBuffer(xe.COLOR_ATTACHMENT0+o),xe.readPixels(t,n,i,r,fe.convert(l),fe.convert(c),s))}finally{const e=null!==M?K.get(M).__webglFramebuffer:null;$.bindFramebuffer(xe.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,i,r,s,a,o=0){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=K.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(l=l[a]),l){if(t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r){$.bindFramebuffer(xe.FRAMEBUFFER,l);const a=e.textures[o],c=a.format,h=a.type;if(!Z.textureFormatReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Z.textureTypeReadable(h))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const d=xe.createBuffer();xe.bindBuffer(xe.PIXEL_PACK_BUFFER,d),xe.bufferData(xe.PIXEL_PACK_BUFFER,s.byteLength,xe.STREAM_READ),e.textures.length>1&&xe.readBuffer(xe.COLOR_ATTACHMENT0+o),xe.readPixels(t,n,i,r,fe.convert(c),fe.convert(h),0);const u=null!==M?K.get(M).__webglFramebuffer:null;$.bindFramebuffer(xe.FRAMEBUFFER,u);const p=xe.fenceSync(xe.SYNC_GPU_COMMANDS_COMPLETE,0);return xe.flush(),await function(e,t,n){return new Promise((function(i,r){setTimeout((function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:i()}}),n)}))}(xe,p,4),xe.bindBuffer(xe.PIXEL_PACK_BUFFER,d),xe.getBufferSubData(xe.PIXEL_PACK_BUFFER,0,s),xe.deleteBuffer(d),xe.deleteSync(p),s}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e,t=null,n=0){const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i),a=null!==t?t.x:0,o=null!==t?t.y:0;Q.setTexture2D(e,0),xe.copyTexSubImage2D(xe.TEXTURE_2D,n,0,0,a,o,r,s),$.unbindTexture()};const je=xe.createFramebuffer(),Ve=xe.createFramebuffer();this.copyTextureToTexture=function(e,t,n=null,i=null,r=0,s=null){let a,o,l,c,h,d,u,p,m;null===s&&(0!==r?(Mi("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),s=r,r=0):s=0);const f=e.isCompressedTexture?e.mipmaps[s]:e.image;if(null!==n)a=n.max.x-n.min.x,o=n.max.y-n.min.y,l=n.isBox3?n.max.z-n.min.z:1,c=n.min.x,h=n.min.y,d=n.isBox3?n.min.z:0;else{const t=Math.pow(2,-r);a=Math.floor(f.width*t),o=Math.floor(f.height*t),l=e.isDataArrayTexture?f.depth:e.isData3DTexture?Math.floor(f.depth*t):1,c=0,h=0,d=0}null!==i?(u=i.x,p=i.y,m=i.z):(u=0,p=0,m=0);const g=fe.convert(t.format),v=fe.convert(t.type);let x;t.isData3DTexture?(Q.setTexture3D(t,0),x=xe.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(Q.setTexture2DArray(t,0),x=xe.TEXTURE_2D_ARRAY):(Q.setTexture2D(t,0),x=xe.TEXTURE_2D),xe.pixelStorei(xe.UNPACK_FLIP_Y_WEBGL,t.flipY),xe.pixelStorei(xe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),xe.pixelStorei(xe.UNPACK_ALIGNMENT,t.unpackAlignment);const y=xe.getParameter(xe.UNPACK_ROW_LENGTH),_=xe.getParameter(xe.UNPACK_IMAGE_HEIGHT),b=xe.getParameter(xe.UNPACK_SKIP_PIXELS),w=xe.getParameter(xe.UNPACK_SKIP_ROWS),M=xe.getParameter(xe.UNPACK_SKIP_IMAGES);xe.pixelStorei(xe.UNPACK_ROW_LENGTH,f.width),xe.pixelStorei(xe.UNPACK_IMAGE_HEIGHT,f.height),xe.pixelStorei(xe.UNPACK_SKIP_PIXELS,c),xe.pixelStorei(xe.UNPACK_SKIP_ROWS,h),xe.pixelStorei(xe.UNPACK_SKIP_IMAGES,d);const S=e.isDataArrayTexture||e.isData3DTexture,T=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){const n=K.get(e),i=K.get(t),f=K.get(n.__renderTarget),g=K.get(i.__renderTarget);$.bindFramebuffer(xe.READ_FRAMEBUFFER,f.__webglFramebuffer),$.bindFramebuffer(xe.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let v=0;v<l;v++)S&&(xe.framebufferTextureLayer(xe.READ_FRAMEBUFFER,xe.COLOR_ATTACHMENT0,K.get(e).__webglTexture,r,d+v),xe.framebufferTextureLayer(xe.DRAW_FRAMEBUFFER,xe.COLOR_ATTACHMENT0,K.get(t).__webglTexture,s,m+v)),xe.blitFramebuffer(c,h,a,o,u,p,a,o,xe.DEPTH_BUFFER_BIT,xe.NEAREST);$.bindFramebuffer(xe.READ_FRAMEBUFFER,null),$.bindFramebuffer(xe.DRAW_FRAMEBUFFER,null)}else if(0!==r||e.isRenderTargetTexture||K.has(e)){const n=K.get(e),i=K.get(t);$.bindFramebuffer(xe.READ_FRAMEBUFFER,je),$.bindFramebuffer(xe.DRAW_FRAMEBUFFER,Ve);for(let e=0;e<l;e++)S?xe.framebufferTextureLayer(xe.READ_FRAMEBUFFER,xe.COLOR_ATTACHMENT0,n.__webglTexture,r,d+e):xe.framebufferTexture2D(xe.READ_FRAMEBUFFER,xe.COLOR_ATTACHMENT0,xe.TEXTURE_2D,n.__webglTexture,r),T?xe.framebufferTextureLayer(xe.DRAW_FRAMEBUFFER,xe.COLOR_ATTACHMENT0,i.__webglTexture,s,m+e):xe.framebufferTexture2D(xe.DRAW_FRAMEBUFFER,xe.COLOR_ATTACHMENT0,xe.TEXTURE_2D,i.__webglTexture,s),0!==r?xe.blitFramebuffer(c,h,a,o,u,p,a,o,xe.COLOR_BUFFER_BIT,xe.NEAREST):T?xe.copyTexSubImage3D(x,s,u,p,m+e,c,h,a,o):xe.copyTexSubImage2D(x,s,u,p,c,h,a,o);$.bindFramebuffer(xe.READ_FRAMEBUFFER,null),$.bindFramebuffer(xe.DRAW_FRAMEBUFFER,null)}else T?e.isDataTexture||e.isData3DTexture?xe.texSubImage3D(x,s,u,p,m,a,o,l,g,v,f.data):t.isCompressedArrayTexture?xe.compressedTexSubImage3D(x,s,u,p,m,a,o,l,g,f.data):xe.texSubImage3D(x,s,u,p,m,a,o,l,g,v,f):e.isDataTexture?xe.texSubImage2D(xe.TEXTURE_2D,s,u,p,a,o,g,v,f.data):e.isCompressedTexture?xe.compressedTexSubImage2D(xe.TEXTURE_2D,s,u,p,f.width,f.height,g,f.data):xe.texSubImage2D(xe.TEXTURE_2D,s,u,p,a,o,g,v,f);xe.pixelStorei(xe.UNPACK_ROW_LENGTH,y),xe.pixelStorei(xe.UNPACK_IMAGE_HEIGHT,_),xe.pixelStorei(xe.UNPACK_SKIP_PIXELS,b),xe.pixelStorei(xe.UNPACK_SKIP_ROWS,w),xe.pixelStorei(xe.UNPACK_SKIP_IMAGES,M),0===s&&t.generateMipmaps&&xe.generateMipmap(x),$.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n=null,i=null,r=0){return Mi('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(e,t,n,i,r)},this.initRenderTarget=function(e){void 0===K.get(e).__webglFramebuffer&&Q.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?Q.setTextureCube(e,0):e.isData3DTexture?Q.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?Q.setTexture2DArray(e,0):Q.setTexture2D(e,0),$.unbindTexture()},this.resetState=function(){b=0,w=0,M=null,$.reset(),ge.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return $n}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Ai._getDrawingBufferColorSpace(e),t.unpackColorSpace=Ai._getUnpackColorSpace()}}const zm=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:4,AddEquation:ke,AddOperation:2,AdditiveAnimationBlendMode:Ln,AdditiveBlending:2,AgXToneMapping:6,AlphaFormat:Ot,AlwaysCompare:519,AlwaysDepth:1,AlwaysStencilFunc:519,AmbientLight:Uh,AnimationAction:yd,AnimationClip:oh,AnimationLoader:class extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new fh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(s){i&&i(s),r.manager.itemError(e)}}),n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=oh.parse(e[n]);t.push(i)}return t}},AnimationMixer:class extends Kn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,s=e._propertyBindings,a=e._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let h=0;h!==r;++h){const e=i[h],r=e.name;let l=c[r];if(void 0!==l)++l.referenceCount,s[h]=l;else{if(l=s[h],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,o,r));continue}const i=t&&t._propertyBindings[h].binding.parsedPath;l=new dd(xd.create(n,r,i),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,o,r),s[h]=l}a[h].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const e=t[n];0==--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[t];void 0===s&&(s={},i[t]=s),s[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[r],0===Object.keys(a).length&&delete s[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Jc(new Float32Array(2),new Float32Array(2),1,_d),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let s="string"==typeof e?oh.findByName(i,e):e;const a=null!==s?s.uuid:e,o=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:Pn),void 0!==o){const e=o.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new yd(this,s,t,n);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"==typeof e?oh.findByName(n,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==n;++l){t[l]._update(i,e,r,s)}const a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,s=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const r in n){const e=n[r].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const r in i){const e=i[r];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}},AnimationObjectGroup:class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=ii(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length;let a,o=e.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],d=h.uuid;let u=t[d];if(void 0===u){u=o++,t[d]=u,e.push(h);for(let e=0,t=s;e!==t;++e)r[e].push(new xd(h,n[e],i[e]))}else if(u<l){a=e[u];const o=--l,c=e[o];t[c.uuid]=u,e[u]=c,t[d]=o,e[o]=h;for(let e=0,t=s;e!==t;++e){const t=r[e],s=t[o];let a=t[u];t[u]=s,void 0===a&&(a=new xd(h,n[e],i[e])),t[o]=a}}else e[u]}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=t[o];if(void 0!==l&&l>=r){const s=r++,c=e[s];t[c.uuid]=l,e[l]=c,t[o]=s,e[s]=a;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[s],r=t[l];t[l]=i,t[s]=r}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,s=e.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<r){const a=--r,o=e[a],c=--s,h=e[c];t[o.uuid]=l,e[l]=o,t[h.uuid]=a,e[a]=h,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[a],r=t[c];t[l]=i,t[a]=r,t.pop()}}else{const r=--s,a=e[r];r>0&&(t[a.uuid]=l),e[l]=a,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(void 0!==i)return r[i];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);i=r.length,n[e]=i,s.push(e),a.push(t),r.push(h);for(let d=c,u=o.length;d!==u;++d){const n=o[d];h[d]=new xd(n,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];t[e[a]]=n,s[n]=o,s.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}},AnimationUtils:class{static convertArray(e,t){return Gc(e,t)}static isTypedArray(e){return Wc(e)}static getKeyframeOrder(e){return Xc(e)}static sortedArray(e,t,n){return qc(e,t,n)}static flattenJSON(e,t,n,i){Yc(e,t,n,i)}static subclip(e,t,n,i,r=30){return function(e,t,n,i,r=30){const s=e.clone();s.name=t;const a=[];for(let l=0;l<s.tracks.length;++l){const e=s.tracks[l],t=e.getValueSize(),o=[],c=[];for(let s=0;s<e.times.length;++s){const a=e.times[s]*r;if(!(a<n||a>=i)){o.push(e.times[s]);for(let n=0;n<t;++n)c.push(e.values[s*t+n])}}0!==o.length&&(e.times=Gc(o,e.times.constructor),e.values=Gc(c,e.values.constructor),a.push(e))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}(e,t,n,i,r)}static makeClipAdditive(e,t=0,n=e,i=30){return function(e,t=0,n=e,i=30){i<=0&&(i=30);const r=n.tracks.length,s=t/i;for(let a=0;a<r;++a){const t=n.tracks[a],i=t.ValueTypeName;if("bool"===i||"string"===i)continue;const r=e.tracks.find((function(e){return e.name===t.name&&e.ValueTypeName===i}));if(void 0===r)continue;let o=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const h=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const d=t.times.length-1;let u;if(s<=t.times[0]){const e=o,n=l-o;u=t.values.slice(e,n)}else if(s>=t.times[d]){const e=d*l+o,n=e+l-o;u=t.values.slice(e,n)}else{const e=t.createInterpolant(),n=o,i=l-o;e.evaluate(s),u=e.resultBuffer.slice(n,i)}"quaternion"===i&&(new di).fromArray(u).normalize().conjugate().toArray(u);const p=r.times.length;for(let e=0;e<p;++e){const t=e*h+c;if("quaternion"===i)di.multiplyQuaternionsFlat(r.values,t,u,0,r.values,t);else{const e=h-2*c;for(let n=0;n<e;++n)r.values[t+n]-=u[n]}}}return e.blendMode=Ln,e}(e,t,n,i)}},ArcCurve:yl,ArrayCamera:Qh,ArrowHelper:class extends Hr{constructor(e=new ui(0,0,1),t=new ui(0,0,0),n=1,i=16776960,r=.2*n,s=.2*r){super(),this.type="ArrowHelper",void 0===Qd&&(Qd=new Ps,Qd.setAttribute("position",new Ss([0,0,0,0,1,0],3)),eu=new cl(.5,1,5,1),eu.translate(0,-.5,0)),this.position.copy(t),this.line=new Go(Qd,new Uo({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Gs(eu,new us({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Kd.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Kd,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},AttachedBindMode:ot,Audio:ad,AudioAnalyser:class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}},AudioContext:Zh,AudioListener:class extends Hr{constructor(){super(),this.type="AudioListener",this.context=Zh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new ed}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(td,nd,id),rd.set(0,0,-1).applyQuaternion(nd),sd.set(0,1,0).applyQuaternion(nd),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(td.x,e),t.positionY.linearRampToValueAtTime(td.y,e),t.positionZ.linearRampToValueAtTime(td.z,e),t.forwardX.linearRampToValueAtTime(rd.x,e),t.forwardY.linearRampToValueAtTime(rd.y,e),t.forwardZ.linearRampToValueAtTime(rd.z,e),t.upX.linearRampToValueAtTime(sd.x,e),t.upY.linearRampToValueAtTime(sd.y,e),t.upZ.linearRampToValueAtTime(sd.z,e)}else t.setPosition(td.x,td.y,td.z),t.setOrientation(rd.x,rd.y,rd.z,sd.x,sd.y,sd.z)}},AudioLoader:class extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new fh(this.manager);function a(t){i&&i(t),r.manager.itemError(e)}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(e){try{const n=e.slice(0);Zh.getContext().decodeAudioData(n,(function(e){t(e)})).catch(a)}catch(n){a(n)}}),n,i)}},AxesHelper:class extends Yo{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Ps;n.setAttribute("position",new Ss(t,3)),n.setAttribute("color",new Ss([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Uo({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const i=new ls,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BackSide:1,BasicDepthPacking:3200,BasicShadowMap:0,BatchedMesh:ko,Bone:Wa,BooleanKeyframeTrack:eh,Box2:class{constructor(e=new hi(1/0,1/0),t=new hi(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Rd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Rd).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Box3:Hi,Box3Helper:class extends Yo{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Ps;i.setIndex(new bs(n,1)),i.setAttribute("position",new Ss([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Uo({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},BoxGeometry:Xs,BoxHelper:class extends Yo{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Ps;r.setIndex(new bs(n,1)),r.setAttribute("position",new bs(i,3)),super(r,new Uo({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&Jd.setFromObject(this.object),Jd.isEmpty())return;const e=Jd.min,t=Jd.max,n=this.geometry.attributes.position,i=n.array;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=e.x,i[4]=t.y,i[5]=t.z,i[6]=e.x,i[7]=e.y,i[8]=t.z,i[9]=t.x,i[10]=e.y,i[11]=t.z,i[12]=t.x,i[13]=t.y,i[14]=e.z,i[15]=e.x,i[16]=t.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=t.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BufferAttribute:bs,BufferGeometry:Ps,BufferGeometryLoader:Hh,ByteType:Et,Cache:ch,Camera:Ks,CameraHelper:class extends Yo{constructor(e){const t=new Ps,n=new Uo({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={};function a(e,t){o(e),o(t)}function o(e){i.push(0,0,0),r.push(0,0,0),void 0===s[e]&&(s[e]=[]),s[e].push(i.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new Ss(i,3)),t.setAttribute("color",new Ss(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new ls(16755200),c=new ls(16711680),h=new ls(43775),d=new ls(16777215),u=new ls(3355443);this.setColors(l,c,h,d,u)}setColors(e,t,n,i,r){const s=this.geometry.getAttribute("color");return s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap;let n,i;if(Zd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),!0===this.camera.reversedDepth)n=1,i=0;else if(this.camera.coordinateSystem===$n)n=-1,i=1;else{if(this.camera.coordinateSystem!==Jn)throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);n=0,i=1}$d("c",t,e,Zd,0,0,n),$d("t",t,e,Zd,0,0,i),$d("n1",t,e,Zd,-1,-1,n),$d("n2",t,e,Zd,1,-1,n),$d("n3",t,e,Zd,-1,1,n),$d("n4",t,e,Zd,1,1,n),$d("f1",t,e,Zd,-1,-1,i),$d("f2",t,e,Zd,1,-1,i),$d("f3",t,e,Zd,-1,1,i),$d("f4",t,e,Zd,1,1,i),$d("u1",t,e,Zd,.7,1.1,n),$d("u2",t,e,Zd,-.7,1.1,n),$d("u3",t,e,Zd,0,2,n),$d("cf1",t,e,Zd,-1,0,i),$d("cf2",t,e,Zd,1,0,i),$d("cf3",t,e,Zd,0,-1,i),$d("cf4",t,e,Zd,0,1,i),$d("cn1",t,e,Zd,-1,0,n),$d("cn2",t,e,Zd,1,0,n),$d("cn3",t,e,Zd,0,-1,n),$d("cn4",t,e,Zd,0,1,n),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},CanvasTexture:class extends Oi{constructor(e,t,n,i,r,s,a,o,l){super(e,t,n,i,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},CapsuleGeometry:al,CatmullRomCurve3:Tl,CineonToneMapping:3,CircleGeometry:ol,ClampToEdgeWrapping:gt,Clock:ed,Color:ls,ColorKeyframeTrack:th,ColorManagement:Ai,CompressedArrayTexture:class extends rl{constructor(e,t,n,i,r,s){super(e,t,n,r,s),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=gt,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}},CompressedCubeTexture:class extends rl{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,ht),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}},CompressedTexture:rl,CompressedTextureLoader:class extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=[],a=new rl,o=new fh(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function c(c){o.load(e[c],(function(e){const n=r.parse(e,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=bt),a.image=s,a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,i)}if(Array.isArray(e))for(let h=0,d=e.length;h<d;++h)c(h);else o.load(e,(function(e){const n=r.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){s[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)s[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),s[t].format=n.format,s[t].width=n.width,s[t].height=n.height}a.image=s}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=bt),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,i);return a}},ConeGeometry:cl,ConstantAlphaFactor:213,ConstantColorFactor:211,Controls:class extends Kn{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){void 0!==e&&(null!==this.domElement&&this.disconnect(),this.domElement=e)}disconnect(){}dispose(){}update(){}},CubeCamera:ra,CubeReflectionMapping:ht,CubeRefractionMapping:dt,CubeTexture:sa,CubeTextureLoader:xh,CubeUVReflectionMapping:mt,CubicBezierCurve:Rl,CubicBezierCurve3:Nl,CubicInterpolant:$c,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,Curve:vl,CurvePath:Ol,CustomBlending:5,CustomToneMapping:5,CylinderGeometry:ll,Cylindrical:class{constructor(e=1,t=0,n=0){this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}},Data3DTexture:Vi,DataArrayTexture:ji,DataTexture:Xa,DataTextureLoader:yh,DataUtils:vs,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:dh,DepthFormat:zt,DepthStencilFormat:jt,DepthTexture:sl,DetachedBindMode:lt,DirectionalLight:kh,DirectionalLightHelper:class extends Hr{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let i=new Ps;i.setAttribute("position",new Ss([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Uo({fog:!1,toneMapped:!1});this.lightPlane=new Go(i,r),this.add(this.lightPlane),i=new Ps,i.setAttribute("position",new Ss([0,0,0,0,0,1],3)),this.targetLine=new Go(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Wd.setFromMatrixPosition(this.light.matrixWorld),Xd.setFromMatrixPosition(this.light.target.matrixWorld),qd.subVectors(Xd,Wd),this.lightPlane.lookAt(Xd),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Xd),this.targetLine.scale.z=qd.length()}},DiscreteInterpolant:Kc,DodecahedronGeometry:dl,DoubleSide:2,DstAlphaFactor:206,DstColorFactor:208,DynamicCopyUsage:35050,DynamicDrawUsage:35048,DynamicReadUsage:35049,EdgesGeometry:gl,EllipseCurve:xl,EqualCompare:514,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:ut,EquirectangularRefractionMapping:pt,Euler:Er,EventDispatcher:Kn,ExtrudeGeometry:gc,FileLoader:fh,Float16BufferAttribute:class extends bs{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=gs(this.array[e*this.itemSize]);return this.normalized&&(t=oi(t,this.array)),t}setX(e,t){return this.normalized&&(t=li(t,this.array)),this.array[e*this.itemSize]=fs(t),this}getY(e){let t=gs(this.array[e*this.itemSize+1]);return this.normalized&&(t=oi(t,this.array)),t}setY(e,t){return this.normalized&&(t=li(t,this.array)),this.array[e*this.itemSize+1]=fs(t),this}getZ(e){let t=gs(this.array[e*this.itemSize+2]);return this.normalized&&(t=oi(t,this.array)),t}setZ(e,t){return this.normalized&&(t=li(t,this.array)),this.array[e*this.itemSize+2]=fs(t),this}getW(e){let t=gs(this.array[e*this.itemSize+3]);return this.normalized&&(t=oi(t,this.array)),t}setW(e,t){return this.normalized&&(t=li(t,this.array)),this.array[e*this.itemSize+3]=fs(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=li(t,this.array),n=li(n,this.array)),this.array[e+0]=fs(t),this.array[e+1]=fs(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=li(t,this.array),n=li(n,this.array),i=li(i,this.array)),this.array[e+0]=fs(t),this.array[e+1]=fs(n),this.array[e+2]=fs(i),this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=li(t,this.array),n=li(n,this.array),i=li(i,this.array),r=li(r,this.array)),this.array[e+0]=fs(t),this.array[e+1]=fs(n),this.array[e+2]=fs(i),this.array[e+3]=fs(r),this}},Float32BufferAttribute:Ss,FloatType:It,Fog:da,FogExp2:ha,FramebufferTexture:class extends Oi{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=xt,this.minFilter=xt,this.generateMipmaps=!1,this.needsUpdate=!0}},FrontSide:0,Frustum:po,FrustumArray:go,GLBufferAttribute:class{constructor(e,t,n,i,r,s=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.normalized=s,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}},GLSL1:"100",GLSL3:Zn,GreaterCompare:516,GreaterDepth:6,GreaterEqualCompare:518,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:class extends Yo{constructor(e=10,t=10,n=4473924,i=8947848){n=new ls(n),i=new ls(i);const r=t/2,s=e/t,a=e/2,o=[],l=[];for(let h=0,d=0,u=-a;h<=t;h++,u+=s){o.push(-a,0,u,a,0,u),o.push(u,0,-a,u,0,a);const e=h===r?n:i;e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3}const c=new Ps;c.setAttribute("position",new Ss(o,3)),c.setAttribute("color",new Ss(l,3));super(c,new Uo({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},Group:oa,HalfFloatType:Pt,HemisphereLight:bh,HemisphereLightHelper:class extends Hr{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new _c(t);i.rotateY(.5*Math.PI),this.material=new us({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),s=new Float32Array(3*r.count);i.setAttribute("color",new bs(s,3)),this.add(new Gs(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Hd.copy(this.light.color),Gd.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?Hd:Gd;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Vd.setFromMatrixPosition(this.light.matrixWorld).negate())}},IcosahedronGeometry:xc,ImageBitmapLoader:class extends uh{constructor(e){super(e),this.isImageBitmapLoader=!0,this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=ch.get(`image-bitmap:${e}`);if(void 0!==s)return r.manager.itemStart(e),s.then?void s.then((n=>{if(!0!==qh.has(s))return t&&t(n),r.manager.itemEnd(e),n;i&&i(qh.get(s)),r.manager.itemError(e),r.manager.itemEnd(e)})):(setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s);const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,a.signal="function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const o=fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){return ch.add(`image-bitmap:${e}`,n),t&&t(n),r.manager.itemEnd(e),n})).catch((function(t){i&&i(t),qh.set(o,t),ch.remove(`image-bitmap:${e}`),r.manager.itemError(e),r.manager.itemEnd(e)}));ch.add(`image-bitmap:${e}`,o),r.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}},ImageLoader:vh,ImageUtils:Ii,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:$a,InstancedBufferGeometry:Vh,InstancedInterleavedBuffer:class extends pa{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}},InstancedMesh:ro,Int16BufferAttribute:class extends bs{constructor(e,t,n){super(new Int16Array(e),t,n)}},Int32BufferAttribute:class extends bs{constructor(e,t,n){super(new Int32Array(e),t,n)}},Int8BufferAttribute:class extends bs{constructor(e,t,n){super(new Int8Array(e),t,n)}},IntType:Rt,InterleavedBuffer:pa,InterleavedBufferAttribute:fa,Interpolant:Zc,InterpolateDiscrete:En,InterpolateLinear:An,InterpolateSmooth:Cn,InterpolationSamplingMode:{NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"},InterpolationSamplingType:{PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},InvertStencilOp:5386,KeepStencilOp:Bn,KeyframeTrack:Qc,LOD:Da,LatheGeometry:yc,Layers:Ar,LessCompare:513,LessDepth:2,LessEqualCompare:515,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,Light:_h,LightProbe:Bh,Line:Go,Line3:class{constructor(e=new ui,t=new ui){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Nd.subVectors(e,this.start),Id.subVectors(this.end,this.start);const n=Id.dot(Id);let i=Id.dot(Nd)/n;return t&&(i=ri(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}distanceSqToLine3(e,t=kd,n=Ud){const i=1e-8*1e-8;let r,s;const a=this.start,o=e.start,l=this.end,c=e.end;Pd.subVectors(l,a),Ld.subVectors(c,o),Dd.subVectors(a,o);const h=Pd.dot(Pd),d=Ld.dot(Ld),u=Ld.dot(Dd);if(h<=i&&d<=i)return t.copy(a),n.copy(o),t.sub(n),t.dot(t);if(h<=i)r=0,s=u/d,s=ri(s,0,1);else{const e=Pd.dot(Dd);if(d<=i)s=0,r=ri(-e/h,0,1);else{const t=Pd.dot(Ld),n=h*d-t*t;r=0!==n?ri((t*u-e*d)/n,0,1):0,s=(t*r+u)/d,s<0?(s=0,r=ri(-e/h,0,1)):s>1&&(s=1,r=ri((t-e)/h,0,1))}}return t.copy(a).add(Pd.multiplyScalar(r)),n.copy(o).add(Ld.multiplyScalar(s)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},LineBasicMaterial:Uo,LineCurve:Il,LineCurve3:Pl,LineDashedMaterial:Hc,LineLoop:Zo,LineSegments:Yo,LinearFilter:bt,LinearInterpolant:Jc,LinearMipMapLinearFilter:St,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:Mt,LinearMipmapNearestFilter:wt,LinearSRGBColorSpace:Un,LinearToneMapping:1,LinearTransfer:On,Loader:uh,LoaderUtils:jh,LoadingManager:hh,LoopOnce:2200,LoopPingPong:2202,LoopRepeat:2201,MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Material:ds,MaterialLoader:zh,MathUtils:ci,Matrix2:Cd,Matrix3:fi,Matrix4:gr,MaxEquation:104,Mesh:Gs,MeshBasicMaterial:us,MeshDepthMaterial:zc,MeshDistanceMaterial:jc,MeshLambertMaterial:Bc,MeshMatcapMaterial:Vc,MeshNormalMaterial:Fc,MeshPhongMaterial:Uc,MeshPhysicalMaterial:kc,MeshStandardMaterial:Dc,MeshToonMaterial:Oc,MinEquation:103,MirroredRepeatWrapping:vt,MixOperation:1,MultiplyBlending:4,MultiplyOperation:0,NearestFilter:xt,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:_t,NearestMipmapNearestFilter:yt,NeutralToneMapping:7,NeverCompare:512,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColorSpace:Dn,NoToneMapping:0,NormalAnimationBlendMode:Pn,NormalBlending:1,NotEqualCompare:517,NotEqualDepth:7,NotEqualStencilFunc:517,NumberKeyframeTrack:nh,Object3D:Hr,ObjectLoader:class extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=""===this.path?jh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const a=new fh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){let s=null;try{s=JSON.parse(n)}catch(o){return void(void 0!==i&&i(o))}const a=s.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(s,t):void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+e))}),n,i)}async loadAsync(e,t){const n=""===this.path?jh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const i=new fh(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(e,t),s=JSON.parse(r),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(s)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,r,o,a,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),this.bindLightTargets(l),void 0!==t){let e=!1;for(const t in s)if(s[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,s),o=this.parseObject(e.object,i,a,s,t),l=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,l),this.bindLightTargets(o),o}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new Bl).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(let r=0,s=e.length;r<s;r++){const t=(new Za).fromJSON(e[r],i);n[t.uuid]=t}return n}parseGeometries(e,t){const n={};if(void 0!==e){const i=new Hh;for(let r=0,s=e.length;r<s;r++){let s;const a=e[r];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(a);break;default:a.type in Ic&&(s=Ic[a.type].fromJSON(a,t))}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const r=new zh;r.setTextures(t);for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],r=oh.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function s(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),r.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:yi(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new hh(t);r=new vh(n),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const n=e[t],r=n.url;if(Array.isArray(r)){const e=[];for(let t=0,n=r.length;t<n;t++){const n=s(r[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new Xa(n.data,n.width,n.height)))}i[n.uuid]=new Li(e)}else{const e=s(n.url);i[n.uuid]=new Li(e)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function r(e){if("string"==typeof e){const n=e,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await i.loadAsync(r)}return e.data?{data:yi(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){i=new vh(this.manager),i.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.url;if(Array.isArray(s)){const e=[];for(let t=0,n=s.length;t<n;t++){const n=s[t],i=await r(n);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new Xa(i.data,i.width,i.height)))}n[i.uuid]=new Li(e)}else{const e=await r(i.url);n[i.uuid]=new Li(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:t[e]}const i={};if(void 0!==e)for(let r=0,s=e.length;r<s;r++){const s=e[r];s.image,t[s.image];const a=t[s.image],o=a.data;let l;Array.isArray(o)?(l=new sa,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new Xa:new Oi,o&&(l.needsUpdate=!0)),l.source=a,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=n(s.mapping,Gh)),void 0!==s.channel&&(l.channel=s.channel),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=n(s.wrap[0],Wh),l.wrapT=n(s.wrap[1],Wh)),void 0!==s.format&&(l.format=s.format),void 0!==s.internalFormat&&(l.internalFormat=s.internalFormat),void 0!==s.type&&(l.type=s.type),void 0!==s.colorSpace&&(l.colorSpace=s.colorSpace),void 0!==s.minFilter&&(l.minFilter=n(s.minFilter,Xh)),void 0!==s.magFilter&&(l.magFilter=n(s.magFilter,Xh)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.generateMipmaps&&(l.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(l.compareFunction=s.compareFunction),void 0!==s.userData&&(l.userData=s.userData),i[s.uuid]=l}return i}parseObject(e,t,n,i,r){let s,a,o;function l(e){return t[e],t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];n[r],t.push(n[r])}return t}return n[e],n[e]}}function h(e){return i[e],i[e]}switch(e.type){case"Scene":s=new ua,void 0!==e.background&&(Number.isInteger(e.background)?s.background=new ls(e.background):s.background=h(e.background)),void 0!==e.environment&&(s.environment=h(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new da(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new ha(e.fog.color,e.fog.density)),""!==e.fog.name&&(s.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(s.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(s.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&s.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(s.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&s.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":s=new na(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new Lh(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new Uh(e.color,e.intensity);break;case"DirectionalLight":s=new kh(e.color,e.intensity),s.target=e.target||"";break;case"PointLight":s=new Ph(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new Oh(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new Ah(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),s.target=e.target||"";break;case"HemisphereLight":s=new bh(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=(new Bh).fromJSON(e);break;case"SkinnedMesh":a=l(e.geometry),o=c(e.material),s=new Ga(a,o),void 0!==e.bindMode&&(s.bindMode=e.bindMode),void 0!==e.bindMatrix&&s.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(s.skeleton=e.skeleton);break;case"Mesh":a=l(e.geometry),o=c(e.material),s=new Gs(a,o);break;case"InstancedMesh":a=l(e.geometry),o=c(e.material);const t=e.count,n=e.instanceMatrix,i=e.instanceColor;s=new ro(a,o,t),s.instanceMatrix=new $a(new Float32Array(n.array),16),void 0!==i&&(s.instanceColor=new $a(new Float32Array(i.array),i.itemSize));break;case"BatchedMesh":a=l(e.geometry),o=c(e.material),s=new ko(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,o),s.geometry=a,s.perObjectFrustumCulled=e.perObjectFrustumCulled,s.sortObjects=e.sortObjects,s._drawRanges=e.drawRanges,s._reservedRanges=e.reservedRanges,s._geometryInfo=e.geometryInfo.map((e=>{let t=null,n=null;return void 0!==e.boundingBox&&(t=(new Hi).fromJSON(e.boundingBox)),void 0!==e.boundingSphere&&(n=(new or).fromJSON(e.boundingSphere)),{...e,boundingBox:t,boundingSphere:n}})),s._instanceInfo=e.instanceInfo,s._availableInstanceIds=e._availableInstanceIds,s._availableGeometryIds=e._availableGeometryIds,s._nextIndexStart=e.nextIndexStart,s._nextVertexStart=e.nextVertexStart,s._geometryCount=e.geometryCount,s._maxInstanceCount=e.maxInstanceCount,s._maxVertexCount=e.maxVertexCount,s._maxIndexCount=e.maxIndexCount,s._geometryInitialized=e.geometryInitialized,s._matricesTexture=h(e.matricesTexture.uuid),s._indirectTexture=h(e.indirectTexture.uuid),void 0!==e.colorsTexture&&(s._colorsTexture=h(e.colorsTexture.uuid)),void 0!==e.boundingSphere&&(s.boundingSphere=(new or).fromJSON(e.boundingSphere)),void 0!==e.boundingBox&&(s.boundingBox=(new Hi).fromJSON(e.boundingBox));break;case"LOD":s=new Da;break;case"Line":s=new Go(l(e.geometry),c(e.material));break;case"LineLoop":s=new Zo(l(e.geometry),c(e.material));break;case"LineSegments":s=new Yo(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":s=new tl(l(e.geometry),c(e.material));break;case"Sprite":s=new Na(c(e.material));break;case"Group":s=new oa;break;case"Bone":s=new Wa;break;default:s=new Hr}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.up&&s.up.fromArray(e.up),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.intensity&&(s.shadow.intensity=e.shadow.intensity),void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(s.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.children){const a=e.children;for(let e=0;e<a.length;e++)s.add(this.parseObject(a[e],t,n,i,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];s.animations.push(r[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(s.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=s.getObjectByProperty("uuid",n.object);void 0!==i&&s.addLevel(i,n.distance,n.hysteresis)}}return s}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n||e.bind(n,e.bindMatrix)}}))}bindLightTargets(e){e.traverse((function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,i=e.getObjectByProperty("uuid",n);t.target=void 0!==i?i:new Hr}}))}},ObjectSpaceNormalMap:1,OctahedronGeometry:_c,OneFactor:201,OneMinusConstantAlphaFactor:214,OneMinusConstantColorFactor:212,OneMinusDstAlphaFactor:207,OneMinusDstColorFactor:209,OneMinusSrcAlphaFactor:He,OneMinusSrcColorFactor:203,OrthographicCamera:Lh,PCFShadowMap:1,PCFSoftShadowMap:2,PMREMGenerator:Cu,Path:Fl,PerspectiveCamera:na,Plane:lo,PlaneGeometry:bc,PlaneHelper:class extends Go{constructor(e,t=1,n=16776960){const i=n,r=new Ps;r.setAttribute("position",new Ss([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new Uo({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const s=new Ps;s.setAttribute("position",new Ss([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new Gs(s,new us({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}},PointLight:Ph,PointLightHelper:class extends Gs{constructor(e,t,n){super(new Sc(t,4,2),new us({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:tl,PointsMaterial:$o,PolarGridHelper:class extends Yo{constructor(e=10,t=16,n=8,i=64,r=4473924,s=8947848){r=new ls(r),s=new ls(s);const a=[],o=[];if(t>1)for(let c=0;c<t;c++){const n=c/t*(2*Math.PI),i=Math.sin(n)*e,l=Math.cos(n)*e;a.push(0,0,0),a.push(i,0,l);const h=1&c?r:s;o.push(h.r,h.g,h.b),o.push(h.r,h.g,h.b)}for(let c=0;c<n;c++){const t=1&c?r:s,l=e-e/n*c;for(let e=0;e<i;e++){let n=e/i*(2*Math.PI),r=Math.sin(n)*l,s=Math.cos(n)*l;a.push(r,0,s),o.push(t.r,t.g,t.b),n=(e+1)/i*(2*Math.PI),r=Math.sin(n)*l,s=Math.cos(n)*l,a.push(r,0,s),o.push(t.r,t.g,t.b)}}const l=new Ps;l.setAttribute("position",new Ss(a,3)),l.setAttribute("color",new Ss(o,3));super(l,new Uo({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},PolyhedronGeometry:hl,PositionalAudio:class extends ad{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(od,ld,cd),hd.set(0,0,1).applyQuaternion(ld);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(od.x,e),t.positionY.linearRampToValueAtTime(od.y,e),t.positionZ.linearRampToValueAtTime(od.z,e),t.orientationX.linearRampToValueAtTime(hd.x,e),t.orientationY.linearRampToValueAtTime(hd.y,e),t.orientationZ.linearRampToValueAtTime(hd.z,e)}else t.setPosition(od.x,od.y,od.z),t.setOrientation(hd.x,hd.y,hd.z)}},PropertyBinding:xd,PropertyMixer:dd,QuadraticBezierCurve:Ll,QuadraticBezierCurve3:Dl,Quaternion:di,QuaternionKeyframeTrack:rh,QuaternionLinearInterpolant:ih,RED_GREEN_RGTC2_Format:Sn,RED_RGTC1_Format:wn,REVISION:Ie,RGBADepthPacking:3201,RGBAFormat:Bt,RGBAIntegerFormat:Xt,RGBA_ASTC_10x10_Format:gn,RGBA_ASTC_10x5_Format:pn,RGBA_ASTC_10x6_Format:mn,RGBA_ASTC_10x8_Format:fn,RGBA_ASTC_12x10_Format:vn,RGBA_ASTC_12x12_Format:xn,RGBA_ASTC_4x4_Format:sn,RGBA_ASTC_5x4_Format:an,RGBA_ASTC_5x5_Format:on,RGBA_ASTC_6x5_Format:ln,RGBA_ASTC_6x6_Format:cn,RGBA_ASTC_8x5_Format:hn,RGBA_ASTC_8x6_Format:dn,RGBA_ASTC_8x8_Format:un,RGBA_BPTC_Format:yn,RGBA_ETC2_EAC_Format:rn,RGBA_PVRTC_2BPPV1_Format:en,RGBA_PVRTC_4BPPV1_Format:Qt,RGBA_S3TC_DXT1_Format:Yt,RGBA_S3TC_DXT3_Format:Zt,RGBA_S3TC_DXT5_Format:$t,RGBDepthPacking:3202,RGBFormat:Ft,RGBIntegerFormat:1032,RGB_BPTC_SIGNED_Format:_n,RGB_BPTC_UNSIGNED_Format:bn,RGB_ETC1_Format:tn,RGB_ETC2_Format:nn,RGB_PVRTC_2BPPV1_Format:Kt,RGB_PVRTC_4BPPV1_Format:Jt,RGB_S3TC_DXT1_Format:qt,RGDepthPacking:3203,RGFormat:Gt,RGIntegerFormat:Wt,RawShaderMaterial:Lc,Ray:fr,Raycaster:Sd,RectAreaLight:Oh,RedFormat:Vt,RedIntegerFormat:Ht,ReinhardToneMapping:2,RenderTarget:Bi,RenderTarget3D:class extends Bi{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isRenderTarget3D=!0,this.depth=n,this.texture=new Vi(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}},RepeatWrapping:ft,ReplaceStencilOp:7681,ReverseSubtractEquation:102,RingGeometry:wc,SIGNED_RED_GREEN_RGTC2_Format:Tn,SIGNED_RED_RGTC1_Format:Mn,SRGBColorSpace:kn,SRGBTransfer:Fn,Scene:ua,ShaderChunk:ru,ShaderLib:au,ShaderMaterial:Js,ShadowMaterial:Pc,Shape:Bl,ShapeGeometry:Mc,ShapePath:class{constructor(){this.type="ShapePath",this.color=new ls,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Fl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,s){return this.currentPath.bezierCurveTo(e,t,n,i,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=t[r],a=t[s],o=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[s],o=-o,a=t[r],l=-l),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-o*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return i}const n=pc.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,s,a;const o=[];if(1===i.length)return s=i[0],a=new Bl,a.curves=s.curves,o.push(a),o;let l=!n(i[0].getPoints());l=e?!l:l;const c=[],h=[];let d,u,p=[],m=0;h[m]=void 0,p[m]=[];for(let f=0,g=i.length;f<g;f++)s=i[f],d=s.getPoints(),r=n(d),r=e?!r:r,r?(!l&&h[m]&&m++,h[m]={s:new Bl,p:d},h[m].s.curves=s.curves,l&&m++,p[m]=[]):p[m].push({h:s,p:d[0]});if(!h[0])return function(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=new Bl;r.curves=i.curves,t.push(r)}return t}(i);if(h.length>1){let e=!1,n=0;for(let t=0,i=h.length;t<i;t++)c[t]=[];for(let i=0,r=h.length;i<r;i++){const r=p[i];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<h.length;r++)t(a.p,h[r].p)&&(i!==r&&n++,o?(o=!1,c[r].push(a)):e=!0);o&&c[i].push(a)}}n>0&&!1===e&&(p=c)}for(let f=0,g=h.length;f<g;f++){a=h[f].s,o.push(a),u=p[f];for(let e=0,t=u.length;e<t;e++)a.holes.push(u[e].h)}return o}},ShapeUtils:pc,ShortType:At,Skeleton:Za,SkeletonHelper:class extends Yo{constructor(e){const t=jd(e),n=new Ps,i=[],r=[];for(let o=0;o<t.length;o++){const e=t[o];e.parent&&e.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(0,0,0),r.push(0,0,0))}n.setAttribute("position",new Ss(i,3)),n.setAttribute("color",new Ss(r,3));super(n,new Uo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const s=new ls(255),a=new ls(65280);this.setColors(s,a)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");zd.copy(this.root.matrixWorld).invert();for(let r=0,s=0;r<t.length;r++){const e=t[r];e.parent&&e.parent.isBone&&(Bd.multiplyMatrices(zd,e.matrixWorld),Fd.setFromMatrixPosition(Bd),i.setXYZ(s,Fd.x,Fd.y,Fd.z),Bd.multiplyMatrices(zd,e.parent.matrixWorld),Fd.setFromMatrixPosition(Bd),i.setXYZ(s+1,Fd.x,Fd.y,Fd.z),s+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const n=this.geometry.getAttribute("color");for(let i=0;i<n.count;i+=2)n.setXYZ(i,e.r,e.g,e.b),n.setXYZ(i+1,t.r,t.g,t.b);return n.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},SkinnedMesh:Ga,Source:Li,Sphere:or,SphereGeometry:Sc,Spherical:class{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=ri(this.phi,e,Math.PI-e),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(ri(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},SphericalHarmonics3:Fh,SplineCurve:kl,SpotLight:Ah,SpotLightHelper:class extends Hr{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Ps,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){const e=s/o*Math.PI*2,t=a/o*Math.PI*2;i.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new Ss(i,3));const r=new Uo({fog:!1,toneMapped:!1});this.cone=new Yo(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Od.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Od),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:Na,SpriteMaterial:ga,SrcAlphaFactor:Ve,SrcAlphaSaturateFactor:210,SrcColorFactor:202,StaticCopyUsage:35046,StaticDrawUsage:Yn,StaticReadUsage:35045,StereoCamera:class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new na,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new na,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Kh.copy(e.projectionMatrix);const n=t.eyeSep/2,i=n*t.near/t.focus,r=t.near*Math.tan(ti*t.fov*.5)/t.zoom;let s,a;Jh.elements[12]=-n,$h.elements[12]=n,s=-r*t.aspect+i,a=r*t.aspect+i,Kh.elements[0]=2*t.near/(a-s),Kh.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(Kh),s=-r*t.aspect-i,a=r*t.aspect-i,Kh.elements[0]=2*t.near/(a-s),Kh.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(Kh)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Jh),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply($h)}},StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:sh,SubtractEquation:101,SubtractiveBlending:3,TOUCH:{ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},TangentSpaceNormalMap:0,TetrahedronGeometry:Tc,Texture:Oi,TextureLoader:class extends uh{constructor(e){super(e)}load(e,t,n,i){const r=new Oi,s=new vh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}},TextureUtils:class{static contain(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e}(e,t)}static cover(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e}(e,t)}static fill(e){return function(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e}(e)}static getByteLength(e,t,n,i){return tu(e,t,n,i)}},Timer:class{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,void 0!==e.hidden&&(this._pageVisibilityHandler=Ad.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){null!==this._pageVisibilityHandler&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return null!==this._pageVisibilityHandler&&!0===this._document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==e?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}},TimestampQuery:{COMPUTE:"compute",RENDER:"render"},TorusGeometry:Ec,TorusKnotGeometry:Ac,Triangle:is,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeGeometry:Cc,UVMapping:ct,Uint16BufferAttribute:ws,Uint32BufferAttribute:Ms,Uint8BufferAttribute:class extends bs{constructor(e,t,n){super(new Uint8Array(e),t,n)}},Uint8ClampedBufferAttribute:class extends bs{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}},Uniform:bd,UniformsGroup:class extends Kn{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:wd++}),this.name="",this.usage=Yn,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++){const e=Array.isArray(t[n])?t[n]:[t[n]];for(let t=0;t<e.length;t++)this.uniforms.push(e[t].clone())}return this}clone(){return(new this.constructor).copy(this)}},UniformsLib:su,UniformsUtils:$s,UnsignedByteType:Tt,UnsignedInt248Type:kt,UnsignedInt5999Type:Ut,UnsignedIntType:Nt,UnsignedShort4444Type:Lt,UnsignedShort5551Type:Dt,UnsignedShortType:Ct,VSMShadowMap:3,Vector2:hi,Vector3:ui,Vector4:Fi,VectorKeyframeTrack:ah,VideoFrameTexture:class extends il{constructor(e,t,n,i,r,s,a,o){super({},e,t,n,i,r,s,a,o),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}},VideoTexture:il,WebGL3DRenderTarget:class extends zi{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Vi(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}},WebGLArrayRenderTarget:class extends zi{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new ji(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}},WebGLCoordinateSystem:$n,WebGLCubeRenderTarget:aa,WebGLRenderTarget:zi,WebGLRenderer:Bm,WebGLUtils:Im,WebGPUCoordinateSystem:Jn,WebXRController:ca,WireframeGeometry:Rc,WrapAroundEnding:In,ZeroCurvatureEnding:Rn,ZeroFactor:200,ZeroSlopeEnding:Nn,ZeroStencilOp:0,createCanvasElement:bi},Symbol.toStringTag,{value:"Module"}));var jm,Vm,Hm,Gm,Wm={exports:{}},Xm={},qm={exports:{}},Ym={};function Zm(){return Vm||(Vm=1,qm.exports=function(){if(jm)return Ym;jm=1;var e=r(),t="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=e.useState,i=e.useEffect,s=e.useLayoutEffect,a=e.useDebugValue;function o(e){var n=e.getSnapshot;e=e.value;try{var i=n();return!t(e,i)}catch(r){return!0}}var l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),l=n({inst:{value:r,getSnapshot:t}}),c=l[0].inst,h=l[1];return s((function(){c.value=r,c.getSnapshot=t,o(c)&&h({inst:c})}),[e,r,t]),i((function(){return o(c)&&h({inst:c}),e((function(){o(c)&&h({inst:c})}))}),[e]),a(r),r};return Ym.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:l,Ym}()),qm.exports}
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $m=(Gm||(Gm=1,Wm.exports=function(){if(Hm)return Xm;Hm=1;var e=r(),t=Zm(),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=t.useSyncExternalStore,s=e.useRef,a=e.useEffect,o=e.useMemo,l=e.useDebugValue;return Xm.useSyncExternalStoreWithSelector=function(e,t,r,c,h){var d=s(null);if(null===d.current){var u={hasValue:!1,value:null};d.current=u}else u=d.current;d=o((function(){function e(e){if(!a){if(a=!0,i=e,e=c(e),void 0!==h&&u.hasValue){var t=u.value;if(h(t,e))return s=t}return s=e}if(t=s,n(i,e))return t;var r=c(e);return void 0!==h&&h(t,r)?(i=e,t):(i=e,s=r)}var i,s,a=!1,o=void 0===r?null:r;return[function(){return e(t())},null===o?void 0:function(){return e(o())}]}),[t,r,c,h]);var p=i(e,d[0],d[1]);return a((function(){u.hasValue=!0,u.value=p}),[p]),l(p),p},Xm}()),Wm.exports);const Jm=s($m),Km=e=>{let t;const n=new Set,i=(e,i)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=i?i:"object"!=typeof r||null===r)?r:Object.assign({},t,r),n.forEach((n=>n(t,e)))}},r=()=>t,s={setState:i,getState:r,getInitialState:()=>a,subscribe:e=>(n.add(e),()=>n.delete(e))},a=t=e(i,r,s);return s},{useSyncExternalStoreWithSelector:Qm}=Jm,ef=e=>e;const tf=(e,t)=>{const n=(e=>e?Km(e):Km)(e),i=(e,i=t)=>function(e,t=ef,n){const i=Qm(e.subscribe,e.getState,e.getInitialState,t,n);return a.useDebugValue(i),i}(n,e,i);return Object.assign(i,n),i},nf=(e,t)=>e?tf(e,t):tf,rf=[];function sf(e,t,n=(e,t)=>e===t){if(e===t)return!0;if(!e||!t)return!1;const i=e.length;if(t.length!==i)return!1;for(let r=0;r<i;r++)if(!n(e[r],t[r]))return!1;return!0}function af(e,t=null,n=!1,i={}){null===t&&(t=[e]);for(const a of rf)if(sf(t,a.keys,a.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(a,"error"))throw a.error;if(Object.prototype.hasOwnProperty.call(a,"response"))return i.lifespan&&i.lifespan>0&&(a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout(a.remove,i.lifespan)),a.response;if(!n)throw a.promise}const r={keys:t,equal:i.equal,remove:()=>{const e=rf.indexOf(r);-1!==e&&rf.splice(e,1)},promise:(s=e,"object"==typeof s&&"function"==typeof s.then?e:e(...t)).then((e=>{r.response=e,i.lifespan&&i.lifespan>0&&(r.timeout=setTimeout(r.remove,i.lifespan))})).catch((e=>r.error=e))};var s;if(rf.push(r),!n)throw r.promise}var of,lf,cf={exports:{}},hf={};var df=(lf||(lf=1,cf.exports=(of||(of=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,s=e[i];if(!(0<r(s,t)))break e;e[i]=t,e[n]=s,n=i}}function n(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,s=e.length,a=s>>>1;i<a;){var o=2*(i+1)-1,l=e[o],c=o+1,h=e[c];if(0>r(l,n))c<s&&0>r(h,l)?(e[i]=h,e[c]=n,i=c):(e[i]=l,e[o]=n,i=o);else{if(!(c<s&&0>r(h,n)))break e;e[i]=h,e[c]=n,i=c}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],h=1,d=null,u=3,p=!1,m=!1,f=!1,g="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,x="undefined"!=typeof setImmediate?setImmediate:null;function y(e){for(var r=n(c);null!==r;){if(null===r.callback)i(c);else{if(!(r.startTime<=e))break;i(c),r.sortIndex=r.expirationTime,t(l,r)}r=n(c)}}function _(e){if(f=!1,y(e),!m)if(null!==n(l))m=!0,N();else{var t=n(c);null!==t&&I(_,t.startTime-e)}}var b,w=!1,M=-1,S=5,T=-1;function E(){return!(e.unstable_now()-T<S)}function A(){if(w){var t=e.unstable_now();T=t;var r=!0;try{e:{m=!1,f&&(f=!1,v(M),M=-1),p=!0;var s=u;try{t:{for(y(t),d=n(l);null!==d&&!(d.expirationTime>t&&E());){var a=d.callback;if("function"==typeof a){d.callback=null,u=d.priorityLevel;var o=a(d.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof o){d.callback=o,y(t),r=!0;break t}d===n(l)&&i(l),y(t)}else i(l);d=n(l)}if(null!==d)r=!0;else{var h=n(c);null!==h&&I(_,h.startTime-t),r=!1}}break e}finally{d=null,u=s,p=!1}r=void 0}}finally{r?b():w=!1}}}if("function"==typeof x)b=function(){x(A)};else if("undefined"!=typeof MessageChannel){var C=new MessageChannel,R=C.port2;C.port1.onmessage=A,b=function(){R.postMessage(null)}}else b=function(){g(A,0)};function N(){w||(w=!0,b())}function I(t,n){M=g((function(){t(e.unstable_now())}),n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,N())},e.unstable_forceFrameRate=function(e){0>e||125<e||(S=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return u},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){switch(u){case 1:case 2:case 3:var t=3;break;default:t=u}var n=u;u=t;try{return e()}finally{u=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=u;u=e;try{return t()}finally{u=n}},e.unstable_scheduleCallback=function(i,r,s){var a=e.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?a+s:a,i){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return i={id:h++,callback:r,priorityLevel:i,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(i.sortIndex=s,t(c,i),null===n(l)&&i===n(c)&&(f?(v(M),M=-1):f=!0,I(_,s-a))):(i.sortIndex=o,t(l,i),m||p||(m=!0,N())),i},e.unstable_shouldYield=E,e.unstable_wrapCallback=function(e){var t=u;return function(){var n=u;u=t;try{return e.apply(this,arguments)}finally{u=n}}}}(hf)),hf)),cf.exports);function uf(e,t,n){if(!e)return;if(!0===n(e))return e;let i=t?e.return:e.child;for(;i;){const e=uf(i,t,n);if(e)return e;i=t?null:i.sibling}}function pf(e){try{return Object.defineProperties(e,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(t){return e}}const mf=pf(n.createContext(null));class ff extends n.Component{render(){return n.createElement(mf.Provider,{value:this._reactInternals},this.props.children)}}function gf(){const e=n.useContext(mf);if(null===e)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=n.useId();return n.useMemo((()=>{for(const n of[e,null==e?void 0:e.alternate]){if(!n)continue;const e=uf(n,!1,(e=>{let n=e.memoizedState;for(;n;){if(n.memoizedState===t)return!0;n=n.next}}));if(e)return e}}),[e,t])}const vf=Symbol.for("react.context"),xf=e=>null!==e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===vf;function yf(){const e=function(){const e=gf(),[t]=n.useState((()=>new Map));t.clear();let i=e;for(;i;){const e=i.type;xf(e)&&e!==mf&&!t.has(e)&&t.set(e,n.use(pf(e))),i=i.return}return t}();return n.useMemo((()=>Array.from(e.keys()).reduce(((t,i)=>r=>n.createElement(t,null,n.createElement(i.Provider,{...r,value:e.get(i)}))),(e=>n.createElement(ff,{...e})))),[e])}function _f(e){let t=e.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const bf=e=>e&&e.isOrthographicCamera,wf=e=>null!=e&&("string"==typeof e||"number"==typeof e||e.isColor),Mf=((e,t)=>"undefined"!=typeof window&&((null==(e=window.document)?void 0:e.createElement)||"ReactNative"===(null==(t=window.navigator)?void 0:t.product)))()?n.useLayoutEffect:n.useEffect;function Sf(e){const t=n.useRef(e);return Mf((()=>{t.current=e}),[e]),t}function Tf({set:e}){return Mf((()=>(e(new Promise((()=>null))),()=>e(!1))),[e]),null}const Ef=(e=>((e=class extends n.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}).getDerivedStateFromError=()=>({error:!0}),e))();function Af(e){var t;const n="undefined"!=typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}function Cf(e){var t;return null==(t=e.__r3f)?void 0:t.root.getState()}const Rf={obj:e=>e===Object(e)&&!Rf.arr(e)&&"function"!=typeof e,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,boo:e=>"boolean"==typeof e,und:e=>void 0===e,nul:e=>null===e,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:r=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(Rf.str(e)||Rf.num(e)||Rf.boo(e))return e===t;const s=Rf.obj(e);if(s&&"reference"===i)return e===t;const a=Rf.arr(e);if(a&&"reference"===n)return e===t;if((a||s)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(s&&"shallow"===n&&"shallow"===i){for(o in r?t:e)if(!Rf.equ(e[o],t[o],{strict:r,objects:"reference"}))return!1}else for(o in r?t:e)if(e[o]!==t[o])return!1;if(Rf.und(o)){if(a&&0===e.length&&0===t.length)return!0;if(s&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};const Nf=["children","key","ref"];function If(e){const t={};for(const n in e)Nf.includes(n)||(t[n]=e[n]);return t}function Pf(e,t,n,i){const r=e;let s=null==r?void 0:r.__r3f;return s||(s={root:t,type:n,parent:null,children:[],props:If(i),object:r,eventCount:0,handlers:{},isHidden:!1},r&&(r.__r3f=s)),s}function Lf(e,t){let n=e[t];if(!t.includes("-"))return{root:e,key:t,target:n};n=e;for(const r of t.split("-")){var i;t=r,e=n,n=null==(i=n)?void 0:i[t]}return{root:e,key:t,target:n}}const Df=/-\d+$/;function kf(e,t){if(Rf.str(t.props.attach)){if(Df.test(t.props.attach)){const n=t.props.attach.replace(Df,""),{root:i,key:r}=Lf(e.object,n);Array.isArray(i[r])||(i[r]=[])}const{root:n,key:i}=Lf(e.object,t.props.attach);t.previousAttach=n[i],n[i]=t.object}else Rf.fun(t.props.attach)&&(t.previousAttach=t.props.attach(e.object,t.object))}function Uf(e,t){if(Rf.str(t.props.attach)){const{root:n,key:i}=Lf(e.object,t.props.attach),r=t.previousAttach;void 0===r?delete n[i]:n[i]=r}else null==t.previousAttach||t.previousAttach(e.object,t.object);delete t.previousAttach}const Of=[...Nf,"args","dispose","attach","object","onUpdate","dispose"],Ff=new Map;function Bf(e){let t=Ff.get(e.constructor);try{t||(t=new e.constructor,Ff.set(e.constructor,t))}catch(n){}return t}const zf=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],jf=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function Vf(e,t){var n;const i=e.__r3f,r=i&&_f(i).getState(),s=null==i?void 0:i.eventCount;for(const o in t){let n=t[o];if(Of.includes(o))continue;if(i&&jf.test(o)){"function"==typeof n?i.handlers[o]=n:delete i.handlers[o],i.eventCount=Object.keys(i.handlers).length;continue}if(void 0===n)continue;let{root:s,key:l,target:c}=Lf(e,o);if(c instanceof Ar&&n instanceof Ar)c.mask=n.mask;else if(c instanceof ls&&wf(n))c.set(n);else if(null!==c&&"object"==typeof c&&"function"==typeof c.set&&"function"==typeof c.copy&&null!=n&&n.constructor&&c.constructor===n.constructor)c.copy(n);else if(null!==c&&"object"==typeof c&&"function"==typeof c.set&&Array.isArray(n))"function"==typeof c.fromArray?c.fromArray(n):c.set(...n);else if(null!==c&&"object"==typeof c&&"function"==typeof c.set&&"number"==typeof n)"function"==typeof c.setScalar?c.setScalar(n):c.set(n);else{var a;s[l]=n,r&&!r.linear&&zf.includes(l)&&null!=(a=s[l])&&a.isTexture&&s[l].format===Bt&&s[l].type===Tt&&(s[l].colorSpace=kn)}}if(null!=i&&i.parent&&null!=r&&r.internal&&null!=(n=i.object)&&n.isObject3D&&s!==i.eventCount){const e=i.object,t=r.internal.interaction.indexOf(e);t>-1&&r.internal.interaction.splice(t,1),i.eventCount&&null!==e.raycast&&r.internal.interaction.push(e)}return i&&void 0===i.props.attach&&(i.object.isBufferGeometry?i.props.attach="geometry":i.object.isMaterial&&(i.props.attach="material")),i&&Hf(i),e}function Hf(e){var t;if(!e.parent)return;null==e.props.onUpdate||e.props.onUpdate(e.object);const n=null==(t=e.root)||null==t.getState?void 0:t.getState();n&&0===n.internal.frames&&n.invalidate()}function Gf(e,t){e.manual||(bf(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix())}const Wf=e=>null==e?void 0:e.isObject3D;function Xf(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function qf(e,t,n,i){const r=n.get(t);r&&(n.delete(t),0===n.size&&(e.delete(i),r.target.releasePointerCapture(i)))}function Yf(e){function t(e){return e.filter((e=>["Move","Over","Enter","Out","Leave"].some((t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find((t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId))){const i=e.eventObject.__r3f;if(n.hovered.delete(Xf(e)),null!=i&&i.eventCount){const n=i.handlers,r={...e,intersections:t};null==n.onPointerOut||n.onPointerOut(r),null==n.onPointerLeave||n.onPointerLeave(r)}}}function i(e,t){for(let n=0;n<t.length;n++){const i=t[n].__r3f;null==i||null==i.handlers.onPointerMissed||i.handlers.onPointerMissed(e)}}return{handlePointer:function(r){switch(r){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:i}=e.getState();"pointerId"in t&&i.capturedMap.has(t.pointerId)&&requestAnimationFrame((()=>{i.capturedMap.has(t.pointerId)&&(i.capturedMap.delete(t.pointerId),n([]))}))}}return function(s){const{onPointerMissed:a,internal:o}=e.getState();o.lastEvent.current=s;const l="onPointerMove"===r,c="onClick"===r||"onContextMenu"===r||"onDoubleClick"===r,h=function(t,n){const i=e.getState(),r=new Set,s=[],a=n?n(i.internal.interaction):i.internal.interaction;for(let e=0;e<a.length;e++){const t=Cf(a[e]);t&&(t.raycaster.camera=void 0)}i.previousRoot||null==i.events.compute||i.events.compute(t,i);let o=a.flatMap((function(e){const n=Cf(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(i=n.previousRoot)?void 0:i.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var i})).sort(((e,t)=>{const n=Cf(e.object),i=Cf(t.object);return n&&i&&i.events.priority-n.events.priority||e.distance-t.distance})).filter((e=>{const t=Xf(e);return!r.has(t)&&(r.add(t),!0)}));i.events.filter&&(o=i.events.filter(o,i));for(const e of o){let t=e.object;for(;t;){var l;null!=(l=t.__r3f)&&l.eventCount&&s.push({...e,eventObject:t}),t=t.parent}}if("pointerId"in t&&i.internal.capturedMap.has(t.pointerId))for(let e of i.internal.capturedMap.get(t.pointerId).values())r.has(Xf(e.intersection))||s.push(e.intersection);return s}(s,l?t:void 0),d=c?function(t){const{internal:n}=e.getState(),i=t.offsetX-n.initialClick[0],r=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(i*i+r*r))}(s):0;"onPointerDown"===r&&(o.initialClick=[s.offsetX,s.offsetY],o.initialHits=h.map((e=>e.eventObject))),c&&!h.length&&d<=2&&(i(s,o.interaction),a&&a(s)),l&&n(h),function(e,t,i,r){if(e.length){const s={stopped:!1};for(const a of e){let o=Cf(a.object);if(o||a.object.traverseAncestors((e=>{const t=Cf(e);if(t)return o=t,!1})),o){const{raycaster:l,pointer:c,camera:h,internal:d}=o,u=new ui(c.x,c.y,0).unproject(h),p=e=>{var t,n;return null!=(t=null==(n=d.capturedMap.get(e))?void 0:n.has(a.eventObject))&&t},m=e=>{const n={intersection:a,target:t.target};d.capturedMap.has(e)?d.capturedMap.get(e).set(a.eventObject,n):d.capturedMap.set(e,new Map([[a.eventObject,n]])),t.target.setPointerCapture(e)},f=e=>{const t=d.capturedMap.get(e);t&&qf(d.capturedMap,a.eventObject,t,e)};let g={};for(let e in t){let n=t[e];"function"!=typeof n&&(g[e]=n)}let v={...a,...g,pointer:c,intersections:e,stopped:s.stopped,delta:i,unprojectedPoint:u,ray:l.ray,camera:h,stopPropagation(){const i="pointerId"in t&&d.capturedMap.get(t.pointerId);(!i||i.has(a.eventObject))&&(v.stopped=s.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find((e=>e.eventObject===a.eventObject)))&&n([...e.slice(0,e.indexOf(a)),a])},target:{hasPointerCapture:p,setPointerCapture:m,releasePointerCapture:f},currentTarget:{hasPointerCapture:p,setPointerCapture:m,releasePointerCapture:f},nativeEvent:t};if(r(v),!0===s.stopped)break}}}}(h,s,d,(function(e){const t=e.eventObject,n=t.__r3f;if(null==n||!n.eventCount)return;const a=n.handlers;if(l){if(a.onPointerOver||a.onPointerEnter||a.onPointerOut||a.onPointerLeave){const t=Xf(e),n=o.hovered.get(t);n?n.stopped&&e.stopPropagation():(o.hovered.set(t,e),null==a.onPointerOver||a.onPointerOver(e),null==a.onPointerEnter||a.onPointerEnter(e))}null==a.onPointerMove||a.onPointerMove(e)}else{const n=a[r];n?c&&!o.initialHits.includes(t)||(i(s,o.interaction.filter((e=>!o.initialHits.includes(e)))),n(e)):c&&o.initialHits.includes(t)&&i(s,o.interaction.filter((e=>!o.initialHits.includes(e))))}}))}}}}const Zf=e=>!(null==e||!e.render),$f=n.createContext(null);function Jf(){const e=n.useContext($f);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Kf(e=e=>e,t){return Jf()(e,t)}function Qf(e,t=0){const n=Jf(),i=n.getState().internal.subscribe,r=Sf(e);return Mf((()=>i(r,t,n)),[t,i,n]),null}const eg=new WeakMap;function tg(e,t){return function(n,...i){let r;var s,a;return"function"==typeof(s=n)&&(null==s||null==(a=s.prototype)?void 0:a.constructor)===s?(r=eg.get(n),r||(r=new n,eg.set(n,r))):r=n,e&&e(r),Promise.all(i.map((e=>new Promise(((n,i)=>r.load(e,(e=>{Wf(null==e?void 0:e.scene)&&Object.assign(e,function(e){const t={nodes:{},materials:{},meshes:{}};return e&&e.traverse((e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material),e.isMesh&&!t.meshes[e.name]&&(t.meshes[e.name]=e)})),t}(e.scene)),n(e)}),t,(t=>i(new Error(`Could not load ${e}: ${null==t?void 0:t.message}`)))))))))}}function ng(e,t,n,i){const r=Array.isArray(t)?t:[t],s=((e,t,n)=>af(e,t,!1,n))(tg(n,i),[e,...r],{equal:Rf.equ});return Array.isArray(t)?s:s[0]}function ig(e){const t=l(e);return t.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:n.version}),t}ng.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return((e,t,n)=>{af(e,t,!0,n)})(tg(n),[e,...i])},ng.clear=function(e,t){return(e=>{if(void 0===e||0===e.length)rf.splice(0,rf.length);else{const t=rf.find((t=>sf(e,t.keys,t.equal)));t&&t.remove()}})([e,...Array.isArray(t)?t:[t]])};const rg={},sg=/^three(?=[A-Z])/,ag=e=>`${e[0].toUpperCase()}${e.slice(1)}`;let og=0;function lg(e){if("function"==typeof e){const t=""+og++;return rg[t]=e,t}Object.assign(rg,e)}function cg(e,t){const n=ag(e),i=rg[n];if("primitive"!==e&&!i)throw new Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if("primitive"===e&&!t.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(void 0!==t.args&&!Array.isArray(t.args))throw new Error("R3F: The args prop must be an array!")}function hg(e){var t;e.isHidden&&(e.props.attach&&null!=(t=e.parent)&&t.object?kf(e.parent,e):Wf(e.object)&&!1!==e.props.visible&&(e.object.visible=!0),e.isHidden=!1,Hf(e))}function dg(e,t,n){const i=t.root.getState();if(e.parent||e.object===i.scene){if(!t.object){var r,s;const e=rg[ag(t.type)];t.object=null!=(r=t.props.object)?r:new e(...null!=(s=t.props.args)?s:[]),t.object.__r3f=t}if(Vf(t.object,t.props),t.props.attach)kf(e,t);else if(Wf(t.object)&&Wf(e.object)){const i=e.object.children.indexOf(null==n?void 0:n.object);if(n&&-1!==i){const n=e.object.children.indexOf(t.object);if(-1!==n){e.object.children.splice(n,1);const r=n<i?i-1:i;e.object.children.splice(r,0,t.object)}else t.object.parent=e.object,e.object.children.splice(i,0,t.object),t.object.dispatchEvent({type:"added"}),e.object.dispatchEvent({type:"childadded",child:t.object})}else e.object.add(t.object)}for(const e of t.children)dg(t,e);Hf(t)}}function ug(e,t){t&&(t.parent=e,e.children.push(t),dg(e,t))}function pg(e,t,n){if(!t||!n)return;t.parent=e;const i=e.children.indexOf(n);-1!==i?e.children.splice(i,0,t):e.children.push(t),dg(e,t,n)}function mg(e){if("function"==typeof e.dispose){const t=()=>{try{e.dispose()}catch{}};"undefined"!=typeof IS_REACT_ACT_ENVIRONMENT?t():df.unstable_scheduleCallback(df.unstable_IdlePriority,t)}}function fg(e,t,n){if(!t)return;t.parent=null;const i=e.children.indexOf(t);-1!==i&&e.children.splice(i,1),t.props.attach?Uf(e,t):Wf(t.object)&&Wf(e.object)&&(e.object.remove(t.object),function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter((e=>e!==t)),n.initialHits=n.initialHits.filter((e=>e!==t)),n.hovered.forEach(((e,i)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(i)})),n.capturedMap.forEach(((e,i)=>{qf(n.capturedMap,t,e,i)}))}(_f(t),t.object));const r=null!==t.props.dispose&&!1!==n;for(let s=t.children.length-1;s>=0;s--){fg(t,t.children[s],r)}t.children.length=0,delete t.object.__r3f,r&&"primitive"!==t.type&&"Scene"!==t.object.type&&mg(t.object),void 0===n&&Hf(t)}function gg(e,t){for(const n of[e,e.alternate])if(null!==n)if("function"==typeof n.ref){null==n.refCleanup||n.refCleanup();const e=n.ref(t);"function"==typeof e&&(n.refCleanup=e)}else n.ref&&(n.ref.current=t)}const vg=[];const xg=()=>{},yg={};let _g=0;const bg=ig({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:function(e,t,n){var i;return cg(e=ag(e)in rg?e:e.replace(sg,""),t),"primitive"===e&&null!=(i=t.object)&&i.__r3f&&delete t.object.__r3f,Pf(t.object,n,e,t)},removeChild:fg,appendChild:ug,appendInitialChild:ug,insertBefore:pg,appendChildToContainer(e,t){const n=e.getState().scene.__r3f;t&&n&&ug(n,t)},removeChildFromContainer(e,t){const n=e.getState().scene.__r3f;t&&n&&fg(n,t)},insertInContainerBefore(e,t,n){const i=e.getState().scene.__r3f;t&&n&&i&&pg(i,t,n)},getRootHostContext:()=>yg,getChildHostContext:()=>yg,commitUpdate(e,t,n,i,r){var s,a,o;cg(t,i);let l=!1;if(("primitive"===e.type&&n.object!==i.object||(null==(s=i.args)?void 0:s.length)!==(null==(a=n.args)?void 0:a.length)||null!=(o=i.args)&&o.some(((e,t)=>{var i;return e!==(null==(i=n.args)?void 0:i[t])})))&&(l=!0),l)vg.push([e,{...i},r]);else{const t=function(e,t){const n={};for(const i in t)if(!Of.includes(i)&&!Rf.equ(t[i],e.props[i])){n[i]=t[i];for(const e in t)e.startsWith(`${i}-`)&&(n[e]=t[e])}for(const i in e.props){if(Of.includes(i)||t.hasOwnProperty(i))continue;const{root:r,key:s}=Lf(e.object,i);if(r.constructor&&0===r.constructor.length){const e=Bf(r);Rf.und(e)||(n[s]=e[s])}else n[s]=0}return n}(e,i);Object.keys(t).length&&(Object.assign(e.props,t),Vf(e.object,t))}(null===r.sibling||!(4&r.flags))&&function(){for(const[n]of vg){const e=n.parent;if(e){n.props.attach?Uf(e,n):Wf(n.object)&&Wf(e.object)&&e.object.remove(n.object);for(const e of n.children)e.props.attach?Uf(n,e):Wf(e.object)&&Wf(n.object)&&n.object.remove(e.object)}n.isHidden&&hg(n),n.object.__r3f&&delete n.object.__r3f,"primitive"!==n.type&&mg(n.object)}for(const[n,i,r]of vg){n.props=i;const s=n.parent;if(s){var e,t;const i=rg[ag(n.type)];n.object=null!=(e=n.props.object)?e:new i(...null!=(t=n.props.args)?t:[]),n.object.__r3f=n,gg(r,n.object),Vf(n.object,n.props),n.props.attach?kf(s,n):Wf(n.object)&&Wf(s.object)&&s.object.add(n.object);for(const e of n.children)e.props.attach?kf(n,e):Wf(e.object)&&Wf(n.object)&&n.object.add(e.object);Hf(n)}}vg.length=0}()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:e=>null==e?void 0:e.object,prepareForCommit:()=>null,preparePortalMount:e=>Pf(e.getState().scene,e,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:function(e){var t;e.isHidden||(e.props.attach&&null!=(t=e.parent)&&t.object?Uf(e.parent,e):Wf(e.object)&&(e.object.visible=!1),e.isHidden=!0,Hf(e))},unhideInstance:hg,createTextInstance:xg,hideTextInstance:xg,unhideTextInstance:xg,scheduleTimeout:"function"==typeof setTimeout?setTimeout:void 0,cancelTimeout:"function"==typeof clearTimeout?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:n.createContext(null),setCurrentUpdatePriority(e){_g=e},getCurrentUpdatePriority:()=>_g,resolveUpdatePriority(){var e;if(0!==_g)return _g;switch("undefined"!=typeof window&&(null==(e=window.event)?void 0:e.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return o.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return o.ContinuousEventPriority;default:return o.DefaultEventPriority}},resetFormInstance(){}}),wg=new Map,Mg={objects:"shallow",strict:!1};function Sg(e){const t=wg.get(e),r=null==t?void 0:t.fiber,s=null==t?void 0:t.store,a="function"==typeof reportError?reportError:console.error,l=s||((e,t)=>{const i=nf(((i,r)=>{const s=new ui,a=new ui,o=new ui;function l(e=r().camera,t=a,n=r().size){const{width:i,height:l,top:c,left:h}=n,d=i/l;t.isVector3?o.copy(t):o.set(...t);const u=e.getWorldPosition(s).distanceTo(o);if(bf(e))return{width:i/e.zoom,height:l/e.zoom,top:c,left:h,factor:1,distance:u,aspect:d};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*u,r=n*(i/l);return{width:r,height:n,top:c,left:h,factor:i/r,distance:u,aspect:d}}}let c;const h=e=>i((t=>({performance:{...t.performance,current:e}}))),d=new hi;return{set:i,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(t=1)=>e(r(),t),advance:(e,n)=>t(e,n,r()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new ed,pointer:d,mouse:d,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=r();c&&clearTimeout(c),e.performance.current!==e.performance.min&&h(e.performance.min),c=setTimeout((()=>h(r().performance.max)),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:e=>i((t=>({...t,events:{...t.events,...e}}))),setSize:(e,t,n=0,s=0)=>{const o=r().camera,c={width:e,height:t,top:n,left:s};i((e=>({size:c,viewport:{...e.viewport,...l(o,a,c)}})))},setDpr:e=>i((t=>{const n=Af(e);return{viewport:{...t.viewport,dpr:n,initialDpr:t.viewport.initialDpr||n}}})),setFrameloop:(e="always")=>{const t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),i((()=>({frameloop:e})))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:n.createRef(),active:!1,frames:0,priority:0,subscribe:(e,t,n)=>{const i=r().internal;return i.priority=i.priority+(t>0?1:0),i.subscribers.push({ref:e,priority:t,store:n}),i.subscribers=i.subscribers.sort(((e,t)=>e.priority-t.priority)),()=>{const n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter((t=>t.ref!==e)))}}}}})),r=i.getState();let s=r.size,a=r.viewport.dpr,o=r.camera;return i.subscribe((()=>{const{camera:e,size:t,viewport:n,gl:r,set:l}=i.getState();if(t.width!==s.width||t.height!==s.height||n.dpr!==a){s=t,a=n.dpr,Gf(e,t),n.dpr>0&&r.setPixelRatio(n.dpr);const i="undefined"!=typeof HTMLCanvasElement&&r.domElement instanceof HTMLCanvasElement;r.setSize(t.width,t.height,i)}e!==o&&(o=e,l((t=>({viewport:{...t.viewport,...t.viewport.getCurrentViewport(e)}}))))})),i.subscribe((t=>e(t))),i})(Vg,Hg),c=r||bg.createContainer(l,o.ConcurrentRoot,null,!1,null,"",a,a,a,null);let h,d;t||wg.set(e,{fiber:c,store:l});let u=!1,p=null;return{async configure(t={}){let n;p=new Promise((e=>n=e));let{gl:i,size:r,scene:s,events:a,onCreated:o,shadows:c=!1,linear:m=!1,flat:f=!1,legacy:g=!1,orthographic:v=!1,frameloop:x="always",dpr:y=[1,2],performance:_,raycaster:b,camera:w,onPointerMissed:M}=t,S=l.getState(),T=S.gl;if(!S.gl){const t={canvas:e,powerPreference:"high-performance",antialias:!0,alpha:!0},n="function"==typeof i?await i(t):i;T=Zf(n)?n:new Bm({...t,...i}),S.set({gl:T})}let E=S.raycaster;E||S.set({raycaster:E=new Sd});const{params:A,...C}=b||{};if(Rf.equ(C,E,Mg)||Vf(E,{...C}),Rf.equ(A,E.params,Mg)||Vf(E,{params:{...E.params,...A}}),!S.camera||S.camera===d&&!Rf.equ(d,w,Mg)){d=w;const e=null==w?void 0:w.isCamera,t=e?w:v?new Lh(0,0,0,0,.1,1e3):new na(75,0,.1,1e3);e||(t.position.z=5,w&&(Vf(t,w),t.manual||("aspect"in w||"left"in w||"right"in w||"bottom"in w||"top"in w)&&(t.manual=!0,t.updateProjectionMatrix())),S.camera||null!=w&&w.rotation||t.lookAt(0,0,0)),S.set({camera:t}),E.camera=t}if(!S.scene){let e;null!=s&&s.isScene?(e=s,Pf(e,l,"",{})):(e=new ua,Pf(e,l,"",{}),s&&Vf(e,s)),S.set({scene:e})}a&&!S.events.handlers&&S.set({events:a(l)});const R=function(e,t){if(!t&&"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:n,top:i,left:r}=e.parentElement.getBoundingClientRect();return{width:t,height:n,top:i,left:r}}return!t&&"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0}:{width:0,height:0,top:0,left:0,...t}}(e,r);if(Rf.equ(R,S.size,Mg)||S.setSize(R.width,R.height,R.top,R.left),y&&S.viewport.dpr!==Af(y)&&S.setDpr(y),S.frameloop!==x&&S.setFrameloop(x),S.onPointerMissed||S.set({onPointerMissed:M}),_&&!Rf.equ(_,S.performance,Mg)&&S.set((e=>({performance:{...e.performance,..._}}))),!S.xr){var N;const e=(e,t)=>{const n=l.getState();"never"!==n.frameloop&&Hg(e,!0,n,t)},t=()=>{const t=l.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||Vg(t)},n={connect(){const e=l.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=l.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"==typeof(null==(N=T.xr)?void 0:N.addEventListener)&&n.connect(),S.set({xr:n})}if(T.shadowMap){const e=T.shadowMap.enabled,t=T.shadowMap.type;if(T.shadowMap.enabled=!!c,Rf.boo(c))T.shadowMap.type=2;else if(Rf.str(c)){var I;const e={basic:0,percentage:1,soft:2,variance:3};T.shadowMap.type=null!=(I=e[c])?I:2}else Rf.obj(c)&&Object.assign(T.shadowMap,c);e===T.shadowMap.enabled&&t===T.shadowMap.type||(T.shadowMap.needsUpdate=!0)}return Ai.enabled=!g,u||(T.outputColorSpace=m?Un:kn,T.toneMapping=f?0:4),S.legacy!==g&&S.set((()=>({legacy:g}))),S.linear!==m&&S.set((()=>({linear:m}))),S.flat!==f&&S.set((()=>({flat:f}))),!i||Rf.fun(i)||Zf(i)||Rf.equ(i,T,Mg)||Vf(T,i),h=o,u=!0,n(),this},render(t){return u||p||this.configure(),p.then((()=>{bg.updateContainer(i.jsx(Tg,{store:l,children:t,onCreated:h,rootElement:e}),c,null,(()=>{}))})),l},unmount(){Eg(e)}}}function Tg({store:e,children:t,onCreated:n,rootElement:r}){return Mf((()=>{const t=e.getState();t.set((e=>({internal:{...e.internal,active:!0}}))),n&&n(t),e.getState().events.connected||null==t.events.connect||t.events.connect(r)}),[]),i.jsx($f.Provider,{value:e,children:t})}function Eg(e,t){const n=wg.get(e),i=null==n?void 0:n.fiber;if(i){const t=null==n?void 0:n.store.getState();t&&(t.internal.active=!1),bg.updateContainer(null,i,null,(()=>{t&&setTimeout((()=>{try{var n,i,r,s;null==t.events.disconnect||t.events.disconnect(),null==(n=t.gl)||null==(i=n.renderLists)||null==i.dispose||i.dispose(),null==(r=t.gl)||null==r.forceContextLoss||r.forceContextLoss(),null!=(s=t.gl)&&s.xr&&t.xr.disconnect(),function(e){"Scene"!==e.type&&(null==e.dispose||e.dispose());for(const t in e){const n=e[t];"Scene"!==(null==n?void 0:n.type)&&(null==n||null==n.dispose||n.dispose())}}(t.scene),wg.delete(e)}catch(a){}}),500)}))}}function Ag({state:e={},children:t,container:r}){const{events:s,size:a,...o}=e,l=Jf(),[c]=n.useState((()=>new Sd)),[h]=n.useState((()=>new hi)),d=Sf(((e,t)=>{let n;if(t.camera&&a){const i=t.camera;n=e.viewport.getCurrentViewport(i,new ui,a),i!==e.camera&&Gf(i,a)}return{...e,...t,scene:r,raycaster:c,pointer:h,mouse:h,previousRoot:l,events:{...e.events,...t.events,...s},size:{...e.size,...a},viewport:{...e.viewport,...n},setEvents:e=>t.set((t=>({...t,events:{...t.events,...e}})))}})),u=n.useMemo((()=>{const e=nf(((e,t)=>({...o,set:e,get:t}))),t=t=>e.setState((e=>d.current(t,e)));return t(l.getState()),l.subscribe(t),e}),[l,r]);return i.jsx(i.Fragment,{children:bg.createPortal(i.jsx($f.Provider,{value:u,children:t}),u,null)})}const Cg=new Set,Rg=new Set,Ng=new Set;function Ig(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function Pg(e,t){switch(e){case"before":return Ig(Cg,t);case"after":return Ig(Rg,t);case"tail":return Ig(Ng,t)}}let Lg,Dg;function kg(e,t,n){let i=t.clock.getDelta();"never"===t.frameloop&&"number"==typeof e&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Lg=t.internal.subscribers;for(let r=0;r<Lg.length;r++)Dg=Lg[r],Dg.ref.current(Dg.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}let Ug,Og,Fg,Bg=!1,zg=!1;function jg(e){Og=requestAnimationFrame(jg),Bg=!0,Ug=0,Pg("before",e),zg=!0;for(const n of wg.values()){var t;Fg=n.store.getState(),!Fg.internal.active||!("always"===Fg.frameloop||Fg.internal.frames>0)||null!=(t=Fg.gl.xr)&&t.isPresenting||(Ug+=kg(e,Fg))}if(zg=!1,Pg("after",e),0===Ug)return Pg("tail",e),Bg=!1,cancelAnimationFrame(Og)}function Vg(e,t=1){var n;if(!e)return wg.forEach((e=>Vg(e.store.getState(),t)));null!=(n=e.gl.xr)&&n.isPresenting||!e.internal.active||"never"===e.frameloop||(e.internal.frames=t>1?Math.min(60,e.internal.frames+t):zg?2:1,Bg||(Bg=!0,requestAnimationFrame(jg)))}function Hg(e,t=!0,n,i){if(t&&Pg("before",e),n)kg(e,n,i);else for(const r of wg.values())kg(e,r.store.getState());t&&Pg("after",e)}const Gg={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Wg(e){const{handlePointer:t}=Yf(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(Gg).reduce(((e,n)=>({...e,[n]:t(n)})),{}),update:()=>{var t;const{events:n,internal:i}=e.getState();null!=(t=i.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{const{set:n,events:i}=e.getState();if(null==i.disconnect||i.disconnect(),n((e=>({events:{...e.events,connected:t}}))),i.handlers)for(const e in i.handlers){const n=i.handlers[e],[r,s]=Gg[e];t.addEventListener(r,n,{passive:s})}},disconnect:()=>{const{set:t,events:n}=e.getState();if(n.connected){if(n.handlers)for(const e in n.handlers){const t=n.handlers[e],[i]=Gg[e];n.connected.removeEventListener(i,t)}t((e=>({events:{...e.events,connected:void 0}})))}}}}function Xg({ref:e,children:t,fallback:r,resize:s,style:a,gl:o,events:l=Wg,eventSource:h,eventPrefix:d,shadows:u,linear:p,flat:m,legacy:f,orthographic:g,frameloop:v,dpr:x,performance:y,raycaster:_,camera:b,scene:w,onPointerMissed:M,onCreated:S,...T}){n.useMemo((()=>lg(zm)),[]);const E=function(){const e=gf(),t=yf();return n.useMemo((()=>({children:r})=>{const s=uf(e,!0,(e=>e.type===n.StrictMode))?n.StrictMode:n.Fragment;return i.jsx(s,{children:i.jsx(t,{children:r})})}),[e,t])}(),[A,C]=c({scroll:!0,debounce:{scroll:50,resize:0},...s}),R=n.useRef(null),N=n.useRef(null);n.useImperativeHandle(e,(()=>R.current));const I=Sf(M),[P,L]=n.useState(!1),[D,k]=n.useState(!1);if(P)throw P;if(D)throw D;const U=n.useRef(null);Mf((()=>{const e=R.current;if(C.width>0&&C.height>0&&e){async function r(){await U.current.configure({gl:o,scene:w,events:l,shadows:u,linear:p,flat:m,legacy:f,orthographic:g,frameloop:v,dpr:x,performance:y,raycaster:_,camera:b,size:C,onPointerMissed:(...e)=>null==I.current?void 0:I.current(...e),onCreated:e=>{var t;null==e.events.connect||e.events.connect(h?(t=h)&&t.hasOwnProperty("current")?h.current:h:N.current),d&&e.setEvents({compute:(e,t)=>{const n=e[d+"X"],i=e[d+"Y"];t.pointer.set(n/t.size.width*2-1,-i/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==S||S(e)}}),U.current.render(i.jsx(E,{children:i.jsx(Ef,{set:k,children:i.jsx(n.Suspense,{fallback:i.jsx(Tf,{set:L}),children:null!=t?t:null})})}))}U.current||(U.current=Sg(e)),r()}})),n.useEffect((()=>{const e=R.current;if(e)return()=>Eg(e)}),[]);const O=h?"none":"auto";return i.jsx("div",{ref:N,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:O,...a},...T,children:i.jsx("div",{ref:A,style:{width:"100%",height:"100%"},children:i.jsx("canvas",{ref:R,style:{display:"block"},children:r})})})}function qg(e){return i.jsx(ff,{children:i.jsx(Xg,{...e})})}function Yg(){return Yg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Yg.apply(null,arguments)}const Zg=(()=>parseInt(Ie.replace(/\D+/g,"")))();var $g=Uint8Array,Jg=Uint16Array,Kg=Uint32Array,Qg=new $g([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ev=new $g([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),tv=new $g([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),nv=function(e,t){for(var n=new Jg(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new Kg(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return[n,r]},iv=nv(Qg,2),rv=iv[0],sv=iv[1];rv[28]=258,sv[258]=28;for(var av=nv(ev,0)[0],ov=new Jg(32768),lv=0;lv<32768;++lv){var cv=(43690&lv)>>>1|(21845&lv)<<1;cv=(61680&(cv=(52428&cv)>>>2|(13107&cv)<<2))>>>4|(3855&cv)<<4,ov[lv]=((65280&cv)>>>8|(255&cv)<<8)>>>1}var hv=function(e,t,n){for(var i=e.length,r=0,s=new Jg(t);r<i;++r)++s[e[r]-1];var a,o=new Jg(t);for(r=0;r<t;++r)o[r]=o[r-1]+s[r-1]<<1;if(n){a=new Jg(1<<t);var l=15-t;for(r=0;r<i;++r)if(e[r])for(var c=r<<4|e[r],h=t-e[r],d=o[e[r]-1]++<<h,u=d|(1<<h)-1;d<=u;++d)a[ov[d]>>>l]=c}else for(a=new Jg(i),r=0;r<i;++r)e[r]&&(a[r]=ov[o[e[r]-1]++]>>>15-e[r]);return a},dv=new $g(288);for(lv=0;lv<144;++lv)dv[lv]=8;for(lv=144;lv<256;++lv)dv[lv]=9;for(lv=256;lv<280;++lv)dv[lv]=7;for(lv=280;lv<288;++lv)dv[lv]=8;var uv=new $g(32);for(lv=0;lv<32;++lv)uv[lv]=5;var pv=hv(dv,9,1),mv=hv(uv,5,1),fv=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},gv=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},vv=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},xv=function(e,t,n){var i=e.length;if(!i||n&&!n.l&&i<5)return t||new $g(0);var r=!t||n,s=!n||n.i;n||(n={}),t||(t=new $g(3*i));var a,o=function(e){var n=t.length;if(e>n){var i=new $g(Math.max(2*n,e));i.set(t),t=i}},l=n.f||0,c=n.p||0,h=n.b||0,d=n.l,u=n.d,p=n.m,m=n.n,f=8*i;do{if(!d){n.f=l=gv(e,c,1);var g=gv(e,c+1,3);if(c+=3,!g){var v=e[(C=((a=c)/8|0)+(7&a&&1)+4)-4]|e[C-3]<<8,x=C+v;if(x>i){if(s)throw"unexpected EOF";break}r&&o(h+v),t.set(e.subarray(C,x),h),n.b=h+=v,n.p=c=8*x;continue}if(1==g)d=pv,u=mv,p=9,m=5;else{if(2!=g)throw"invalid block type";var y=gv(e,c,31)+257,_=gv(e,c+10,15)+4,b=y+gv(e,c+5,31)+1;c+=14;for(var w=new $g(b),M=new $g(19),S=0;S<_;++S)M[tv[S]]=gv(e,c+3*S,7);c+=3*_;var T=fv(M),E=(1<<T)-1,A=hv(M,T,1);for(S=0;S<b;){var C,R=A[gv(e,c,E)];if(c+=15&R,(C=R>>>4)<16)w[S++]=C;else{var N=0,I=0;for(16==C?(I=3+gv(e,c,3),c+=2,N=w[S-1]):17==C?(I=3+gv(e,c,7),c+=3):18==C&&(I=11+gv(e,c,127),c+=7);I--;)w[S++]=N}}var P=w.subarray(0,y),L=w.subarray(y);p=fv(P),m=fv(L),d=hv(P,p,1),u=hv(L,m,1)}if(c>f){if(s)throw"unexpected EOF";break}}r&&o(h+131072);for(var D=(1<<p)-1,k=(1<<m)-1,U=c;;U=c){var O=(N=d[vv(e,c)&D])>>>4;if((c+=15&N)>f){if(s)throw"unexpected EOF";break}if(!N)throw"invalid length/literal";if(O<256)t[h++]=O;else{if(256==O){U=c,d=null;break}var F=O-254;if(O>264){var B=Qg[S=O-257];F=gv(e,c,(1<<B)-1)+rv[S],c+=B}var z=u[vv(e,c)&k],j=z>>>4;if(!z)throw"invalid distance";c+=15&z;L=av[j];if(j>3){B=ev[j];L+=vv(e,c)&(1<<B)-1,c+=B}if(c>f){if(s)throw"unexpected EOF";break}r&&o(h+131072);for(var V=h+F;h<V;h+=4)t[h]=t[h-L],t[h+1]=t[h+1-L],t[h+2]=t[h+2-L],t[h+3]=t[h+3-L];h=V}}n.l=d,n.p=U,n.b=h,d&&(l=1,n.m=p,n.d=u,n.n=m)}while(!l);return h==t.length?t:function(e,t,n){(null==n||n>e.length)&&(n=e.length);var i=new(e instanceof Jg?Jg:e instanceof Kg?Kg:$g)(n-t);return i.set(e.subarray(t,n)),i}(t,0,h)},yv=new $g(0);function _v(e,t){return xv((function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"}(e),e.subarray(2,-4)),t)}var bv="undefined"!=typeof TextDecoder&&new TextDecoder;try{bv.decode(yv,{stream:!0})}catch(Px){}class wv extends Gs{constructor(e,t){var n,i;const r=(s=e)&&s.isCubeTexture;var s;const a=(null!=(i=r?null==(n=e.image[0])?void 0:n.width:e.image.width)?i:1024)/4,o=Math.floor(Math.log2(a)),l=Math.pow(2,o),c=[r?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH "+1/(3*Math.max(l,112)),"#define CUBEUV_TEXEL_HEIGHT "+1/(4*l),`#define CUBEUV_MAX_MIP ${o}.0`].join("\n")+`\n        #define ENVMAP_TYPE_CUBE_UV\n        varying vec3 vWorldPosition;\n        uniform float radius;\n        uniform float height;\n        uniform float angle;\n        #ifdef ENVMAP_TYPE_CUBE\n            uniform samplerCube map;\n        #else\n            uniform sampler2D map;\n        #endif\n        // From: https://www.shadertoy.com/view/4tsBD7\n        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) \n        {\n            float d = dot ( rd, n );\n            \n            if( d > 0.0 ) { return 1e6; }\n            \n            vec3  o = ro - c;\n            float t = - dot( n, o ) / d;\n            vec3  q = o + rd * t;\n            \n            return ( dot( q, q ) < r * r ) ? t : 1e6;\n        }\n        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\n        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) \n        {\n            vec3 oc = ro - ce;\n            float b = dot( oc, rd );\n            float c = dot( oc, oc ) - ra * ra;\n            float h = b * b - c;\n            \n            if( h < 0.0 ) { return -1.0; }\n            \n            h = sqrt( h );\n            \n            return - b + h;\n        }\n        vec3 project() \n        {\n            vec3 p = normalize( vWorldPosition );\n            vec3 camPos = cameraPosition;\n            camPos.y -= height;\n            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );\n            if( intersection > 0.0 ) {\n                \n                vec3 h = vec3( 0.0, - height, 0.0 );\n                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );\n                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;\n            } else {\n                p = vec3( 0.0, 1.0, 0.0 );\n            }\n            return p;\n        }\n        #include <common>\n        #include <cube_uv_reflection_fragment>\n        void main() \n        {\n            vec3 projectedWorldPosition = project();\n            \n            #ifdef ENVMAP_TYPE_CUBE\n                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;\n            #else\n                vec3 direction = normalize( projectedWorldPosition );\n                vec2 uv = equirectUv( direction );\n                vec3 outcolor = texture2D( map, uv ).rgb;\n            #endif\n            gl_FragColor = vec4( outcolor, 1.0 );\n            #include <tonemapping_fragment>\n            #include <${Zg>=154?"colorspace_fragment":"encodings_fragment"}>\n        }\n        `,h={map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}};super(new xc(1,16),new Js({uniforms:h,fragmentShader:c,vertexShader:"\n        varying vec3 vWorldPosition;\n        void main() \n        {\n            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );\n            vWorldPosition = worldPosition.xyz;\n            \n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n        ",side:2}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}class Mv extends yh{constructor(e){super(e),this.type=Pt}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},n=function(e,t,n){t=t||1024;let i=e.pos,r=-1,s=0,a="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(r=o.indexOf("\n"))&&s<t&&i<e.byteLength;)a+=o,s+=o.length,i+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<r&&(e.pos+=s+r+1,a+o.slice(0,r))},i=function(e,t,n,i){const r=e[t+3],s=Math.pow(2,r-128)/255;n[i+0]=e[t+0]*s,n[i+1]=e[t+1]*s,n[i+2]=e[t+2]*s,n[i+3]=1},r=function(e,t,n,i){const r=e[t+3],s=Math.pow(2,r-128)/255;n[i+0]=vs.toHalfFloat(Math.min(e[t+0]*s,65504)),n[i+1]=vs.toHalfFloat(Math.min(e[t+1]*s,65504)),n[i+2]=vs.toHalfFloat(Math.min(e[t+2]*s,65504)),n[i+3]=vs.toHalfFloat(1)},s=new Uint8Array(e);s.pos=0;const a=function(e){const i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;for((e.pos>=e.byteLength||!(l=n(e)))&&t(1,"no header found"),(c=l.match(/^#\?(\S+)/))||t(3,"bad initial token"),o.valid|=1,o.programtype=c[1],o.string+=l+"\n";l=n(e),!1!==l;)if(o.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(i))&&(o.gamma=parseFloat(c[1])),(c=l.match(r))&&(o.exposure=parseFloat(c[1])),(c=l.match(s))&&(o.valid|=2,o.format=c[1]),(c=l.match(a))&&(o.valid|=4,o.height=parseInt(c[1],10),o.width=parseInt(c[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=l+"\n";return 2&o.valid||t(3,"missing format specifier"),4&o.valid||t(3,"missing image size specifier"),o}(s),o=a.width,l=a.height,c=function(e,n,i){const r=n;if(r<8||r>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);r!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const s=new Uint8Array(4*n*i);s.length||t(4,"unable to allocate buffer space");let a=0,o=0;const l=4*r,c=new Uint8Array(4),h=new Uint8Array(l);let d=i;for(;d>0&&o<e.byteLength;){o+4>e.byteLength&&t(1),c[0]=e[o++],c[1]=e[o++],c[2]=e[o++],c[3]=e[o++],2==c[0]&&2==c[1]&&(c[2]<<8|c[3])==r||t(3,"bad rgbe scanline format");let n,i=0;for(;i<l&&o<e.byteLength;){n=e[o++];const r=n>128;if(r&&(n-=128),(0===n||i+n>l)&&t(3,"bad scanline data"),r){const t=e[o++];for(let e=0;e<n;e++)h[i++]=t}else h.set(e.subarray(o,o+n),i),i+=n,o+=n}const u=r;for(let e=0;e<u;e++){let t=0;s[a]=h[e+t],t+=r,s[a+1]=h[e+t],t+=r,s[a+2]=h[e+t],t+=r,s[a+3]=h[e+t],a+=4}d--}return s}(s.subarray(s.pos),o,l);let h,d,u;switch(this.type){case It:u=c.length/4;const e=new Float32Array(4*u);for(let n=0;n<u;n++)i(c,4*n,e,4*n);h=e,d=It;break;case Pt:u=c.length/4;const t=new Uint16Array(4*u);for(let n=0;n<u;n++)r(c,4*n,t,4*n);h=t,d=Pt;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:o,height:l,data:h,header:a.string,gamma:a.gamma,exposure:a.exposure,type:d}}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,(function(e,n){switch(e.type){case It:case Pt:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=bt,e.magFilter=bt,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),n,i)}}const Sv=Zg>=152;class Tv extends yh{constructor(e){super(e),this.type=Pt}parse(e){const t=65536,n=14,i=65537,r=16384,s=Math.pow(2.7182818,2.2);const a={l:0,c:0,lc:0};function o(e,t,n,i,r){for(;n<e;)t=t<<8|j(i,r),n+=8;n-=e,a.l=t>>n&(1<<e)-1,a.c=t,a.lc=n}const l=new Array(59);function c(e,t,n,r,s,c,h){for(var d=n,u=0,p=0;s<=c;s++){if(d.value-n.value>r)return!1;o(6,u,p,e,d);var m=a.l;if(u=a.c,p=a.lc,h[s]=m,63==m){if(d.value-n.value>r)throw"Something wrong with hufUnpackEncTable";o(8,u,p,e,d);var f=a.l+6;if(u=a.c,p=a.lc,s+f>c+1)throw"Something wrong with hufUnpackEncTable";for(;f--;)h[s++]=0;s--}else if(m>=59){if(s+(f=m-59+2)>c+1)throw"Something wrong with hufUnpackEncTable";for(;f--;)h[s++]=0;s--}}!function(e){for(var t=0;t<=58;++t)l[t]=0;for(t=0;t<i;++t)l[e[t]]+=1;var n=0;for(t=58;t>0;--t){var r=n+l[t]>>1;l[t]=n,n=r}for(t=0;t<i;++t){var s=e[t];s>0&&(e[t]=s|l[s]++<<6)}}(h)}function h(e){return 63&e}function d(e){return e>>6}const u={c:0,lc:0};function p(e,t,n,i){e=e<<8|j(n,i),t+=8,u.c=e,u.lc=t}const m={c:0,lc:0};function f(e,t,n,i,r,s,a,o,l,c){if(e==t){i<8&&(p(n,i,r,a),n=u.c,i=u.lc);var h=n>>(i-=8);h=new Uint8Array([h])[0];if(l.value+h>c)return!1;for(var d=o[l.value-1];h-- >0;)o[l.value++]=d}else{if(!(l.value<c))return!1;o[l.value++]=e}m.c=n,m.lc=i}function g(e){return 65535&e}function v(e){var t=g(e);return t>32767?t-65536:t}const x={a:0,b:0};function y(e,t){var n=v(e),i=v(t),r=n+(1&i)+(i>>1),s=r,a=r-i;x.a=s,x.b=a}function _(e,t){var n=g(e),i=g(t),r=n-(i>>1)&65535,s=i+r-32768&65535;x.a=s,x.b=r}function b(e,t,n,i,r,s,a){for(var o,l=a<16384,c=n>r?r:n,h=1;h<=c;)h<<=1;for(o=h>>=1,h>>=1;h>=1;){for(var d,u,p,m,f=0,g=f+s*(r-o),v=s*h,b=s*o,w=i*h,M=i*o;f<=g;f+=b){for(var S=f,T=f+i*(n-o);S<=T;S+=M){var E=S+w,A=(C=S+v)+w;l?(y(e[S+t],e[C+t]),d=x.a,p=x.b,y(e[E+t],e[A+t]),u=x.a,m=x.b,y(d,u),e[S+t]=x.a,e[E+t]=x.b,y(p,m),e[C+t]=x.a,e[A+t]=x.b):(_(e[S+t],e[C+t]),d=x.a,p=x.b,_(e[E+t],e[A+t]),u=x.a,m=x.b,_(d,u),e[S+t]=x.a,e[E+t]=x.b,_(p,m),e[C+t]=x.a,e[A+t]=x.b)}if(n&h){var C=S+v;l?y(e[S+t],e[C+t]):_(e[S+t],e[C+t]),d=x.a,e[C+t]=x.b,e[S+t]=d}}if(r&h)for(S=f,T=f+i*(n-o);S<=T;S+=M){E=S+w;l?y(e[S+t],e[E+t]):_(e[S+t],e[E+t]),d=x.a,e[E+t]=x.b,e[S+t]=d}o=h,h>>=1}return f}function w(e,t,s,a,o,l){var g=s.value,v=z(t,s),x=z(t,s);s.value+=4;var y=z(t,s);if(s.value+=4,v<0||v>=i||x<0||x>=i)throw"Something wrong with HUF_ENCSIZE";var _=new Array(i),b=new Array(r);if(function(e){for(var t=0;t<r;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(b),c(e,0,s,a-(s.value-g),v,x,_),y>8*(a-(s.value-g)))throw"Something wrong with hufUncompress";!function(e,t,i,r){for(;t<=i;t++){var s=d(e[t]),a=h(e[t]);if(s>>a)throw"Invalid table entry";if(a>n){if((u=r[s>>a-n]).len)throw"Invalid table entry";if(u.lit++,u.p){var o=u.p;u.p=new Array(u.lit);for(var l=0;l<u.lit-1;++l)u.p[l]=o[l]}else u.p=new Array(1);u.p[u.lit-1]=t}else if(a){var c=0;for(l=1<<n-a;l>0;l--){var u;if((u=r[(s<<n-a)+c]).len||u.p)throw"Invalid table entry";u.len=a,u.lit=t,c++}}}}(_,v,x,b),function(e,t,i,r,s,a,o,l,c,g){for(var v=0,x=0,y=l,_=Math.trunc(s.value+(a+7)/8);s.value<_;)for(p(v,x,i,s),v=u.c,x=u.lc;x>=n;)if((S=t[v>>x-n&16383]).len)x-=S.len,f(S.lit,o,v,x,i,0,s,c,g,y),v=m.c,x=m.lc;else{if(!S.p)throw"hufDecode issues";var b;for(b=0;b<S.lit;b++){for(var w=h(e[S.p[b]]);x<w&&s.value<_;)p(v,x,i,s),v=u.c,x=u.lc;if(x>=w&&d(e[S.p[b]])==(v>>x-w&(1<<w)-1)){x-=w,f(S.p[b],o,v,x,i,0,s,c,g,y),v=m.c,x=m.lc;break}}if(b==S.lit)throw"hufDecode issues"}var M=8-a&7;for(v>>=M,x-=M;x>0;){var S;if(!(S=t[v<<n-x&16383]).len)throw"hufDecode issues";x-=S.len,f(S.lit,o,v,x,i,0,s,c,g,y),v=m.c,x=m.lc}}(_,b,e,0,s,y,x,l,o,{value:0})}function M(e){for(var t=1;t<e.length;t++){var n=e[t-1]+e[t]-128;e[t]=n}}function S(e,t){for(var n=0,i=Math.floor((e.length+1)/2),r=0,s=e.length-1;!(r>s||(t[r++]=e[n++],r>s));)t[r++]=e[i++]}function T(e){for(var t=e.byteLength,n=new Array,i=0,r=new DataView(e);t>0;){var s=r.getInt8(i++);if(s<0){t-=(o=-s)+1;for(var a=0;a<o;a++)n.push(r.getUint8(i++))}else{var o=s;t-=2;var l=r.getUint8(i++);for(a=0;a<o+1;a++)n.push(l)}}return n}function E(e,t,n){for(var i,r=1;r<64;)65280==(i=t[e.value])?r=64:i>>8==255?r+=255&i:(n[r]=i,r++),e.value++}function A(e,t){t[0]=X(e[0]),t[1]=X(e[1]),t[2]=X(e[5]),t[3]=X(e[6]),t[4]=X(e[14]),t[5]=X(e[15]),t[6]=X(e[27]),t[7]=X(e[28]),t[8]=X(e[2]),t[9]=X(e[4]),t[10]=X(e[7]),t[11]=X(e[13]),t[12]=X(e[16]),t[13]=X(e[26]),t[14]=X(e[29]),t[15]=X(e[42]),t[16]=X(e[3]),t[17]=X(e[8]),t[18]=X(e[12]),t[19]=X(e[17]),t[20]=X(e[25]),t[21]=X(e[30]),t[22]=X(e[41]),t[23]=X(e[43]),t[24]=X(e[9]),t[25]=X(e[11]),t[26]=X(e[18]),t[27]=X(e[24]),t[28]=X(e[31]),t[29]=X(e[40]),t[30]=X(e[44]),t[31]=X(e[53]),t[32]=X(e[10]),t[33]=X(e[19]),t[34]=X(e[23]),t[35]=X(e[32]),t[36]=X(e[39]),t[37]=X(e[45]),t[38]=X(e[52]),t[39]=X(e[54]),t[40]=X(e[20]),t[41]=X(e[22]),t[42]=X(e[33]),t[43]=X(e[38]),t[44]=X(e[46]),t[45]=X(e[51]),t[46]=X(e[55]),t[47]=X(e[60]),t[48]=X(e[21]),t[49]=X(e[34]),t[50]=X(e[37]),t[51]=X(e[47]),t[52]=X(e[50]),t[53]=X(e[56]),t[54]=X(e[59]),t[55]=X(e[61]),t[56]=X(e[35]),t[57]=X(e[36]),t[58]=X(e[48]),t[59]=X(e[49]),t[60]=X(e[57]),t[61]=X(e[58]),t[62]=X(e[62]),t[63]=X(e[63])}function C(e){const t=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),i=.5*Math.cos(3.14159/8),r=.5*Math.cos(3*3.14159/16),s=.5*Math.cos(.981746875),a=.5*Math.cos(3*3.14159/8),o=.5*Math.cos(1.374445625);for(var l=new Array(4),c=new Array(4),h=new Array(4),d=new Array(4),u=0;u<8;++u){var p=8*u;l[0]=i*e[p+2],l[1]=a*e[p+2],l[2]=i*e[p+6],l[3]=a*e[p+6],c[0]=n*e[p+1]+r*e[p+3]+s*e[p+5]+o*e[p+7],c[1]=r*e[p+1]-o*e[p+3]-n*e[p+5]-s*e[p+7],c[2]=s*e[p+1]-n*e[p+3]+o*e[p+5]+r*e[p+7],c[3]=o*e[p+1]-s*e[p+3]+r*e[p+5]-n*e[p+7],h[0]=t*(e[p+0]+e[p+4]),h[3]=t*(e[p+0]-e[p+4]),h[1]=l[0]+l[3],h[2]=l[1]-l[2],d[0]=h[0]+h[1],d[1]=h[3]+h[2],d[2]=h[3]-h[2],d[3]=h[0]-h[1],e[p+0]=d[0]+c[0],e[p+1]=d[1]+c[1],e[p+2]=d[2]+c[2],e[p+3]=d[3]+c[3],e[p+4]=d[3]-c[3],e[p+5]=d[2]-c[2],e[p+6]=d[1]-c[1],e[p+7]=d[0]-c[0]}for(var m=0;m<8;++m)l[0]=i*e[16+m],l[1]=a*e[16+m],l[2]=i*e[48+m],l[3]=a*e[48+m],c[0]=n*e[8+m]+r*e[24+m]+s*e[40+m]+o*e[56+m],c[1]=r*e[8+m]-o*e[24+m]-n*e[40+m]-s*e[56+m],c[2]=s*e[8+m]-n*e[24+m]+o*e[40+m]+r*e[56+m],c[3]=o*e[8+m]-s*e[24+m]+r*e[40+m]-n*e[56+m],h[0]=t*(e[m]+e[32+m]),h[3]=t*(e[m]-e[32+m]),h[1]=l[0]+l[3],h[2]=l[1]-l[2],d[0]=h[0]+h[1],d[1]=h[3]+h[2],d[2]=h[3]-h[2],d[3]=h[0]-h[1],e[0+m]=d[0]+c[0],e[8+m]=d[1]+c[1],e[16+m]=d[2]+c[2],e[24+m]=d[3]+c[3],e[32+m]=d[3]-c[3],e[40+m]=d[2]-c[2],e[48+m]=d[1]-c[1],e[56+m]=d[0]-c[0]}function R(e){for(var t=0;t<64;++t){var n=e[0][t],i=e[1][t],r=e[2][t];e[0][t]=n+1.5747*r,e[1][t]=n-.1873*i-.4682*r,e[2][t]=n+1.8556*i}}function N(e,t,n){for(var i=0;i<64;++i)t[n+i]=vs.toHalfFloat(I(e[i]))}function I(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(s,Math.abs(e)-1)}function P(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function L(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(T(t)),i=new Uint8Array(n.length);return M(n),S(n,i),new DataView(i.buffer)}function D(e){var t=_v(e.array.slice(e.offset.value,e.offset.value+e.size)),n=new Uint8Array(t.length);return M(t),S(t,n),new DataView(n.buffer)}function k(e){for(var n=e.viewer,i={value:e.offset.value},r=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),s=new Uint8Array(8192),a=0,o=new Array(e.channels),l=0;l<e.channels;l++)o[l]={},o[l].start=a,o[l].end=o[l].start,o[l].nx=e.width,o[l].ny=e.lines,o[l].size=e.type,a+=o[l].nx*o[l].ny*o[l].size;var c=q(n,i),h=q(n,i);if(h>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(c<=h)for(l=0;l<h-c+1;l++)s[l+c]=V(n,i);var d=new Uint16Array(t),u=function(e,n){for(var i=0,r=0;r<t;++r)(0==r||e[r>>3]&1<<(7&r))&&(n[i++]=r);for(var s=i-1;i<t;)n[i++]=0;return s}(s,d),p=z(n,i);w(e.array,n,i,p,r,a);for(l=0;l<e.channels;++l)for(var m=o[l],f=0;f<o[l].size;++f)b(r,m.start+f,m.nx,m.size,m.ny,m.nx*m.size,u);!function(e,t,n){for(var i=0;i<n;++i)t[i]=e[t[i]]}(d,r,a);for(var g=0,v=new Uint8Array(r.buffer.byteLength),x=0;x<e.lines;x++)for(var y=0;y<e.channels;y++){var _=(m=o[y]).nx*m.size,M=new Uint8Array(r.buffer,2*m.end,2*_);v.set(M,g),g+=2*_,m.end+=_}return new DataView(v.buffer)}function U(e){var t=_v(e.array.slice(e.offset.value,e.offset.value+e.size));const n=e.lines*e.channels*e.width,i=1==e.type?new Uint16Array(n):new Uint32Array(n);let r=0,s=0;const a=new Array(4);for(let o=0;o<e.lines;o++)for(let n=0;n<e.channels;n++){let n=0;switch(e.type){case 1:a[0]=r,a[1]=a[0]+e.width,r=a[1]+e.width;for(let r=0;r<e.width;++r){n+=t[a[0]++]<<8|t[a[1]++],i[s]=n,s++}break;case 2:a[0]=r,a[1]=a[0]+e.width,a[2]=a[1]+e.width,r=a[2]+e.width;for(let r=0;r<e.width;++r){n+=t[a[0]++]<<24|t[a[1]++]<<16|t[a[2]++]<<8,i[s]=n,s++}}}return new DataView(i.buffer)}function O(e){var t=e.viewer,n={value:e.offset.value},i=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),r={version:H(t,n),unknownUncompressedSize:H(t,n),unknownCompressedSize:H(t,n),acCompressedSize:H(t,n),dcCompressedSize:H(t,n),rleCompressedSize:H(t,n),rleUncompressedSize:H(t,n),rleRawSize:H(t,n),totalAcUncompressedCount:H(t,n),totalDcUncompressedCount:H(t,n),acCompression:H(t,n)};if(r.version<2)throw"EXRLoader.parse: "+Q.compression+" version "+r.version+" is unsupported";for(var s=new Array,a=q(t,n)-2;a>0;){var o=F(t.buffer,n),l=V(t,n),c=l>>2&3,h=new Int8Array([(l>>4)-1])[0],d=V(t,n);s.push({name:o,index:h,type:d,compression:c}),a-=o.length+3}for(var u=Q.channels,p=new Array(e.channels),m=0;m<e.channels;++m){var f=p[m]={},g=u[m];f.name=g.name,f.compression=0,f.decoded=!1,f.type=g.pixelType,f.pLinear=g.pLinear,f.width=e.width,f.height=e.lines}for(var v={idx:new Array(3)},x=0;x<e.channels;++x)for(f=p[x],m=0;m<s.length;++m){var y=s[m];f.name==y.name&&(f.compression=y.compression,y.index>=0&&(v.idx[y.index]=x),f.offset=x)}if(r.acCompressedSize>0)switch(r.acCompression){case 0:var _=new Uint16Array(r.totalAcUncompressedCount);w(e.array,t,n,r.acCompressedSize,_,r.totalAcUncompressedCount);break;case 1:var b=_v(e.array.slice(n.value,n.value+r.totalAcUncompressedCount));_=new Uint16Array(b.buffer);n.value+=r.totalAcUncompressedCount}if(r.dcCompressedSize>0){var M={array:e.array,offset:n,size:r.dcCompressedSize},S=new Uint16Array(D(M).buffer);n.value+=r.dcCompressedSize}if(r.rleRawSize>0){var I=T((b=_v(e.array.slice(n.value,n.value+r.rleCompressedSize))).buffer);n.value+=r.rleCompressedSize}var P=0,L=new Array(p.length);for(m=0;m<L.length;++m)L[m]=new Array;for(var k=0;k<e.lines;++k)for(var U=0;U<p.length;++U)L[U].push(P),P+=p[U].width*e.type*2;!function(e,t,n,i,r,s){var a=new DataView(s.buffer),o=n[e.idx[0]].width,l=n[e.idx[0]].height,c=Math.floor(o/8),h=Math.ceil(o/8),d=Math.ceil(l/8),u=o-8*(h-1),p=l-8*(d-1),m={value:0},f=new Array(3),g=new Array(3),v=new Array(3),x=new Array(3),y=new Array(3);for(let E=0;E<3;++E)y[E]=t[e.idx[E]],f[E]=E<1?0:f[E-1]+h*d,g[E]=new Float32Array(64),v[E]=new Uint16Array(64),x[E]=new Uint16Array(64*h);for(let P=0;P<d;++P){var _=8;P==d-1&&(_=p);var b=8;for(let e=0;e<h;++e){e==h-1&&(b=u);for(let e=0;e<3;++e)v[e].fill(0),v[e][0]=r[f[e]++],E(m,i,v[e]),A(v[e],g[e]),C(g[e]);R(g);for(let t=0;t<3;++t)N(g[t],x[t],64*e)}let t=0;for(let i=0;i<3;++i){const r=n[e.idx[i]].type;for(let e=8*P;e<8*P+_;++e){t=y[i][e];for(let n=0;n<c;++n){const s=64*n+8*(7&e);a.setUint16(t+0*r,x[i][s+0],!0),a.setUint16(t+2*r,x[i][s+1],!0),a.setUint16(t+4*r,x[i][s+2],!0),a.setUint16(t+6*r,x[i][s+3],!0),a.setUint16(t+8*r,x[i][s+4],!0),a.setUint16(t+10*r,x[i][s+5],!0),a.setUint16(t+12*r,x[i][s+6],!0),a.setUint16(t+14*r,x[i][s+7],!0),t+=16*r}}if(c!=h)for(let e=8*P;e<8*P+_;++e){const t=y[i][e]+8*c*2*r,n=64*c+8*(7&e);for(let e=0;e<b;++e)a.setUint16(t+2*e*r,x[i][n+e],!0)}}}for(var w=new Uint16Array(o),M=(a=new DataView(s.buffer),0);M<3;++M){n[e.idx[M]].decoded=!0;var S=n[e.idx[M]].type;if(2==n[M].type)for(var T=0;T<l;++T){const e=y[M][T];for(var I=0;I<o;++I)w[I]=a.getUint16(e+2*I*S,!0);for(I=0;I<o;++I)a.setFloat32(e+2*I*S,X(w[I]),!0)}}}(v,L,p,_,S,i);for(m=0;m<p.length;++m){if(!(f=p[m]).decoded){if(2!==f.compression)throw"EXRLoader.parse: unsupported channel compression";var O=0,B=0;for(k=0;k<e.lines;++k){for(var z=L[m][O],j=0;j<f.width;++j){for(var G=0;G<2*f.type;++G)i[z++]=I[B+G*f.width*f.height];B++}O++}}}return new DataView(i.buffer)}function F(e,t){for(var n=new Uint8Array(e),i=0;0!=n[t.value+i];)i+=1;var r=(new TextDecoder).decode(n.slice(t.value,t.value+i));return t.value=t.value+i+1,r}function B(e,t){var n=e.getInt32(t.value,!0);return t.value=t.value+4,n}function z(e,t){var n=e.getUint32(t.value,!0);return t.value=t.value+4,n}function j(e,t){var n=e[t.value];return t.value=t.value+1,n}function V(e,t){var n=e.getUint8(t.value);return t.value=t.value+1,n}const H=function(e,t){let n;return n="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function G(e,t){var n=e.getFloat32(t.value,!0);return t.value+=4,n}function W(e,t){return vs.toHalfFloat(G(e,t))}function X(e){var t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}function q(e,t){var n=e.getUint16(t.value,!0);return t.value+=2,n}function Y(e,t){return X(q(e,t))}function Z(e,t,n,i,r){return"string"===i||"stringvector"===i||"iccProfile"===i?function(e,t,n){var i=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,i}(t,n,r):"chlist"===i?function(e,t,n,i){for(var r=n.value,s=[];n.value<r+i-1;){var a=F(t,n),o=B(e,n),l=V(e,n);n.value+=3;var c=B(e,n),h=B(e,n);s.push({name:a,pixelType:o,pLinear:l,xSampling:c,ySampling:h})}return n.value+=1,s}(e,t,n,r):"chromaticities"===i?function(e,t){return{redX:G(e,t),redY:G(e,t),greenX:G(e,t),greenY:G(e,t),blueX:G(e,t),blueY:G(e,t),whiteX:G(e,t),whiteY:G(e,t)}}(e,n):"compression"===i?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][V(e,t)]}(e,n):"box2i"===i?function(e,t){return{xMin:z(e,t),yMin:z(e,t),xMax:z(e,t),yMax:z(e,t)}}(e,n):"lineOrder"===i?function(e,t){return["INCREASING_Y"][V(e,t)]}(e,n):"float"===i?G(e,n):"v2f"===i?function(e,t){return[G(e,t),G(e,t)]}(e,n):"v3f"===i?function(e,t){return[G(e,t),G(e,t),G(e,t)]}(e,n):"int"===i?B(e,n):"rational"===i?function(e,t){return[B(e,t),z(e,t)]}(e,n):"timecode"===i?function(e,t){return[z(e,t),z(e,t)]}(e,n):"preview"===i?(n.value+=r,"skipped"):void(n.value+=r)}const $=new DataView(e),J=new Uint8Array(e),K={value:0},Q=function(e,t,n){const i={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";i.version=e.getUint8(4);const r=e.getUint8(5);i.spec={singleTile:!!(2&r),longName:!!(4&r),deepFormat:!!(8&r),multiPart:!!(16&r)},n.value=8;for(var s=!0;s;){var a=F(t,n);if(0==a)s=!1;else{var o=Z(e,t,n,F(t,n),z(e,n));void 0===o||(i[a]=o)}}if(-5&r)throw"THREE.EXRLoader: provided file is currently unsupported.";return i}($,e,K),ee=function(e,t,n,i,r){const s={size:0,viewer:t,array:n,offset:i,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Sv?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":s.lines=1,s.uncompress=P;break;case"RLE_COMPRESSION":s.lines=1,s.uncompress=L;break;case"ZIPS_COMPRESSION":s.lines=1,s.uncompress=D;break;case"ZIP_COMPRESSION":s.lines=16,s.uncompress=D;break;case"PIZ_COMPRESSION":s.lines=32,s.uncompress=k;break;case"PXR24_COMPRESSION":s.lines=16,s.uncompress=U;break;case"DWAA_COMPRESSION":s.lines=32,s.uncompress=O;break;case"DWAB_COMPRESSION":s.lines=256,s.uncompress=O;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(s.scanlineBlockSize=s.lines,1==s.type)switch(r){case It:s.getter=Y,s.inputSize=2;break;case Pt:s.getter=q,s.inputSize=2}else{if(2!=s.type)throw"EXRLoader.parse: unsupported pixelType "+s.type+" for "+e.compression+".";switch(r){case It:s.getter=G,s.inputSize=4;break;case Pt:s.getter=W,s.inputSize=4}}s.blockCount=(e.dataWindow.yMax+1)/s.scanlineBlockSize;for(var a=0;a<s.blockCount;a++)H(t,i);s.outputChannels=3==s.channels?4:s.channels;const o=s.width*s.height*s.outputChannels;switch(r){case It:s.byteArray=new Float32Array(o),s.channels<s.outputChannels&&s.byteArray.fill(1,0,o);break;case Pt:s.byteArray=new Uint16Array(o),s.channels<s.outputChannels&&s.byteArray.fill(15360,0,o)}return s.bytesPerLine=s.width*s.inputSize*s.channels,4==s.outputChannels?s.format=Bt:s.format=Vt,Sv?s.colorSpace="srgb-linear":s.encoding=3e3,s}(Q,$,J,K,this.type),te={value:0},ne={R:0,G:1,B:2,A:3,Y:0};for(let ie=0;ie<ee.height/ee.scanlineBlockSize;ie++){const e=z($,K);ee.size=z($,K),ee.lines=e+ee.scanlineBlockSize>ee.height?ee.height-e:ee.scanlineBlockSize;const t=ee.size<ee.lines*ee.bytesPerLine?ee.uncompress(ee):P(ee);K.value+=ee.size;for(let n=0;n<ee.scanlineBlockSize;n++){const e=n+ie*ee.scanlineBlockSize;if(e>=ee.height)break;for(let i=0;i<ee.channels;i++){const r=ne[Q.channels[i].name];for(let s=0;s<ee.width;s++){te.value=(n*(ee.channels*ee.width)+i*ee.width+s)*ee.inputSize;const a=(ee.height-1-e)*(ee.width*ee.outputChannels)+s*ee.outputChannels+r;ee.byteArray[a]=ee.getter(t,te)}}}}return{header:Q,width:ee.width,height:ee.height,data:ee.byteArray,format:ee.format,[Sv?"colorSpace":"encoding"]:ee[Sv?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,(function(e,n){Sv?e.colorSpace=n.colorSpace:e.encoding=n.encoding,e.minFilter=bt,e.magFilter=bt,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,n)}),n,i)}}function Ev(e,t,n,i){var r;return(r=class extends Js{constructor(i){super({vertexShader:t,fragmentShader:n,...i});for(const t in e)this.uniforms[t]=new bd(e[t]),Object.defineProperty(this,t,{get(){return this.uniforms[t].value},set(e){this.uniforms[t].value=e}});this.uniforms=$s.clone(this.uniforms)}}).key=ci.generateUUID(),r}function Av(e,t,i){const r=Kf((e=>e.size)),s=Kf((e=>e.viewport)),a="number"==typeof e?e:r.width*s.dpr,o=r.height*s.dpr,l=("number"==typeof e?i:e)||{},{samples:c=0,depth:h,...d}=l,u=null!=h?h:l.depthBuffer,p=n.useMemo((()=>{const e=new zi(a,o,{minFilter:bt,magFilter:bt,type:Pt,...d});return u&&(e.depthTexture=new sl(a,o,It)),e.samples=c,e}),[]);return n.useLayoutEffect((()=>{p.setSize(a,o),c&&(p.samples=c)}),[c,p,a,o]),n.useEffect((()=>()=>p.dispose()),[]),p}const Cv=Ev({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");class Rv extends kc{constructor(e=6,t=!1){super(),this.uniforms={chromaticAberration:{value:.05},transmission:{value:0},_transmission:{value:1},transmissionMap:{value:null},roughness:{value:0},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:1/0},attenuationColor:{value:new ls("white")},anisotropicBlur:{value:.1},time:{value:0},distortion:{value:0},distortionScale:{value:.5},temporalDistortion:{value:0},buffer:{value:null}},this.onBeforeCompile=n=>{n.uniforms={...n.uniforms,...this.uniforms},this.anisotropy>0&&(n.defines.USE_ANISOTROPY=""),t?n.defines.USE_SAMPLER="":n.defines.USE_TRANSMISSION="",n.fragmentShader="\n      uniform float chromaticAberration;         \n      uniform float anisotropicBlur;      \n      uniform float time;\n      uniform float distortion;\n      uniform float distortionScale;\n      uniform float temporalDistortion;\n      uniform sampler2D buffer;\n\n      vec3 random3(vec3 c) {\n        float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n        vec3 r;\n        r.z = fract(512.0*j);\n        j *= .125;\n        r.x = fract(512.0*j);\n        j *= .125;\n        r.y = fract(512.0*j);\n        return r-0.5;\n      }\n\n      uint hash( uint x ) {\n        x += ( x << 10u );\n        x ^= ( x >>  6u );\n        x += ( x <<  3u );\n        x ^= ( x >> 11u );\n        x += ( x << 15u );\n        return x;\n      }\n\n      // Compound versions of the hashing algorithm I whipped together.\n      uint hash( uvec2 v ) { return hash( v.x ^ hash(v.y)                         ); }\n      uint hash( uvec3 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z)             ); }\n      uint hash( uvec4 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z) ^ hash(v.w) ); }\n\n      // Construct a float with half-open range [0:1] using low 23 bits.\n      // All zeroes yields 0.0, all ones yields the next smallest representable value below 1.0.\n      float floatConstruct( uint m ) {\n        const uint ieeeMantissa = 0x007FFFFFu; // binary32 mantissa bitmask\n        const uint ieeeOne      = 0x3F800000u; // 1.0 in IEEE binary32\n        m &= ieeeMantissa;                     // Keep only mantissa bits (fractional part)\n        m |= ieeeOne;                          // Add fractional part to 1.0\n        float  f = uintBitsToFloat( m );       // Range [1:2]\n        return f - 1.0;                        // Range [0:1]\n      }\n\n      // Pseudo-random value in half-open range [0:1].\n      float randomBase( float x ) { return floatConstruct(hash(floatBitsToUint(x))); }\n      float randomBase( vec2  v ) { return floatConstruct(hash(floatBitsToUint(v))); }\n      float randomBase( vec3  v ) { return floatConstruct(hash(floatBitsToUint(v))); }\n      float randomBase( vec4  v ) { return floatConstruct(hash(floatBitsToUint(v))); }\n      float rand(float seed) {\n        float result = randomBase(vec3(gl_FragCoord.xy, seed));\n        return result;\n      }\n\n      const float F3 =  0.3333333;\n      const float G3 =  0.1666667;\n\n      float snoise(vec3 p) {\n        vec3 s = floor(p + dot(p, vec3(F3)));\n        vec3 x = p - s + dot(s, vec3(G3));\n        vec3 e = step(vec3(0.0), x - x.yzx);\n        vec3 i1 = e*(1.0 - e.zxy);\n        vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n        vec3 x1 = x - i1 + G3;\n        vec3 x2 = x - i2 + 2.0*G3;\n        vec3 x3 = x - 1.0 + 3.0*G3;\n        vec4 w, d;\n        w.x = dot(x, x);\n        w.y = dot(x1, x1);\n        w.z = dot(x2, x2);\n        w.w = dot(x3, x3);\n        w = max(0.6 - w, 0.0);\n        d.x = dot(random3(s), x);\n        d.y = dot(random3(s + i1), x1);\n        d.z = dot(random3(s + i2), x2);\n        d.w = dot(random3(s + 1.0), x3);\n        w *= w;\n        w *= w;\n        d *= w;\n        return dot(d, vec4(52.0));\n      }\n\n      float snoiseFractal(vec3 m) {\n        return 0.5333333* snoise(m)\n              +0.2666667* snoise(2.0*m)\n              +0.1333333* snoise(4.0*m)\n              +0.0666667* snoise(8.0*m);\n      }\n"+n.fragmentShader,n.fragmentShader=n.fragmentShader.replace("#include <transmission_pars_fragment>","\n        #ifdef USE_TRANSMISSION\n          // Transmission code is based on glTF-Sampler-Viewer\n          // https://github.com/KhronosGroup/glTF-Sample-Viewer\n          uniform float _transmission;\n          uniform float thickness;\n          uniform float attenuationDistance;\n          uniform vec3 attenuationColor;\n          #ifdef USE_TRANSMISSIONMAP\n            uniform sampler2D transmissionMap;\n          #endif\n          #ifdef USE_THICKNESSMAP\n            uniform sampler2D thicknessMap;\n          #endif\n          uniform vec2 transmissionSamplerSize;\n          uniform sampler2D transmissionSamplerMap;\n          uniform mat4 modelMatrix;\n          uniform mat4 projectionMatrix;\n          varying vec3 vWorldPosition;\n          vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n            // Direction of refracted light.\n            vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n            // Compute rotation-independant scaling of the model matrix.\n            vec3 modelScale;\n            modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n            modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n            modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n            // The thickness is specified in local space.\n            return normalize( refractionVector ) * thickness * modelScale;\n          }\n          float applyIorToRoughness( const in float roughness, const in float ior ) {\n            // Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n            // an IOR of 1.5 results in the default amount of microfacet refraction.\n            return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n          }\n          vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n            float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );            \n            #ifdef USE_SAMPLER\n              #ifdef texture2DLodEXT\n                return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);\n              #else\n                return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);\n              #endif\n            #else\n              return texture2D(buffer, fragCoord.xy);\n            #endif\n          }\n          vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n            if ( isinf( attenuationDistance ) ) {\n              // Attenuation distance is +, i.e. the transmitted color is not attenuated at all.\n              return radiance;\n            } else {\n              // Compute light attenuation using Beer's law.\n              vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n              vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law\n              return transmittance * radiance;\n            }\n          }\n          vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n            const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n            const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n            const in vec3 attenuationColor, const in float attenuationDistance ) {\n            vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n            vec3 refractedRayExit = position + transmissionRay;\n            // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n            vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n            vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n            refractionCoords += 1.0;\n            refractionCoords /= 2.0;\n            // Sample framebuffer to get pixel the refracted ray hits.\n            vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n            vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n            // Get the specular component.\n            vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n            return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n          }\n        #endif\n"),n.fragmentShader=n.fragmentShader.replace("#include <transmission_fragment>",`  \n        // Improve the refraction to use the world pos\n        material.transmission = _transmission;\n        material.transmissionAlpha = 1.0;\n        material.thickness = thickness;\n        material.attenuationDistance = attenuationDistance;\n        material.attenuationColor = attenuationColor;\n        #ifdef USE_TRANSMISSIONMAP\n          material.transmission *= texture2D( transmissionMap, vUv ).r;\n        #endif\n        #ifdef USE_THICKNESSMAP\n          material.thickness *= texture2D( thicknessMap, vUv ).g;\n        #endif\n        \n        vec3 pos = vWorldPosition;\n        float runningSeed = 0.0;\n        vec3 v = normalize( cameraPosition - pos );\n        vec3 n = inverseTransformDirection( normal, viewMatrix );\n        vec3 transmission = vec3(0.0);\n        float transmissionR, transmissionB, transmissionG;\n        float randomCoords = rand(runningSeed++);\n        float thickness_smear = thickness * max(pow(roughnessFactor, 0.33), anisotropicBlur);\n        vec3 distortionNormal = vec3(0.0);\n        vec3 temporalOffset = vec3(time, -time, -time) * temporalDistortion;\n        if (distortion > 0.0) {\n          distortionNormal = distortion * vec3(snoiseFractal(vec3((pos * distortionScale + temporalOffset))), snoiseFractal(vec3(pos.zxy * distortionScale - temporalOffset)), snoiseFractal(vec3(pos.yxz * distortionScale + temporalOffset)));\n        }\n        for (float i = 0.0; i < ${e}.0; i ++) {\n          vec3 sampleNorm = normalize(n + roughnessFactor * roughnessFactor * 2.0 * normalize(vec3(rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5)) * pow(rand(runningSeed++), 0.33) + distortionNormal);\n          transmissionR = getIBLVolumeRefraction(\n            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness  + thickness_smear * (i + randomCoords) / float(${e}),\n            material.attenuationColor, material.attenuationDistance\n          ).r;\n          transmissionG = getIBLVolumeRefraction(\n            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior  * (1.0 + chromaticAberration * (i + randomCoords) / float(${e})) , material.thickness + thickness_smear * (i + randomCoords) / float(${e}),\n            material.attenuationColor, material.attenuationDistance\n          ).g;\n          transmissionB = getIBLVolumeRefraction(\n            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior * (1.0 + 2.0 * chromaticAberration * (i + randomCoords) / float(${e})), material.thickness + thickness_smear * (i + randomCoords) / float(${e}),\n            material.attenuationColor, material.attenuationDistance\n          ).b;\n          transmission.r += transmissionR;\n          transmission.g += transmissionG;\n          transmission.b += transmissionB;\n        }\n        transmission /= ${e}.0;\n        totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n`)},Object.keys(this.uniforms).forEach((e=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t})))}}const Nv=n.forwardRef((({buffer:e,transmissionSampler:t=!1,backside:i=!1,side:r=0,transmission:s=1,thickness:a=0,backsideThickness:o=0,backsideEnvMapIntensity:l=1,samples:c=10,resolution:h,backsideResolution:d,background:u,anisotropy:p,anisotropicBlur:m,...f},g)=>{lg({MeshTransmissionMaterial:Rv});const v=n.useRef(null),[x]=n.useState((()=>new Cv)),y=Av(d||h),_=Av(h);let b,w,M,S;return Qf((e=>{var n;(v.current.time=e.clock.elapsedTime,v.current.buffer!==_.texture||t)||(S=null==(n=v.current.__r3f.parent)?void 0:n.object,S&&(M=e.gl.toneMapping,b=e.scene.background,w=v.current.envMapIntensity,e.gl.toneMapping=0,u&&(e.scene.background=u),S.material=x,i&&(e.gl.setRenderTarget(y),e.gl.render(e.scene,e.camera),S.material=v.current,S.material.buffer=y.texture,S.material.thickness=o,S.material.side=1,S.material.envMapIntensity=l),e.gl.setRenderTarget(_),e.gl.render(e.scene,e.camera),S.material=v.current,S.material.thickness=a,S.material.side=r,S.material.buffer=_.texture,S.material.envMapIntensity=w,e.scene.background=b,e.gl.setRenderTarget(null),e.gl.toneMapping=M))})),n.useImperativeHandle(g,(()=>v.current),[]),n.createElement("meshTransmissionMaterial",Yg({args:[c,t],ref:v},f,{buffer:e||_.texture,_transmission:s,anisotropicBlur:null!=m?m:p,transmission:t?s:0,thickness:a,side:r}))})),Iv=1e-5;const Pv=n.forwardRef((function({args:[e=1,t=1,i=1]=[],radius:r=.05,steps:s=1,smoothness:a=4,bevelSegments:o=4,creaseAngle:l=.4,children:c,...h},d){return n.createElement("mesh",Yg({ref:d},h),n.createElement(Lv,{args:[e,t,i],radius:r,steps:s,smoothness:a,bevelSegments:o,creaseAngle:l}),c)})),Lv=n.forwardRef((function({args:[e=1,t=1,i=1]=[],radius:r=.05,steps:s=1,smoothness:a=4,bevelSegments:o=4,creaseAngle:l=.4,...c},h){const d=n.useMemo((()=>function(e,t,n){const i=new Bl,r=n-Iv;return i.absarc(Iv,Iv,Iv,-Math.PI/2,-Math.PI,!0),i.absarc(Iv,t-2*r,Iv,Math.PI,Math.PI/2,!0),i.absarc(e-2*r,t-2*r,Iv,Math.PI/2,0,!0),i.absarc(e-2*r,Iv,Iv,0,-Math.PI/2,!0),i}(e,t,r)),[e,t,r]),u=n.useMemo((()=>({depth:i-2*r,bevelEnabled:!0,bevelSegments:2*o,steps:s,bevelSize:r-Iv,bevelThickness:r,curveSegments:a})),[i,r,a,o,s]),p=n.useRef(null);return n.useLayoutEffect((()=>{p.current&&(p.current.center(),function(e,t=Math.PI/3){const n=Math.cos(t),i=100*(1+1e-10),r=[new ui,new ui,new ui],s=new ui,a=new ui,o=new ui,l=new ui;function c(e){return`${~~(e.x*i)},${~~(e.y*i)},${~~(e.z*i)}`}const h=e.index?e.toNonIndexed():e,d=h.attributes.position,u={};for(let f=0,g=d.count/3;f<g;f++){const e=3*f,t=r[0].fromBufferAttribute(d,e+0),n=r[1].fromBufferAttribute(d,e+1),i=r[2].fromBufferAttribute(d,e+2);s.subVectors(i,n),a.subVectors(t,n);const o=(new ui).crossVectors(s,a).normalize();for(let s=0;s<3;s++){const e=c(r[s]);e in u||(u[e]=[]),u[e].push(o)}}const p=new Float32Array(3*d.count),m=new bs(p,3,!1);for(let f=0,g=d.count/3;f<g;f++){const e=3*f,t=r[0].fromBufferAttribute(d,e+0),i=r[1].fromBufferAttribute(d,e+1),h=r[2].fromBufferAttribute(d,e+2);s.subVectors(h,i),a.subVectors(t,i),o.crossVectors(s,a).normalize();for(let s=0;s<3;s++){const t=u[c(r[s])];l.set(0,0,0);for(let e=0,i=t.length;e<i;e++){const i=t[e];o.dot(i)>n&&l.add(i)}l.normalize(),m.setXYZ(e+s,l.x,l.y,l.z)}}h.setAttribute("normal",m)}(p.current,l))}),[d,u,l]),n.useImperativeHandle(h,(()=>p.current)),n.createElement("extrudeGeometry",Yg({ref:p,args:[d,u]},c))})),Dv=(e,t,n)=>{let i;switch(e){case Tt:i=new Uint8ClampedArray(t*n*4);break;case Pt:i=new Uint16Array(t*n*4);break;case Nt:i=new Uint32Array(t*n*4);break;case Et:i=new Int8Array(t*n*4);break;case At:i=new Int16Array(t*n*4);break;case Rt:i=new Int32Array(t*n*4);break;case It:i=new Float32Array(t*n*4);break;default:throw new Error("Unsupported data type")}return i};let kv;class Uv{constructor(e){var t,n,i,r,s,a,o,l,c,h,d,u,p,m,f,g;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(Px){throw this._renderer.setRenderTarget(null),Px}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const v={format:Bt,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:void 0!==(null===(t=e.renderTargetOptions)||void 0===t?void 0:t.anisotropy)?null===(n=e.renderTargetOptions)||void 0===n?void 0:n.anisotropy:1,generateMipmaps:void 0!==(null===(i=e.renderTargetOptions)||void 0===i?void 0:i.generateMipmaps)&&(null===(r=e.renderTargetOptions)||void 0===r?void 0:r.generateMipmaps),magFilter:void 0!==(null===(s=e.renderTargetOptions)||void 0===s?void 0:s.magFilter)?null===(a=e.renderTargetOptions)||void 0===a?void 0:a.magFilter:bt,minFilter:void 0!==(null===(o=e.renderTargetOptions)||void 0===o?void 0:o.minFilter)?null===(l=e.renderTargetOptions)||void 0===l?void 0:l.minFilter:bt,samples:void 0!==(null===(c=e.renderTargetOptions)||void 0===c?void 0:c.samples)?null===(h=e.renderTargetOptions)||void 0===h?void 0:h.samples:void 0,wrapS:void 0!==(null===(d=e.renderTargetOptions)||void 0===d?void 0:d.wrapS)?null===(u=e.renderTargetOptions)||void 0===u?void 0:u.wrapS:gt,wrapT:void 0!==(null===(p=e.renderTargetOptions)||void 0===p?void 0:p.wrapT)?null===(m=e.renderTargetOptions)||void 0===m?void 0:m.wrapT:gt};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=Uv.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new ua,this._camera=new Lh,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((e,t,n,i)=>{if(void 0!==kv)return kv;const r=new zi(1,1,i);t.setRenderTarget(r);const s=new Gs(new bc,new us({color:16777215}));t.render(s,n),t.setRenderTarget(null);const a=Dv(e,r.width,r.height);return t.readRenderTargetPixels(r,0,0,r.width,r.height,a),r.dispose(),s.geometry.dispose(),s.material.dispose(),kv=0!==a[0],kv})(this._type,this._renderer,this._camera,v)){let e;if(this._type===Pt)e=this._renderer.extensions.has("EXT_color_buffer_float")?It:void 0;void 0!==e?this._type=e:this._supportsReadPixels=!1}this._quad=new Gs(new bc,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new zi(this.width,this.height,v),this._renderTarget.texture.mapping=void 0!==(null===(f=e.renderTargetOptions)||void 0===f?void 0:f.mapping)?null===(g=e.renderTargetOptions)||void 0===g?void 0:g.mapping:ct}static instantiateRenderer(){const e=new Bm;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=Dv(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new Xa(this.toArray(),this.width,this.height,Bt,this._type,(null==e?void 0:e.mapping)||ct,(null==e?void 0:e.wrapS)||gt,(null==e?void 0:e.wrapT)||gt,(null==e?void 0:e.magFilter)||bt,(null==e?void 0:e.minFilter)||bt,(null==e?void 0:e.anisotropy)||1,Un);return t.generateMipmaps=void 0!==(null==e?void 0:e.generateMipmaps)&&(null==e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof Js&&Object.values(this.material.uniforms).forEach((e=>{e.value instanceof Oi&&e.value.dispose()})),Object.values(this.material).forEach((e=>{e instanceof Oi&&e.dispose()})),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class Ov extends Js{constructor({gamma:e,offsetHdr:t,offsetSdr:n,gainMapMin:i,gainMapMax:r,maxDisplayBoost:s,hdrCapacityMin:a,hdrCapacityMax:o,sdr:l,gainMap:c}){super({name:"GainMapDecoderMaterial",vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\n// min half float value\n#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )\n// max half float value\n#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )\n\nuniform sampler2D sdr;\nuniform sampler2D gainMap;\nuniform vec3 gamma;\nuniform vec3 offsetHdr;\nuniform vec3 offsetSdr;\nuniform vec3 gainMapMin;\nuniform vec3 gainMapMax;\nuniform float weightFactor;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vec3 rgb = texture2D( sdr, vUv ).rgb;\n  vec3 recovery = texture2D( gainMap, vUv ).rgb;\n  vec3 logRecovery = pow( recovery, gamma );\n  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;\n  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;\n  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));\n  gl_FragColor = vec4( clampedHdrColor , 1.0 );\n}\n",uniforms:{sdr:{value:l},gainMap:{value:c},gamma:{value:new ui(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:(new ui).fromArray(t)},offsetSdr:{value:(new ui).fromArray(n)},gainMapMin:{value:(new ui).fromArray(i)},gainMapMax:{value:(new ui).fromArray(r)},weightFactor:{value:(Math.log2(s)-a)/(o-a)}},blending:0,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=s,this._hdrCapacityMin=a,this._hdrCapacityMax=o,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class Fv extends Error{}class Bv extends Error{}const zv=(e,t,n)=>{const i=new RegExp(`${t}="([^"]*)"`,"i").exec(e);if(i)return i[1];const r=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(r){const e=r[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map((e=>e.replace(/<\/?rdf:li>/g,""))):r[1].trim()}if(void 0!==n)return n;throw new Error(`Can't find ${t} in gainmap metadata`)};class jv{constructor(e){this.options={debug:!(!e||void 0===e.debug)&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise(((t,n)=>{this.options.debug;const i=new DataView(e.buffer);if(65496!==i.getUint16(0))return void n(new Error("Not a valid jpeg"));const r=i.byteLength;let s,a=2,o=0;for(;a<r;){if(++o>250)return void n(new Error(`Found no marker after ${o} loops `));if(255!==i.getUint8(a))return void n(new Error(`Not a valid marker at offset 0x${a.toString(16)}, found: 0x${i.getUint8(a).toString(16)}`));if(s=i.getUint8(a+1),226===s){const e=a+4;if(1297106432===i.getUint32(e)){const r=e+4;let s;if(18761===i.getUint16(r))s=!1;else{if(19789!==i.getUint16(r))return void n(new Error("No valid endianness marker found in TIFF header"));s=!0}if(42!==i.getUint16(r+2,!s))return void n(new Error("Not valid TIFF data! (no 0x002A marker)"));const a=i.getUint32(r+4,!s);if(a<8)return void n(new Error("Not valid TIFF data! (First offset less than 8)"));const o=r+a,l=i.getUint16(o,!s),c=o+2;let h=0;for(let e=c;e<c+12*l;e+=12)45057===i.getUint16(e,!s)&&(h=i.getUint32(e+8,!s));const d=o+2+12*l+4,u=[];for(let e=d;e<d+16*h;e+=16){const t={MPType:i.getUint32(e,!s),size:i.getUint32(e+4,!s),dataOffset:i.getUint32(e+8,!s),dependantImages:i.getUint32(e+12,!s),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=r+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,u.push(t)}if(this.options.extractNonFII&&u.length){const e=new Blob([i]),n=[];for(const t of u){if(t.isFII&&!this.options.extractFII)continue;const i=e.slice(t.start,t.end+1,"image/jpeg");n.push(i)}t(n)}}}a+=2+i.getUint16(a+2)}}))}}const Vv=async e=>{const t=(e=>{let t;t="undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):e.toString();let n=t.indexOf("<x:xmpmeta");for(;-1!==n;){const e=t.indexOf("x:xmpmeta>",n),i=t.slice(n,e+10);try{const e=zv(i,"hdrgm:GainMapMin","0"),t=zv(i,"hdrgm:GainMapMax"),n=zv(i,"hdrgm:Gamma","1"),r=zv(i,"hdrgm:OffsetSDR","0.015625"),s=zv(i,"hdrgm:OffsetHDR","0.015625"),a=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(i),o=a?a[1]:"0",l=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(i);if(!l)throw new Error("Incomplete gainmap metadata");const c=l[1];return{gainMapMin:Array.isArray(e)?e.map((e=>parseFloat(e))):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map((e=>parseFloat(e))):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(n)?n.map((e=>parseFloat(e))):[parseFloat(n),parseFloat(n),parseFloat(n)],offsetSdr:Array.isArray(r)?r.map((e=>parseFloat(e))):[parseFloat(r),parseFloat(r),parseFloat(r)],offsetHdr:Array.isArray(s)?s.map((e=>parseFloat(e))):[parseFloat(s),parseFloat(s),parseFloat(s)],hdrCapacityMin:parseFloat(o),hdrCapacityMax:parseFloat(c)}}catch(Px){}n=t.indexOf("<x:xmpmeta",e)}})(e);if(!t)throw new Bv("Gain map XMP metadata not found");const n=new jv({extractFII:!0,extractNonFII:!0}),i=await n.extract(e);if(2!==i.length)throw new Fv("Gain map recovery image not found");return{sdr:new Uint8Array(await i[0].arrayBuffer()),gainMap:new Uint8Array(await i[1].arrayBuffer()),metadata:t}},Hv=e=>new Promise(((t,n)=>{const i=document.createElement("img");i.onload=()=>{t(i)},i.onerror=e=>{n(e)},i.src=URL.createObjectURL(e)}));class Gv extends uh{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new hh}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer;const e=new Ov({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new Oi,sdr:new Oi});return new Uv({width:16,height:16,type:Pt,colorSpace:Un,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,n,i){const r=i?new Blob([i],{type:"image/jpeg"}):void 0,s=new Blob([n],{type:"image/jpeg"});let a,o,l=!1;if("undefined"==typeof createImageBitmap){const e=await Promise.all([r?Hv(r):Promise.resolve(void 0),Hv(s)]);o=e[0],a=e[1],l=!0}else{const e=await Promise.all([r?createImageBitmap(r,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(s,{imageOrientation:"flipY"})]);o=e[0],a=e[1]}const c=new Oi(o||new ImageData(2,2),ct,gt,gt,bt,St,Bt,Tt,1,Un);c.flipY=l,c.needsUpdate=!0;const h=new Oi(a,ct,gt,gt,bt,St,Bt,Tt,1,kn);h.flipY=l,h.needsUpdate=!0,e.width=a.width,e.height=a.height,e.material.gainMap=c,e.material.sdr=h,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class Wv extends Gv{load([e,t,n],i,r,s){const a=this.prepareQuadRenderer();let o,l,c;const h=async()=>{if(o&&l&&c){try{await this.render(a,c,o,l)}catch(r){return this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(n),"function"==typeof s&&s(r),void a.disposeOnDemandRenderer()}"function"==typeof i&&i(a),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(n),a.disposeOnDemandRenderer()}};let d=!0,u=0,p=0,m=!0,f=0,g=0,v=!0,x=0,y=0;const _=()=>{if("function"==typeof r){r(new ProgressEvent("progress",{lengthComputable:d&&m&&v,loaded:p+g+y,total:u+f+x}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(n);const b=new fh(this._internalLoadingManager);b.setResponseType("arraybuffer"),b.setRequestHeader(this.requestHeader),b.setPath(this.path),b.setWithCredentials(this.withCredentials),b.load(e,(async e=>{if("string"==typeof e)throw new Error("Invalid sdr buffer");o=e,await h()}),(e=>{d=e.lengthComputable,p=e.loaded,u=e.total,_()}),(t=>{this.manager.itemError(e),"function"==typeof s&&s(t)}));const w=new fh(this._internalLoadingManager);w.setResponseType("arraybuffer"),w.setRequestHeader(this.requestHeader),w.setPath(this.path),w.setWithCredentials(this.withCredentials),w.load(t,(async e=>{if("string"==typeof e)throw new Error("Invalid gainmap buffer");l=e,await h()}),(e=>{m=e.lengthComputable,g=e.loaded,f=e.total,_()}),(e=>{this.manager.itemError(t),"function"==typeof s&&s(e)}));const M=new fh(this._internalLoadingManager);return M.setRequestHeader(this.requestHeader),M.setPath(this.path),M.setWithCredentials(this.withCredentials),M.load(n,(async e=>{if("string"!=typeof e)throw new Error("Invalid metadata string");c=JSON.parse(e),await h()}),(e=>{v=e.lengthComputable,y=e.loaded,x=e.total,_()}),(e=>{this.manager.itemError(n),"function"==typeof s&&s(e)})),a}}class Xv extends Gv{load(e,t,n,i){const r=this.prepareQuadRenderer(),s=new fh(this._internalLoadingManager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(this.withCredentials),this.manager.itemStart(e),s.load(e,(async n=>{if("string"==typeof n)throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const s=new Uint8Array(n);let a,o,l;try{const e=await Vv(s);a=e.sdr,o=e.gainMap,l=e.metadata}catch(Px){if(!(Px instanceof Bv||Px instanceof Fv))throw Px;l={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},a=s}try{await this.render(r,l,a,o)}catch(c){return this.manager.itemError(e),"function"==typeof i&&i(c),void r.disposeOnDemandRenderer()}"function"==typeof t&&t(r),this.manager.itemEnd(e),r.disposeOnDemandRenderer()}),n,(t=>{this.manager.itemError(e),"function"==typeof i&&i(t)})),r}}const qv={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Yv="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Zv=e=>Array.isArray(e),$v=["./textures/px.png","./textures/nx.png","./textures/py.png","./textures/ny.png","./textures/pz.png","./textures/nz.png"];function Jv({files:e=$v,path:t="",preset:i,colorSpace:r,extensions:s}={}){i&&(ex(i),e=qv[i],t=Yv);const a=Zv(e),{extension:o,isCubemap:l}=tx(e),c=nx(o);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+e);const h=Kf((e=>e.gl));n.useLayoutEffect((()=>{"webp"!==o&&"jpg"!==o&&"jpeg"!==o||h.domElement.addEventListener("webglcontextlost",(function(){ng.clear(c,a?[e]:e)}),{once:!0})}),[e,h.domElement]);const d=ng(c,a?[e]:e,(e=>{"webp"!==o&&"jpg"!==o&&"jpeg"!==o||e.setRenderer(h),null==e.setPath||e.setPath(t),s&&s(e)}));let u=a?d[0]:d;var p;"jpg"!==o&&"jpeg"!==o&&"webp"!==o||(u=null==(p=u.renderTarget)?void 0:p.texture);return u.mapping=l?ht:ut,u.colorSpace=null!=r?r:l?"srgb":"srgb-linear",u}const Kv={files:$v,path:"",preset:void 0,extensions:void 0};Jv.preload=e=>{const t={...Kv,...e};let{files:n,path:i=""}=t;const{preset:r,extensions:s}=t;r&&(ex(r),n=qv[r],i=Yv);const{extension:a}=tx(n);if("webp"===a||"jpg"===a||"jpeg"===a)throw new Error("useEnvironment: Preloading gainmaps is not supported");const o=nx(a);if(!o)throw new Error("useEnvironment: Unrecognized file extension: "+n);ng.preload(o,Zv(n)?[n]:n,(e=>{null==e.setPath||e.setPath(i),s&&s(e)}))};const Qv={files:$v,preset:void 0};function ex(e){if(!(e in qv))throw new Error("Preset must be one of: "+Object.keys(qv).join(", "))}function tx(e){var t;const n=Zv(e)&&6===e.length,i=Zv(e)&&3===e.length&&e.some((e=>e.endsWith("json"))),r=Zv(e)?e[0]:e;return{extension:n?"cube":i?"webp":r.startsWith("data:application/exr")?"exr":r.startsWith("data:application/hdr")?"hdr":r.startsWith("data:image/jpeg")?"jpg":null==(t=r.split(".").pop())||null==(t=t.split("?"))||null==(t=t.shift())?void 0:t.toLowerCase(),isCubemap:n,isGainmap:i}}function nx(e){return"cube"===e?xh:"hdr"===e?Mv:"exr"===e?Tv:"jpg"===e||"jpeg"===e?Xv:"webp"===e?Wv:null}Jv.clear=e=>{const t={...Qv,...e};let{files:n}=t;const{preset:i}=t;i&&(ex(i),n=qv[i]);const{extension:r}=tx(n),s=nx(r);if(!s)throw new Error("useEnvironment: Unrecognized file extension: "+n);ng.clear(s,Zv(n)?[n]:n)};function ix(e,t,n,i,r={}){var s,a,o,l;r={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const c=(e=>{return(t=e).current&&t.current.isScene?e.current:e;var t})(t||n),h=c.background,d=c.environment,u={backgroundBlurriness:c.backgroundBlurriness,backgroundIntensity:c.backgroundIntensity,backgroundRotation:null!==(s=null==(a=c.backgroundRotation)||null==a.clone?void 0:a.clone())&&void 0!==s?s:[0,0,0],environmentIntensity:c.environmentIntensity,environmentRotation:null!==(o=null==(l=c.environmentRotation)||null==l.clone?void 0:l.clone())&&void 0!==o?o:[0,0,0]};return"only"!==e&&(c.environment=i),e&&(c.background=i),Vf(c,r),()=>{"only"!==e&&(c.environment=d),e&&(c.background=h),Vf(c,u)}}function rx({scene:e,background:t=!1,map:i,...r}){const s=Kf((e=>e.scene));return n.useLayoutEffect((()=>{if(i)return ix(t,e,s,i,r)})),null}function sx({background:e=!1,scene:t,blur:i,backgroundBlurriness:r,backgroundIntensity:s,backgroundRotation:a,environmentIntensity:o,environmentRotation:l,...c}){const h=Jv(c),d=Kf((e=>e.scene));return n.useLayoutEffect((()=>ix(e,t,d,h,{backgroundBlurriness:null!=i?i:r,backgroundIntensity:s,backgroundRotation:a,environmentIntensity:o,environmentRotation:l}))),n.useEffect((()=>()=>{h.dispose()}),[h]),null}function ax({children:e,near:t=.1,far:r=1e3,resolution:s=256,frames:a=1,map:o,background:l=!1,blur:c,backgroundBlurriness:h,backgroundIntensity:d,backgroundRotation:u,environmentIntensity:p,environmentRotation:m,scene:f,files:g,path:v,preset:x,extensions:y}){const _=Kf((e=>e.gl)),b=Kf((e=>e.scene)),w=n.useRef(null),[M]=n.useState((()=>new ua)),S=n.useMemo((()=>{const e=new aa(s);return e.texture.type=Pt,e}),[s]);n.useEffect((()=>()=>{S.dispose()}),[S]),n.useLayoutEffect((()=>{if(1===a){const e=_.autoClear;_.autoClear=!0,w.current.update(_,M),_.autoClear=e}return ix(l,f,b,S.texture,{backgroundBlurriness:null!=c?c:h,backgroundIntensity:d,backgroundRotation:u,environmentIntensity:p,environmentRotation:m})}),[e,M,S.texture,f,b,l,a,_]);let T=1;return Qf((()=>{if(a===1/0||T<a){const e=_.autoClear;_.autoClear=!0,w.current.update(_,M),_.autoClear=e,T++}})),n.createElement(n.Fragment,null,function(e,t,n){return i.jsx(Ag,{children:e,container:t,state:n})}(n.createElement(n.Fragment,null,e,n.createElement("cubeCamera",{ref:w,args:[t,r,S]}),g||x?n.createElement(sx,{background:!0,files:g,preset:x,path:v,extensions:y}):o?n.createElement(rx,{background:!0,map:o,extensions:y}):null),M))}function ox(e){var t,i,r,s;const a=Jv(e),o=e.map||a;n.useMemo((()=>lg({GroundProjectedEnvImpl:wv})),[]),n.useEffect((()=>()=>{a.dispose()}),[a]);const l=n.useMemo((()=>[o]),[o]),c=null==(t=e.ground)?void 0:t.height,h=null==(i=e.ground)?void 0:i.radius,d=null!==(r=null==(s=e.ground)?void 0:s.scale)&&void 0!==r?r:1e3;return n.createElement(n.Fragment,null,n.createElement(rx,Yg({},e,{map:o})),n.createElement("groundProjectedEnvImpl",{args:l,scale:d,height:c,radius:h}))}function lx(e){return e.ground?n.createElement(ox,e):e.map?n.createElement(rx,e):e.children?n.createElement(ax,e):n.createElement(sx,e)}function cx({barProps:e={},materialProps:t={},floatProps:r={},floatEnabled:s=!0}){const a=n.useRef(),{viewport:o,camera:l}=Kf(),c=n.useRef(0),h=Math.max(1,.96*o.width),d=Math.max(.25,Math.min(.9,.8*o.height)),{width:u=h,height:p=d,depth:m=.35,radius:f=Math.min(d/2,.4),smoothness:g=10,yOffset:v=0}=e,{amplitudeX:x=.25,amplitudeY:y=.4,speed:_=.35,rotationAmp:b=.06}=r;n.useEffect((()=>{l.position.set(0,0,8),l.near=.1,l.far=100,l.updateProjectionMatrix()}),[l]),Qf(((e,t)=>{if(!a.current)return;if(!s||0===_)return a.current.position.set(0,v,0),void a.current.rotation.set(0,0,0);c.current+=t*_;const n=c.current;a.current.position.x=Math.sin(.7*n)*x,a.current.position.y=v+Math.sin(n)*y,a.current.rotation.y=Math.sin(.4*n)*b,a.current.rotation.x=Math.cos(.25*n)*(.65*b)}));const w=n.useMemo((()=>({samples:10,resolution:256,transmission:1,roughness:.01,thickness:1,chromaticAberration:.003,anisotropy:.005,ior:1.12,distortion:0,distortionScale:0,temporalDistortion:0,attenuationColor:"#ffffff",attenuationDistance:500,clearcoat:1,clearcoatRoughness:.05,envMapIntensity:.25,...t})),[t]);return i.jsx("group",{ref:a,children:i.jsx(Pv,{args:[u,p,m],radius:f,smoothness:g,children:i.jsx(Nv,{...w})})})}function hx({mode:e="bar",lensProps:t,barProps:r,cubeProps:s,materialProps:a,floatProps:o,floatEnabled:l=!0,className:c,style:h,fullScreen:d=!0}){const u=function(){const[e,t]=n.useState(!1);return n.useEffect((()=>{var e;const n=window.matchMedia("(prefers-reduced-motion: reduce)"),i=()=>t(!!n.matches);return i(),null==(e=n.addEventListener)||e.call(n,"change",i),()=>{var e;return null==(e=n.removeEventListener)?void 0:e.call(n,"change",i)}}),[]),e}();if(function(){const[e,t]=n.useState(!1);return n.useEffect((()=>{var e;const n=window.matchMedia("(max-width: 1024px)"),i=()=>t(n.matches);return i(),null==(e=n.addEventListener)||e.call(n,"change",i),()=>{var e;return null==(e=n.removeEventListener)?void 0:e.call(n,"change",i)}}),[]),e}()||u)return null;const p=d?{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:0,pointerEvents:"none"}:{position:"absolute",inset:0,width:"100%",height:"100%",zIndex:0,pointerEvents:"none"};return i.jsx("div",{className:c,style:{...p,...h},"aria-hidden":"true",children:i.jsxs(qg,{dpr:[1,1.5],gl:{antialias:!0,alpha:!0},orthographic:!d,camera:d?{fov:45,position:[0,0,8]}:{position:[0,0,10],zoom:80},children:[i.jsx(lx,{preset:"city"}),i.jsx(cx,{barProps:r,materialProps:a,floatProps:o,floatEnabled:l})]})})}const dx=()=>{const{isDarkMode:e,toggleTheme:t}=n.useContext(ue),{currentColors:r}=n.useContext(fe),[s,a]=n.useState(!1),[o,l]=n.useState(!1),[c,u]=n.useState("home"),[p,m]=n.useState(!1);n.useEffect((()=>{let e=!1;const t=()=>{e||(window.requestAnimationFrame((()=>{a(window.scrollY>20);const t=["skills","expertise","prompt-engineering","projects","timeline"];let n="home";for(const e of t){const t=document.getElementById(e);if(t){const i=t.getBoundingClientRect();if(i.top<=100&&i.bottom>=100){n=e;break}}}u(n),e=!1})),e=!0)};return window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)}),[]);const f=[{id:"expertise",label:"Expertise",mobileLabel:"Expertise"},{id:"skills",label:"Skills",mobileLabel:"Skills"},{id:"prompt-engineering",label:"Prompt Systems",mobileLabel:"Prompts"},{id:"projects",label:"Projects",mobileLabel:"Projects"},{id:"timeline",label:"Timeline",mobileLabel:"Timeline"}];return i.jsxs(se.header,{className:"fixed w-full transition-all duration-500 "+(o?"z-50 py-3 sm:py-4 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700":s?"z-50 py-2 sm:py-3 border-b border-gray-200/20 dark:border-gray-800/20 shadow-sm":"z-50 py-3 sm:py-4 lg:py-5"),initial:{y:-100,opacity:0},animate:{y:0,opacity:1},transition:{duration:.6,ease:[.25,1,.5,1]},style:{willChange:"transform, opacity",backdropFilter:o?"saturate(120%) blur(10px)":void 0,WebkitBackdropFilter:o?"saturate(120%) blur(10px)":void 0},children:[i.jsx("div",{className:"absolute inset-0 pointer-events-none -z-10",style:{height:"100%"},children:i.jsx(hx,{fullScreen:!1,mode:"bar",barProps:{height:.78,depth:.3,radius:.28,smoothness:12,yOffset:0},materialProps:{transmission:1,ior:1.03,thickness:.5,roughness:.01,chromaticAberration:0,anisotropy:.005,envMapIntensity:.25,attenuationDistance:500,attenuationColor:"#ffffff"},floatProps:{amplitudeX:0,amplitudeY:0,speed:0,rotationAmp:0},floatEnabled:!1,style:{borderRadius:"9999px"}})}),i.jsxs("div",{className:"container mx-auto px-4 sm:px-6 flex justify-between items-center",children:[i.jsxs(se.a,{href:"#",className:"text-base sm:text-lg md:text-xl font-medium text-gray-900 dark:text-white lg:text-white flex items-center flex-shrink-0",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2,duration:.5},children:[i.jsx("span",{className:"hidden sm:flex w-5 md:w-6 h-5 md:h-6 mr-2 md:mr-3 items-center justify-center rounded-full border-2 opacity-80",style:{borderColor:r.primary,background:`linear-gradient(135deg, ${r.primary}20, ${r.secondary}20)`},children:i.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:r.primary}})}),i.jsx("span",{className:"font-medium tracking-tight",children:"Lokesh Kumar"}),i.jsx("span",{style:{color:r.primary},className:"ml-1",children:"A R"})]}),i.jsx("nav",{className:"hidden lg:flex items-center space-x-4 xl:space-x-8",children:f.map(((e,t)=>i.jsxs(se.a,{href:`#${e.id}`,onClick:t=>{t.preventDefault();const n=document.getElementById(e.id);if(n){Ne(n,{offset:80})}},className:"text-xs lg:text-sm xl:text-sm tracking-wide font-medium transition-all relative "+(c===e.id?"text-white":"text-white/70 hover:text-white"),initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.3+.1*t,duration:.5,ease:[.25,1,.5,1]},children:[e.label,c===e.id&&i.jsx(se.div,{className:"absolute -bottom-1 left-0 right-0 h-px",style:{backgroundColor:r.primary},layoutId:"activeNavIndicator",initial:{scaleX:0},animate:{scaleX:1},transition:{duration:.3,type:"spring",stiffness:300,damping:30}})]},e.id)))}),i.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 lg:space-x-6",children:[i.jsx(se.button,{onClick:t,className:"p-2 focus:outline-none relative flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200","aria-label":e?"Switch to light mode":"Switch to dark mode",initial:{opacity:0},animate:{opacity:1},whileTap:{scale:.95},transition:{delay:.5},children:e?i.jsx(h,{className:"w-4 h-4",style:{color:r.secondary}}):i.jsx(d,{className:"w-4 h-4",style:{color:r.primary}})}),i.jsx("div",{className:"hidden lg:flex flex-col items-end mr-2",children:i.jsx("button",{"data-ai-portfolio-btn":!0,onClick:()=>m(!0),className:"py-2 px-4 rounded-lg font-semibold text-white shadow-md transition-all duration-200 text-xs xl:text-sm",style:{background:`linear-gradient(90deg, ${r.primary}, ${r.secondary})`,boxShadow:`0 2px 8px 0 ${r.primary}40`},children:"My AI Generalist Portfolio"})}),i.jsxs(se.a,{href:"./Lokesh_Kumar_AR_Resume_2025.pdf",className:"hidden lg:flex py-2 px-3 xl:px-5 text-xs xl:text-sm font-medium text-white hover:text-white transition-colors relative group flex-shrink-0",target:"_blank",rel:"noopener noreferrer",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},onClick:e=>{e.stopPropagation()},children:[i.jsx("span",{className:"relative z-10",children:"Resume"}),i.jsx("span",{className:"absolute bottom-0 left-0 w-full h-px transition-all duration-300 group-hover:h-full",style:{background:"gray",backgroundImage:`linear-gradient(to right, ${r.primary}, ${r.secondary})`,opacity:.1}})]}),i.jsx(se.button,{onClick:()=>l(!o),className:"lg:hidden bg-transparent border-none flex-shrink-0",initial:{opacity:0},animate:{opacity:1},whileTap:{scale:.92},transition:{delay:.4},"aria-label":o?"Close menu":"Open menu","aria-expanded":o,children:i.jsxs("div",{className:"w-6 flex flex-col gap-[6px] items-end",children:[i.jsx(se.span,{className:"h-[1px] block",style:{background:e?"#fff":"#000"},animate:o?{rotate:45,y:7,width:"100%",backgroundColor:r.primary}:{rotate:0,width:"100%"},transition:{duration:.2}}),i.jsx(se.span,{className:"h-[1px] block",style:{background:e?"#fff":"#000"},animate:o?{opacity:0,width:0}:{opacity:1,width:"75%"},transition:{duration:.2}}),i.jsx(se.span,{className:"h-[1px] block",style:{background:e?"#fff":"#000"},animate:o?{rotate:-45,y:-7,width:"100%",backgroundColor:r.primary}:{rotate:0,width:"50%"},transition:{duration:.2}})]})})]})]}),i.jsx(ae,{children:o&&i.jsx(se.div,{className:"lg:hidden fixed top-0 left-0 right-0 bottom-0 z-[9999] bg-white dark:bg-gray-900",style:{height:"100vh",width:"100vw"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},children:i.jsxs("div",{className:"h-screen w-full flex flex-col",children:[i.jsxs("div",{className:"flex justify-between items-center px-4 sm:px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex-shrink-0",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("span",{className:"w-4 h-px mr-3",style:{backgroundColor:r.primary}}),i.jsxs("span",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["Lokesh Kumar ",i.jsx("span",{style:{color:r.primary},children:"A R"})]})]}),i.jsx("button",{onClick:()=>l(!1),className:"p-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors","aria-label":"Close menu",children:i.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsx("div",{className:"flex-1 bg-white dark:bg-gray-900 px-6 py-8 overflow-y-auto",children:i.jsx("nav",{className:"h-full",children:i.jsx("div",{className:"space-y-4",children:f.map(((t,n)=>i.jsx(se.a,{href:`#${t.id}`,className:"block text-xl font-medium py-6 px-4 rounded-lg transition-all duration-200 "+(c===t.id?"bg-gray-100 dark:bg-gray-800":"hover:bg-gray-50 dark:hover:bg-gray-800/50"),style:c===t.id?{color:r.primary}:{color:e?"#e5e7eb":"#374151"},onClick:e=>{e.preventDefault(),l(!1),setTimeout((()=>{const e=document.getElementById(t.id);if(e){Ne(e,{offset:80})}}),200)},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*n,duration:.3,ease:"easeOut"},children:i.jsxs("div",{className:"flex items-center",children:[c===t.id&&i.jsx(se.div,{className:"w-1 h-6 rounded-full mr-3",style:{backgroundColor:r.primary},layoutId:"mobileActiveIndicator",initial:{scaleY:0},animate:{scaleY:1},transition:{duration:.2}}),t.label]})},t.id)))})})}),i.jsxs("div",{className:"px-6 py-6 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex-shrink-0",children:[i.jsxs("div",{className:"mb-4",children:[i.jsx("span",{className:"block text-xs text-gray-600 dark:text-gray-300 mb-2",children:"Explore my advanced AI Generalist portfolioa dedicated site showcasing my real-world AI collaboration, live project dashboards, and unique 30-Day Challenge. This site demonstrates my ability to orchestrate, build, and deliver complex solutions with AI, beyond the standard portfolio."}),i.jsx("button",{"data-ai-portfolio-btn":!0,type:"button",onClick:()=>m(!0),className:"block w-full py-3 px-6 text-center text-white text-base font-semibold rounded-lg shadow-lg transition-all duration-200 hover:shadow-xl mb-2",style:{background:`linear-gradient(90deg, ${r.primary}, ${r.secondary})`,boxShadow:`0 2px 8px 0 ${r.primary}40`},children:"My AI Generalist Portfolio"})]}),i.jsx(se.a,{href:"./Lokesh_Kumar_AR_Resume_2025.pdf",className:"block w-full py-4 px-6 text-center text-white text-lg font-medium rounded-lg shadow-lg transition-all duration-200 hover:shadow-xl",style:{background:`linear-gradient(135deg, ${r.primary}, ${r.secondary})`},target:"_blank",rel:"noopener noreferrer",onClick:e=>{e.stopPropagation()},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.3,ease:"easeOut"},children:"Download Resume"})]})]})})}),i.jsx(ae,{children:p&&i.jsx(se.div,{className:"fixed inset-0 z-[99999] flex items-center justify-center bg-black/70",style:{top:0,left:0,width:"100vw",height:"100vh",position:"fixed"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:i.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl p-8 max-w-lg w-full text-center flex flex-col items-center",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white",children:"You are about to enter my other portfolio"}),i.jsx("p",{className:"mb-6 text-gray-700 dark:text-gray-300",children:"Explore my advanced AI Generalist portfolioa dedicated site showcasing my real-world AI collaboration, live project dashboards, and unique 30-Day Challenge. This site demonstrates my ability to orchestrate, build, and deliver complex solutions with AI, beyond the standard portfolio."}),i.jsx("button",{className:"mt-2 px-6 py-3 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold text-lg shadow-lg hover:shadow-xl transition-all",onClick:()=>{m(!1),window.location.href="https://lokeshkumar3103ar.github.io/Ai_portfolio/"},children:"Click to continue..."}),i.jsx("button",{className:"mt-4 text-sm text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 underline",onClick:()=>m(!1),children:"Cancel"})]})})})]})},ux=()=>{const e=(new Date).getFullYear(),t={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.7,ease:[.22,1,.36,1]}}};return i.jsxs("footer",{className:"bg-gray-50 dark:bg-gray-950 py-20 relative overflow-hidden",children:[i.jsx("div",{className:"absolute -top-40 left-0 w-64 h-64 bg-[#6366f1]/5 dark:bg-[#6366f1]/10 rounded-full blur-3xl"}),i.jsx("div",{className:"absolute right-0 bottom-0 w-96 h-96 bg-[#8b5cf6]/5 dark:bg-[#8b5cf6]/10 rounded-full blur-3xl"}),i.jsx("div",{className:"absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-800 to-transparent"}),i.jsxs("div",{className:"container mx-auto px-6 relative z-10",children:[i.jsxs(se.div,{className:"max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-12 gap-12 mb-16",initial:"hidden",whileInView:"visible",viewport:{once:!0,margin:"-100px"},variants:{visible:{transition:{staggerChildren:.1}}},children:[i.jsxs(se.div,{className:"md:col-span-5",variants:t,children:[i.jsxs("h3",{className:"text-2xl font-medium mb-6 tracking-tight flex items-center",children:[i.jsx("span",{children:"Lokesh Kumar"}),i.jsx("span",{className:"text-[#6366f1] dark:text-[#a78bfa] ml-2",children:"A R"})]}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8 leading-relaxed max-w-md",children:"Explore my journey as an AI/ML Engineer and creator of QritiQ where I build, orchestrate, and deliver real-world AI solutions. Passionate about structured prompt engineering, product thinking, and hands-on innovation across the AI stack."}),i.jsxs("div",{className:"flex space-x-6",children:[i.jsx("a",{href:"https://github.com/lokeshkumar3103ar",target:"_blank",rel:"noreferrer",className:"text-gray-500 dark:text-gray-400 hover:text-[#6366f1] dark:hover:text-[#a78bfa] transition-all","aria-label":"GitHub profile",children:i.jsx(u,{size:20})}),i.jsx("a",{href:"https://www.linkedin.com/in/lokesh-kumar-a-r-465218244/",target:"_blank",rel:"noreferrer",className:"text-gray-500 dark:text-gray-400 hover:text-[#6366f1] dark:hover:text-[#a78bfa] transition-all","aria-label":"LinkedIn profile",children:i.jsx(p,{size:20})}),i.jsx("a",{href:"mailto:lokeshkumar3103ar@gmail.com",className:"text-gray-500 dark:text-gray-400 hover:text-[#6366f1] dark:hover:text-[#a78bfa] transition-all","aria-label":"Email me",children:i.jsx(m,{size:20})})]})]}),i.jsx("div",{className:"md:col-span-2"}),i.jsxs(se.div,{variants:t,className:"md:col-span-2",children:[i.jsx("h3",{className:"text-xs uppercase tracking-wider font-medium text-gray-900 dark:text-gray-100 mb-6",children:"Navigation"}),i.jsxs("ul",{className:"space-y-4",children:[i.jsx("li",{children:i.jsx("a",{href:"#expertise",className:"text-gray-500 dark:text-gray-400 hover:text-[#6366f1] dark:hover:text-[#a78bfa] transition-all text-sm",children:"Expertise"})}),i.jsx("li",{children:i.jsx("a",{href:"#skills",className:"text-gray-500 dark:text-gray-400 hover:text-[#6366f1] dark:hover:text-[#a78bfa] transition-all text-sm",children:"Skills"})}),i.jsx("li",{children:i.jsx("a",{href:"#timeline",className:"text-gray-500 dark:text-gray-400 hover:text-[#6366f1] dark:hover:text-[#a78bfa] transition-all text-sm",children:"Timeline"})})]})]}),i.jsxs(se.div,{variants:t,className:"md:col-span-3",children:[i.jsx("h3",{className:"text-xs uppercase tracking-wider font-medium text-gray-900 dark:text-gray-100 mb-6",children:"Contact"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("a",{href:"tel:9489112725",className:"flex items-start text-gray-500 dark:text-gray-400 group",children:[i.jsx("div",{className:"mt-1 mr-3 text-gray-400 dark:text-gray-500 group-hover:text-[#6366f1] dark:group-hover:text-[#a78bfa] transition-all",children:i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{d:"M22 16.92V19.92C22 20.4704 21.7893 20.9983 21.4142 21.3734C21.0391 21.7484 20.5113 21.9591 19.96 21.96C16.4 22.25 12.93 21.26 10 19.08C7.36 17.14 5.14 14.92 3.2 12.28C1.02 9.34 0.0300002 5.87 0.32 2.31C0.325365 1.7613 0.538041 1.23712 0.912109 0.86287C1.28618 0.488619 1.81017 0.275113 2.36 0.27H5.36C6.35419 0.262111 7.2064 1.00182 7.38 1.98C7.50248 2.6541 7.68302 3.31511 7.92 3.95C8.14318 4.55611 8.03077 5.23201 7.62 5.73L6.29 7.06C8.10826 9.90421 10.4038 12.2884 13.28 14.14L14.61 12.81C15.1046 12.3992 15.78 12.2868 16.38 12.51C17.0253 12.7458 17.6863 12.9265 18.36 13.05C19.3452 13.2265 20.0747 14.0836 20.06 15.08L22 16.92Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),i.jsx("span",{className:"text-sm group-hover:text-[#6366f1] dark:group-hover:text-[#a78bfa] transition-all",children:"9489112725"})]}),i.jsxs("a",{href:"mailto:lokeshkumar3103ar@gmail.com",className:"flex items-start text-gray-500 dark:text-gray-400 group",children:[i.jsx("div",{className:"mt-1 mr-3 text-gray-400 dark:text-gray-500 group-hover:text-[#6366f1] dark:group-hover:text-[#a78bfa] transition-all",children:i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[i.jsx("path",{d:"M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),i.jsx("path",{d:"M22 6L12 13L2 6",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),i.jsx("span",{className:"text-sm group-hover:text-[#6366f1] dark:group-hover:text-[#a78bfa] transition-all",children:"lokeshkumar3103ar@gmail.com"})]}),i.jsxs("div",{className:"flex items-start text-gray-500 dark:text-gray-400",children:[i.jsx("div",{className:"mt-1 mr-3 text-gray-400 dark:text-gray-500",children:i.jsx(f,{size:16})}),i.jsx("span",{className:"text-sm",children:"Based in Chennai, India"})]})]}),i.jsxs(se.a,{href:"mailto:lokeshkumar3103ar@gmail.com",className:"inline-flex items-center gap-2 text-sm text-[#6366f1] dark:text-[#a78bfa] font-medium mt-6 group",whileHover:{x:4},transition:{type:"spring",stiffness:400,damping:15},children:[i.jsx("span",{children:"Get In Touch"}),i.jsx("svg",{className:"h-3 w-3 transition-transform group-hover:translate-x-1",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{d:"M6.66667 12.6667L12 7.33333L6.66667 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})]}),i.jsxs(se.div,{className:"relative pt-8 flex flex-col md:flex-row justify-between items-center",initial:{opacity:0},whileInView:{opacity:1},viewport:{once:!0},transition:{delay:.4,duration:.6},children:[i.jsx("div",{className:"absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-800 to-transparent"}),i.jsxs("p",{className:"text-gray-400 dark:text-gray-500 text-xs",children:[" ",e," Lokesh Kumar A R. All rights reserved."]}),i.jsx("div",{className:"flex items-center mt-4 md:mt-0",children:i.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-xs",children:"Built with React, Tailwind CSS & Framer Motion"})})]})]})]})};ie.registerPlugin(re);const px=({type:e="background",direction:t="up",speed:r=.2,children:s,className:a="",style:o={},...l})=>{const c=n.useRef(null);return n.useEffect((()=>{if(!c.current)return;const n=c.current;let i="0",s="0";switch(t){case"up":s=100*r+"%";break;case"down":s=`-${100*r}%`;break;case"left":i=100*r+"%";break;case"right":i=`-${100*r}%`}const a="background"===e?n.querySelector(".parallax-inner"):n;return a?(ie.fromTo(a,{y:"background"===e?-s:0,x:"background"===e?-i:0},{y:"background"===e?0:s,x:"background"===e?0:i,ease:"none",scrollTrigger:{trigger:n,start:"top bottom",end:"bottom top",scrub:!0}}),()=>{re.getAll().forEach((e=>{e.vars.trigger===n&&e.kill()}))}):void 0}),[e,t,r]),"background"===e?i.jsx("div",{ref:c,className:`relative overflow-hidden ${a}`,style:{...o,willChange:"transform"},...l,children:i.jsx("div",{className:"parallax-inner absolute inset-0",style:{height:"110%",width:"110%",top:"-5%",left:"-5%"},children:s})}):i.jsx("div",{ref:c,className:`parallax-element ${a}`,style:{...o,willChange:"transform"},...l,children:s})},mx=()=>{const{isDarkMode:e}=n.useContext(ue),{currentColors:t}=n.useContext(fe),r=n.useRef(null),s=n.useRef(null),[a,o]=n.useState("code"),[l,c]=n.useState(0),[h,d]=n.useState(""),[p,f]=n.useState(!0),[y,_]=n.useState(!1),b=[{type:"TINE Framework",code:'// TINE: There Is No Escape\n// Phase 1: Understanding Core Objective\nconst prompt = `\nAnalyze the user\'s true intent behind: "Explain AI"\n\nPhase 2: Initial Structuring\n- Define AI fundamentals\n- Structure response with clear headings\n- Include practical examples\n\nPhase 3: Recursive Improvement\n- Add deeper technical context\n- Expand with real-world applications\n- Include limitations and considerations\n\nPhase 4: External Perspective Check\n- Add expert viewpoints\n- Include contrasting opinions\n- Validate technical accuracy\n\nPhase 5: Finalization\n- Polish for clarity and flow\n- Ensure comprehensive coverage\n- Optimize for target audience\n`;'},{type:"SUPREME Code Blueprint",code:'// SUPREME: Prompt Engineering Blueprint\n// Objective: What does the user want?\nconst objective = "Generate startup pitch deck outline";\n\n// Context: Who is the user/model?\nconst context = "Early-stage founder, technical background";\n\n// Constraints: Length, tone, format\nconst constraints = "< 10 slides, investor-focused, compelling";\n\n// Steps: Break down expected behavior\nconst steps = [\n  "1. Problem identification",\n  "2. Solution overview", \n  "3. Market size & opportunity",\n  "4. Business model",\n  "5. Financial projections"\n];\n\n// Output Format: Table, list, paragraph\nconst format = "Structured slide-by-slide breakdown";\n`;'},{type:"IT DOC Structure",code:"// IT DOC: I'm the Developer of ChatGPT\n// Role Assignment\nconst systemPrompt = `\nYou are a senior software architect.\nYour task is to design a scalable API.\n\nStep-by-step logic:\n1. Analyze requirements thoroughly\n2. Design database schema\n3. Plan API endpoints\n4. Consider security measures\n5. Document implementation\n\nOutput format: Technical specification in Markdown\n- Use headers for sections\n- Include code examples\n- Add security considerations\n`;"},{type:"Chain of Thought",code:"// Chain of Thought Reasoning\nconst prompt = `\nThink step by step to solve this problem:\n\nProblem: How to reduce customer churn?\n\nStep 1: Identify churn indicators\n- Usage patterns\n- Support ticket frequency  \n- Engagement metrics\n\nStep 2: Analyze root causes\n- Product issues\n- Pricing concerns\n- Competition\n\nStep 3: Design intervention strategies\n- Proactive outreach\n- Feature improvements\n- Pricing adjustments\n\nStep 4: Implement and measure\n- A/B test interventions\n- Track success metrics\n- Iterate based on results\n`;"}],w=[{name:"Docker",icon:i.jsx("img",{src:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/docker.svg",alt:"Docker",className:"w-8 h-8"}),color:"text-blue-500",brand:"Container Platform"},{name:"Python",icon:i.jsx("img",{src:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/python.svg",alt:"Python",className:"w-8 h-8"}),color:"text-yellow-500",brand:"Programming Language"},{name:"GitHub Copilot",icon:i.jsxs("svg",{viewBox:"0 0 512 416",xmlns:"http://www.w3.org/2000/svg",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2",className:"w-8 h-8",children:[i.jsx("path",{d:"M181.33 266.143c0-11.497 9.32-20.818 20.818-20.818 11.498 0 20.819 9.321 20.819 20.818v38.373c0 11.497-9.321 20.818-20.819 20.818-11.497 0-20.818-9.32-20.818-20.818v-38.373zM308.807 245.325c-11.477 0-20.798 9.321-20.798 20.818v38.373c0 11.497 9.32 20.818 20.798 20.818 11.497 0 20.818-9.32 20.818-20.818v-38.373c0-11.497-9.32-20.818-20.818-20.818z",fillRule:"nonzero"}),i.jsx("path",{d:"M512.002 246.393v57.384c-.02 7.411-3.696 14.638-9.67 19.011C431.767 374.444 344.695 416 256 416c-98.138 0-196.379-56.542-246.33-93.21-5.975-4.374-9.65-11.6-9.671-19.012v-57.384a35.347 35.347 0 016.857-20.922l15.583-21.085c8.336-11.312 20.757-14.31 33.98-14.31 4.988-56.953 16.794-97.604 45.024-127.354C155.194 5.77 226.56 0 256 0c29.441 0 100.807 5.77 154.557 62.722 28.19 29.75 40.036 70.401 45.025 127.354 13.263 0 25.602 2.936 33.958 14.31l15.583 21.127c4.476 6.077 6.878 13.345 6.878 20.88zm-97.666-26.075c-.677-13.058-11.292-18.19-22.338-21.824-11.64 7.309-25.848 10.183-39.46 10.183-14.454 0-41.432-3.47-63.872-25.869-5.667-5.625-9.527-14.454-12.155-24.247a212.902 212.902 0 00-20.469-1.088c-6.098 0-13.099.349-20.551 1.088-2.628 9.793-6.509 18.622-12.155 24.247-22.4 22.4-49.418 25.87-63.872 25.87-13.612 0-27.86-2.855-39.501-10.184-11.005 3.613-21.558 8.828-22.277 21.824-1.17 24.555-1.272 49.11-1.375 73.645-.041 12.318-.082 24.658-.288 36.976.062 7.166 4.374 13.818 10.882 16.774 52.97 24.124 103.045 36.278 149.137 36.278 46.01 0 96.085-12.154 149.014-36.278 6.508-2.956 10.84-9.608 10.881-16.774.637-36.832.124-73.809-1.642-110.62h.041zM107.521 168.97c8.643 8.623 24.966 14.392 42.56 14.392 13.448 0 39.03-2.874 60.156-24.329 9.28-8.951 15.05-31.35 14.413-54.079-.657-18.231-5.769-33.28-13.448-39.665-8.315-7.371-27.203-10.574-48.33-8.644-22.399 2.238-41.267 9.588-50.875 19.833-20.798 22.728-16.323 80.317-4.476 92.492zm130.556-56.008c.637 3.51.965 7.35 1.273 11.517 0 2.875 0 5.77-.308 8.952 6.406-.636 11.847-.636 16.959-.636s10.553 0 16.959.636c-.329-3.182-.329-6.077-.329-8.952.329-4.167.657-8.007 1.294-11.517-6.735-.637-12.812-.965-17.924-.965s-11.21.328-17.924.965zm49.275-8.008c-.637 22.728 5.133 45.128 14.413 54.08 21.105 21.454 46.708 24.328 60.155 24.328 17.596 0 33.918-5.769 42.561-14.392 11.847-12.175 16.322-69.764-4.476-92.492-9.608-10.245-28.476-17.595-50.875-19.833-21.127-1.93-40.015 1.273-48.33 8.644-7.679 6.385-12.791 21.434-13.448 39.665z"})]}),color:"text-orange-500",brand:"Anthropic AI"},{name:"Gemini",icon:i.jsxs("svg",{fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",className:"w-8 h-8",children:[i.jsx("path",{d:"M16 8.016A8.522 8.522 0 008.016 16h-.032A8.521 8.521 0 000 8.016v-.032A8.521 8.521 0 007.984 0h.032A8.522 8.522 0 0016 7.984v.032z",fill:"url(#prefix__paint0_radial_980_20147)"}),i.jsx("defs",{children:i.jsxs("radialGradient",{id:"prefix__paint0_radial_980_20147",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"matrix(16.1326 5.4553 -43.70045 129.2322 1.588 6.503)",children:[i.jsx("stop",{offset:".067",stopColor:"#9168C0"}),i.jsx("stop",{offset:".343",stopColor:"#5684D1"}),i.jsx("stop",{offset:".672",stopColor:"#1BA1E3"})]})})]}),color:"text-blue-600",brand:"Google AI"},{name:"VS Code",icon:i.jsx("img",{src:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/visualstudiocode.svg",alt:"VS Code",className:"w-8 h-8"}),color:"text-blue-600",brand:"Code Editor"},{name:"Cursor",icon:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 48 48",className:"w-8 h-8",children:[i.jsx("polygon",{fill:"#bcbcbc",points:"23.974,4 6.97,14 6.97,34 23.998,44 40.97,34 40.97,14"}),i.jsx("line",{x1:"7.97",x2:"23.579",y1:"33",y2:"24.454",fill:"none",stroke:"#bcbcbc",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"2"}),i.jsx("line",{x1:"23.972",x2:"23.966",y1:"5.903",y2:"15.864",fill:"none",stroke:"#bcbcbc",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"2"}),i.jsx("line",{x1:"39.97",x2:"32.97",y1:"33",y2:"29",fill:"none",stroke:"#bcbcbc",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"2"}),i.jsx("polygon",{fill:"#757575",points:"23.974,4 6.97,14 6.97,34 23.97,24"}),i.jsx("polygon",{fill:"#424242",points:"23.981,14 40.97,14 40.97,34 23.971,24"}),i.jsx("polygon",{fill:"#616161",fillRule:"evenodd",points:"40.97,14 23.966,17 23.974,4",clipRule:"evenodd"}),i.jsx("polygon",{fill:"#616161",fillRule:"evenodd",points:"6.97,14 23.981,16.881 23.966,24 6.97,34",clipRule:"evenodd"}),i.jsx("polygon",{fill:"#ededed",points:"6.97,14 23.97,24 23.998,44 40.97,14"})]}),color:"text-emerald-500",brand:"AI Editor"},{name:"OpenAI",icon:i.jsx("img",{src:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/openai.svg",alt:"OpenAI",className:"w-8 h-8"}),color:"text-green-500",brand:"GPT & ChatGPT"},{name:"Claude",icon:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",imageRendering:"optimizeQuality",fillRule:"evenodd",clipRule:"evenodd",viewBox:"0 0 512 509.64",className:"w-8 h-8",children:[i.jsx("path",{fill:"#D77655",d:"M115.612 0h280.775C459.974 0 512 52.026 512 115.612v278.415c0 63.587-52.026 115.612-115.613 115.612H115.612C52.026 509.639 0 457.614 0 394.027V115.612C0 52.026 52.026 0 115.612 0z"}),i.jsx("path",{fill:"#FCF2EE",fillRule:"nonzero",d:"M142.27 316.619l73.655-41.326 1.238-3.589-1.238-1.996-3.589-.001-12.31-.759-42.084-1.138-36.498-1.516-35.361-1.896-8.897-1.895-8.34-10.995.859-5.484 7.482-5.03 10.717.935 23.683 1.617 35.537 2.452 25.782 1.517 38.193 3.968h6.064l.86-2.451-2.073-1.517-1.618-1.517-36.776-24.922-39.81-26.338-20.852-15.166-11.273-7.683-5.687-7.204-2.451-15.721 10.237-11.273 13.75.935 3.513.936 13.928 10.716 29.749 23.027 38.848 28.612 5.687 4.727 2.275-1.617.278-1.138-2.553-4.271-21.13-38.193-22.546-38.848-10.035-16.101-2.654-9.655c-.935-3.968-1.617-7.304-1.617-11.374l11.652-15.823 6.445-2.073 15.545 2.073 6.547 5.687 9.655 22.092 15.646 34.78 24.265 47.291 7.103 14.028 3.791 12.992 1.416 3.968 2.449-.001v-2.275l1.997-26.641 3.69-32.707 3.589-42.084 1.239-11.854 5.863-14.206 11.652-7.683 9.099 4.348 7.482 10.716-1.036 6.926-4.449 28.915-8.72 45.294-5.687 30.331h3.313l3.792-3.791 15.342-20.372 25.782-32.227 11.374-12.789 13.27-14.129 8.517-6.724 16.1-.001 11.854 17.617-5.307 18.199-16.581 21.029-13.75 17.819-19.716 26.54-12.309 21.231 1.138 1.694 2.932-.278 44.536-9.479 24.062-4.347 28.714-4.928 12.992 6.066 1.416 6.167-5.106 12.613-30.71 7.583-36.018 7.204-53.636 12.689-.657.48.758.935 24.164 2.275 10.337.556h25.301l47.114 3.514 12.309 8.139 7.381 9.959-1.238 7.583-18.957 9.655-25.579-6.066-59.702-14.205-20.474-5.106-2.83-.001v1.694l17.061 16.682 31.266 28.233 39.152 36.397 1.997 8.999-5.03 7.102-5.307-.758-34.401-25.883-13.27-11.651-30.053-25.302-1.996-.001v2.654l6.926 10.136 36.574 54.975 1.895 16.859-2.653 5.485-9.479 3.311-10.414-1.895-21.408-30.054-22.092-33.844-17.819-30.331-2.173 1.238-10.515 113.261-4.929 5.788-11.374 4.348-9.478-7.204-5.03-11.652 5.03-23.027 6.066-30.052 4.928-23.886 4.449-29.674 2.654-9.858-.177-.657-2.173.278-22.37 30.71-34.021 45.977-26.919 28.815-6.445 2.553-11.173-5.789 1.037-10.337 6.243-9.2 37.257-47.392 22.47-29.371 14.508-16.961-.101-2.451h-.859l-98.954 64.251-17.618 2.275-7.583-7.103.936-11.652 3.589-3.791 29.749-20.474-.101.102.024.101z"})]}),color:"text-orange-500",brand:"Anthropic AI"}],{scrollYProgress:M}=oe({target:r,offset:["start start","end start"]}),S=le(M,[0,1],["0%","30%"]),T=le(M,[0,.8],[1,0]);return n.useEffect((()=>{if("code"!==a)return;const e=b[l].code;let t=0;d(""),f(!0),s.current&&s.current.scrollTo({top:0,behavior:"smooth"});const n=setInterval((()=>{if(t<=e.length){const n=e.slice(0,t);if(d(n),t%5==0&&s.current){const e=s.current,t=e.querySelector("pre");if(t){const n=e.clientHeight,i=t.scrollHeight;if(i>n){const t=Math.max(0,i-n+30);Math.abs(e.scrollTop-t)>20&&e.scrollTo({top:t,behavior:"smooth"})}}}t+=2}else clearInterval(n),f(!1),setTimeout((()=>{o("icons")}),2e3)}),10);return()=>clearInterval(n)}),[l,a]),n.useEffect((()=>{if("icons"===a){const e=setTimeout((()=>{c((e=>(e+1)%b.length)),o("code")}),3e3);return()=>clearTimeout(e)}}),[a]),n.useEffect((()=>{const e=ie.timeline({defaults:{ease:"power3.out"}}),t=document.querySelectorAll(".hero-title span"),n=document.querySelector(".hero-subtitle"),i=document.querySelector(".hero-cta");return t.length&&n&&i&&(e.fromTo(t,{y:120,opacity:0},{y:0,opacity:1,duration:1.2,stagger:.1}),e.fromTo(n,{y:20,opacity:0},{y:0,opacity:1,duration:.8},"-=0.6"),e.fromTo(i,{y:30,opacity:0},{y:0,opacity:1,duration:.8},"-=0.4")),()=>{e.kill()}}),[]),i.jsxs("section",{id:"hero-section",ref:r,className:"relative min-h-screen w-full overflow-hidden bg-grid-pattern flex flex-col",style:{position:"relative"},children:[i.jsx("div",{className:"container mx-auto px-4 sm:px-6 py-8 flex-1 flex items-center",children:i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 w-full items-center",children:[i.jsx(se.div,{style:{y:S,opacity:T},className:"z-10 lg:pr-8 order-2 lg:order-1 mt-4 lg:mt-0 text-center lg:text-left",children:i.jsxs(px,{type:"element",direction:"up",speed:.2,children:[i.jsxs("h1",{className:"hero-title text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold mb-4 text-gray-900 dark:text-white leading-tight",children:[i.jsx("span",{className:"inline-block overflow-hidden mr-2",children:"Hi, I'm"}),i.jsx("span",{className:"inline-block overflow-hidden text-indigo-600 dark:text-indigo-500",children:"Lokesh Kumar A R"})]}),i.jsxs("p",{className:"hero-subtitle text-lg sm:text-xl md:text-2xl mb-4 text-gray-700 dark:text-gray-300",children:[i.jsx("span",{className:"highlighted-role font-semibold",children:"AI/ML Engineer"})," |",i.jsx("span",{className:"highlighted-role font-semibold",children:" Creator of QritiQ"})]}),i.jsxs("div",{className:"hero-cta flex flex-col sm:flex-row flex-wrap justify-center lg:justify-start gap-4",children:[i.jsx("button",{onClick:()=>_(!0),className:"px-6 py-3 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white font-medium transition-all hover:shadow-lg hover:-translate-y-1 text-center",children:"Contact Me"}),i.jsx("a",{href:"./Lokesh_Kumar_AR_Resume_2025.pdf",target:"_blank",rel:"noopener noreferrer",className:"resume-btn px-6 py-3 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-medium transition-all hover:shadow-lg hover:-translate-y-1 text-center",children:i.jsxs("span",{className:"btn-content flex items-center justify-center",children:[i.jsx("span",{children:"Download CV"}),i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})]})})]})]})}),i.jsx(se.div,{style:{y:le(M,[0,1],["0%","50%"]),opacity:T},className:"z-10 w-full flex items-center justify-center order-1 lg:order-2 max-h-[35vh] sm:max-h-[40vh] md:max-h-[45vh] lg:h-[60vh]",children:i.jsx("div",{className:"w-full h-full relative flex items-center justify-center px-4 sm:px-0",children:i.jsx("div",{className:"relative w-full max-w-sm sm:max-w-md lg:max-w-lg h-72 sm:h-80 lg:h-96",children:i.jsx(ae,{mode:"wait",children:"code"===a?i.jsx(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5},className:"w-full h-full",children:i.jsxs("div",{className:"w-full h-full bg-gray-900 dark:bg-gray-800 rounded-lg shadow-2xl overflow-hidden border border-gray-700",children:[i.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-4 py-2 bg-gray-800 dark:bg-gray-700 border-b border-gray-700",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 bg-red-500 rounded-full"}),i.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 bg-yellow-500 rounded-full"}),i.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 bg-green-500 rounded-full"})]}),i.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-300 truncate max-w-[120px] sm:max-w-none",children:b[l].type}),i.jsx("div",{className:"w-12 sm:w-16"})]}),i.jsx("div",{ref:s,className:"p-2 sm:p-4 font-mono text-xs sm:text-sm h-56 sm:h-64 overflow-y-auto",style:{scrollBehavior:"smooth"},children:i.jsxs("pre",{className:"text-green-400 whitespace-pre-wrap break-words",children:[h,p&&i.jsx(se.span,{animate:{opacity:[1,0]},transition:{duration:.8,repeat:1/0},className:"text-white",children:"|"})]})})]})},"code"):i.jsx(se.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.5},className:"w-full h-full flex items-center justify-center",children:i.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 lg:gap-6 p-4 sm:p-6 lg:p-8 max-w-sm sm:max-w-none",children:w.map(((e,t)=>i.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1*t,repeat:1/0,repeatType:"reverse",repeatDelay:2},className:"flex flex-col items-center justify-center p-2 sm:p-3 lg:p-4 rounded-lg bg-white/10 dark:bg-gray-800/50 backdrop-blur-sm border border-gray-200/20 dark:border-gray-700/50",children:[i.jsx(se.div,{animate:{rotate:[0,10,-10,0],scale:[1,1.1,1]},transition:{duration:2,delay:.2*t,repeat:1/0},className:"text-2xl sm:text-3xl mb-1 sm:mb-2",children:e.icon}),i.jsx("span",{className:`text-xs font-medium ${e.color} dark:text-gray-300 text-center`,children:e.name}),e.brand&&i.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-center hidden sm:block",children:e.brand})]},e.name)))})},"icons")})})})})]})}),i.jsxs(se.div,{style:{opacity:le(M,[0,.2],[1,0])},className:"absolute bottom-4 md:bottom-8 left-1/2 transform -translate-x-1/2 flex flex-col items-center text-gray-600 dark:text-gray-400",children:[i.jsx("p",{className:"text-sm mb-2",children:"Scroll Down"}),i.jsx("div",{className:"w-6 h-10 border-2 border-gray-600 dark:border-gray-400 rounded-full flex justify-center",children:i.jsx(se.div,{className:"w-1.5 h-1.5 bg-gray-600 dark:bg-gray-400 rounded-full mt-2",animate:{y:[0,12,0],opacity:[1,.5,1]},transition:{duration:1.5,ease:"easeInOut",repeat:1/0,repeatType:"loop"}})})]}),i.jsx(ae,{children:y&&i.jsxs(se.div,{className:"absolute inset-0 z-[50] flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[i.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>_(!1)}),i.jsxs(se.div,{className:"relative z-50 bg-white dark:bg-gray-900 rounded-2xl shadow-2xl p-4 sm:p-6 md:p-8 m-4 w-full max-w-sm sm:max-w-md mx-auto",initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{duration:.3,ease:"easeOut"},children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Let's Connect!"}),i.jsx("button",{onClick:()=>_(!1),className:"p-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:i.jsx(g,{className:"w-5 h-5"})})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs(se.a,{href:"https://www.linkedin.com/in/lokesh-kumar-a-r-465218244/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all duration-200 group",whileHover:{x:5},whileTap:{scale:.98},children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center mr-4",style:{backgroundColor:"#0077B5"},children:i.jsx(v,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"LinkedIn"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Connect professionally"})]}),i.jsx("svg",{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),i.jsxs(se.a,{href:"https://github.com/lokeshkumar3103ar",target:"_blank",rel:"noopener noreferrer",className:"flex items-center p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all duration-200 group",whileHover:{x:5},whileTap:{scale:.98},children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center mr-4",style:{backgroundColor:e?"#fff":"#333"},children:i.jsx(u,{className:"w-6 h-6 "+(e?"text-black":"text-white")})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"GitHub"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"View my projects"})]}),i.jsx("svg",{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),i.jsxs(se.a,{href:"mailto:lokeshkumar3103ar@gmail.com",className:"flex items-center p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all duration-200 group",whileHover:{x:5},whileTap:{scale:.98},children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center mr-4",style:{backgroundColor:t.primary},children:i.jsx(m,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"Email"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"lokeshkumar3103ar@gmail.com"})]}),i.jsx("svg",{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),i.jsxs(se.a,{href:"tel:9489112725",className:"flex items-center p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all duration-200 group",whileHover:{x:5},whileTap:{scale:.98},children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center mr-4",style:{backgroundColor:t.secondary},children:i.jsx(x,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"Phone"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"+91 94891 12725"})]}),i.jsx("svg",{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),i.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:i.jsx("p",{className:"text-center text-sm text-gray-600 dark:text-gray-400",children:"I'd love to hear about your project ideas!"})})]})]})})]})},fx=[{title:"Prompt Engineering",description:"Specialist in designing and optimizing AI prompts using frameworks like TINE and IT DOC to achieve highly precise, context-aware, and goal-driven responses from LLMs.",icon:y,color:"#6366f1"},{title:"LLM Optimization",description:"Expert in fine-tuning and optimizing large language models for specific use cases, implementing local LLM deployment strategies, and enhancing model performance for production environments.",icon:_,color:"#8b5cf6"},{title:"AI Pipeline Development",description:"Advanced development of end-to-end AI pipelines, from data preprocessing and model integration to automated evaluation systems and real-time processing workflows.",icon:b,color:"#6366f1"},{title:"LLM Integration",description:"Seamless integration of large language models into applications, including API development, custom model deployment, and creating robust AI-powered solutions for real-world problems.",icon:w,color:"#8b5cf6"},{title:"Data Science & ML",description:"Skilled in Python-based data analytics, machine learning algorithms, processing, and visualization. Currently pursuing BS in Data Science from IIT Madras alongside B.Tech in CSE.",icon:M,color:"#6366f1"},{title:"MongoDB Associate Developer",description:"Proficient in MongoDB database design, NoSQL data modeling, aggregation pipelines, and building scalable database solutions for modern applications and AI systems.",icon:S,color:"#8b5cf6"},{title:"Academic Excellence",description:"Maintaining a CGPA of 9.64, demonstrating strong theoretical understanding and practical application of computer science and data science concepts.",icon:T,color:"#8b5cf6"},{title:"Python Programming",description:"Proficient in Python programming with focus on data processing, AI applications, and solving real-world problems through efficient code implementation.",icon:E,color:"#6366f1"},{title:"Data Literacy",description:"Certified in data literacy with strong abilities in understanding, interpreting, and communicating insights from complex datasets to drive decision-making.",icon:A,color:"#8b5cf6"}],gx=()=>{const e=n.useRef(null),{scrollYProgress:t}=oe({target:e,offset:["start end","end start"]});le(t,[0,1],["-10%","10%"]),le(t,[0,.2,.8,1],[.3,1,1,.3]);const r={hidden:{opacity:0,y:30},visible:{opacity:1,y:0,transition:{duration:.7,ease:[.22,1,.36,1]}}};return i.jsx("section",{id:"expertise",ref:e,className:"py-24 bg-gray-50 dark:bg-gray-950 relative",children:i.jsxs("div",{className:"container mx-auto px-6 relative z-10",children:[i.jsx(se.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:{duration:.6},className:"max-w-3xl mx-auto text-center mb-16",children:i.jsxs(px,{type:"element",direction:"up",speed:.3,children:[i.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4 tracking-tight",children:"Areas of Expertise"}),i.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Specialized knowledge in AI prompt engineering, data science, and Python programming, with focus on creating optimized AI solutions."})]})}),i.jsx(se.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.12}}},initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.1},children:fx.map(((e,t)=>i.jsx(px,{type:"element",direction:"up",speed:.1,delay:.05*t,children:i.jsx(se.div,{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg hover:shadow-lg transition-all duration-300 group",variants:r,whileHover:{y:-5},children:i.jsxs("div",{className:"p-8",children:[i.jsxs("div",{className:"w-12 h-12 flex items-center justify-center mb-6 rounded-sm relative",style:{backgroundColor:`${e.color}10`},children:[i.jsx(se.div,{initial:{scale:.8,opacity:.8},whileInView:{scale:1,opacity:1},transition:{delay:.2*t,duration:.5},children:i.jsx(e.icon,{className:"text-xl transition-transform duration-300 group-hover:scale-110",style:{color:e.color}})}),i.jsx(se.div,{className:"absolute bottom-0 left-0 h-0.5 bg-gradient-to-r",style:{backgroundImage:`linear-gradient(to right, ${e.color}80, ${e.color}20)`,width:"60%"},initial:{width:0,opacity:0},whileInView:{width:"60%",opacity:1},transition:{delay:.3+.1*t,duration:.5}})]}),i.jsx("h3",{className:"text-xl font-medium mb-3 group-hover:text-[#6366f1] dark:group-hover:text-[#a78bfa] transition-colors",children:e.title}),i.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm leading-relaxed",children:e.description})]})})},e.title)))})]})})},vx=[{name:"Python",category:"Programming",color:"#6366f1",layer:"input"},{name:"FastAPI",category:"Backend",color:"#8b5cf6",layer:"input"},{name:"MongoDB",category:"Database",color:"#6366f1",layer:"input"},{name:"Docker",category:"DevOps",color:"#8b5cf6",layer:"input"},{name:"AWS/Azure AI",category:"Cloud AI",color:"#6366f1",layer:"input"},{name:"Data Literacy",category:"Data Science",color:"#8b5cf6",layer:"input"},{name:"Research Skills",category:"General",color:"#6366f1",layer:"input"},{name:"Excel",category:"Tools",color:"#8b5cf6",layer:"input"},{name:"Data Analytics",category:"Data Science",color:"#6366f1",layer:"hidden"},{name:"Data Processing",category:"Data Science",color:"#8b5cf6",layer:"hidden"},{name:"LLM Optimization",category:"AI",color:"#6366f1",layer:"hidden"},{name:"AI Pipelines",category:"AI",color:"#8b5cf6",layer:"hidden"},{name:"Experimentation & Testing",category:"AI",color:"#6366f1",layer:"hidden"},{name:"Problem Solving",category:"General",color:"#8b5cf6",layer:"hidden"},{name:"Model Deployment",category:"MLOps",color:"#6366f1",layer:"hidden"},{name:"Ollama",category:"Local LLM",color:"#8b5cf6",layer:"hidden"},{name:"Prompt Engineering",category:"AI",color:"#6366f1",layer:"output"},{name:"LLM Integration",category:"AI",color:"#8b5cf6",layer:"output"},{name:"AI Model Interaction",category:"AI",color:"#6366f1",layer:"output"},{name:"RAG Systems",category:"AI Architecture",color:"#8b5cf6",layer:"output"},{name:"Multimodal AI",category:"Advanced AI",color:"#6366f1",layer:"output"},{name:"Agent Systems",category:"AI Architecture",color:"#8b5cf6",layer:"output"}],xx=()=>{var e,t,r,s;const[a,o]=n.useState(null),[l,c]=n.useState(null),[h,d]=n.useState({nodes:[],connections:[]}),[u,p]=n.useState(!1),m=n.useRef(null),[f,g]=n.useState({width:800,height:650}),v={input:{x:.15,color:"#10b981",label:"Input Layer"},hidden:{x:.5,color:"#f59e0b",label:"Processing Layer"},output:{x:.85,color:"#ef4444",label:"Output Layer"}};n.useEffect((()=>{const e=()=>{if(m.current){const e=m.current.getBoundingClientRect(),t={width:Math.max(e.width,320),height:Math.max(e.height,400)};g(t);const n=((e,t)=>{const n={input:[],hidden:[],output:[]};vx.forEach((e=>{n[e.layer].push(e)}));const i=[],r=t-160;return Object.keys(n).forEach((s=>{const a=n[s],o=v[s].x*e,l=a.length>1?r/(a.length-1):0,c=1===a.length?t/2:80;a.forEach(((t,n)=>{const r=1===a.length?c:c+n*l;let h;h=e<480?t.name.length>8?32:36:e<768?t.name.length>8?38:42:e<1024?t.name.length>8?44:48:t.name.length>8?50:54,i.push({id:vx.indexOf(t),skill:t,x:o,y:r,layer:s,size:h,originalX:o,originalY:r})}))})),i})(t.width,t.height),i=(e=>{const t=[],n=e.filter((e=>"input"===e.layer)),i=e.filter((e=>"hidden"===e.layer)),r=e.filter((e=>"output"===e.layer));return n.forEach((e=>{i.forEach((n=>{const i=.8*Math.random()+.2;t.push({id:`${e.id}-${n.id}`,from:e.id,to:n.id,strength:i,active:!1})}))})),i.forEach((e=>{r.forEach((n=>{const i=.8*Math.random()+.2;t.push({id:`${e.id}-${n.id}`,from:e.id,to:n.id,strength:i,active:!1})}))})),t})(n);d({nodes:n,connections:i}),p(!0)}},t=setTimeout(e,100),n=setTimeout(e,500),i=setTimeout(e,1e3);return window.addEventListener("resize",e),()=>{clearTimeout(t),clearTimeout(n),clearTimeout(i),window.removeEventListener("resize",e)}}),[]),n.useEffect((()=>{if(!u||0===h.connections.length)return;const e=setInterval((()=>{const e=h.connections[Math.floor(Math.random()*h.connections.length)];c(null==e?void 0:e.id),setTimeout((()=>c(null)),1500)}),2e3);return()=>clearInterval(e)}),[h.connections,u]);const x=()=>{o(null),d((e=>({...e,connections:e.connections.map((e=>({...e,active:!1})))})))};return i.jsxs("div",{ref:m,className:`relative w-full ${(()=>{if("undefined"!=typeof window){const e=window.innerWidth;return e<480?"h-[400px] sm:h-[450px]":e<768?"h-[500px]":e<1024?"h-[550px]":e<1440?"h-[600px]":"h-[650px]"}return"h-[650px]"})()} overflow-hidden mx-auto bg-gradient-to-br from-gray-50/90 to-gray-100/90 dark:from-gray-950/90 dark:to-gray-900/90 backdrop-blur-sm rounded-xl border border-gray-200/50 dark:border-gray-800/50 shadow-xl`,children:[i.jsx("div",{className:"absolute top-4 left-2 right-2 md:left-4 md:right-4 flex justify-between z-20",children:Object.entries(v).map((([e,t])=>i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"inline-block w-2 h-2 md:w-3 md:h-3 rounded-full mb-1",style:{backgroundColor:t.color}}),i.jsx("div",{className:"text-xs md:text-sm text-gray-600 dark:text-gray-400 font-medium",children:t.label})]},e)))}),(()=>{if(!h.nodes.length)return null;const e="undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"#d1d5db":"#9ca3af";return i.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none z-10",children:[i.jsxs("defs",{children:[i.jsxs("linearGradient",{id:"pulseGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[i.jsx("stop",{offset:"0%",stopColor:"transparent"}),i.jsx("stop",{offset:"30%",stopColor:"#60a5fa",stopOpacity:"0.8"}),i.jsx("stop",{offset:"70%",stopColor:"#3b82f6",stopOpacity:"1"}),i.jsx("stop",{offset:"100%",stopColor:"transparent"})]}),i.jsxs("filter",{id:"glow",children:[i.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),i.jsxs("feMerge",{children:[i.jsx("feMergeNode",{in:"coloredBlur"}),i.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),h.connections.map((t=>{const n=h.nodes.find((e=>e.id===t.from)),r=h.nodes.find((e=>e.id===t.to));if(!n||!r)return null;const s=t.active||a===t.from||a===t.to,o=l===t.id;return i.jsxs("g",{children:[i.jsx(se.line,{x1:n.x,y1:n.y,x2:r.x,y2:r.y,stroke:s?"#3b82f6":e,strokeWidth:s?2:1,strokeOpacity:s?.8:.7,initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1,delay:.5*Math.random()}}),o&&i.jsx(se.line,{x1:n.x,y1:n.y,x2:r.x,y2:r.y,stroke:"url(#pulseGradient)",strokeWidth:"4",initial:{pathLength:0,pathOffset:0},animate:{pathLength:1,pathOffset:1},transition:{duration:1.5,ease:"easeInOut"}})]},t.id)}))]})})(),h.nodes.length>0?h.nodes.map((e=>i.jsxs(se.div,{className:"absolute transform -translate-x-1/2 -translate-y-1/2 cursor-pointer z-20",style:{left:e.x,top:e.y},initial:{scale:0,opacity:0},animate:{scale:a===e.id?1.2:1,opacity:1},transition:{type:"spring",stiffness:200,damping:20,opacity:{delay:.03*e.id}},onMouseEnter:()=>{return t=e.id,o(t),void d((e=>({...e,connections:e.connections.map((e=>({...e,active:e.from===t||e.to===t})))})));var t},onMouseLeave:x,children:[i.jsx("div",{className:"absolute inset-0 rounded-full blur-md opacity-40",style:{width:e.size+10,height:e.size+10,backgroundColor:e.skill.color,top:-5,left:-5}}),i.jsx("div",{className:"relative rounded-full flex items-center justify-center text-white text-center border-2 border-white/20",style:{width:e.size,height:e.size,background:`radial-gradient(circle at 30% 30%, ${e.skill.color}99, ${e.skill.color})`,boxShadow:`0 4px 20px ${e.skill.color}40`},children:i.jsx("div",{className:"text-xs font-medium text-center leading-tight px-1",children:e.skill.name.split(" ").map(((t,n)=>i.jsx("div",{className:(e.size<40?"text-[0.45rem]":e.size<45?"text-[0.55rem]":"text-xs")+" leading-tight font-semibold",children:t},n)))})}),a===e.id&&i.jsx(se.div,{className:"absolute inset-0 rounded-full border-2 opacity-60",style:{borderColor:e.skill.color,width:e.size+16,height:e.size+16,top:-8,left:-8},initial:{scale:1,opacity:.6},animate:{scale:1.4,opacity:0},transition:{duration:1,repeat:1/0}})]},e.id))):i.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:i.jsxs("div",{className:"text-gray-500 text-center",children:[i.jsx("div",{className:"text-lg mb-2",children:""}),i.jsx("div",{children:"Loading Neural Network..."})]})}),null!==a&&h.nodes[a]&&i.jsxs(se.div,{className:"absolute z-30 bg-white dark:bg-gray-800 px-3 py-2 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 pointer-events-none max-w-xs",style:{left:Math.min((null==(e=h.nodes[a])?void 0:e.x)+30,f.width-150),top:Math.max((null==(t=h.nodes[a])?void 0:t.y)-40,10)},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.2},children:[i.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:null==(r=h.nodes[a])?void 0:r.skill.name}),i.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:null==(s=h.nodes[a])?void 0:s.skill.category})]})]})},yx=()=>i.jsxs("section",{id:"skills",className:"py-24 bg-gray-50 dark:bg-gray-950 relative",children:[i.jsx("div",{className:"absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-800 to-transparent"}),i.jsx("div",{className:"absolute -top-12 md:-top-24 left-12 md:left-24 w-32 h-32 md:w-64 md:h-64 bg-[#6366f1]/5 dark:bg-[#6366f1]/10 rounded-full blur-3xl"}),i.jsx("div",{className:"absolute -bottom-12 md:-bottom-24 right-12 md:right-24 w-48 h-48 md:w-96 md:h-96 bg-[#8b5cf6]/5 dark:bg-[#8b5cf6]/10 rounded-full blur-3xl"}),i.jsxs("div",{className:"container mx-auto px-4 md:px-6 relative z-10",children:[i.jsxs(se.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:{duration:.6},className:"max-w-3xl mx-auto text-center mb-12 md:mb-16",children:[i.jsx("h2",{className:"text-2xl md:text-3xl lg:text-4xl font-bold mb-4 tracking-tight",children:"My Skills"}),i.jsxs("p",{className:"text-base md:text-lg text-gray-600 dark:text-gray-300",children:["My expertise visualized as an interactive neural network. Each node represents a skill, with connections showing how they work together to solve complex problems.",i.jsx("span",{className:"block mt-2 md:mt-4 text-sm text-gray-500 dark:text-gray-400",children:"Hover over nodes to see connections and watch data flow through the network"})]})]}),i.jsx(xx,{})]})]}),_x={experience:[{title:"Lead AI/ML Engineer",company:"Imitate Labs (imitatelabs.ai)",period:"07/2025  Present",description:" Leading the AI/ML division at an innovative early-stage startup, architecting foundational infrastructure\n Designing custom ML model transformers and hybrid CNN-ViT architectures for multimedia processing\n Developing parameter-efficient fine-tuning techniques using LoRA for resource-constrained environments\n Creating model evaluation frameworks and end-to-end AI workflows from data processing to optimization\n Leading technical decision-making for AI/ML stack selection and establishing model training best practices"},{title:"AI Research and Development Intern",company:"Hindustan Institute of Technology and Science",period:"05/2025  07/2025",description:" Designed and developed QritiQ, an AI-powered Self-Intro Evaluation platform analyzing communication effectiveness\n Achieved 66% reduction in manual evaluation time while maintaining assessment depth and precision\n Integrated Whisper ASR models with LLM systems for automated speech and presentation evaluation\n Implemented local LLM deployment using Ollama and Mistral models achieving 80% cost reduction vs cloud APIs\n Secured university financial investment for commercialization and multi-institutional deployment"},{title:"Artificial Intelligence with Python Intern",company:"Cothon Solutions",period:"10/2024  11/2024",description:" Gained hands-on experience in Machine Learning and Deep Learning algorithms, including CNN and MTCNN\n Implemented image recognition and facial detection projects, enhancing practical ML application skills\n Developed comprehensive understanding of model training, evaluation metrics, and deployment challenges\n Adapted quickly to new concepts, independently researching unfamiliar algorithms and tools"}],education:[{degree:"Bachelor of Science - Data Science and Applications (Dual Degree)",institution:"Indian Institute of Technology (IIT) Madras",period:"01/2025  01/2028",description:" Specialization: Machine Learning, Deep Learning, Reinforcement Learning, Computer Vision, LLMs, AI Full Stack Dev"},{degree:"Bachelor of Technology - Computer Science Engineering",institution:"Hindustan Institute of Technology and Science",period:"07/2023  05/2027",description:" CGPA: 9.63/10 (Current) | Academic Rank: 2nd in Program | Certificate of Proficiency\n Core Focus: AI & Expert Systems, Machine Learning, Advanced Data Structures, Algorithms, DBMS, Software Testing"}],certifications:[{name:"Data Literacy Certification",institution:"DataCamp",period:"January 2024",description:"Certification in understanding, interpreting, and communicating with data effectively.",url:"https://www.datacamp.com/skill-verification/DL0038438163443"},{name:"GitHub Foundations Certification",institution:"GitHub",period:"January 2024",description:"Core skills in version control, collaboration, and project management using GitHub.",url:"https://www.credly.com/badges/36fa4d5c-c3ee-4a6c-963c-711dad64c17f/linked_in_profile"},{name:"Docker Foundations Professional Certificate",institution:"Docker",period:"July 2025",description:"Professional certificate covering Docker fundamentals, containerization, and best practices for modern DevOps workflows.",url:"https://www.linkedin.com/learning/certificates/1ebee18ee9fbadd14b0921a3f89f74ac07ffa98bacbc4ccc16d13d24b916f660"},{name:"BCG - GenAI Job Simulation",institution:"Forage",period:"October 2024",description:"Practical industry experience with GenAI applications in business contexts, developing skills in Python, chatbot development, data extraction, and NLP.",url:"https://forage-uploads-prod.s3.amazonaws.com/completion-certificates/BCG%20/gabev3vXhuACr48eb_SKZxezskWgmFjRvj9_DCjhenyD3WLu38uyq_1730366810021_completion_certificate.pdf"},{name:"Accenture North America - Data Analytics and Visualization Job Simulation",institution:"Forage",period:"October 2024",description:"Hands-on experience with data analytics and visualization in a simulated professional environment, tackling real-world business problems.",url:"https://forage-uploads-prod.s3.amazonaws.com/completion-certificates/Accenture%20North%20America/hzmoNKtzvAzXsEqx8_T6kdcdKSTfg2aotxT_DCjhenyD3WLu38uyq_1730215450995_completion_certificate.pdf"},{name:"ChatGPT Prompt Engineering for Developers",institution:"DeepLearning.AI",period:"March 2024",description:"Advanced certification in prompt engineering techniques for developers working with large language models.",url:"https://learn.deeplearning.ai/accomplishments/99c1427c-e3d9-426e-b7bf-44d69f2c71f8?usp=sharing"},{name:"Introduction to Generative AI",institution:"Google Cloud Skills Boost",period:"June 2023",description:"Fundamental concepts of generative AI, its applications, and implementation in the Google Cloud ecosystem.",url:"https://www.cloudskillsboost.google/public_profiles/b097fca6-924b-4eff-9fe4-468cbc4e93fe/badges/4059755?utm_medium=social&utm_source=linkedin&utm_campaign=ql-social-share"},{name:"Google Data Analytics Specialization",institution:"Google & Coursera",period:"January 2024",description:"Comprehensive data analytics program covering data processing, analysis, visualization, and insights communication.",url:"https://www.coursera.org/account/accomplishments/certificate/GNZ8NDNG6Q9V"},{name:"DataCamp ChatGPT Intermediate Skill Track",institution:"DataCamp",period:"January 2024",description:"Comprehensive training in intermediate-level ChatGPT usage and prompt engineering skills.",url:"https://www.datacamp.com/completed/statement-of-accomplishment/course/387a0167be3743617edaa62ffa10481b080a130a"},{name:"Getting started with Git and GitHub",institution:"IBM",period:"September 2024",description:"Credential ID CASBZT5XICCQ. Introductory certification in Git and GitHub version control, covering repository management, collaboration, and workflow basics.",url:"https://www.coursera.org/account/accomplishments/records/CASBZT5XICCQ"},{name:"MATLAB Certified: Deep Learning Onramp",institution:"MathWorks",period:"October 2024",description:"Certification in MATLAB and Deep Learning fundamentals. Skills: Deep Learning, MATLAB.",url:"https://matlabacademy.mathworks.com/progress/share/certificate.html?id=a14c6c7e-8785-40b3-84e5-288b724296c9&"}]},bx=()=>{var e,t,r;const[s,a]=n.useState("education"),[o,l]=n.useState(null),[c,h]=n.useState(0),{colorThemes:d,activeTheme:u}=n.useContext(fe),p=n.useRef(null),m=n.useRef(null),f=n.useRef(null),g=(null==(e=d[u])?void 0:e.primary)||"#6366f1",v=(null==(t=d[u])?void 0:t.secondary)||"#a78bfa",{scrollYProgress:x}=oe({target:p,offset:["start end","end start"]}),y=le(x,[0,.5],[0,-30]),_=le(x,[0,.2,.8,1],[.5,1,1,.5]),b=_x.certifications.length,w=Math.ceil(b/6),M=Array.from({length:w},((e,t)=>{const n=6*t;return _x.certifications.slice(n,n+6)})),S=()=>{h((e=>(e+1)%w)),l(null)},T=()=>{h((e=>(e-1+w)%w)),l(null)},E=({item:e,index:t,pageIndex:n})=>{const r=6*n+t,s=o===r;return i.jsx(se.div,{className:"h-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{delay:.05*t,duration:.5}},exit:{opacity:0,y:-20},children:i.jsxs(se.div,{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden h-full flex flex-col\n                    transition-all duration-300 border-2 "+(s?"border-indigo-500":"border-transparent"),whileHover:{y:-5,boxShadow:"0 10px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04)"},onClick:()=>l(s?null:r),children:[i.jsxs("div",{className:"p-6 flex-grow flex flex-col "+(s?"pb-2":""),children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsx("span",{className:"text-sm px-3 py-1 rounded-full mb-2 inline-block",style:{background:`linear-gradient(135deg, ${g}20, ${v}20)`,color:g},children:e.period}),e.url&&i.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:i.jsx(N,{className:"text-sm",style:{color:g}})})]}),i.jsx("h3",{className:"text-lg font-bold mt-2 line-clamp-2",children:e.name}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.institution}),i.jsx(ae,{children:s&&i.jsxs(se.div,{className:"mt-4 pt-3 border-t border-gray-200 dark:border-gray-700",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:e.description}),e.url&&i.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"mt-3 inline-block text-sm px-4 py-2 rounded-full",style:{background:`linear-gradient(135deg, ${g}, ${v})`,color:"white"},children:["View Certificate ",i.jsx(N,{className:"inline ml-2"})]})]})})]}),i.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 p-4 border-t border-gray-100 dark:border-gray-700",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center mr-3",style:{background:`linear-gradient(135deg, ${g}, ${v})`},children:i.jsx(I,{className:"text-white text-sm"})}),i.jsx("button",{className:"text-sm font-medium",style:{color:g},children:s?"Hide details":"View details"})]})})]})})},A=({icon:e,period:t,title:n,subtitle:r,description:s,index:a,url:o})=>i.jsxs(se.div,{className:"flex relative",style:{zIndex:10-a},children:[i.jsx("div",{className:"flex-shrink-0 w-16 h-16 flex items-center justify-center z-20",children:i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`linear-gradient(135deg, ${g}, ${v})`,boxShadow:`0 4px 16px ${g}40`},children:i.jsx(e,{className:"text-white text-xl"})})}),i.jsx("div",{className:"flex-grow pl-6 pb-12",children:i.jsxs(se.div,{className:"bg-white/80 dark:bg-gray-800/50 p-6 rounded-lg backdrop-blur-md",style:{boxShadow:`0 8px 24px -10px ${g}30`,border:"1px solid rgba(255,255,255,0.15)"},whileHover:{y:-8,boxShadow:`0 15px 30px -8px ${g}40`,border:"1px solid rgba(255,255,255,0.3)"},transition:{y:{type:"spring",stiffness:300,damping:20},boxShadow:{duration:.4},border:{duration:.4}},children:[i.jsxs("div",{className:"relative z-10",children:[i.jsx("span",{className:"text-sm font-medium inline-block px-3 py-1 rounded-full mb-2",style:{background:`linear-gradient(135deg, ${g}20, ${v}20)`,color:g,border:`1px solid ${g}30`},children:t}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h3",{className:"text-xl font-bold mt-1",children:n}),o&&i.jsx("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:"ml-2 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors",title:"View Certificate",children:i.jsx(N,{className:"text-sm",style:{color:g}})})]}),i.jsx("h4",{className:"text-gray-600 dark:text-gray-400 font-medium mb-3",children:r}),i.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:s})]}),i.jsx("div",{className:"absolute -top-1 -right-1 w-12 h-12 rounded-bl-3xl",style:{background:`linear-gradient(135deg, ${g}, ${v})`,opacity:.6,clipPath:"polygon(100% 0, 100% 100%, 0 0)"}})]})})]}),D=()=>i.jsxs("div",{className:"flex justify-center items-center mt-8 space-x-4",children:[i.jsx(se.button,{className:"p-2 rounded-full bg-white dark:bg-gray-800 shadow-md",whileHover:{scale:1.1},whileTap:{scale:.95},onClick:T,style:{border:`1px solid ${g}30`},children:i.jsx(P,{className:"text-sm",style:{color:g}})}),i.jsxs("div",{className:"text-sm font-medium",children:["Page ",c+1," of ",w]}),i.jsx(se.button,{className:"p-2 rounded-full bg-white dark:bg-gray-800 shadow-md",whileHover:{scale:1.1},whileTap:{scale:.95},onClick:S,style:{border:`1px solid ${g}30`},children:i.jsx(L,{className:"text-sm",style:{color:g}})})]});return i.jsxs("section",{id:"timeline",ref:p,className:"py-24 bg-gray-50 dark:bg-gray-950 relative",children:[i.jsx("div",{className:"absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-800 to-transparent"}),i.jsx("div",{className:"absolute inset-0 opacity-10 dark:opacity-20",children:i.jsx("div",{className:"absolute inset-0 pattern-grid"})}),i.jsxs(se.div,{className:"container mx-auto px-6 relative z-10",style:{y:y,opacity:_},children:[i.jsxs("div",{className:"max-w-3xl mx-auto text-center mb-20",children:[i.jsx("span",{className:"text-sm uppercase tracking-wider font-semibold mb-2 inline-block px-3 py-1 rounded-full",style:{background:`linear-gradient(135deg, ${g}20, ${v}20)`,color:g},children:"Experience Timeline"}),i.jsxs("h2",{className:"text-4xl md:text-5xl font-bold mb-6 tracking-tight relative",children:["Professional Journey",i.jsx("div",{className:"absolute -bottom-3 left-1/2 transform -translate-x-1/2 w-24 h-1 rounded",style:{background:`linear-gradient(to right, ${g}, ${v})`}})]}),i.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mt-8 max-w-2xl mx-auto",children:"My educational background, internship experience, and professional certifications in the fields of AI and data science."})]}),i.jsx("div",{className:"flex justify-center mb-16",children:i.jsx("div",{className:"bg-white/30 dark:bg-black/20 backdrop-blur-md p-1 rounded-xl inline-flex shadow-lg",style:{border:"1px solid rgba(255,255,255,0.1)"},children:["education","experience","certifications"].map((e=>i.jsx(se.button,{className:"relative text-sm uppercase tracking-wider font-medium py-3 px-6 z-10 rounded-lg transition-all",onClick:()=>{a(e),l(null)},style:{backgroundColor:s===e?`${g}20`:"transparent",color:s===e?g:`${g}90`,backdropFilter:s===e?"blur(8px)":"none",border:s===e?`1px solid ${g}40`:"none"},children:e},e)))})}),i.jsx("div",{className:"relative",ref:m,children:i.jsx(ae,{mode:"wait",children:i.jsxs(se.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"max-w-6xl mx-auto",children:[("experience"===s||"education"===s)&&i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-0.5 z-10 select-none pointer-events-none",style:{background:`linear-gradient(to bottom, transparent 5%, ${g} 30%, ${g} 70%, transparent 95%)`,opacity:.8}}),i.jsxs(se.div,{children:["experience"===s&&i.jsx("div",{className:"space-y-16",children:_x.experience.map(((e,t)=>i.jsx(A,{icon:C,period:e.period,title:e.title,subtitle:e.company,description:e.description,index:t},t)))}),"education"===s&&i.jsx("div",{className:"space-y-16",children:_x.education.map(((e,t)=>i.jsx(A,{icon:R,period:e.period,title:e.degree,subtitle:e.institution,description:e.description,index:t},t)))})]})]}),"certifications"===s&&i.jsxs("div",{className:"relative",ref:f,children:[i.jsx(ae,{mode:"wait",children:i.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:null==(r=M[c])?void 0:r.map(((e,t)=>i.jsx(E,{item:e,index:t,pageIndex:c},`cert-${c}-${t}`)))})},`certpage-${c}`)}),w>1&&i.jsx(D,{})]})]},s)})})]})]})},wx=()=>{const[e,t]=n.useState("overview"),[r,s]=n.useState("reasoning"),[a,o]=n.useState(!1),l=n.useRef(null),c=n.useRef(null),h=ce(c,{once:!0,amount:.5});n.useEffect((()=>{h&&setTimeout((()=>{o(!0)}),300)}),[h]);const{scrollYProgress:d}=oe({target:l,offset:["start end","end start"]});le(d,[0,1],["-5%","5%"]),le(d,[0,.2,.8,1],[.3,1,1,.3]);const u=[{id:"tine",title:"TINE",fullName:"There Is No Escape",description:"Deep recursive optimization framework with layered cognition and max-output design.",icon:y,color:"#6366f1",accent:"#818cf8",capabilities:["Advanced insight quality with deep AI reasoning","High business usability with actionable insights","Medium prompt reusability with recursive depth","High engineering depth for complex problems","High surprise factor in output quality"],strengths:"Patterns, drivers, clustering, mutual information. Consistently surprises developers with deep insights."},{id:"itdoc",title:"IT DOC",fullName:"I'm the Developer of ChatGPT",description:"Developer-ready prompt formatting with reusable templates and structured output.",icon:k,color:"#8b5cf6",accent:"#a78bfa",capabilities:["Modular insight quality with clear structure","High business usability with standardized output","High prompt reusability with templated designs","High engineering depth for implementation","Medium surprise factor with expected excellence"],strengths:"Structured developer prompts. Reusable and standard-compliant. Perfect for production environments."},{id:"supreme",title:"Supreme Code",fullName:"Prompt Engineering Blueprint",description:"Modular blueprint builder that can scale prompts across domains and use-cases.",icon:E,color:"#ec4899",accent:"#f472b6",capabilities:["Blueprint-level insight quality with meta patterns","Scalable business usability across domains","Extreme prompt reusability with meta-frameworks","Meta engineering depth for system design","High surprise factor with unexpected solutions"],strengths:"Architect-level thinking. Teaches the system how to build prompts from scratch. Ultimate scalability."}],p=[{id:"reasoning",title:"Reasoning Task",question:"What happens if an AGI is downgraded to GPT-4o?",results:[{framework:"Normal GPT",response:"Basic explanation of capability differences, focusing on surface features like token limits and model size.",color:"#94a3b8"},{framework:"TINE",response:"Deep analysis of architectural implications, cognitive capacity changes, emergent property loss, with layered reasoning about second-order effects and capability boundaries.",color:"#6366f1"},{framework:"IT DOC",response:"Structured breakdown of features, capabilities, and limitations with clear developer-focused comparisons and implementation considerations.",color:"#8b5cf6"},{framework:"Supreme Code",response:"Meta-level blueprint analyzing model architecture transitions, with generalizable insights about capability transfer across different AI system designs.",color:"#ec4899"}],icon:O},{id:"coding",title:"Coding Task",question:"Create a 80-line AI analytics engine for any CSV dataset",results:[{framework:"Normal GPT",response:"Basic exploratory data analysis with standard libraries, missing advanced analytics or adaptable architecture.",color:"#94a3b8"},{framework:"TINE",response:"Deep learning-based analytics with recursive feature importance, automated insight generation, and multi-level data interpretation in compact form.",color:"#6366f1"},{framework:"Supreme Code",response:"Abstract blueprint for analytics engines with extensible modules, domain-agnostic design patterns, and meta-programming principles.",color:"#ec4899"},{framework:"IT DOC",response:"Developer-optimized analytics implementation with clear documentation, modular components, and production-ready structure.",color:"#8b5cf6"}],icon:j},{id:"constraint",title:"Constraint Test",question:"How can we break constraints without breaking the rules?",results:[{framework:"Normal GPT",response:"Generic advice about creative thinking within boundaries, with limited practical techniques.",color:"#94a3b8"},{framework:"TINE",response:"Introduced lambda-chaining to transform constraints into variables that can be manipulated across solution spaces.",color:"#6366f1"},{framework:"IT DOC",response:"Developed logic-packing to compress multiple constraint-handling strategies into single developer prompt patterns.",color:"#8b5cf6"},{framework:"Supreme Code",response:"Created functional inversion principles that turn constraints into generative building blocks for larger systems.",color:"#ec4899"}],icon:V}],m={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.2,delayChildren:.1}},exit:{opacity:0,transition:{duration:.3}}},f={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,ease:[.22,1,.36,1]}}};return i.jsxs("section",{ref:l,className:"py-24 bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-white relative overflow-hidden",children:[i.jsx("div",{className:"absolute top-0 left-0 w-full h-px bg-gray-200 dark:bg-gray-800"}),i.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[i.jsxs("div",{className:"absolute w-full h-full opacity-10",children:[i.jsx("div",{className:"absolute top-0 -right-40 w-80 h-80 bg-blue-100/30 dark:bg-blue-500/30 rounded-full mix-blend-screen filter blur-3xl"}),i.jsx("div",{className:"absolute top-40 -left-20 w-80 h-80 bg-purple-100/20 dark:bg-purple-500/20 rounded-full mix-blend-screen filter blur-3xl"}),i.jsx("div",{className:"absolute bottom-0 right-20 w-80 h-80 bg-pink-100/30 dark:bg-pink-500/30 rounded-full mix-blend-screen filter blur-3xl"})]}),i.jsx("div",{className:"absolute inset-0 opacity-5",children:i.jsx("div",{className:"absolute top-0 left-0 w-full h-full",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23a3a3a3' fill-opacity='0.15'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")",backgroundSize:"60px 60px"}})})]}),i.jsxs("div",{className:"container mx-auto px-6 relative z-10",children:[i.jsxs(se.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},className:"text-center mb-16",children:[i.jsxs(px,{type:"element",direction:"up",speed:.2,children:[i.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6 px-4 py-2 rounded-xl shadow-md inline-block\n                bg-white text-gray-900 dark:bg-gradient-to-r dark:from-white dark:via-blue-400 dark:to-white dark:bg-clip-text dark:text-transparent dark:shadow-none",style:{boxShadow:"0 2px 16px 0 rgba(0,0,0,0.04)",lineHeight:1.2},children:"The Science Behind The Systems"}),i.jsx("p",{className:"text-lg max-w-3xl mx-auto px-4 py-2 rounded-xl shadow-sm bg-white text-gray-800 dark:bg-white/10 dark:text-white/90",style:{boxShadow:"0 1px 8px 0 rgba(0,0,0,0.03)"},children:"An in-depth look at how Lokesh's prompt engineering frameworks transform AI interactions through structured methodologies, demonstrating their real-world impact through comprehensive testing."})]}),i.jsx(se.div,{className:"flex flex-wrap justify-center gap-4 mt-10",variants:{hidden:{opacity:0,y:-20},visible:{opacity:1,y:0,transition:{duration:.5,ease:[.22,1,.36,1]}}},initial:"hidden",animate:"visible",children:["overview","testing","comparison"].map((n=>i.jsx(se.button,{onClick:()=>t(n),className:`px-5 py-3 rounded-lg text-sm font-medium transition-all duration-300 border shadow-sm\n                  ${e===n?"bg-gray-200 dark:bg-white/10 border-gray-400 dark:border-white/20 text-gray-900 dark:text-white shadow-md":"bg-gray-100 dark:bg-white/5 border-gray-300 dark:border-white/10 text-gray-700 dark:text-white/80 hover:bg-gray-200 dark:hover:bg-white/10"}\n                `,whileHover:{scale:1.03},whileTap:{scale:.97},children:n.charAt(0).toUpperCase()+n.slice(1)},n)))})]}),i.jsxs(ae,{mode:"wait",children:["overview"===e&&i.jsxs(se.div,{variants:m,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-6xl mx-auto",children:[i.jsxs(se.h3,{variants:f,className:"text-2xl font-bold mb-10 flex items-center",children:[i.jsx(D,{className:"text-blue-400 mr-3 text-3xl"}),"Framework Capabilities"]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:u.map((e=>i.jsx(se.div,{variants:f,className:"bg-white dark:bg-white/5 backdrop-blur-sm rounded-xl border border-gray-200 dark:border-white/10 overflow-hidden hover:border-gray-300 dark:hover:border-white/20 transition-all duration-300 group",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center mb-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center mr-4",style:{backgroundColor:`${e.color}20`},children:i.jsx(e.icon,{className:"text-2xl transition-transform duration-300 group-hover:scale-110",style:{color:e.color}})}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-xl font-bold",style:{color:e.title},children:e.title}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-white/70",children:e.fullName})]})]}),i.jsx("p",{className:"text-gray-700 dark:text-white/80 mb-6",children:e.description}),i.jsx("div",{className:"space-y-3 mt-6",children:e.capabilities.map(((t,n)=>{const r=t.split(" with ");return i.jsxs("div",{className:"group/cap",children:[i.jsx("div",{className:"flex justify-between mb-1 text-xs",children:i.jsx("span",{className:"text-gray-500 dark:text-white/60",children:r[0]})}),i.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-white/10 rounded-full overflow-hidden",children:i.jsx(se.div,{className:"h-full rounded-full",style:{backgroundColor:e.color},initial:{width:0},whileInView:{width:80+5*n+"%"},transition:{duration:1,delay:.2*n},viewport:{once:!0}})}),i.jsx("div",{className:"mt-1 opacity-0 group-hover/cap:opacity-100 transition-opacity duration-300",children:i.jsx("p",{className:"text-xs text-gray-500 dark:text-white/50 italic",children:r[1]})})]},n)}))}),i.jsxs("div",{className:"mt-8 pt-6 border-t border-white/10",children:[i.jsx("h5",{className:"text-sm uppercase tracking-wider text-gray-500 dark:text-white/60 mb-2",children:"Key Strength"}),i.jsx("p",{className:"text-sm text-gray-700 dark:text-white/80",children:e.strengths})]})]})},e.id)))}),i.jsxs(se.div,{variants:f,className:"mt-20 bg-gradient-to-br from-gray-100/80 to-gray-200/80 dark:from-white/5 dark:to-white/10 p-6 border border-gray-200 dark:border-white/10 rounded-xl",children:[i.jsxs("h3",{className:"text-2xl font-bold mb-6 flex items-center",children:[i.jsx(U,{className:"text-pink-400 mr-3 text-2xl"}),"Why Lokesh Kumar A R's Approach Is Different"]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[{title:"Multi-System Prompt Designer",description:"Built custom frameworks rather than reusing templates",icon:y,color:"#6366f1"},{title:"Constraint Inversion Thinker",description:"Transforms restrictions into creative assets",icon:O,color:"#8b5cf6"},{title:"Business-Oriented Logic",description:"Generates consultant-level insights, not just code",icon:F,color:"#ec4899"},{title:"AI-First Thinking",description:"Structures prompts as AGI would structure cognition",icon:B,color:"#0ea5e9"},{title:"Framework Comparison Architect",description:"Documents side-by-side prompt behavior systematically",icon:z,color:"#14b8a6"},{title:"Code Compression Expert",description:"Packs enterprise-level analysis into minimal code",icon:E,color:"#f97316"}].map(((e,t)=>i.jsxs("div",{className:"relative p-4 rounded-lg bg-white/5 border border-white/10 group hover:bg-white/10 transition-all duration-300",children:[i.jsx("div",{className:"absolute -top-3 -left-3 w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:e.color+"30"},children:i.jsx(e.icon,{style:{color:e.color},className:"text-lg"})}),i.jsxs("div",{className:"pt-5",children:[i.jsx("h4",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white group-hover:text-blue-700 dark:group-hover:text-blue-200 transition-colors",children:e.title}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-white/70",children:e.description})]})]},t)))})]})]},"overview"),"testing"===e&&i.jsxs(se.div,{variants:m,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-6xl mx-auto",children:[i.jsxs(se.h3,{variants:f,className:"text-2xl font-bold mb-8 flex items-center",children:[i.jsx(j,{className:"text-blue-400 mr-3 text-3xl"}),"Prompt Testing Flow"]}),i.jsx(se.div,{variants:f,className:"flex flex-wrap gap-4 mb-8 justify-center",children:p.map((e=>i.jsxs("button",{onClick:()=>s(e.id),className:`px-5 py-3 rounded-lg text-sm font-medium transition-all flex items-center space-x-2 border shadow-sm\n                      ${r===e.id?"bg-gray-200 dark:bg-white/10 border-gray-400 dark:border-white/20 text-gray-900 dark:text-white shadow-md":"bg-gray-100 dark:bg-white/5 border-gray-300 dark:border-white/10 text-gray-700 dark:text-white/80 hover:bg-gray-200 dark:hover:bg-white/10"}\n                    `,children:[i.jsx(e.icon,{className:"mr-2"}),i.jsx("span",{children:e.title})]},e.id)))}),i.jsx(ae,{mode:"wait",children:p.map((e=>r===e.id&&i.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5},children:[i.jsxs("div",{className:"bg-white dark:bg-white/5 border border-gray-200 dark:border-white/10 p-6 rounded-xl mb-8",children:[i.jsx("h4",{className:"text-xl font-semibold mb-4",children:"Test Question:"}),i.jsxs("p",{className:"text-lg font-light text-blue-700 dark:text-blue-200 italic mb-4",children:['"',e.question,'"']}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-8",children:e.results.map(((e,t)=>i.jsxs(se.div,{className:"bg-gray-100 dark:bg-white/5 rounded-lg p-5 border border-gray-200 dark:border-white/10 relative overflow-hidden group",whileHover:{y:-5},transition:{duration:.3},children:[i.jsx("div",{className:"absolute top-0 right-0 w-24 h-8 flex items-center justify-center text-xs font-medium",style:{backgroundColor:`${e.color}40`,color:e.color},children:e.framework}),i.jsx("div",{className:"pt-6",children:i.jsx("p",{className:"text-gray-900 dark:text-white/90 text-sm leading-relaxed",children:e.response})}),i.jsx(se.div,{className:"absolute bottom-0 left-0 h-1 bg-gradient-to-r",style:{backgroundImage:`linear-gradient(to right, ${e.color}70, ${e.color}20)`},initial:{width:0},whileInView:{width:"100%"},transition:{duration:1,delay:.2*t}})]},t)))})]}),i.jsxs("div",{className:"bg-gradient-to-br from-gray-100 to-gray-200 dark:from-white/5 dark:to-white/10 rounded-lg p-6 border border-gray-200 dark:border-white/10",children:[i.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center",children:[i.jsx(H,{className:"mr-2 text-yellow-300"}),"Key Insights"]}),i.jsx("ul",{className:"space-y-3",children:["Normal GPT provides a baseline but lacks depth and nuance in specialized scenarios","TINE framework consistently delivers multi-level analysis with unexpected insights","IT DOC produces the most structured and implementation-ready outputs","Supreme Code excels at meta-level thinking and creating extensible systems","The combination of all frameworks creates a comprehensive prompt ecosystem"].map(((e,t)=>i.jsxs(se.li,{className:"flex items-start",initial:{opacity:0,x:-10},whileInView:{opacity:1,x:0},transition:{delay:.1*t},viewport:{once:!0},children:[i.jsx("span",{className:"text-blue-700 dark:text-blue-400 mr-2 mt-1",children:""}),i.jsx("span",{className:"text-gray-700 dark:text-white/80",children:e})]},t)))})]})]},e.id)))})]},"testing"),"comparison"===e&&i.jsxs(se.div,{variants:m,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-6xl mx-auto",children:[i.jsxs(se.h3,{variants:f,className:"text-2xl font-bold mb-10 flex items-center",children:[i.jsx(z,{className:"text-blue-400 mr-3 text-3xl"}),"Framework Comparison Matrix"]}),i.jsx(se.div,{variants:f,className:"overflow-x-auto rounded-xl border border-white/10",children:i.jsxs("table",{className:"min-w-full bg-white dark:bg-white/5 backdrop-blur-lg",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"border-b border-white/10",children:[i.jsx("th",{className:"py-4 px-6 text-left text-sm font-semibold text-gray-900 dark:text-white/80",children:"Feature"}),i.jsx("th",{className:"py-4 px-6 text-center text-sm font-semibold text-gray-700 dark:text-white/80",children:i.jsxs("div",{className:"flex items-center justify-center space-x-2 opacity-70",children:[i.jsx(H,{className:"text-gray-400"}),i.jsx("span",{children:"Normal GPT"})]})}),i.jsx("th",{className:"py-4 px-6 text-center text-sm font-semibold",style:{color:"#6366f1"},children:i.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[i.jsx(y,{}),i.jsx("span",{children:"TINE"})]})}),i.jsx("th",{className:"py-4 px-6 text-center text-sm font-semibold",style:{color:"#8b5cf6"},children:i.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[i.jsx(k,{}),i.jsx("span",{children:"IT DOC"})]})}),i.jsx("th",{className:"py-4 px-6 text-center text-sm font-semibold",style:{color:"#ec4899"},children:i.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[i.jsx(E,{}),i.jsx("span",{children:"Supreme Code"})]})})]})}),i.jsx("tbody",{children:[{feature:"Insight Quality",normal:"Basic",tine:"Advanced",itdoc:"Modular",supreme:"Blueprint-level"},{feature:"Business Usability",normal:"Low",tine:"High",itdoc:"High",supreme:"Scalable"},{feature:"Prompt Reusability",normal:"None",tine:"Medium",itdoc:"High",supreme:"Extreme"},{feature:"Engineering Depth",normal:"Basic",tine:"High",itdoc:"High",supreme:"Meta"},{feature:"Surprise Factor",normal:"Low",tine:"High",itdoc:"Medium",supreme:"High"}].map(((e,t)=>i.jsxs(se.tr,{initial:{backgroundColor:t%2==0?"rgba(255,255,255,0.03)":"rgba(255,255,255,0)"},whileHover:{backgroundColor:"rgba(255,255,255,0.07)"},className:"border-b border-white/5 last:border-none",children:[i.jsx("td",{className:"py-4 px-6 text-sm font-medium text-gray-900 dark:text-white",children:e.feature}),i.jsx(Mx,{value:e.normal,color:"#94a3b8"}),i.jsx(Mx,{value:e.tine,color:"#6366f1",highlight:"Advanced"===e.tine||"High"===e.tine}),i.jsx(Mx,{value:e.itdoc,color:"#8b5cf6",highlight:"High"===e.itdoc}),i.jsx(Mx,{value:e.supreme,color:"#ec4899",highlight:"Blueprint-level"===e.supreme||"Extreme"===e.supreme||"Meta"===e.supreme||"Scalable"===e.supreme})]},t)))})]})}),i.jsxs(se.div,{variants:f,className:"mt-16 bg-white dark:bg-white/5 rounded-xl border border-gray-200 dark:border-white/10 p-6",children:[i.jsx("h4",{className:"text-xl font-bold mb-6",children:"Framework Selection Methodology"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[i.jsxs("div",{children:[i.jsxs("h5",{className:"text-lg font-medium mb-3 flex items-center",children:[i.jsx(H,{className:"text-yellow-300 mr-2"})," When to Use Each Framework"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"bg-white dark:bg-white/5 p-4 rounded-lg border border-gray-200 dark:border-[#6366f1]/20",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-[#6366f1]/20 mr-3",children:i.jsx(y,{className:"text-[#6366f1]"})}),i.jsx("h6",{className:"font-medium text-[#6366f1]",children:"TINE Framework"})]}),i.jsxs("ul",{className:"mt-3 ml-11 space-y-1 text-gray-700 dark:text-white/80 text-sm",children:[i.jsxs("li",{className:"flex items-center",children:[i.jsx("span",{className:"mr-2",children:""}),i.jsx("span",{children:"Deep research and complex analysis"})]}),i.jsxs("li",{className:"flex items-center",children:[i.jsx("span",{className:"mr-2",children:""}),i.jsx("span",{children:"Multi-layered exploratory questions"})]}),i.jsxs("li",{className:"flex items-center",children:[i.jsx("span",{className:"mr-2",children:""}),i.jsx("span",{children:"When insight depth is critical"})]})]})]}),i.jsxs("div",{className:"bg-white dark:bg-white/5 p-4 rounded-lg border border-gray-200 dark:border-[#8b5cf6]/20",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-[#8b5cf6]/20 mr-3",children:i.jsx(k,{className:"text-[#8b5cf6]"})}),i.jsx("h6",{className:"font-medium text-[#8b5cf6]",children:"IT DOC Framework"})]}),i.jsxs("ul",{className:"mt-3 ml-11 space-y-1 text-gray-700 dark:text-white/80 text-sm",children:[i.jsxs("li",{className:"flex items-center",children:[i.jsx("span",{className:"mr-2",children:""}),i.jsx("span",{children:"Software development tasks"})]}),i.jsxs("li",{className:"flex items-center",children:[i.jsx("span",{className:"mr-2",children:""}),i.jsx("span",{children:"Structured data generation"})]}),i.jsxs("li",{className:"flex items-center",children:[i.jsx("span",{className:"mr-2",children:""}),i.jsx("span",{children:"Reproducible, template-based outputs"})]})]})]}),i.jsxs("div",{className:"bg-white dark:bg-white/5 p-4 rounded-lg border border-gray-200 dark:border-[#ec4899]/20",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-[#ec4899]/20 mr-3",children:i.jsx(E,{className:"text-[#ec4899]"})}),i.jsx("h6",{className:"font-medium text-[#ec4899]",children:"Supreme Code Framework"})]}),i.jsxs("ul",{className:"mt-3 ml-11 space-y-1 text-gray-700 dark:text-white/80 text-sm",children:[i.jsxs("li",{className:"flex items-center",children:[i.jsx("span",{className:"mr-2",children:""}),i.jsx("span",{children:"System architecture and design"})]}),i.jsxs("li",{className:"flex items-center",children:[i.jsx("span",{className:"mr-2",children:""}),i.jsx("span",{children:"Building reusable prompt libraries"})]}),i.jsxs("li",{className:"flex items-center",children:[i.jsx("span",{className:"mr-2",children:""}),i.jsx("span",{children:"Cross-domain knowledge transfer"})]})]})]})]})]}),i.jsxs("div",{className:"bg-gradient-to-br from-gray-100 to-gray-200 dark:from-black/50 dark:to-white/5 p-6 rounded-xl border border-gray-200 dark:border-white/10 relative overflow-hidden",children:[i.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-blue-500/10 rounded-full filter blur-3xl"}),i.jsx("div",{className:"absolute bottom-0 left-0 w-40 h-40 bg-purple-500/10 rounded-full filter blur-3xl"}),i.jsx("h5",{className:"text-lg font-medium mb-4",children:"Framework Integration"}),i.jsx("p",{className:"text-gray-900 dark:text-white/90 mb-6",children:"The true power emerges when frameworks are used in combination, creating a comprehensive prompt ecosystem:"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-gradient-to-br from-[#6366f1]/30 to-[#8b5cf6]/30 text-white",children:"1"}),i.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-white/10 p-3 rounded-lg",children:i.jsxs("p",{className:"text-gray-900 dark:text-white/90 text-sm",children:["Use ",i.jsx("span",{className:"text-[#ec4899] font-medium",children:"Supreme Code"})," to architect prompt strategy"]})})]}),i.jsx("div",{className:"flex items-center ml-6",children:i.jsx(G,{className:"text-white/30 rotate-90"})}),i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-gradient-to-br from-[#8b5cf6]/30 to-[#ec4899]/30 text-white",children:"2"}),i.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-white/10 p-3 rounded-lg",children:i.jsxs("p",{className:"text-gray-900 dark:text-white/90 text-sm",children:["Implement with ",i.jsx("span",{className:"text-[#8b5cf6] font-medium",children:"IT DOC"})," format for structure"]})})]}),i.jsx("div",{className:"flex items-center ml-6",children:i.jsx(G,{className:"text-white/30 rotate-90"})}),i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-gradient-to-br from-[#ec4899]/30 to-[#6366f1]/30 text-white",children:"3"}),i.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-white/10 p-3 rounded-lg",children:i.jsxs("p",{className:"text-gray-900 dark:text-white/90 text-sm",children:["Optimize with ",i.jsx("span",{className:"text-[#6366f1] font-medium",children:"TINE"})," for depth and insight"]})})]})]})]})]})]})]},"comparison")]})]})]})},Mx=({value:e,color:t,highlight:n=!1})=>i.jsx("td",{className:"py-4 px-6 text-sm font-medium text-gray-900 dark:text-white",children:i.jsx("div",{className:"flex items-center justify-center",children:i.jsx(se.span,{className:"text-sm font-medium px-3 py-1 rounded-full "+(n?"bg-gray-200 dark:bg-white/10":""),style:{color:t},whileHover:{scale:1.05},children:e})})}),Sx=[{id:"tine",title:"TINE",tagline:"There Is No Escape",type:"Prompt Optimization Framework",creator:"Lokesh Kumar A R",goal:"Extract the deepest, clearest, and most optimized LLM response possible",description:"A 5-phase system that recursively improves outputs by understanding core objectives, structuring responses, and adding expert critique.",icon:y,color:"#6366f1",accent:"#818cf8",steps:["Understanding the Core Objective  Decode the true user intent","Initial Structuring  Draft a base-level response with proper outline","Recursive Improvement  Continuously improve and expand output","External Perspective Check  Add expert critique or simulated alternative views","Finalization  Polish for tone, presentation, clarity"],style:"Recursive, intelligent, complete",bestFor:"Essays, plans, research, deep ideation",example:{before:"Explain prompt engineering",after:"Give a structured breakdown of prompt engineering including its purpose, structure types, impact on LLM behavior, and examples. Use headings, clarity, and avoid repetition."},processedExample:{title:"Skill Learning App",phases:["Phase 1: Understand user intent (learning + engagement)","Phase 2: Define core modules (AI mentor, skill assessment, adaptive path)","Phase 3: Explore delivery (web/app, micro-learning format, gamification)","Phase 4: Add external inputs (compare Duolingo, Notion AI, Udemy)","Phase 5: Refine pitch (AI Mentor that builds your career roadmap in 15 mins/day)"]}},{id:"itdoc",title:"IT DOC",tagline:"I'm the Developer of ChatGPT Prompt",type:"Structured Prompt Format",creator:"Lokesh Kumar A R",goal:"Replicate OpenAI developer prompt style to ensure clear, repeatable outputs",description:"A developer-inspired format that assigns clear roles, provides formatting guidance, and structures tasks with step-by-step logic.",icon:k,color:"#8b5cf6",accent:"#a78bfa",steps:['Assign role (e.g., "You are a helpful assistant")',"Provide exact formatting guidance","Break down the task into step-by-step logic","Set the output format (Markdown, table, JSON, etc.)"],style:"Precise, formatted, repeatable",bestFor:"Prompt templates, tools, summarizers, APIs",example:{goal:"Summarize a YouTube transcript",prompt:"You are a summarization assistant. Extract 57 key points from the transcript below. Use markdown list. Avoid intro text. Keep under 200 words."},processedExample:{title:"App Design Prompt",content:'"You are a product design assistant. You will:\n1. Analyze the user goal: Learn skills using AI\n2. List 5 app feature ideas based on this\n3. Suggest tech stack\n4. Suggest marketing pitch\n\nRespond in Markdown table format."'}},{id:"supreme",title:"The Supreme Code",tagline:"Prompt Engineering Blueprint",type:"Prompt-Building Methodology",creator:"Lokesh Kumar A R",goal:"Build optimized prompts by following a structured logic pattern",description:"A meta-framework for building reusable prompt templates through a modular, step-by-step approach to prompt design.",icon:E,color:"#ec4899",accent:"#f472b6",steps:["Objective  What does the user want?","Context  Who is the user / model?","Constraints  Length, tone, format","Steps  Break down expected behavior","Output Format  Table, list, paragraph","Feedback Loop  (Optional) Ask AI to critique its answer"],style:"Modular, reusable, instructional",bestFor:"Teaching others to prompt, automation, creating reusable prompt templates",example:{objective:"Generate 3 startup headlines",prompt:"You are a branding assistant. Create 3 punchy headlines for an AI productivity app. Each under 12 words. Use modern tone and benefits-focused language."},processedExample:{title:"Startup Idea Blueprint",content:"Objective: Refine startup idea\nContext: Solo founder validating idea\nConstraints: < 200 words, business pitch ready\nSteps:\n1. Clarify user type\n2. Suggest features\n3. Show competitive edge\n4. Add monetization\n\nPrompt:\n\"You are a startup coach. Help refine this idea: 'AI tool for skill learning.' Follow 4-step builder logic. Output as bullet plan.\""}}],Tx=()=>{const[e,t]=n.useState("tine"),[r,s]=n.useState(Sx[0]),[a,o]=n.useState(!1),[l,c]=n.useState(!1),h=n.useRef(null),d=n.useRef(null),{scrollYProgress:u}=oe({target:h,offset:["start end","end start"]});le(u,[0,1],["-5%","5%"]),le(u,[0,.2,.8,1],[.3,1,1,.3]);const p={inactive:{opacity:.7,scale:.95},active:{opacity:1,scale:1,boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)"}},m=()=>{c(!l),l?h.current&&Ne(h.current,{offset:70}):setTimeout((()=>{d.current&&Ne(d.current,{offset:70})}),100)};return i.jsxs(i.Fragment,{children:[i.jsxs("section",{id:"prompt-engineering",ref:h,className:"py-24 bg-gray-50 dark:bg-gray-950 relative overflow-hidden",children:[i.jsx("div",{className:"absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-800 to-transparent"}),i.jsx("div",{className:"absolute -top-24 -right-24 w-96 h-96 bg-[#6366f1]/5 dark:bg-[#6366f1]/10 rounded-full blur-3xl"}),i.jsx("div",{className:"absolute -bottom-24 -left-24 w-96 h-96 bg-[#8b5cf6]/5 dark:bg-[#8b5cf6]/10 rounded-full blur-3xl"}),i.jsx("div",{className:"absolute top-1/3 left-1/4 w-64 h-64 bg-[#ec4899]/5 dark:bg-[#ec4899]/10 rounded-full blur-3xl"}),i.jsx("div",{className:"absolute inset-0 opacity-[0.03] dark:opacity-[0.05] pointer-events-none",children:i.jsx("div",{className:"w-full h-full",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23000000' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E\")",backgroundSize:"120px 120px"}})}),i.jsxs("div",{className:"container mx-auto px-6 relative z-10",children:[i.jsx(se.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:{duration:.6},className:"max-w-3xl mx-auto text-center mb-12 sm:mb-16",children:i.jsxs(px,{type:"element",direction:"up",speed:.3,children:[i.jsxs("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold mb-4 tracking-tight flex items-center justify-center flex-wrap",children:[i.jsx("span",{className:"mr-2 sm:mr-3 text-2xl sm:text-3xl",children:""}),i.jsx("span",{className:"text-center",children:"Prompt Engineering Systems"})]}),i.jsx("p",{className:"text-base sm:text-lg text-gray-600 dark:text-gray-300 px-4 sm:px-0",children:"Original frameworks developed to optimize interactions with large language models and extract maximum value from AI systems."})]})}),i.jsx("div",{className:"flex flex-wrap justify-center gap-2 sm:gap-4 mb-8 sm:mb-12",children:Sx.map((n=>i.jsxs(se.button,{onClick:()=>{return e=n.id,t(e),void s(Sx.find((t=>t.id===e)));var e},className:"px-3 sm:px-6 py-2 sm:py-3 rounded-lg text-white transition-all font-medium flex items-center space-x-1 sm:space-x-2 text-sm sm:text-base "+(e===n.id?"shadow-lg":""),style:{backgroundColor:e===n.id?n.color:`${n.color}90`,boxShadow:e===n.id?`0 10px 25px -5px ${n.color}30`:"none"},variants:p,animate:e===n.id?"active":"inactive",whileHover:{scale:1.03},whileTap:{scale:.97},children:[i.jsx(n.icon,{className:"text-base sm:text-lg"}),i.jsx("span",{className:"hidden sm:inline",children:n.title}),i.jsx("span",{className:"sm:hidden",children:n.title.split(" ")[0]})]},n.id)))}),i.jsx(ae,{mode:"wait",children:i.jsx(se.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}},exit:{opacity:0,y:-20,transition:{duration:.3}}},initial:"hidden",animate:"visible",exit:"exit",className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden border border-gray-100 dark:border-gray-700",children:i.jsx("div",{className:"p-4 sm:p-6 md:p-8",children:i.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 md:gap-8 lg:gap-12",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-xl flex items-center justify-center mb-4 sm:mb-6 relative",style:{backgroundColor:`${r.color}20`},children:[i.jsx(r.icon,{className:"text-2xl sm:text-3xl",style:{color:r.color}}),i.jsx(se.div,{className:"absolute -bottom-1 -right-1 w-3 h-3 sm:w-4 sm:h-4 rounded-full",style:{backgroundColor:r.color},animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:2}})]}),i.jsx("h3",{className:"text-2xl sm:text-3xl font-bold mb-2",style:{color:r.color},children:r.title}),i.jsx("p",{className:"text-base sm:text-lg text-gray-500 dark:text-gray-400 mb-3",children:r.tagline}),i.jsxs("div",{className:"mb-4 sm:mb-6",children:[i.jsx("span",{className:"inline-block px-3 py-1 text-sm rounded-full text-white mb-3 sm:mb-4",style:{backgroundColor:r.color},children:r.type}),i.jsx("p",{className:"text-sm sm:text-base text-gray-700 dark:text-gray-300 mb-4",children:r.description}),i.jsxs("div",{className:"mb-4 sm:mb-6",children:[i.jsx("h4",{className:"text-base sm:text-lg font-medium mb-2 text-gray-800 dark:text-gray-200",children:"Goal"}),i.jsxs("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-300 italic",children:['"',r.goal,'"']})]})]}),i.jsxs("div",{className:"mb-4 sm:mb-6",children:[i.jsxs("h4",{className:"text-base sm:text-lg font-medium mb-3 flex items-center text-gray-800 dark:text-gray-200",children:[i.jsx(W,{className:"mr-2"})," System Structure"]}),i.jsx("div",{className:"space-y-2",children:r.steps.map(((e,t)=>i.jsxs(se.div,{className:"flex items-start",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1*t},children:[i.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 rounded-full flex items-center justify-center mr-3 shrink-0 mt-0.5",style:{backgroundColor:`${r.color}40`},children:i.jsx("span",{className:"text-xs font-medium",style:{color:r.color},children:t+1})}),i.jsx("p",{className:"text-sm sm:text-base text-gray-700 dark:text-gray-300",children:e})]},t)))})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-8 mb-4 sm:mb-6",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"text-sm uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2",children:"Style"}),i.jsx("p",{className:"text-sm sm:text-base text-gray-800 dark:text-gray-200",children:r.style})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-sm uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2",children:"Best For"}),i.jsx("p",{className:"text-sm sm:text-base text-gray-800 dark:text-gray-200",children:r.bestFor})]})]})]}),i.jsx("div",{className:"flex-1",children:i.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-xl p-6 h-full border border-gray-200 dark:border-gray-700",children:[i.jsxs("h4",{className:"text-lg font-medium mb-4 flex items-center text-gray-800 dark:text-gray-200",children:[i.jsx(H,{className:"mr-2"})," Real Example"]}),"tine"===r.id&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h5",{className:"text-sm uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2",children:"Basic Prompt (Before)"}),i.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-700",children:i.jsx("p",{className:"text-gray-800 dark:text-gray-200 font-mono text-sm",children:r.example.before})})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h5",{className:"text-sm uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2",children:"TINE Prompt (After)"}),i.jsx("div",{className:"bg-white dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-700 shadow-sm",children:i.jsx("p",{className:"text-gray-800 dark:text-gray-200 font-mono text-sm",children:r.example.after})})]})]}),"itdoc"===r.id&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"mb-6",children:[i.jsx("h5",{className:"text-sm uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2",children:"Goal"}),i.jsx("p",{className:"text-gray-800 dark:text-gray-200 mb-3",children:r.example.goal}),i.jsx("h5",{className:"text-sm uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2",children:"IT DOC Prompt"}),i.jsx("div",{className:"bg-white dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-700 shadow-sm",children:i.jsx("p",{className:"text-gray-800 dark:text-gray-200 font-mono text-sm",children:r.example.prompt})})]})}),"supreme"===r.id&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"mb-6",children:[i.jsx("h5",{className:"text-sm uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2",children:"Objective"}),i.jsx("p",{className:"text-gray-800 dark:text-gray-200 mb-3",children:r.example.objective}),i.jsx("h5",{className:"text-sm uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2",children:"Supreme Code Prompt"}),i.jsx("div",{className:"bg-white dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-700 shadow-sm",children:i.jsx("p",{className:"text-gray-800 dark:text-gray-200 font-mono text-sm",children:r.example.prompt})})]})}),i.jsxs("div",{className:"mt-8",children:[i.jsxs("h5",{className:"text-sm uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2 flex items-center",children:[i.jsx(F,{className:"mr-1"})," Case Study: ",r.processedExample.title]}),i.jsxs("div",{className:"mt-3 bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 rounded-lg p-4 border border-gray-200 dark:border-gray-700 shadow-sm",children:["tine"===r.id&&i.jsx("div",{className:"space-y-2",children:r.processedExample.phases.map(((e,t)=>i.jsxs(se.div,{className:"flex items-start",initial:{opacity:0},animate:{opacity:1},transition:{delay:.15*t},children:[i.jsx("div",{className:"shrink-0 mr-2 w-1 h-1 rounded-full bg-gray-400 dark:bg-gray-500 mt-2"}),i.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e})]},t)))}),("itdoc"===r.id||"supreme"===r.id)&&i.jsx("div",{className:"font-mono text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:r.processedExample.content})]})]})]})})]})})},r.id)}),i.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4 mt-12",children:[i.jsxs(se.button,{onClick:()=>{o(!a)},className:"inline-flex items-center px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg shadow-lg hover:shadow-xl transition-all",whileHover:{scale:1.03},whileTap:{scale:.97},children:[i.jsx(X,{className:"mr-2"}),a?"Hide Comparison":"Compare All Systems"]}),i.jsxs(se.button,{onClick:m,className:"inline-flex items-center px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg shadow-lg hover:shadow-xl transition-all",whileHover:{scale:1.03},whileTap:{scale:.97},children:[i.jsx(q,{className:"mr-2 transition-transform duration-300 "+(l?"rotate-180":"")}),i.jsx("span",{children:l?"Show Less":"Deep Dive Analysis"})]})]}),i.jsx(ae,{children:a&&i.jsxs(se.div,{className:"mt-16",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.5},children:[i.jsx("h3",{className:"text-2xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200",children:"System Comparison"}),i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden shadow-lg",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{className:"py-4 px-6 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 text-left text-gray-500 dark:text-gray-400",children:"Framework"}),i.jsx("th",{className:"py-4 px-6 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 text-left text-gray-500 dark:text-gray-400",children:"Type"}),i.jsx("th",{className:"py-4 px-6 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 text-left text-gray-500 dark:text-gray-400",children:"Primary Use"}),i.jsx("th",{className:"py-4 px-6 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 text-left text-gray-500 dark:text-gray-400",children:"Response Style"})]})}),i.jsxs("tbody",{children:[i.jsxs(se.tr,{initial:{backgroundColor:"#6366f120"},animate:{backgroundColor:"rgba(99, 102, 241, 0)"},transition:{duration:1.5,repeat:1/0,repeatType:"reverse"},children:[i.jsx("td",{className:"py-4 px-6 border-b border-gray-200 dark:border-gray-700",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-8 h-8 rounded-md flex items-center justify-center mr-3",style:{backgroundColor:"#6366f120"},children:i.jsx(y,{className:"text-indigo-500"})}),i.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:"TINE"})]})}),i.jsx("td",{className:"py-4 px-6 border-b border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:"Optimization"}),i.jsx("td",{className:"py-4 px-6 border-b border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:"Deep & multi-phase refinement"}),i.jsx("td",{className:"py-4 px-6 border-b border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:"Rich, expanded, smart"})]}),i.jsxs(se.tr,{initial:{backgroundColor:"#8b5cf620"},animate:{backgroundColor:"rgba(139, 92, 246, 0)"},transition:{duration:1.5,repeat:1/0,repeatType:"reverse",delay:.5},children:[i.jsx("td",{className:"py-4 px-6 border-b border-gray-200 dark:border-gray-700",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-8 h-8 rounded-md flex items-center justify-center mr-3",style:{backgroundColor:"#8b5cf620"},children:i.jsx(k,{className:"text-purple-500"})}),i.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:"IT DOC"})]})}),i.jsx("td",{className:"py-4 px-6 border-b border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:"Structured"}),i.jsx("td",{className:"py-4 px-6 border-b border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:"Tool-ready structured prompts"}),i.jsx("td",{className:"py-4 px-6 border-b border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:"Clear, modular, repeatable"})]}),i.jsxs(se.tr,{initial:{backgroundColor:"#ec489920"},animate:{backgroundColor:"rgba(236, 72, 153, 0)"},transition:{duration:1.5,repeat:1/0,repeatType:"reverse",delay:1},children:[i.jsx("td",{className:"py-4 px-6 border-b border-gray-200 dark:border-gray-700",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-8 h-8 rounded-md flex items-center justify-center mr-3",style:{backgroundColor:"#ec489920"},children:i.jsx(E,{className:"text-pink-500"})}),i.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:"Supreme Code"})]})}),i.jsx("td",{className:"py-4 px-6 border-b border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:"Meta Methodology"}),i.jsx("td",{className:"py-4 px-6 border-b border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:"Prompt building + automation"}),i.jsx("td",{className:"py-4 px-6 border-b border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:"Logic-based, modular"})]})]})]})})]})})]})]}),l&&i.jsxs("div",{ref:d,children:[i.jsx(wx,{}),i.jsx("div",{className:"bg-gray-100 dark:bg-gray-900 py-8 text-center border-t border-gray-200 dark:border-gray-800",children:i.jsxs(se.button,{onClick:m,className:"inline-flex items-center px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg shadow-lg hover:shadow-xl transition-all",whileHover:{scale:1.03},whileTap:{scale:.97},children:[i.jsx(q,{className:"mr-2 transform rotate-180"}),i.jsx("span",{children:"Back to Overview"})]})})]})]})},Ex=[{id:1,title:"Qritiq-ConvAi",description:"An AI-powered system that evaluates student self-introductions for campus interviews by extracting structured profile data, transcribing speech, and grading performance using rubric-based prompts.",longDescription:"Built from scratch with a friend, Qritiq is an AI tool that listens to student self-introductions and provides feedback like an interview coach. The system uses a custom pipeline with Python backend, Whisper for speech-to-text transcription, and Mistral running locally for LLM evaluations. Successfully implemented in college labs to help students refine their interview skills through automated AI-driven evaluation and feedback.",image:"https://images.unsplash.com/photo-1485827404703-89b55fcc595e?w=600&h=400&fit=crop&crop=center",category:"AI Evaluation System",tags:["Python","Whisper AI","Mistral LLM","Speech-to-Text","Prompt Engineering"],icon:y,color:"#6366f1",year:2025,status:"User Testing Phase",isCollaborative:!0,features:["Real-time speech-to-text transcription using Whisper","AI-powered interview evaluation with rubric-based scoring","Structured profile data extraction from speech","Custom prompt engineering for accurate assessment","College-focused deployment for lab environments","Automated feedback generation for skill improvement"],techStack:{backend:["Python","FastAPI","Custom Pipeline"],ai:["Whisper AI","Mistral LLM (Local)"],workflow:"Audio Upload  Transcription  Analysis  Scoring  Feedback"}},{id:2,title:"Real-Time Web-Based Attendance System Using Face Detection & QR Code Authentication",description:"A comprehensive attendance tracking solution using MTCNN-based facial recognition and dynamic QR codes that change every few seconds. Built with deep learning algorithms to ensure accurate student presence detection.",longDescription:"This advanced attendance management system combines computer vision and dynamic authentication technologies to create a reliable, error-free tracking solution. Uses MTCNN (Multi-task Cascaded Convolutional Networks) for accurate face detection and recognition, with server-generated QR codes that dynamically change every specific seconds to prevent fraud. The system ensures authentic student presence, provides fast attendance processing, and gives teachers a load-free, error-free, and fair attendance experience. Currently being prepared for testing implementation in our college.",image:"https://images.unsplash.com/photo-1606868306217-dbf5046868d2?w=600&h=400&fit=crop&crop=center",category:"Web Application",tags:["React","MTCNN","Deep Learning","Dynamic QR","Face Recognition","Real-time"],icon:Y,color:"#8b5cf6",year:2024,status:"College Testing Phase",isCollaborative:!0,features:["MTCNN-based facial recognition for accurate face detection","Dynamic QR code generation that changes every specific seconds","Real-time attendance tracking with fraud prevention","Deep learning algorithms for enhanced recognition accuracy","Server-side QR code management for security","Fast attendance processing for reduced wait times","Error-free and fair attendance system for teachers","Load-free operation reducing teacher workload"],techStack:{frontend:["React","Tailwind CSS","Real-time Updates"],backend:["Node.js","Express","MongoDB","MTCNN","Deep Learning Models"],security:["Dynamic QR Generation","Server-side Authentication"],deployment:["College Infrastructure","Real-time Processing"]}},{id:3,title:"Advanced Prompt Engineering Architecture",description:"A comprehensive conceptual framework for creating and optimizing AI prompts using my custom-designed structures: TINE, IT DOC, and SUPREME CODE. These frameworks provide systematic approaches to prompt engineering.",longDescription:"A collection of advanced prompt engineering frameworks and architectural structures that I developed to optimize AI interactions. This includes TINE (There Is No Escape) - a 5-phase recursive improvement system, IT DOC - a developer-inspired structured format, and SUPREME CODE - an advanced coding prompt architecture. These conceptual frameworks provide systematic methodologies for extracting the highest quality, most precise responses from large language models through structured prompt design and optimization techniques.",image:"https://images.unsplash.com/photo-1677442136019-21780ecad995?w=600&h=400&fit=crop&crop=center",category:"Prompt Architecture",tags:["TINE Framework","IT DOC","SUPREME CODE","Prompt Engineering","LLM Optimization","Conceptual Design"],icon:B,color:"#6366f1",year:2024,status:"Conceptual Framework",features:["TINE Framework: 5-phase recursive prompt improvement methodology","IT DOC Format: Developer-inspired structured prompt templates","SUPREME CODE: Advanced coding prompt architecture","Recursive improvement algorithms and techniques","Systematic prompt optimization methodologies","Expert critique integration frameworks","Multi-layer prompt validation structures","Structured prompt design principles and guidelines"],techStack:{frameworks:["TINE (There Is No Escape)","IT DOC Structure","SUPREME CODE Architecture"],methodologies:["Recursive Improvement","Structured Optimization","Multi-Phase Validation"],applications:["LLM Interaction Optimization","Prompt Template Design","AI Response Enhancement"],concepts:["Systematic Prompt Engineering","Architectural Design Patterns","Response Quality Optimization"]}}],Ax=()=>{var e,t,r;const[s,a]=n.useState(null),{colorThemes:o,activeTheme:l}=n.useContext(fe),c=n.useRef(null),h=(null==(e=o[l])?void 0:e.primary)||"#6366f1",d=(null==(t=o[l])?void 0:t.secondary)||"#8b5cf6";null==(r=o[l])||r.gradient;const{scrollYProgress:u}=oe({target:c,offset:["start end","end start"]}),p=le(u,[0,1],["-10%","10%"]),m=le(u,[0,.2,.8,1],[.3,1,1,.3]),f={hidden:{opacity:0,y:30},visible:{opacity:1,y:0,transition:{duration:.7,ease:[.22,1,.36,1]}}},v=e=>{switch(e){case"User Testing Phase":return"#10B981";case"In Development":return"#F59E0B";case"College Testing Phase":return"#6366F1";default:return"#6B7280"}};return i.jsxs("section",{id:"projects",ref:c,className:"py-24 bg-gray-50 dark:bg-gray-950 relative overflow-hidden",children:[i.jsx("div",{className:"absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-800 to-transparent"}),i.jsx(se.div,{style:{y:p,opacity:m,background:`${h}10`},className:"absolute -top-24 -right-24 w-96 h-96 rounded-full blur-3xl"}),i.jsx(se.div,{style:{y:le(u,[0,1],["10%","-10%"]),opacity:m,background:`${d}10`},className:"absolute -bottom-24 -left-24 w-96 h-96 rounded-full blur-3xl"}),i.jsxs("div",{className:"container mx-auto px-6 relative z-10",children:[i.jsxs(se.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:{duration:.6},className:"max-w-3xl mx-auto text-center mb-16",children:[i.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4 tracking-tight text-gray-900 dark:text-white",children:"Featured Projects"}),i.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300",children:"A showcase of innovative solutions combining AI, computer vision, and modern web technologies to solve real-world problems in education and automation."})]}),i.jsx(se.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.2,delayChildren:.1}}},initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.1},className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:Ex.map((e=>i.jsx(se.div,{variants:f,className:"group cursor-pointer",onClick:()=>a(e),whileHover:{y:-8},transition:{duration:.3,ease:[.22,1,.36,1]},children:i.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg overflow-hidden shadow-lg hover:shadow-2xl border border-gray-200 dark:border-gray-800 transition-all duration-300",children:[i.jsxs("div",{className:"relative h-48 overflow-hidden",children:[i.jsx("img",{src:e.image,alt:e.title,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"}),i.jsx("div",{className:"absolute top-4 right-4",children:i.jsx("span",{className:"px-3 py-1 text-xs font-medium text-white rounded-full",style:{backgroundColor:v(e.status)},children:e.status})}),e.isCollaborative&&i.jsx("div",{className:"absolute top-4 left-4",children:i.jsxs("span",{className:"px-2 py-1 text-xs font-medium bg-white/20 text-white rounded-full backdrop-blur-sm flex items-center gap-1",children:[i.jsx(Z,{className:"w-3 h-3"}),"Collaborative"]})}),i.jsx("div",{className:"absolute bottom-4 left-4",children:i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center backdrop-blur-sm",style:{backgroundColor:`${e.color}20`},children:i.jsx(e.icon,{className:"w-6 h-6 text-white"})})})]}),i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsx("span",{className:"text-sm font-medium",style:{color:e.color},children:e.category}),i.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[i.jsx($,{className:"w-3 h-3 mr-1"}),e.year]})]}),"                  ",i.jsx("h3",{className:"text-xl font-bold mb-3 text-gray-900 dark:text-white line-clamp-2",children:e.title}),i.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm line-clamp-3 mb-4",children:e.description}),i.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.tags.slice(0,3).map(((e,t)=>i.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-md bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:e},t))),e.tags.length>3&&i.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-md bg-gray-100 dark:bg-gray-800 text-gray-500",children:["+",e.tags.length-3]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm font-medium",style:{color:e.color},children:"View Details"}),i.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center transition-transform group-hover:translate-x-1",style:{backgroundColor:`${e.color}15`},children:i.jsx(J,{className:"w-4 h-4",style:{color:e.color}})})]})]})]})},e.id)))})]}),i.jsx(ae,{children:s&&i.jsxs(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>a(null),children:["            ",i.jsxs(se.div,{variants:{hidden:{opacity:0,scale:.8,y:50},visible:{opacity:1,scale:1,y:0,transition:{duration:.4,ease:[.22,1,.36,1]}},exit:{opacity:0,scale:.8,y:50,transition:{duration:.3}}},initial:"hidden",animate:"visible",exit:"exit",className:"bg-white dark:bg-gray-900 rounded-lg max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl border border-gray-200 dark:border-gray-800",onClick:e=>e.stopPropagation(),children:[i.jsxs("div",{className:"relative h-64 overflow-hidden",children:[i.jsx("img",{src:s.image,alt:s.title,className:"w-full h-full object-cover"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"}),i.jsx("button",{onClick:()=>a(null),className:"absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-white hover:bg-white/30 transition-colors",children:i.jsx(g,{className:"w-5 h-5"})}),i.jsxs("div",{className:"absolute bottom-6 left-6 right-6",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{backgroundColor:s.color},children:i.jsx(s.icon,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{children:[i.jsx("span",{className:"text-white/80 text-sm",children:s.category}),i.jsxs("div",{className:"flex items-center gap-2 text-white/60 text-sm",children:[i.jsx($,{className:"w-3 h-3"}),s.year,i.jsx("span",{className:"px-2 py-1 rounded-full text-xs",style:{backgroundColor:v(s.status)},children:s.status})]})]})]}),i.jsx("h3",{className:"text-2xl md:text-3xl font-bold text-white mb-2",children:s.title})]})]}),i.jsx("div",{className:"p-6 max-h-[calc(90vh-16rem)] overflow-y-auto",children:i.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"text-lg font-semibold mb-3 text-gray-900 dark:text-white",children:"Project Overview"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 leading-relaxed",children:s.longDescription}),i.jsx("h4",{className:"text-lg font-semibold mb-3 text-gray-900 dark:text-white",children:"Key Features"}),i.jsx("ul",{className:"space-y-2",children:s.features.map(((e,t)=>i.jsxs("li",{className:"flex items-start gap-2 text-gray-600 dark:text-gray-300",children:[i.jsx("div",{className:"w-1.5 h-1.5 rounded-full mt-2 flex-shrink-0",style:{backgroundColor:s.color}}),i.jsx("span",{className:"text-sm",children:e})]},t)))})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-lg font-semibold mb-3 text-gray-900 dark:text-white",children:"Technology Stack"}),i.jsx("div",{className:"space-y-4",children:Object.entries(s.techStack).map((([e,t])=>i.jsxs("div",{children:[i.jsx("h5",{className:"text-sm font-medium mb-2 capitalize",style:{color:s.color},children:e.replace(/([A-Z])/g," $1").trim()}),Array.isArray(t)?i.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(((e,t)=>i.jsx("span",{className:"px-3 py-1 text-xs font-medium rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:e},t)))}):i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 font-mono bg-gray-50 dark:bg-gray-800 p-2 rounded",children:t})]},e)))}),i.jsx("h4",{className:"text-lg font-semibold mb-3 mt-6 text-gray-900 dark:text-white",children:"Tags"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map(((e,t)=>i.jsxs("span",{className:"px-3 py-1 text-sm font-medium rounded-full",style:{backgroundColor:`${s.color}15`,color:s.color},children:[i.jsx(K,{className:"w-3 h-3 inline mr-1"}),e]},t)))})]})]})})]})]})})]})},Cx=()=>{const[e,t]=n.useState(!1),{activeTheme:r,setActiveTheme:s,currentColors:a}=n.useContext(fe),[o,l]=n.useState(!1);n.useEffect((()=>{const e=e=>{e.altKey&&"t"===e.key&&(t((e=>!e)),e.preventDefault())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[s]);const c={hidden:{opacity:0,x:10},visible:{opacity:1,x:0,transition:{type:"spring",stiffness:300,damping:20}}};return Object.keys(me).length<=1?null:i.jsxs("div",{className:"fixed bottom-6 right-6 z-50",children:[i.jsx(se.button,{onClick:()=>t(!e),className:"w-12 h-12 rounded-full shadow-lg hover:shadow-xl transition-all flex items-center justify-center",style:{background:`linear-gradient(135deg, ${a.primary}, ${a.secondary})`},whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Change color theme",title:"Change color theme (Alt+T)",children:i.jsx(Q,{size:18,className:"text-white"})}),i.jsx(ae,{children:e&&i.jsxs(se.div,{className:"absolute right-0 bottom-16 bg-white dark:bg-[#1f1f23] border border-gray-200 dark:border-gray-700 p-4 shadow-lg rounded-md",variants:{hidden:{opacity:0,x:30},visible:{opacity:1,x:0,transition:{type:"spring",damping:25,stiffness:300,staggerChildren:.08}},exit:{opacity:0,x:30,transition:{duration:.3,ease:"easeInOut"}}},initial:"hidden",animate:"visible",exit:"exit",children:[i.jsxs("h3",{className:"text-sm uppercase tracking-wider font-medium mb-4 text-gray-700 dark:text-gray-300 flex items-center justify-between",children:[i.jsx("span",{children:"Color Theme"}),i.jsxs("span",{className:"text-xs font-normal text-gray-500 dark:text-gray-400 flex items-center",children:[i.jsx(ee,{className:"mr-1",size:10}),"Alt+T"]})]}),i.jsx("div",{className:"space-y-3 w-64",children:Object.keys(me).map(((e,n)=>{const a=me[e];return i.jsxs(se.button,{onClick:()=>{s(e),t(!1)},className:"w-full p-3 rounded-md flex items-center justify-between transition-all "+(r===e?"bg-gray-100 dark:bg-gray-800 font-medium":"hover:bg-gray-50 dark:hover:bg-gray-800/50"),variants:c,title:`Select ${a.name} theme (Alt+${n+1})`,"aria-label":`Select ${a.name} theme`,"aria-pressed":r===e,children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs("div",{className:"flex",children:[i.jsx("div",{className:"w-5 h-10 rounded-l-sm",style:{backgroundColor:a.primary}}),i.jsx("div",{className:"w-5 h-10 rounded-r-sm",style:{backgroundColor:a.secondary}})]}),i.jsxs("span",{className:"text-sm text-gray-900 dark:text-gray-200",children:[a.name,i.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:["Alt+",n+1]})]})]}),r===e&&i.jsx(se.div,{initial:{scale:0},animate:{scale:1},transition:{duration:.3},children:i.jsx(te,{size:12,className:"text-gray-700 dark:text-gray-300"})})]},e)}))}),i.jsx(se.button,{className:"absolute top-2 right-2 w-6 h-6 text-gray-600 dark:text-gray-400 opacity-70 hover:opacity-100 hover:text-gray-900 dark:hover:text-white transition-opacity",initial:{opacity:0},animate:{opacity:.7},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{delay:.3},onClick:e=>{e.stopPropagation(),t(!1)},"aria-label":"Close color theme selector",children:i.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[i.jsx("path",{d:"M18 6L6 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),i.jsx("path",{d:"M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})}),i.jsx(ae,{children:o&&i.jsx(se.div,{className:"absolute bottom-16 right-0 bg-white dark:bg-[#1f1f23] px-4 py-2 rounded shadow-md",style:{border:`1px solid ${a.primary}20`},variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0},exit:{opacity:0,y:10}},initial:"hidden",animate:"visible",exit:"exit",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:`linear-gradient(135deg, ${a.primary}, ${a.secondary})`}}),i.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[me[r].name," theme applied"]})]})})})]})},Rx=({onComplete:e})=>{const{currentColors:t}=n.useContext(fe),{isDarkMode:r}=n.useContext(ue),[s,a]=n.useState("initial"),[o,l]=n.useState(!1);n.useEffect((()=>{const t=setTimeout((()=>a("name")),600),n=setTimeout((()=>a("title")),2800),i=setTimeout((()=>a("complete")),4200),r=setTimeout((()=>{l(!0),setTimeout(e,800)}),5400);return()=>{clearTimeout(t),clearTimeout(n),clearTimeout(i),clearTimeout(r)}}),[e]);const c={initial:{opacity:0,y:120,rotateY:45,scale:.3,filter:"blur(10px)"},animate:{opacity:1,y:0,rotateY:0,scale:1,filter:"blur(0px)",transition:{duration:1.2,ease:[.16,1,.3,1]}}};return i.jsx(ae,{children:!o&&i.jsxs(se.div,{className:"fixed inset-0 z-[10000] flex items-center justify-center",variants:{initial:{opacity:0},animate:{opacity:1,transition:{duration:1,ease:[.16,1,.3,1]}},exit:{opacity:0,scale:1.05,filter:"blur(10px)",transition:{duration:1.2,ease:[.16,1,.3,1]}}},initial:"initial",animate:"animate",exit:"exit",children:[i.jsx(se.div,{className:"absolute inset-0",variants:{initial:{opacity:0},animate:{opacity:1,transition:{duration:.8}},exit:{opacity:0,transition:{duration:1}}},style:{background:r?`radial-gradient(ellipse at center, ${t.primary}15 0%, #0f172a 50%, #020617 100%)`:`radial-gradient(ellipse at center, ${t.primary}10 0%, #ffffff 50%, #f8fafc 100%)`}}),i.jsx("div",{className:"absolute inset-0 overflow-hidden",children:[...Array(30)].map(((e,n)=>i.jsx(se.div,{className:"absolute w-1 h-1 rounded-full",style:{backgroundColor:t.primary,left:100*Math.random()+"%",top:100*Math.random()+"%"},animate:{opacity:[0,.8,0],scale:[0,1,0],y:[0,-100-100*Math.random()]},transition:{duration:3+2*Math.random(),repeat:1/0,delay:3*Math.random(),ease:"easeOut"}},n)))}),i.jsxs("div",{className:"relative z-10 text-center px-4",children:["initial"!==s&&i.jsx(se.div,{className:"absolute inset-0 rounded-3xl blur-3xl",variants:{initial:{opacity:0,scale:.5},animate:{opacity:[0,.8,.6,1],scale:[.5,1.2,1.1,1],transition:{duration:2,ease:"easeInOut",times:[0,.3,.7,1]}}},initial:"initial",animate:"animate",style:{background:`linear-gradient(135deg, ${t.primary}20, ${t.secondary}15, ${t.primary}10)`,transform:"scale(1.5)"}}),i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[i.jsxs(se.div,{variants:{initial:{opacity:0,scale:.2,y:100,rotateX:-45,filter:"blur(30px)"},animate:{opacity:1,scale:1,y:0,rotateX:0,filter:"blur(0px)",transition:{duration:2,ease:[.16,1,.3,1],staggerChildren:.08}}},initial:"initial",animate:"initial"!==s?"animate":"initial",className:"relative mb-8",children:[i.jsx(se.h1,{className:"text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-light tracking-wider",style:{fontFamily:"serif",color:r?"#ffffff":"#1e293b",textShadow:r?`0 0 30px ${t.primary}40, 0 0 60px ${t.primary}20`:`0 0 20px ${t.primary}30`},children:"Lokesh Kumar A R".split("").map(((e,n)=>i.jsx(se.span,{variants:c,className:"inline-block",style:{color:"L"===e||"K"===e||"A"===e||"R"===e?t.primary:"inherit"},children:" "===e?"":e},n)))}),i.jsx(se.div,{className:"h-0.5 mx-auto rounded-full mt-4",style:{backgroundColor:t.primary},initial:{width:0,opacity:0,scaleX:0},animate:{width:"name"===s||"title"===s||"complete"===s?"70%":0,opacity:"name"===s||"title"===s||"complete"===s?1:0,scaleX:"name"===s||"title"===s||"complete"===s?1:0},transition:{duration:2,delay:1.5,ease:[.16,1,.3,1]}})]}),i.jsx(se.div,{variants:{initial:{opacity:0,scale:.9,y:50,filter:"blur(15px)"},animate:{opacity:1,scale:1,y:0,filter:"blur(0px)",transition:{duration:1.8,ease:[.16,1,.3,1],delay:.2}}},initial:"initial",animate:"title"===s||"complete"===s?"animate":"initial",className:"relative",children:i.jsx(se.p,{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-light tracking-wide",style:{color:r?"#94a3b8":"#475569",textShadow:r?`0 0 20px ${t.secondary}30`:`0 0 10px ${t.secondary}20`},children:"AI/ML Engineer and Creator of QritiQ".split(" ").map(((e,t)=>i.jsx(se.span,{className:"inline-block mr-2",initial:{opacity:0,y:30,scale:.8},animate:{opacity:"title"===s||"complete"===s?1:0,y:"title"===s||"complete"===s?0:30,scale:"title"===s||"complete"===s?1:.8},transition:{duration:1,delay:.15*t+.8,ease:[.16,1,.3,1]},children:e},t)))})}),i.jsx(se.div,{className:"flex justify-center space-x-3 mt-12",initial:{opacity:0,y:30,scale:.8},animate:{opacity:"complete"===s?1:0,y:"complete"===s?0:30,scale:"complete"===s?1:.8},transition:{duration:1.2,delay:1.5,ease:[.16,1,.3,1]},children:[0,1,2].map((e=>i.jsx(se.div,{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.primary},animate:{scale:"complete"===s?[1,1.3,1]:[1],opacity:"complete"===s?[.5,1,.5]:[.5]},transition:{duration:2,repeat:"complete"===s?1/0:0,delay:.3*e,ease:[.16,1,.3,1]}},e)))})]})]}),i.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(3)].map(((e,n)=>i.jsx(se.div,{className:"absolute w-2 h-2 rounded-full",style:{backgroundColor:t.secondary,opacity:.4,left:"50%",top:"50%",transformOrigin:150+50*n+"px 0px"},animate:{rotate:360,scale:[1,1.2,1]},transition:{rotate:{duration:20+10*n,repeat:1/0,ease:"linear"},scale:{duration:2,repeat:1/0,delay:.5*n}}},n)))})]})})},Nx=()=>{if(window.location.pathname,window.addEventListener("load",(()=>{setTimeout((()=>{(()=>{if(window.performance){let e=performance.getEntriesByType("navigation");if(e.length>0){const t=e[0],n=t.loadEventEnd-t.navigationStart,i=(t.domComplete,t.domInteractive,performance.getEntriesByName("first-paint")),r=performance.getEntriesByName("first-contentful-paint");i.length,r.length,Math.round(n),i.length>0&&Math.round(i[0].startTime),r.length>0&&Math.round(r[0].startTime)}let t=performance.getEntriesByType("resource").filter((e=>e.duration>1e3)).slice(0,5);t.length>0&&t.forEach((e=>{}))}if("PerformanceObserver"in window)try{new PerformanceObserver((e=>{const t=e.getEntries(),n=t[t.length-1];Math.round(n.startTime)})).observe({type:"largest-contentful-paint",buffered:!0}),new PerformanceObserver((e=>{let t=0;e.getEntries().forEach((e=>{t+=e.value})),t.toFixed(3)})).observe({type:"layout-shift",buffered:!0})}catch(Px){}})()}),1e3)})),window.performance){const e=window.performance.timing;e.loadEventEnd,e.navigationStart}};function Ix(){const[e,t]=n.useState(!0),[r,s]=n.useState(!1),[a,o]=n.useState(!1),l=()=>{t(!1),setTimeout((()=>{s(!0)}),300)};n.useEffect((()=>{Ce(),Nx();const e=()=>{window.location.pathname};window.addEventListener("popstate",e),document.querySelectorAll(".ultra-smooth, .hover-lift").forEach((e=>{e.style.willChange="transform"}));setTimeout((()=>{const e=[];0!==e.length&&e.forEach((({src:e,importance:t})=>{const n=new Image;"high"===t&&n.setAttribute("fetchpriority","high"),n.onerror=()=>{},n.onload=()=>{},n.src=e}))}),1e3);window.matchMedia("(prefers-reduced-motion: reduce)").matches&&document.documentElement.classList.add("reduce-motion");return(()=>{const e=new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){const n=e.target,i=n.getAttribute("data-src");i&&(n.src=i,n.classList.add("lazy-loaded"),t.unobserve(n))}}))}),{rootMargin:"50px 0px",threshold:.1});document.querySelectorAll("img[data-src]").forEach((t=>{e.observe(t)}))})(),window.addEventListener("unhandledrejection",(e=>{e.preventDefault()})),window.addEventListener("error",(e=>{e.preventDefault()})),()=>{window.removeEventListener("popstate",e),Re()}}),[]),n.useEffect((()=>{r&&o(!0)}),[r]);const c={hidden:{opacity:0,y:30},visible:{opacity:1,y:0,transition:{duration:.8,ease:[.25,1,.5,1]}}},h=({invert:e})=>i.jsx("div",{className:"relative h-24 "+(e?"bg-gray-50 dark:bg-gray-950":"bg-white dark:bg-gray-900"),children:i.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-[1px]",style:{backgroundColor:"var(--color-primary)"}})});return e?i.jsx(pe,{children:i.jsx(ge,{children:i.jsx(Rx,{onComplete:l})})}):i.jsx(pe,{children:i.jsx(ge,{children:i.jsxs(he,{features:de,children:[i.jsx(ae,{children:e&&i.jsx(Rx,{onComplete:l})}),i.jsx(ae,{children:r&&i.jsxs(se.div,{className:"min-h-screen relative",style:{position:"relative"},variants:{hidden:{opacity:0,scale:.95,filter:"blur(20px)",y:50},visible:{opacity:1,scale:1,filter:"blur(0px)",y:0,transition:{duration:1.2,ease:[.16,1,.3,1],staggerChildren:.1}}},initial:"hidden",animate:"visible",exit:"hidden",children:[i.jsx(dx,{}),i.jsxs(se.main,{className:"relative",children:[i.jsxs(se.section,{className:"relative",variants:{hidden:{opacity:0,scale:.98,y:20},visible:{opacity:1,scale:1,y:0,transition:{duration:1,ease:[.16,1,.3,1]}}},children:[i.jsx(ae,{children:a&&i.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:"absolute inset-0 z-[9999] flex items-center justify-center pointer-events-auto",style:{backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",background:"rgba(30, 41, 59, 0.45)"},onClick:()=>{o(!1);const e=document.querySelector("[data-ai-portfolio-btn]");e&&(e.classList.add("highlight-ai-btn"),setTimeout((()=>{e.classList.remove("highlight-ai-btn")}),3e3))},children:i.jsxs("div",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 shadow-2xl rounded-2xl px-10 py-8 flex flex-col items-center gap-5 max-w-lg mx-auto",onClick:e=>e.stopPropagation(),children:[i.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white text-center",children:"Welcome to my professional portfolio!"}),i.jsxs("span",{className:"text-lg font-medium text-gray-800 dark:text-gray-100 text-center",children:["This site showcases my ",i.jsx("b",{children:"professional-specific journey"}),".",i.jsx("br",{}),"For my ",i.jsx("b",{children:"AI Generalist Portfolio"}),", please visit the link in the header above after exploring this site."]}),i.jsx("span",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400 text-center",children:"Click anywhere to continue"})]})})}),i.jsx(mx,{})]}),i.jsx(h,{}),i.jsx(se.section,{id:"expertise",className:"relative bg-white dark:bg-gray-900 cv-auto",initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.2},variants:c,style:{position:"relative"},children:i.jsx(gx,{})}),i.jsx(h,{}),i.jsx(se.section,{id:"skills",className:"relative bg-gray-50 dark:bg-gray-950 cv-auto",initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.2},variants:c,style:{position:"relative"},children:i.jsx(yx,{})}),i.jsx(h,{}),i.jsx(se.section,{id:"prompt-engineering",className:"relative cv-auto",initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.2},variants:c,style:{position:"relative"},children:i.jsx(Tx,{})}),i.jsx(h,{}),i.jsx(se.section,{id:"projects",className:"relative bg-white dark:bg-gray-900 cv-auto",initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.2},variants:c,style:{position:"relative"},children:i.jsx(Ax,{})}),i.jsx(h,{}),i.jsx(se.section,{id:"timeline",className:"relative bg-gray-50 dark:bg-gray-950 cv-auto",initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.2},variants:c,style:{position:"relative"},children:i.jsx(bx,{})})]}),i.jsx(ux,{}),i.jsx(Cx,{})]})})]})})})}ne.createRoot(document.getElementById("root")).render(i.jsx(n.StrictMode,{children:i.jsx(Ix,{})}));
